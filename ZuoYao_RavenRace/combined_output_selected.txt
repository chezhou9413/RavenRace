=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\LoadFolders.xml
=

<?xml version="1.0" encoding="utf-8"?>
<loadFolders>
    <v1.6>
        <li>/</li>
        <li>1.6</li>
        <li IfModActive="Nals.FacialAnimation">RavenRaceFA</li>
        <li IfModActive="rim.job.world,rjw.menstruation">RJWCompat</li>
    </v1.6>
</loadFolders>

=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\About\About.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<ModMetaData>
    <name>Raven Race - Embers in Shadow</name>
    <author>ZuoYao</author>
    <packageId>ZuoYao.RavenRace</packageId>
    <supportedVersions>
        <li>1.6</li>
    </supportedVersions>
    <description>
渡鸦族 · 暗影中的余烬

一个全面的种族模组，包含渡鸦族及其金乌飞升系统。

特性：
- 独特的渡鸦族种族，拥有翅膀和特殊能力
- 血脉系统：追踪并遗传金乌血脉浓度
- 育生祭坛：孵化灵卵并影响后代特性
- 扶桑组织：神秘的支援网络
- 间谍系统：渗透、暗杀、颠覆
- 主线任务：揭开金乌一族的秘密
- 独特装备：暗羽钢和日冕合金制品

现在还处在早期测试版本，如果你在渡鸦群（518495086）之外看到了这个，那就是哪个思乐牧的东西把我还没做完的包给发出来了。
请注意，这个模组还在开发中，可能会有不稳定或不完整的地方，仅供小范围测试使用，并不代表完整体验。

建议把渡鸦放在所有的外星人种族后面排序！

以下名字排名不分先后：
主体绿皮代码：我自己
动态表情支持与代码修改：追踪虫 （感谢虫佬给我的俺寻思代码的指正，指导和修改，可以说没有他就没有渡鸦族，忠！诚！）
SA支持：生物大师
画师：冰皮汤圆（人物和服饰）、荟冰/懒鱼（建筑和武器）、一口黑莓酒（叙事者）、奈亚（待定的封面图）、无常梨（渡鸦曲裾）
贴图微调：和泉，KV4_EX（感谢两位对我贴图的细心调整和指导！）
特殊角色支持：KV4_EX（锁妈的服装，技能等各种贴图）
文案：生物大师，我自己

鸣谢：
感谢米莉拉帝国作者艾蕾德尔以及米莉拉民主之翼作者Oversleeping关于黑衣人事件替换，及特殊角色管理器的代码参考和各种帮助！
感谢外星人动态表情作者塔洛斯的动态表情教学与协助！
感谢联合重工作者PSIONIC海豹的护墙器，渡鸦墙体与地板的贴图支持与帮助！
感谢萌螈作者八云的贴符代码参考！
感谢萌螈僵尸拓展作者村民的FA补丁代码参考！
感谢防御工事系列作者青葉的代码参考！
感谢边缘战争空岛作者叶小羊的mod制作教学与工具支持！
感谢雪牛娘作者三项全能柊舞缇娜！的代码指导与帮助！
感谢沃芬作者瓜鸽提供的狼球贴图！
感谢泰临族作者Esuro_埃苏罗的三件常用武器的贴图支持与帮助！
感谢绮罗、米莉拉作者ancot（大肉包体型），以及萌螈作者易青（小笼包体型）的优秀种族人物模型参考！
感谢烟烬族作者小面包的许可和代码参考！
感谢A.K.的种族背景文本支持！
感谢地鼠模组的电台设计参考！

感谢天狼公爵丫制作的视频宣传！
感谢山地久保田制作的视频提及渡鸦！
感谢여우，夜寻喵和只会偷吃的厨师喵对我早期模组的宣传与鼓励！
感谢堂丸、海龙喵对我发布贴图和代码委托的协助！
感谢色孽风气造福渡鸦青年提供的渡鸦常识库！
感谢和泉和KV4_EX对我服饰缩放调整问题的帮助！
感谢厨神米夏的铸币大头表情包！
感谢Milch.（烧奶老师）的表情包和贴贴稿件！
感谢糖与卡蒂亚和我一起约的贴贴头像！
感谢呜呜绮梦在喵喵咪咪屯养着我的爻爻猫！
感谢STM企鹅军阀目前帮我摸的渡鸦futa小男娘！


感谢所有在测试群里陪伴我的，提供反馈和建议的朋友们！


    </description>
    <modDependencies>
        <li>
            <packageId>erdelf.HumanoidAlienRaces</packageId>
            <displayName>Humanoid Alien Races</displayName>
            <steamWorkshopUrl>steam://url/CommunityFilePage/839005762</steamWorkshopUrl>
        </li>
        <li>
            <packageId>Chezhou.ChezhouLib.lib</packageId>
            <displayName>ChezhouLib</displayName>
            <steamWorkshopUrl>https://steamcommunity.com/sharedfiles/filedetails/?id=3595247479</steamWorkshopUrl>
        </li>
    </modDependencies>
    <loadAfter>
        <li>Ludeon.RimWorld</li>
        <li>Ludeon.RimWorld.Royalty</li>
        <li>Ludeon.RimWorld.Ideology</li>
        <li>Ludeon.RimWorld.Biotech</li>
        <li>Ludeon.RimWorld.Anomaly</li>
        <li>erdelf.HumanoidAlienRaces</li>
        <li>Chezhou.ChezhouLib.lib</li>        <!-- 必要的前置库 -->
        <!-- Phase 3.6 兼容项 -->
        <li>Ancot.Milira</li>        <!-- 米莉拉 -->
        <li>Milira.Independent.Pathing</li>        <!-- 天羽族真实飞行补丁 -->
        <li>Moe.MoeLotl</li>        <!-- 萌螈 -->
        <li>Koelime.Race</li>        <!-- 珂莉姆 -->

    </loadAfter>
    <incompatibleWith />
</ModMetaData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Apparel\Raven\Casual\Apparel_Raven_Casual.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="ApparelMakeableBase">
    <defName>Raven_Apparel_Casual</defName>
    <label>渡鸦常服</label>
    <description>一套渡鸦族风格的日常便装，设计简洁，便于活动。虽然防御力平平，但剪裁贴合身形，适合在殖民地内进行各种日常工作。</description>
    <graphicData>
      <texPath>Items/Apparel/Raven/Casual/RavenCasual_Female_south</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    
    <costList>
      <Cloth>40</Cloth>
    </costList>
    
    <thingCategories>
      <li>Apparel</li>
    </thingCategories>
    
    <statBases>
      <MaxHitPoints>100</MaxHitPoints>
      <WorkToMake>1600</WorkToMake>
      <Mass>0.3</Mass>
      <StuffEffectMultiplierArmor>0.2</StuffEffectMultiplierArmor>
      <StuffEffectMultiplierInsulation_Cold>0.22</StuffEffectMultiplierInsulation_Cold>
      <StuffEffectMultiplierInsulation_Heat>0.10</StuffEffectMultiplierInsulation_Heat>
      <EquipDelay>1.5</EquipDelay>
    </statBases>
    
    <apparel>
      <bodyPartGroups>
        <li>Torso</li>
        <li>Legs</li>
      </bodyPartGroups>
      <wornGraphicPath>Items/Apparel/Raven/Casual/RavenCasual</wornGraphicPath>
      <layers>
        <li>OnSkin</li>
      </layers>
      <tags>
        <li>IndustrialBasic</li>
        <li>RavenApparel</li>
      </tags>
      <defaultOutfitTags>
        <li>Worker</li>
        <li>Soldier</li>
      </defaultOutfitTags>
    </apparel>
    
    <recipeMaker>
      <researchPrerequisite>RavenResearch_Tailoring</researchPrerequisite>
      <recipeUsers>
        <li>Raven_Building_SewingBench</li>
      </recipeUsers>
    </recipeMaker>


  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Apparel\Raven\Qipao\Apparel_Raven_Qipao.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 中式旗袍奶盖 ==================== -->
  <ThingDef ParentName="ApparelMakeableBase">
    <!-- 定义名称，用于内部引用 -->
    <defName>Raven_Apparel_Qipao</defName>
    <!-- 游戏内显示的名称 -->
    <label>中式旗袍奶盖</label>
    <!-- 游戏内显示的描述 -->
    <description>一件融合了古典旗袍与现代设计的优雅服饰，专为渡鸦族的身形剪裁。胸前的“奶盖”设计既是装饰，也提供了额外的舒适度。面料轻薄透气，适合在温暖气候下进行社交活动，也能提供基础的防护。</description>
    
    <!-- 物品在地上的贴图 -->
    <graphicData>
      <!-- 推荐使用单独的图标文件，如果没有，暂时指向女性南向贴图作为占位符 -->
      <texPath>Items/Apparel/Raven/Qipao/RavenQipao_Female_south</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    
    <!-- 制作所需材料，参考曲裾 -->
    <costStuffCount>80</costStuffCount>
    <stuffCategories>
      <li>Fabric</li>
      <li>Leathery</li>
    </stuffCategories>
    
    <!-- 物品分类 -->
    <thingCategories>
      <li>Apparel</li>
    </thingCategories>
    
    <!-- 基础属性，参考曲裾 -->
    <statBases>
      <MaxHitPoints>120</MaxHitPoints>
      <!-- WorkToMake 由下面的 recipeMaker 自动处理 -->
      <Mass>0.8</Mass>
      <StuffEffectMultiplierArmor>0.22</StuffEffectMultiplierArmor>
      <StuffEffectMultiplierInsulation_Cold>0.3</StuffEffectMultiplierInsulation_Cold> 
      <StuffEffectMultiplierInsulation_Heat>0.8</StuffEffectMultiplierInsulation_Heat>
      <EquipDelay>2.0</EquipDelay>
    </statBases>
    
    <!-- 作为服装的属性 -->
    <apparel>
      <!-- 覆盖的身体部位 -->
      <bodyPartGroups>
        <li>Torso</li>
        <li>Legs</li>
        <li>Shoulders</li>
      </bodyPartGroups>
      
      <!-- 穿着时的贴图路径，游戏会自动添加 _Male/_Female 和方向后缀 -->
      <wornGraphicPath>Items/Apparel/Raven/Qipao/RavenQipao</wornGraphicPath>
      
      <!-- 穿着的图层，Shell层，可以穿在大多数内衣外面 -->
      <layers>
        <li>Shell</li>
      </layers>
      
      <!-- 服装标签 -->
      <tags>
        <li>IndustrialBasic</li>
        <!-- 专属标签，用于商人库存和敌人生成 -->
        <li>RavenApparel</li> 
      </tags>
      <!-- 默认装备策略 -->
      <defaultOutfitTags>
        <li>Worker</li>
      </defaultOutfitTags>
    </apparel>
    
    <!-- 配方生成器 -->
    <recipeMaker>
      <!-- 制作速度依赖的属性 -->
      <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
      <!-- 制作所需工时 -->
      <workAmount>4200</workAmount>
      <!-- 技能需求 -->
      <skillRequirements>
        <Crafting>6</Crafting>
      </skillRequirements>
      <!-- [核心] 解锁此配方所需的研究 -->
      <!-- 指向我们即将创建的新科技 -->
      <researchPrerequisite>RavenResearch_Tailoring</researchPrerequisite>
      <!-- [核心] 可以在哪些工作台上制作 -->
      <!-- 只允许在新的渡鸦缝纫台上制作 -->
      <recipeUsers>
        <li>Raven_Building_SewingBench</li>
      </recipeUsers>
    </recipeMaker>



    
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Apparel\Raven\Quju\Apparel_Raven_Quju.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="ApparelMakeableBase">
    <defName>Raven_Apparel_Quju</defName>
    <label>渡鸦曲裾</label>
    <description>一件为渡鸦族设计的传统曲裾。宽大的袖袍和层叠的裙摆不仅优雅，还为翅膀的活动留出了充足空间。采用特殊的织物制成，具有出色的保暖性能。</description>
    <graphicData>
      <texPath>Items/Apparel/Raven/Quju/RavenQuju_Icon</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    
    <costStuffCount>80</costStuffCount>
    <stuffCategories>
      <li>Fabric</li>
      <li>Leathery</li>
    </stuffCategories>
    
    <thingCategories>
      <li>Apparel</li>
    </thingCategories>
    
    <statBases>
      <MaxHitPoints>150</MaxHitPoints>
      <!-- WorkToMake 由下面的 recipeMaker 自动处理 -->
      <Mass>1.2</Mass>
      <StuffEffectMultiplierArmor>0.25</StuffEffectMultiplierArmor>
      <StuffEffectMultiplierInsulation_Cold>1.2</StuffEffectMultiplierInsulation_Cold> 
      <StuffEffectMultiplierInsulation_Heat>0.4</StuffEffectMultiplierInsulation_Heat>
      <EquipDelay>2.5</EquipDelay>
    </statBases>
    
    <apparel>
      <bodyPartGroups>
        <li>Torso</li>
        <li>Legs</li>
        <li>Shoulders</li>
        <li>Arms</li>
      </bodyPartGroups>
      
      <wornGraphicPath>Items/Apparel/Raven/Quju/RavenQuju</wornGraphicPath>
      
      <layers>
        <li>Shell</li>
      </layers>
      
      <tags>
        <li>IndustrialBasic</li>
        <li>RavenApparel</li>
      </tags>
      <defaultOutfitTags>
        <li>Worker</li>
        <li>Soldier</li>
      </defaultOutfitTags>
    </apparel>
    
    <recipeMaker>
      <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
      <workAmount>4000</workAmount>
      <skillRequirements>
        <Crafting>6</Crafting>
      </skillRequirements>
      <!-- 【核心修改】将前置科技改为新的缝纫科技 -->
      <researchPrerequisite>RavenResearch_Tailoring</researchPrerequisite>
      <!-- 【核心修改】将可制作的工作台改为新的渡鸦缝纫台 -->
      <recipeUsers>
        <li>Raven_Building_SewingBench</li>
      </recipeUsers>
    </recipeMaker>
    




  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Furniture\Raven_Building_IncenseBurner.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="BuildingBase">
    <defName>Raven_IncenseBurner</defName>
    <label>催情香炉</label>
    <description>燃烧七情花蜜。燃烧时会散发出令人意乱情迷的香气。</description>
    <thingClass>Building</thingClass>
    <graphicData>
      <texPath>Buildings/IncenseBurner/IncenseBurner</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <drawSize>1.2</drawSize>
    </graphicData>
    <altitudeLayer>Building</altitudeLayer>
    <tickerType>Normal</tickerType>
    <drawerType>MapMeshAndRealTime</drawerType>
    
    <specialDisplayRadius>9.9</specialDisplayRadius>

    <comps>
      <li Class="CompProperties_Refuelable">
        <fuelConsumptionRate>10</fuelConsumptionRate>
        <fuelCapacity>50</fuelCapacity>
        <fuelFilter>
          <thingDefs>
            <li>WoodLog</li>
            <!-- [核心修改] 必须改为 RavenItem_SevenEmotionsNectar -->
            <li>RavenItem_SevenEmotionsNectar</li>
          </thingDefs>
        </fuelFilter>
        <initialFuelPercent>0</initialFuelPercent>
        <showAllowAutoRefuelToggle>true</showAllowAutoRefuelToggle>
      </li>
      <li Class="RavenRace.Buildings.Comps.CompProperties_IncenseBurner">
        <effectRadius>9.9</effectRadius>
        <joyAmount>0.05</joyAmount>
        <forceLovinChance>0.05</forceLovinChance>
      </li>
    </comps>
    
    <designationCategory>Raven_Category</designationCategory>
    <researchPrerequisites>
      <li>RavenResearch_Reproduction</li>
    </researchPrerequisites>
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Production\Building_DuskWorkbench.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 薄暮制作台 (Dusk Workbench) ==================== -->
  <ThingDef ParentName="BenchBase">
    <defName>Raven_Building_DuskWorkbench</defName>
    <label>薄暮制作台</label>
    <description>一个修长的流线型工作台，专为处理暗羽钢和光敏材料而设计。台面由特殊的吸光材料制成，配有精密的光学校准仪器。\n\n它可以用来制作暗日透镜以及其他涉及光影转换的精密部件。</description>
    
    <thingClass>Building_WorkTable</thingClass>
    <altitudeLayer>Building</altitudeLayer>
    <passability>PassThroughOnly</passability>
    <pathCost>50</pathCost>
    <fillPercent>0.5</fillPercent>
    <castEdgeShadows>true</castEdgeShadows>
    <staticSunShadowHeight>0.20</staticSunShadowHeight>
    
    <graphicData>
      <texPath>Buildings/Production/DuskWorkbench/DuskWorkbench</texPath>
      <graphicClass>Graphic_Multi</graphicClass>
      <drawSize>(3, 3)</drawSize>
      <damageData>
        <cornerTL>Damage/Corner</cornerTL>
        <cornerTR>Damage/Corner</cornerTR>
        <cornerBL>Damage/Corner</cornerBL>
        <cornerBR>Damage/Corner</cornerBR>
      </damageData>
    </graphicData>
    
    <size>(3,1)</size>
    
    <interactionCellOffset>(0,0,-1)</interactionCellOffset>
    <hasInteractionCell>true</hasInteractionCell>
    
    <costList>
      <Steel>150</Steel>
      <Raven_DarkfeatherSteel>50</Raven_DarkfeatherSteel>
      <ComponentIndustrial>5</ComponentIndustrial>
    </costList>
    
    <statBases>
      <MaxHitPoints>250</MaxHitPoints>
      <WorkToBuild>3500</WorkToBuild>
      <Flammability>0.5</Flammability>
      <Cleanliness>-2</Cleanliness>
    </statBases>
    
    <minifiedDef>MinifiedThing</minifiedDef>
    
    <comps>
      <li Class="CompProperties_Power">
        <compClass>CompPowerTrader</compClass>
        <basePowerConsumption>250</basePowerConsumption>
        <shortCircuitInRain>true</shortCircuitInRain>
      </li>
      <li Class="CompProperties_Flickable"/>
      <li Class="CompProperties_Breakdownable"/>
      <li Class="CompProperties_AffectedByFacilities">
        <linkableFacilities>
          <li>ToolCabinet</li>
        </linkableFacilities>
      </li>
    </comps>
    
    <designationCategory>Raven_Category</designationCategory>
    <researchPrerequisites>
      <li>RavenResearch_BasicMaterials</li>
    </researchPrerequisites>
    
    <surfaceType>Item</surfaceType>
    <constructionSkillPrerequisite>6</constructionSkillPrerequisite>
    
    <inspectorTabs>
      <li>ITab_Bills</li>
    </inspectorTabs>
    <building>
      <spawnedConceptLearnOpportunity>BillsTab</spawnedConceptLearnOpportunity>
    </building>
  </ThingDef>

  <!-- 
    【核心修复】
    将 "制作暗日透镜" 的配方从 Recipes_Materials.xml 移至此处。
    这确保了在加载此配方时，其依赖的工作台（本文件中的 Raven_Building_DuskWorkbench）一定已经被定义，从而解决了交叉引用错误。
  -->
  <RecipeDef>
    <defName>Make_Raven_DarkSunLens</defName>
    <label>制作暗日透镜</label>
    <description>切割暗羽钢并在高压下注入微量的金羽粉末，利用光学设备校准其折射率。这需要极高的工艺技巧。</description>
    <jobString>正在制作暗日透镜。</jobString>
    
    <workAmount>4000</workAmount>
    <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
    <effectWorking>Smith</effectWorking>
    <soundWorking>Recipe_Machining</soundWorking>
    
    <!-- 依赖于此文件内定义的薄暮制作台 -->
    <recipeUsers>
      <li>Raven_Building_DuskWorkbench</li>
    </recipeUsers>
    
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>Raven_DarkfeatherSteel</li>
          </thingDefs>
        </filter>
        <count>20</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Raven_GoldenFeather</li>
          </thingDefs>
        </filter>
        <count>1</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Plasteel</li>
          </thingDefs>
        </filter>
        <count>10</count>
      </li>
    </ingredients>
    
    <fixedIngredientFilter>
      <thingDefs>
        <li>Raven_DarkfeatherSteel</li>
        <li>Raven_GoldenFeather</li>
        <li>Plasteel</li>
      </thingDefs>
    </fixedIngredientFilter>
    
    <products>
      <Raven_DarkSunLens>1</Raven_DarkSunLens>
    </products>
    
    <skillRequirements>
      <Crafting>8</Crafting>
      <Intellectual>4</Intellectual>
    </skillRequirements>
    
    <researchPrerequisite>RavenResearch_BasicMaterials</researchPrerequisite>
  </RecipeDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Production\Building_RavenSewingBench.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 渡鸦缝纫台 ==================== -->
  <ThingDef ParentName="BenchBase">
    <!-- 定义名称，用于内部引用 -->
    <defName>Raven_Building_SewingBench</defName>
    <!-- 游戏内显示的名称 -->
    <label>渡鸦缝纫台</label>
    <!-- 游戏内显示的描述 -->
    <description>一台专为渡鸦族设计的精密缝纫工作台。其结构考虑了羽翼的活动空间，并集成了用于处理特殊织物和羽毛的工具。\n\n所有渡鸦族的专属服饰都在这里制作。</description>
    
    <!-- C# 逻辑类 -->
    <thingClass>Building_WorkTable</thingClass>
    <altitudeLayer>Building</altitudeLayer>
    <passability>PassThroughOnly</passability>
    <pathCost>50</pathCost>
    <fillPercent>0.5</fillPercent>
    <castEdgeShadows>true</castEdgeShadows>
    <staticSunShadowHeight>0.20</staticSunShadowHeight>
    
    <!-- 贴图数据 -->
    <graphicData>
      <!-- 指向多方向贴图的基础路径 -->
      <texPath>Buildings/Production/RavenSewingBench/RavenSewingBench</texPath>
      <graphicClass>Graphic_Multi</graphicClass>
      <!-- 绘制尺寸，参考3x1的薄暮制作台 -->
      <drawSize>(3, 3)</drawSize>
      <damageData>
        <cornerTL>Damage/Corner</cornerTL>
        <cornerTR>Damage/Corner</cornerTR>
        <cornerBL>Damage/Corner</cornerBL>
        <cornerBR>Damage/Corner</cornerBR>
      </damageData>
    </graphicData>
    
    <!-- 建筑尺寸 -->
    <size>(3,1)</size>
    
    <!-- 交互点偏移，位于建筑下方 -->
    <interactionCellOffset>(0,0,-1)</interactionCellOffset>
    <hasInteractionCell>true</hasInteractionCell>
    
    <!-- 制作成本 -->
    <costList>
      <Steel>120</Steel>
      <Raven_DarkfeatherSteel>30</Raven_DarkfeatherSteel>
      <ComponentIndustrial>4</ComponentIndustrial>
    </costList>
    
    <!-- 基础属性 -->
    <statBases>
      <MaxHitPoints>200</MaxHitPoints>
      <WorkToBuild>3000</WorkToBuild>
      <Flammability>0.5</Flammability>
      <Cleanliness>-2</Cleanliness>
    </statBases>
    
    <!-- 允许拆卸和移动 -->
    <minifiedDef>MinifiedThing</minifiedDef>
    
    <!-- 组件 -->
    <comps>
      <!-- 电力组件 -->
      <li Class="CompProperties_Power">
        <compClass>CompPowerTrader</compClass>
        <basePowerConsumption>200</basePowerConsumption>
        <shortCircuitInRain>true</shortCircuitInRain>
      </li>
      <!-- 开关组件 -->
      <li Class="CompProperties_Flickable"/>
      <!-- 故障组件 -->
      <li Class="CompProperties_Breakdownable"/>
      <!-- 工具柜链接组件 -->
      <li Class="CompProperties_AffectedByFacilities">
        <linkableFacilities>
          <li>ToolCabinet</li>
        </linkableFacilities>
      </li>
    </comps>
    
    <!-- 建筑分类 -->
    <designationCategory>Raven_Category</designationCategory>
    <!-- [核心] 解锁此建筑所需的研究 -->
    <researchPrerequisites>
      <li>RavenResearch_Tailoring</li>
    </researchPrerequisites>
    
    <surfaceType>Item</surfaceType>
    <constructionSkillPrerequisite>5</constructionSkillPrerequisite>
    
    <!-- UI 面板 -->
    <inspectorTabs>
      <li>ITab_Bills</li>
    </inspectorTabs>
    <building>
      <spawnedConceptLearnOpportunity>BillsTab</spawnedConceptLearnOpportunity>
    </building>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Production\Hediffs_EmberDrain.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_EmberDrain</defName>
    <label>余烬枯竭</label>
    <description>这个人的金乌血脉精华刚刚被“残火”提取仪提取过。体内的能量回路处于极度匮乏和不稳定的状态。\n\n在此状态消失前，无法再次进行余烬提取，否则会导致直接死亡（安全协议会阻止仪器启动）。\n\n这会导致轻微的意识模糊和身体虚弱。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(0.6, 0.6, 0.6)</defaultLabelColor>
    <isBad>true</isBad>
    <initialSeverity>1.0</initialSeverity>
    <comps>
      <!-- 持续时间：20天 -->
      <li Class="HediffCompProperties_Disappears">
        <disappearsAfterTicks>
          <min>1200000</min>
          <max>1200000</max>
        </disappearsAfterTicks>
        <showRemainingTime>true</showRemainingTime>
      </li>
    </comps>
    <stages>
      <li>
        <capMods>
          <li>
            <capacity>Consciousness</capacity>
            <offset>-0.05</offset>
          </li>
          <li>
            <capacity>BloodFiltration</capacity>
            <offset>-0.10</offset>
          </li>
        </capMods>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Production\Raven_Building_EmberExtractor.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="BuildingBase">
    <defName>Raven_Building_EmberExtractor</defName>
    <label>残火提取仪</label>
    <description>一台精密的生物炼金设备，能够安全地将渡鸦族体内的金乌血脉精华剥离出来，而不伤害受试者的性命。\n\n提取过程会让受试者陷入长时间的“余烬枯竭”状态，在此期间无法再次进行提取。</description>
    <thingClass>RavenRace.Buildings.Building_EmberExtractor</thingClass>
    
    <graphicData>
      <texPath>Buildings/Production/EmberExtractor/Base</texPath>
      <graphicClass>Graphic_Multi</graphicClass>
      <drawSize>(4, 4)</drawSize>
      <drawOffset>(0.045, 0, 0.18)</drawOffset> <!-- [新增] 向上(Z轴)偏移 -->
      <shadowData>
        <volume>(1.8, 1.0, 2.8)</volume>
      </shadowData>
    </graphicData>
    
    <size>(3,2)</size>
    <altitudeLayer>Building</altitudeLayer>
    <passability>PassThroughOnly</passability>
    <pathCost>50</pathCost>
    <fillPercent>0.5</fillPercent>
    <castEdgeShadows>true</castEdgeShadows>
    <rotatable>true</rotatable>
    <drawerType>MapMeshAndRealTime</drawerType>
    
    <!-- [最终修复] 正确的自定义 BuildingProperties 方式 -->
    <building Class="RavenRace.Buildings.BuildingProperties_EmberExtractor">
      <!-- 这个自定义字段现在可以被正确识别了 -->
      <emberExtractorTankGraphic>
        <texPath>Buildings/Production/EmberExtractor/Tank</texPath>
        <graphicClass>Graphic_Multi</graphicClass>
        <shaderType>Transparent</shaderType>
        <drawSize>(4, 4)</drawSize>
        <drawOffset>(0.045, 0, 0.18)</drawOffset> <!-- [新增] 向上(Z轴)偏移 -->
      </emberExtractorTankGraphic>
    </building>
    
    <statBases>
      <MaxHitPoints>350</MaxHitPoints>
      <WorkToBuild>5000</WorkToBuild>
      <Mass>50</Mass>
      <Flammability>0.5</Flammability>
    </statBases>
    
    <costList>
      <Steel>200</Steel>
      <Raven_DarkfeatherSteel>60</Raven_DarkfeatherSteel>
      <ComponentIndustrial>8</ComponentIndustrial>
      <Plasteel>30</Plasteel>
    </costList>
    
    <comps>
      <li Class="CompProperties_Power">
        <compClass>CompPowerTrader</compClass>
        <basePowerConsumption>500</basePowerConsumption>
      </li>
      <li Class="CompProperties_Flickable"/>
    </comps>
    
    <interactionCellOffset>(0,0,-1)</interactionCellOffset>
    <hasInteractionCell>true</hasInteractionCell>
    
    <designationCategory>Raven_Category</designationCategory>
    <researchPrerequisites>
      <li>RavenResearch_EmberExtraction</li>
    </researchPrerequisites>
    <constructionSkillPrerequisite>8</constructionSkillPrerequisite>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Production\Raven_Building_SunRaiserInjector.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="BenchBase">
    <defName>Raven_Building_SunRaiserInjector</defName>
    <label>升阳注入器</label>
    <description>一台汇集了扶桑最高工艺的精密仪器。它能将日冕钢和金羽中蕴含的神性粒子进行超高压对撞，并以无法理解的方式使其重构，最终凝聚成一枚“破碎日核”。整个过程极其漫长且消耗巨大。</description>
    
    <thingClass>Building_WorkTable</thingClass>
    <altitudeLayer>Building</altitudeLayer>
    <passability>PassThroughOnly</passability>
    <pathCost>70</pathCost>
    <fillPercent>0.5</fillPercent>
    <castEdgeShadows>true</castEdgeShadows>
    <staticSunShadowHeight>0.20</staticSunShadowHeight>
    
    <graphicData>
      <texPath>Buildings/Production/SunRaiserInjector/SunRaiserInjector</texPath>
      <graphicClass>Graphic_Multi</graphicClass>
      <drawSize>(5.2, 5.2)</drawSize>
      <drawOffset>(0, 0, 0.9)</drawOffset> <!-- [新增] 向上(Z轴)偏移 -->
      <damageData>
        <cornerTL>Damage/Corner</cornerTL>
        <cornerTR>Damage/Corner</cornerTR>
        <cornerBL>Damage/Corner</cornerBL>
        <cornerBR>Damage/Corner</cornerBR>
      </damageData>
    </graphicData>
    
    <size>(3,3)</size>
    
    <interactionCellOffset>(0,0,-2)</interactionCellOffset>
    <hasInteractionCell>true</hasInteractionCell>
    
    <costList>
      <Plasteel>150</Plasteel>
      <Raven_CoronaSteel>80</Raven_CoronaSteel>
      <ComponentSpacer>6</ComponentSpacer>
    </costList>
    
    <statBases>
      <MaxHitPoints>500</MaxHitPoints>
      <WorkToBuild>10000</WorkToBuild>
      <Mass>150</Mass>
      <Flammability>0</Flammability>
    </statBases>
    
    <minifiedDef>MinifiedThing</minifiedDef>
    

    
    <comps>
      <li Class="CompProperties_Power">
        <compClass>CompPowerTrader</compClass>
        <basePowerConsumption>1200</basePowerConsumption>
        <shortCircuitInRain>true</shortCircuitInRain>
      </li>
      <li Class="CompProperties_Flickable"/>
      <li Class="CompProperties_Breakdownable"/>
      <li Class="CompProperties_AffectedByFacilities">
        <linkableFacilities>
          <li>ToolCabinet</li>
        </linkableFacilities>
      </li>
    </comps>
    
    <designationCategory>Raven_Category</designationCategory>
    <researchPrerequisites>
      <li>RavenResearch_AdvancedForging</li>
    </researchPrerequisites>
    
    <constructionSkillPrerequisite>10</constructionSkillPrerequisite>
    
    <inspectorTabs>
      <li>ITab_Bills</li>
    </inspectorTabs>
    <building>
      <spawnedConceptLearnOpportunity>BillsTab</spawnedConceptLearnOpportunity>
    </building>
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Structure\Raven_Structure.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 渡鸦墙体 (Raven Wall) ==================== -->
  <ThingDef ParentName="BuildingBase">
    <defName>Raven_Wall</defName>
    <label>渡鸦墙体</label>
    <description>由暗羽钢与钢铁复合锻造而成的重型墙体。结构内部填充了吸能材料，能有效抵御爆炸与钝击，其哑光表面的美感也深受渡鸦族喜爱。</description>
    
    <thingClass>RavenRace.Buildings.RavenWall_Building</thingClass>
    <category>Building</category>
    <noRightClickDraftAttack>true</noRightClickDraftAttack>
    <replaceTags>
      <li>Wall</li>
    </replaceTags>

    <graphicData>
      <texPath>Buildings/Structure/RavenWall</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <shaderType>Cutout</shaderType>
      <linkType>CornerFiller</linkType>
      <linkFlags>
        <li>Wall</li>
        <li>Rock</li>
      </linkFlags>
      <damageData>
        <cornerTL>Damage/Corner</cornerTL>
        <cornerTR>Damage/Corner</cornerTR>
        <cornerBL>Damage/Corner</cornerBL>
        <cornerBR>Damage/Corner</cornerBR>
        <edgeTop>Damage/Edge</edgeTop>
        <edgeBot>Damage/Edge</edgeBot>
        <edgeLeft>Damage/Edge</edgeLeft>
        <edgeRight>Damage/Edge</edgeRight>
      </damageData>
    </graphicData>

    <uiIconPath>Buildings/Structure/RavenWall_Icon</uiIconPath>
    
    <drawStyleCategory>Walls</drawStyleCategory>
    
    <statBases>
      <MaxHitPoints>1200</MaxHitPoints>
      <WorkToBuild>200</WorkToBuild>
      <Flammability>0</Flammability>
      <Beauty>3</Beauty>
      <MeditationFocusStrength>0.2</MeditationFocusStrength>
    </statBases>

    <costList>
      <Steel>12</Steel>
      <Raven_DarkfeatherSteel>6</Raven_DarkfeatherSteel>
    </costList>

    <leaveResourcesWhenKilled>false</leaveResourcesWhenKilled>
    <altitudeLayer>Building</altitudeLayer>
    <passability>Impassable</passability>
    <blockWind>true</blockWind>
    <blockLight>true</blockLight>
    <holdsRoof>true</holdsRoof>
    <castEdgeShadows>true</castEdgeShadows>
    <fillPercent>1</fillPercent>
    <coversFloor>true</coversFloor>
    <tickerType>Never</tickerType>
    <rotatable>false</rotatable>
    <selectable>true</selectable>
    <neverMultiSelect>true</neverMultiSelect>
    <designationCategory>Raven_Category</designationCategory>
    <staticSunShadowHeight>1.0</staticSunShadowHeight>
    <canOverlapZones>false</canOverlapZones>
    <fertility>0</fertility>

    <building>
      <paintable>true</paintable>
      <isInert>true</isInert>
      <isWall>true</isWall>
      <isPlaceOverableWall>true</isPlaceOverableWall>
      <supportsWallAttachments>true</supportsWallAttachments>
      <isAirtight>true</isAirtight>
      
      <blueprintGraphicData>
        <texPath>Buildings/Structure/RavenWall</texPath>
      </blueprintGraphicData>
      <relatedBuildCommands>
        <li>Cooler</li>
        <li>Vent</li>
      </relatedBuildCommands>
    </building>

    <comps>
      <li Class="CompProperties_MeditationFocus">
        <statDef>MeditationFocusStrength</statDef>
        <focusTypes><li>Minimal</li></focusTypes>
      </li>
    </comps>

    <modExtensions>
      <!-- [核心修改] 更新 Class 引用 -->
      <li Class="RavenRace.Harmony.RavenStuffColorDisableExtension">
        <disableStuffColor>true</disableStuffColor>
      </li>
    </modExtensions>

    <researchPrerequisites>
      <li>RavenResearch_BasicMaterials</li>
    </researchPrerequisites>
  </ThingDef>

  <!-- 渡鸦地砖 -->
  <TerrainDef ParentName="FloorBase">
    <defName>Raven_Terrain_Tile</defName>
    <label>渡鸦地砖</label>
    <description>采用高抛光渡鸦合金制成的地砖。其表面极其平滑，且具有天然的抗污属性，非常易于清洁，且具有极高的装饰价值。</description>
    <texturePath>Terrain/Surfaces/RavenTile</texturePath>
    <edgeType>Fade</edgeType> 
    <statBases>
      <WorkToBuild>850</WorkToBuild>
      <Beauty>2</Beauty>
      <Cleanliness>0.5</Cleanliness>
      <CleaningTimeFactor>0.6</CleaningTimeFactor>
    </statBases>
    <costList>
      <Raven_DarkfeatherSteel>4</Raven_DarkfeatherSteel>
    </costList>
    <constructionSkillPrerequisite>5</constructionSkillPrerequisite>
    <designationCategory>Raven_Category</designationCategory>
    <researchPrerequisites>
      <li>RavenResearch_BasicMaterials</li>
    </researchPrerequisites>
  </TerrainDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Thoughts\Hediff_IncenseAura.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <HediffDef>
    <defName>RavenHediff_IncenseAura</defName>
    <label>香薰氛围</label>
    <description>受到催情香炉的影响，感到身心放松，意识变得敏锐但由于香气的影响，情绪变得更加激动。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(1, 0.8, 0.9)</defaultLabelColor>
    <isBad>false</isBad>
    <maxSeverity>1.0</maxSeverity>
    <comps>      
      <!-- 修正：大幅降低衰减速度，或者大幅增加单次添加量 -->
      <li Class="HediffCompProperties_SeverityPerDay">
        <severityPerDay>-1.0</severityPerDay> <!-- 每天减1.0，即24小时消失 -->
      </li>
    </comps>
    <stages>
      <li>
        <label>微醺</label>
        <capMods>
          <li><capacity>Consciousness</capacity><offset>0.05</offset></li>
          <li><capacity>BloodFiltration</capacity><offset>0.10</offset></li>
        </capMods>
        <statOffsets>
            <RestRateMultiplier>1.1</RestRateMultiplier>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Buildings\Thoughts\Thoughts_Buildings.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThoughtDef>
    <defName>Raven_Thought_IncenseSmell</defName>
    <durationDays>0.1</durationDays> <!-- 很短，只有在范围内才有 -->
    <stackLimit>1</stackLimit>
    <stages>
      <li>
        <label>迷醉香气</label>
        <description>空气中弥漫着一股甜腻而温暖的香气，让人感到莫名的燥热和兴奋。</description>
        <baseMoodEffect>5</baseMoodEffect>
      </li>
    </stages>
  </ThoughtDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Medicine\Raven_AphrodisiacExtract.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="ResourceBase">
    <defName>RavenItem_AphrodisiacExtract</defName>
    <label>高浓度催情提取液</label>
    <description>从七情花蜜中提炼的纯化药剂。可以作为药物服用，也可以涂抹在近战武器上以赋予其“催情毒素”效果。</description>

    <graphicData>
      <texPath>Items/Medicine/AphrodisiacExtract</texPath>
      <graphicClass>Graphic_StackCount</graphicClass> 
    </graphicData>

    <statBases>
      <MarketValue>50</MarketValue>
      <Mass>0.1</Mass>
    </statBases>
    <techLevel>Industrial</techLevel>
    <thingCategories>
      <li>Drugs</li>
    </thingCategories>
    <stackLimit>75</stackLimit>
   <comps>
      <li Class="CompProperties_Usable">
        <useJob>UseItem</useJob>
        <useLabel>涂抹于武器...</useLabel>
        <useDuration>120</useDuration>
      </li>
      
      <li Class="RavenRace.Items.Comps.CompProperties_TargetableRavenPoison">
        <compClass>RavenRace.Items.Comps.CompTargetable_RavenPoison</compClass>
      </li>
      
      <li Class="CompProperties_UseEffect">
        <compClass>RavenRace.Items.Comps.CompTargetEffect_RavenCoat</compClass>
      </li>
      
      <li Class="CompProperties_UseEffectDestroySelf" />
    </comps>
  </ThingDef>

  <RecipeDef>
    <defName>Make_AphrodisiacExtract</defName>
    <label>提炼催情提取液</label>
    <description>从七情花蜜中提炼高浓度药剂。</description>
    <jobString>正在提炼药剂。</jobString>
    <workAmount>800</workAmount>
    <workSpeedStat>DrugSynthesisSpeed</workSpeedStat>
    <effectWorking>Cook</effectWorking>
    <soundWorking>Recipe_CookMeal</soundWorking>
    <recipeUsers>
      <li>DrugLab</li>
    </recipeUsers>
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <!-- [核心修改] 必须改为 RavenItem_SevenEmotionsNectar -->
            <li>RavenItem_SevenEmotionsNectar</li>
          </thingDefs>
        </filter>
        <count>4</count>
      </li>
    </ingredients>
    <fixedIngredientFilter>
      <thingDefs>
        <!-- [核心修改] 这里也要改 -->
        <li>RavenItem_SevenEmotionsNectar</li>
      </thingDefs>
    </fixedIngredientFilter>
    <products>
      <RavenItem_AphrodisiacExtract>1</RavenItem_AphrodisiacExtract>
    </products>
    <skillRequirements>
      <Intellectual>4</Intellectual>
    </skillRequirements>
  </RecipeDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Medicine\ThingDef_Oxytocin.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- ==================== 催产素物品定义 ==================== -->
  <ThingDef ParentName="MakeableDrugBase">
    <defName>Raven_Drug_Oxytocin</defName>
    <label>催产素</label>
    <description>一种强效的激素药物，能强制刺激渡鸦族的生殖系统。服用后会立即引发剧烈的排卵反应，导致服用者在极短时间内产下一枚未受精的灵卵。\n\n副作用：会导致极度的虚弱和疼痛。</description>
    
    <graphicData>
      <texPath>Items/Medicine/Oxytocin</texPath>
      <graphicClass>Graphic_Single</graphicClass> 
      <drawSize>0.8</drawSize>
    </graphicData>
    
    <rotatable>false</rotatable>
    
    <statBases>
      <WorkToMake>600</WorkToMake>
      <MarketValue>45</MarketValue>
      <Mass>0.05</Mass>
    </statBases>
    
    <techLevel>Industrial</techLevel>
    
    <ingestible>
      <drugCategory>Medical</drugCategory>
      <foodType>Processed</foodType> 
      <outcomeDoers>
        <!-- 必须与 C# 类名完全一致 -->
        <li Class="RavenRace.Features.Reproduction.IngestionOutcomeDoer_Oxytocin">
        </li>
      </outcomeDoers>
    </ingestible>
    
    <recipeMaker>
      <researchPrerequisite>RavenResearch_Reproduction</researchPrerequisite>
      <recipeUsers>
        <li>DrugLab</li>
      </recipeUsers>
    </recipeMaker>
    
    <costList>
      <Neutroamine>2</Neutroamine>
      <MedicineHerbal>1</MedicineHerbal>
    </costList>
    
    <comps>
      <li Class="CompProperties_Drug">
        <listOrder>1000</listOrder>
      </li>
    </comps>
  </ThingDef>

  <!-- ==================== 强制排卵 Hediff 定义 ==================== -->
  <HediffDef>
    <defName>Raven_Hediff_RapidOvulation</defName>
    <label>强制排卵</label>
    <description>生殖系统正在药物刺激下超负荷运转，即将产下未受精灵卵。</description>
    
    <!-- [Change] RavenRace.Hediff_RapidOvulation -> RavenRace.Features.Reproduction.HediffRapidOvulation -->
    <!-- 类名标准化：Hediff_RapidOvulation -> HediffRapidOvulation -->
    <!-- 命名空间更新：移至 Reproduction 功能模块 -->
    <hediffClass>RavenRace.Features.Reproduction.HediffRapidOvulation</hediffClass>
    
    <defaultLabelColor>(1.0, 0.2, 0.6)</defaultLabelColor>
    <isBad>true</isBad>
    <initialSeverity>0.1</initialSeverity>
    <maxSeverity>1.0</maxSeverity>
    
    <comps>
      <!-- 极快的增长速度，确保短时间内触发分娩 -->
      <li Class="HediffCompProperties_SeverityPerDay">
        <severityPerDay>24.0</severityPerDay>
      </li>
    </comps>
    
    <stages>
      <li>
        <label>阵痛</label>
        <painOffset>0.4</painOffset>
        <vomitMtbDays>0.1</vomitMtbDays>
        <capMods>
          <li>
            <capacity>Moving</capacity>
            <offset>-0.5</offset>
          </li>
        </capMods>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Misc\Item_HojoCube.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_Item_HojoCube</defName>
    <label>齁金魔方</label>
    <description>一个通体金黄的立方体，表面浮现着粉色的奇异淫纹。凑近了听，似乎能听到“齁噢噢噢❤”的奇怪声音。</description>
    
    <graphicData>
      <texPath>Items/Misc/HojoCube/HojoCube</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <drawSize>1.0</drawSize>
    </graphicData>
    
    <statBases>
      <MarketValue>1</MarketValue> <!-- 价值为1 -->
      <Mass>1.0</Mass>
      <Beauty>100</Beauty>
      <Flammability>0</Flammability>
    </statBases>
    
    <thingCategories>
      <li>Artifacts</li>
    </thingCategories>
    
    <tradeability>None</tradeability> <!-- 无法交易 -->
    <stackLimit>1</stackLimit>
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Misc\Raven_AbilityTome.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 渡鸦本能教本 (赋予技能) ==================== -->
  <ThingDef ParentName="ResourceBase">
    <defName>RavenItem_AbilityTome</defName>
    <label>渡鸦本能教本</label>
    <description>一本古老的典籍，详细记载了渡鸦族如何利用其独特的魅力和信息素来影响其他生物的意志。学习后可以掌握“强制求爱”技能。\n\n“理论终究是理论，实践才是检验真理的唯一标准。” —— 某位不愿透露姓名的司命</description>
    <graphicData>
      <texPath>Items/Medicine/Oxytocin</texPath> <!-- 复用贴图 -->
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>

    <statBases>
      <MarketValue>750</MarketValue>
      <Mass>0.5</Mass>
    </statBases>

    <techLevel>Industrial</techLevel>

    <thingCategories>
      <li>Items</li>
    </thingCategories>

    <tradeTags>
      <li>ExoticMisc</li>
    </tradeTags>

    <comps>
      <!-- 使用交互 -->
      <li Class="CompProperties_Usable">
        <useJob>UseItem</useJob>
        <useLabel>学习强制求爱</useLabel>
        <useDuration>60</useDuration> <!-- 学习需要一点时间 -->
      </li>
      <!-- 选择目标 (学习者) -->
      <li Class="CompProperties_Targetable">
        <compClass>CompTargetable_SinglePawn</compClass>
      </li>
      <!-- 实际效果 -->
      <li Class="CompProperties_UseEffect">
        <compClass>RavenRace.Items.Comps.CompTargetEffect_GainForceLovin</compClass>
      </li>
      <!-- 使用后销毁 -->
      <li Class="CompProperties_UseEffectDestroySelf" />
    </comps>
  </ThingDef>

  <!-- ==================== 制作配方 ==================== -->
  <RecipeDef>
    <defName>Make_RavenItem_AbilityTome</defName>
    <label>抄写渡鸦本能教本</label>
    <description>抄写一本关于渡鸦族本能的教本。</description>
    <jobString>正在抄写教本。</jobString>
    <workAmount>50</workAmount>
    <workSpeedStat>ResearchSpeed</workSpeedStat> <!-- 与研究速度挂钩 -->
    <effectWorking>Cook</effectWorking>
    <soundWorking>Recipe_CookMeal</soundWorking>


    <recipeUsers>
        <li>DrugLab</li>
    </recipeUsers>

    <researchPrerequisite>RavenResearch_Reproduction</researchPrerequisite>

    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>Steel</li>
          </thingDefs>
        </filter>
        <count>40</count>
      </li>
    </ingredients>

    <products>
      <RavenItem_AbilityTome>1</RavenItem_AbilityTome>
    </products>


  </RecipeDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Relics\Relics.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 1. 某位大师的画笔 ==================== -->
  <!-- 继承自RelicInertBase使其成为一个惰性圣物 -->
  <ThingDef ParentName="RelicInertBase">
    <defName>RavenRelic_MastersBrush</defName>
    <label>某位大师的画笔</label>
    <description>据说是创造邪恶六角恐龙的超凡智能遗留下的画笔，有一股强大的灵能守护着它。据说在萌螈的禁忌典籍里有记载，必须得到那位超凡智能的认可的人才能使用。对于某些人来说，它的功能堪称罪大恶极。它可以将所有种族的大肉包变成小笼包。</description>
    <graphicData>
      <texPath>Items/Relics/MastersBrush</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <statBases>
      <!-- 重写基类的属性 -->
      <MarketValue>1</MarketValue>
      <Mass>0.1</Mass>
      <Beauty>500</Beauty>
    </statBases>
    <!-- 归类为神器，而不是普通惰性圣物 -->
    <thingCategories>
      <li>Artifacts</li>
    </thingCategories>
    <tradeability>None</tradeability>
  </ThingDef>

  <!-- ==================== 2. 某个绿色米莉拉的价格标签 ==================== -->
  <ThingDef ParentName="RelicInertBase">
    <defName>RavenRelic_MiliraPriceTag</defName>
    <label>某个绿色米莉拉的价格标签</label>
    <description>来自某位雌雄莫辨的米莉拉钉在耳朵上的价格标签，但是无论用什么方法识别上面的条码，都会弹出此商品不存在的提示。然而，传说得到某位粉色超凡智能的加护后，便能成功读取该条码，上面显示着：“价格：882853688白银；商品描述：一只对你百依百顺的绿色米莉拉小男娘；付款链接：xxxxxxxxxxx。”“111真能买吗？”某位黑色米莉拉如此说道。</description>
    <graphicData>
      <texPath>Items/Relics/MiliraPriceTag</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>1</MarketValue>
      <Mass>0.01</Mass>
      <Beauty>500</Beauty>
    </statBases>
    <thingCategories>
      <li>Artifacts</li>
    </thingCategories>
    <tradeability>None</tradeability>
  </ThingDef>

  <!-- ==================== 3. 鼠饼恩情雕像 ==================== -->
  <ThingDef ParentName="RelicInertBase">
    <defName>RavenRelic_RatkinStatue</defName>
    <label>鼠饼恩情雕像</label>
    <description>一尊描绘着几位鼠鼠高层指点江山的小雕塑，据说每位在城市里的鼠鼠床头必须摆上，并且每天起床和睡觉前都要双手举过头顶一边哭一边跳，以表对几位做出巨大贡献的鼠鼠的尊敬。雕像做的十分精致，细致到连每一根脚趾头的纹路都刻的清清楚楚，能看出设计工匠的努力。“为什么工匠这么清楚每位高层的脚的样子？这刻画的也太精细了吧，每个人的脚趾甲长度都不一样。”“嘘，还想要脑袋的话，那就别说了。”</description>
    <graphicData>
      <texPath>Items/Relics/RatkinStatue</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>1</MarketValue>
      <Mass>1.5</Mass>
      <Beauty>500</Beauty>
    </statBases>
    <thingCategories>
      <li>Artifacts</li>
    </thingCategories>
    <tradeability>None</tradeability>
  </ThingDef>

  <!-- ==================== 4. 狼球抱枕 ==================== -->
  <ThingDef ParentName="RelicInertBase">
    <defName>RavenRelic_WolfeinPillow</defName>
    <label>狼球抱枕</label>
    <description>一个毛茸茸，圆滚滚的抱枕，似乎捏他了看板娘芬里尔的形象。据沃芬野史记载，当年有一位因欺骗巨企高层的获罪的抵抗组织成员---沃沃芬斯，就被判处推着狼球抱枕上山的惩罚。因为抱枕实在是太圆太可爱了，每次快到山顶的时候就会滑落下山，沃沃芬斯不得不从头再推一次，循环往复。这个抱枕和后面藏着的故事一直在哲学界有着激烈的讨论，他们吵得不可开交，但是，这只是个很可爱的抱枕，不是吗？</description>
    <graphicData>
      <texPath>Items/Relics/WolfeinPillow</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>1</MarketValue>
      <Mass>1.0</Mass>
      <Beauty>500</Beauty>
    </statBases>
    <thingCategories>
      <li>Artifacts</li>
    </thingCategories>
    <tradeability>None</tradeability>
  </ThingDef>

  <!-- ==================== 5. 一款神秘的奶 ==================== -->
  <ThingDef ParentName="RelicInertBase">
    <defName>RavenRelic_MysteriousMilk</defName>
    <label>一款神秘的奶</label>
    <description>一瓶有着神秘香气的母乳，似乎来自某些长着龙角的，拥有傲人乳房的种族。</description>
    <graphicData>
      <texPath>Items/Relics/MysteriousMilk</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>1</MarketValue>
      <Mass>0.5</Mass>
      <Beauty>500</Beauty>
    </statBases>
    <thingCategories>
      <li>Artifacts</li>
    </thingCategories>
    <tradeability>None</tradeability>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Resources\Raven_Alloys.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 暗羽钢 (Darkfeather Steel) ==================== -->
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_DarkfeatherSteel</defName>
    <label>暗羽钢</label>
    <description>将熔融的铁与粉碎的黑曜石混合，掺入原木燃烧产生的特殊碱灰，形成富含微气孔和吸光碳颗粒的复合结构。它比普通钢铁更轻，且具有优异的吸能性。</description>
    <graphicData>
      <!-- 
           [修复核心] 
           路径指向文件夹：Items/Materials/Alloys/DarkfeatherSteel
           游戏会扫描该文件夹下的所有图片。
           文件名必须是 DarkfeatherSteel_a.png 等，确保下划线前缀一致。
      -->
      <texPath>Items/Materials/Alloys/DarkfeatherSteel</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    
    <soundInteract>Metal_Drop</soundInteract>
    <soundDrop>Metal_Drop</soundDrop>
    <stackLimit>75</stackLimit>
    <statBases>
      <MaxHitPoints>100</MaxHitPoints>
      <MarketValue>3.5</MarketValue>
      <Mass>0.4</Mass>
      <Flammability>0.2</Flammability>
      <SharpDamageMultiplier>1.1</SharpDamageMultiplier>
      <BluntDamageMultiplier>1.0</BluntDamageMultiplier>
      <StuffPower_Armor_Sharp>1.0</StuffPower_Armor_Sharp>
      <StuffPower_Armor_Blunt>0.6</StuffPower_Armor_Blunt>
      <StuffPower_Armor_Heat>0.7</StuffPower_Armor_Heat>
      <StuffPower_Insulation_Cold>3</StuffPower_Insulation_Cold>
      <StuffPower_Insulation_Heat>3</StuffPower_Insulation_Heat>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
    <stuffProps>
      <categories>
        <li>Metallic</li>
      </categories>
      <commonality>0.05</commonality>
      <color>(60, 60, 65)</color>
      <constructEffect>ConstructMetal</constructEffect>
      <soundMeleeHitSharp>MeleeHit_Metal_Sharp</soundMeleeHitSharp>
      <soundMeleeHitBlunt>MeleeHit_Metal_Blunt</soundMeleeHitBlunt>
      <statFactors>
        <MaxHitPoints>1.2</MaxHitPoints>
        <Beauty>1</Beauty>
        <Flammability>0.2</Flammability>
        <WorkToMake>1.2</WorkToMake>
        <WorkToBuild>1.2</WorkToBuild>
      </statFactors>
    </stuffProps>
  </ThingDef>

  <RecipeDef>
    <defName>Make_Raven_DarkfeatherSteel</defName>
    <label>冶炼暗羽钢</label>
    <description>冶炼暗羽钢。需要铁、石块和原木。</description>
    <jobString>正在冶炼暗羽钢。</jobString>
    <workSpeedStat>SmeltingSpeed</workSpeedStat>
    <effectWorking>Smelt</effectWorking>
    <soundWorking>Recipe_Smelt</soundWorking>
    <workAmount>1500</workAmount>
    <recipeUsers>
      <li>ElectricSmelter</li>
    </recipeUsers>
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>Steel</li>
          </thingDefs>
        </filter>
        <count>40</count>
      </li>
      <li>
        <filter>
          <categories>
            <li>StoneBlocks</li>
          </categories>
        </filter>
        <count>25</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>WoodLog</li>
          </thingDefs>
        </filter>
        <count>50</count>
      </li>
    </ingredients>
    <products>
      <Raven_DarkfeatherSteel>25</Raven_DarkfeatherSteel>
    </products>
    <skillRequirements>
      <Crafting>6</Crafting>
    </skillRequirements>
  </RecipeDef>

  <!-- ==================== 日冕钢 (Corona Steel) ==================== -->
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_CoronaSteel</defName>
    <label>日冕钢</label>
    <description>技术与神性的结合。以暗羽钢为胚体，包裹熔融的白银作为能量脉络，并嵌入翡翠作为灵魂稳定器。它散发着微弱的金色光辉。</description>
    <graphicData>
      <!-- 
           [修复核心] 
           路径指向文件夹：Items/Materials/Alloys/CoronaSteel
      -->
      <texPath>Items/Materials/Alloys/CoronaSteel</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <soundInteract>Metal_Drop</soundInteract>
    <soundDrop>Metal_Drop</soundDrop>
    <stackLimit>75</stackLimit>
    <statBases>
      <MaxHitPoints>200</MaxHitPoints>
      <MarketValue>12.0</MarketValue>
      <Mass>0.45</Mass>
      <Flammability>0.0</Flammability>
      <SharpDamageMultiplier>1.4</SharpDamageMultiplier>
      <BluntDamageMultiplier>1.2</BluntDamageMultiplier>
      <StuffPower_Armor_Sharp>1.4</StuffPower_Armor_Sharp>
      <StuffPower_Armor_Blunt>0.8</StuffPower_Armor_Blunt>
      <StuffPower_Armor_Heat>1.0</StuffPower_Armor_Heat>
      <StuffPower_Insulation_Cold>6</StuffPower_Insulation_Cold>
      <StuffPower_Insulation_Heat>6</StuffPower_Insulation_Heat>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
    <stuffProps>
      <categories>
        <li>Metallic</li>
      </categories>
      <commonality>0.01</commonality>
      <color>(210, 180, 100)</color>
      <constructEffect>ConstructMetal</constructEffect>
      <soundMeleeHitSharp>MeleeHit_Metal_Sharp</soundMeleeHitSharp>
      <soundMeleeHitBlunt>MeleeHit_Metal_Blunt</soundMeleeHitBlunt>
      <statFactors>
        <MaxHitPoints>1.8</MaxHitPoints>
        <Beauty>2</Beauty>
        <Flammability>0.0</Flammability>
        <WorkToMake>1.6</WorkToMake>
        <WorkToBuild>1.6</WorkToBuild>
      </statFactors>
    </stuffProps>
  </ThingDef>

  <RecipeDef>
    <defName>Make_Raven_CoronaSteel</defName>
    <label>淬炼日冕钢</label>
    <description>淬炼日冕钢。需要暗羽钢、白银和翡翠。</description>
    <jobString>正在淬炼日冕钢。</jobString>
    <workSpeedStat>SmeltingSpeed</workSpeedStat>
    <effectWorking>Smelt</effectWorking>
    <soundWorking>Recipe_Smelt</soundWorking>
    <workAmount>3000</workAmount>
    <recipeUsers>
      <li>ElectricSmelter</li>
    </recipeUsers>
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>Raven_DarkfeatherSteel</li>
          </thingDefs>
        </filter>
        <count>25</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Silver</li>
          </thingDefs>
        </filter>
        <count>50</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Jade</li>
          </thingDefs>
        </filter>
        <count>1</count>
      </li>
    </ingredients>
    <products>
      <Raven_CoronaSteel>25</Raven_CoronaSteel>
    </products>
    <skillRequirements>
      <Crafting>10</Crafting>
    </skillRequirements>
  </RecipeDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Resources\Raven_SpecialMaterials.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 1. 折翼金羽 -->
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_GoldenFeather</defName>
    <label>折翼金羽</label>
    <description>一根根部带有金色脉络的羽毛，是渡鸦族在极端情绪或生理剧变下析出的神性结晶。\n\n获取方式：\n1. 渡鸦族情绪极度崩溃或极度快乐时概率掉落。\n2. 渡鸦族重伤濒死时概率掉落。\n3. 渡鸦族产下灵卵时必定掉落。\n（每种方式有独立的冷却时间）\n\n它蕴含着微弱但纯净的金乌之力，是制作高级法器和药剂的关键材料。</description>
    <graphicData>
      <texPath>Items/Materials/GoldenFeather</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <stackLimit>75</stackLimit>
    <statBases>
      <MarketValue>60</MarketValue>
      <Mass>0.01</Mass>
      <Flammability>1.0</Flammability>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
    <tradeTags>
      <li>ExoticMisc</li>
    </tradeTags>
  </ThingDef>

  <!-- 2. 暗日透镜 -->
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_DarkSunLens</defName>
    <label>暗日透镜</label>
    <description>一块不规则的黑曜石薄片，经过扶桑工匠的特殊处理。当滴入金乌之血时，它能扭曲周围的光线与热能。\n\n是制作高级隐身装备的核心部件。</description>
    <graphicData>
      <texPath>Items/Materials/DarkSunLens</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>120</MarketValue>
      <Mass>0.1</Mass>
      <Flammability>0</Flammability>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
    <tradeTags>
      <li>ExoticMisc</li>
    </tradeTags>
  </ThingDef>

  <!-- 3. 余烬之血 -->
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_EmberBlood</defName>
    <label>余烬之血</label>
    <description>从渡鸦族心脏中提取的浓缩血液，呈暗金色胶状，散发着不稳定的热量。\n\n获取方式：\n1. 对渡鸦族进行“提取余烬之血”手术（必死）。\n2. 通过扶桑电台发布“崇高奉献”特殊协议。\n\n这是一种极其危险的血脉纯化媒介。直接注射可能唤醒体内的金乌之力，但也极可能导致死亡或疯狂。</description>
    <graphicData>
      <texPath>Items/Materials/EmberBlood</texPath> 
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>800</MarketValue>
      <Mass>0.2</Mass>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
    <tradeTags>
      <li>ExoticMisc</li>
    </tradeTags>
    <stackLimit>75</stackLimit>
    
    <ingestible>
      <foodType>Fluid</foodType>
      <preferability>NeverForNutrition</preferability>
      <baseIngestTicks>200</baseIngestTicks>
      <ingestSound>Ingest_Inject</ingestSound>
      <ingestHoldUsesTable>false</ingestHoldUsesTable>
      <ingestCommandString>注射{0}</ingestCommandString> 
      <ingestReportString>正在注射{0}。</ingestReportString>
      <outcomeDoers>
        <li Class="RavenRace.IngestionOutcomeDoer_EmberBlood" />
      </outcomeDoers>
    </ingestible>
  </ThingDef>

  <!-- 4. 破碎日核 -->
  <ThingDef ParentName="ResourceBase">
    <defName>Raven_ShatteredSunCore</defName>
    <label>破碎日核</label>
    <description>古代金乌都星毁灭后的核心碎片。这种晶体内部封存着仿佛仍在流动的太阳光丝。\n\n它是制作神级装备的必要材料，也是极其昂贵的收藏品。</description>
    <graphicData>
      <texPath>Items/Materials/ShatteredSunCore</texPath>
      <graphicClass>Graphic_StackCount</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>2500</MarketValue>
      <Mass>0.5</Mass>
      <Flammability>0</Flammability>
      <Beauty>10</Beauty>
    </statBases>
    <thingCategories>
      <li>Manufactured</li>
    </thingCategories>
    <tradeTags>
      <li>ExoticMisc</li>
    </tradeTags>
    <stackLimit>75</stackLimit>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Items\Resources\ThingDef_UnfertilizedEgg.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 未受精灵卵 -->
  <ThingDef ParentName="EggUnfertBase">
    <defName>Raven_SpiritEgg_Unfertilized</defName>
    <label>unfertilized spirit egg</label>
    <description>A raven spirit egg that was not fertilized. It cannot hatch life but contains high nutrition and emits a faint warmth.</description>
    <graphicData>
      <texPath>Items/Resource/RavenSpiritEgg</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <drawSize>1.8</drawSize>
      <color>(200, 200, 200)</color>
    </graphicData>



    <statBases>
      <MarketValue>80</MarketValue>
      <Mass>1.0</Mass>
      <Nutrition>1.8</Nutrition>
      <Flammability>0.1</Flammability> <!-- [Fixed] 易燃性 -->
      <Beauty>4</Beauty> <!-- [Fixed] 负美观度 -->
    </statBases>


    <ingestible>
      <foodType>AnimalProduct</foodType>
      <preferability>RawTasty</preferability>
      <tasteThought>AteFineMeal</tasteThought>
    </ingestible>
    <tradeTags>
      <li>AnimalProduct</li>
    </tradeTags>
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Joy\Raven_AdultJoy.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <JoyKindDef>
    <defName>Raven_AdultEntertainment</defName>
    <label>淫靡感官刺激</label>
    <description>通过高度露骨的性行为影像获得的快感。这种刺激会直接引发渡鸦族最原始的交配冲动。</description>
    <needsThing>true</needsThing>
  </JoyKindDef>

  <JobDef>
    <defName>Raven_WatchAV</defName>
    <driverClass>JobDriver_WatchTelevision</driverClass>
    <reportString>正在观看成人艺术资料，因极度的快感而急促喘息。</reportString>
    <joyDuration>4000</joyDuration>
    <joyMaxParticipants>8</joyMaxParticipants>
    <joyKind>Raven_AdultEntertainment</joyKind>
    <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
  </JobDef>

  <!-- 专属想法 -->
  <ThoughtDef>
    <defName>Raven_Thought_AdultObservation</defName>
    <durationDays>0.5</durationDays>
    <stackLimit>1</stackLimit>
    <stages>
      <li>
        <label>沉沦色欲</label>
        <description>脑子里全是刚才屏幕上那些疯狂交配的画面...巨大的阳具不断贯穿湿润的小穴，伴随着“啾啵啾啵”的泥泞声和绝顶时的失神娇喘。身体变得好烫，我好想被狠狠地内射，把温暖的遗传因子填满子宫...</description>
        <baseMoodEffect>12</baseMoodEffect>
      </li>
    </stages>
  </ThoughtDef>

  <JoyGiverDef>
    <defName>Raven_Giver_WatchAV</defName>
    <giverClass>RavenRace.Features.MiscSmallFeatures.AVTelevision.JoyGiver_WatchAV</giverClass>
    <baseChance>5</baseChance> 
    <!-- 【1.6 核心修复】设为 false 后，小人会直接站在电视前观看，不再强制找椅子 -->
    <desireSit>false</desireSit> 
    <thingDefs>
      <li>TubeTelevision</li>
      <li>FlatscreenTelevision</li>
      <li>MegascreenTelevision</li>
    </thingDefs>
    <jobDef>Raven_WatchAV</jobDef>
    <joyKind>Raven_AdultEntertainment</joyKind>
    <requiredCapacities><li>Sight</li></requiredCapacities>
  </JoyGiverDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Plants\Raven_SevenEmotions.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ThingDef ParentName="PlantBase">
    <defName>RavenPlant_SevenEmotions</defName>
    <label>七情草</label>
    <description>一种通体呈现彩色光晕的奇异草药。它的花朵中蕴含着能极大地放大生物情欲感官的花蜜。</description>
    <statBases>
      <MaxHitPoints>85</MaxHitPoints>
      <Nutrition>0.2</Nutrition>
    </statBases>
    <graphicData>
      <texPath>Plants/SevenEmotionsHerb/SevenEmotionsHerb</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <selectable>true</selectable>
    <plant>
      <sowTags>
        <li>Ground</li>
        <li>Hydroponic</li>
      </sowTags>
      <sowResearchPrerequisites>
        <li>RavenResearch_Reproduction</li>
      </sowResearchPrerequisites>
      <harvestTag>Standard</harvestTag>
      <!-- [核心修改] 收获物改为花蜜 -->
      <harvestedThingDef>RavenItem_SevenEmotionsNectar</harvestedThingDef>
      <harvestYield>4</harvestYield>
      <growDays>6</growDays>
      <visualSizeRange>0.3~1.1</visualSizeRange>
      <topWindExposure>0.1</topWindExposure>
    </plant>
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Plants\Raven_SevenEmotionsNectar.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 七情花蜜 -->
  <ThingDef ParentName="ResourceBase">
    <defName>RavenItem_SevenEmotionsNectar</defName>
    <label>七情花蜜</label>
    <description>从七情草的花蕊中采集的浓稠花蜜，散发着令人脸红心跳的甜腻香气。它不仅是提炼催情药剂的原料，直接燃烧时也会释放出致幻的费洛蒙烟雾。</description>
    <graphicData>
      <!-- 确保你有这个贴图：Textures/Items/Resource/SevenEmotionsNectar.png -->
      <texPath>Items/Resource/SevenEmotionsNectar</texPath>
      <graphicClass>Graphic_Single</graphicClass> 
      <color>(255, 180, 200)</color>
    </graphicData>
    <statBases>
      <MarketValue>4.5</MarketValue>
      <Mass>0.05</Mass>
      <Flammability>1.0</Flammability>
    </statBases>
    <thingCategories>
      <li>PlantMatter</li>
    </thingCategories>
    <ingestible>
        <foodType>Processed</foodType>
        <!-- 这一行非常重要，防止报错 -->
        <preferability>NeverForNutrition</preferability>
        <outcomeDoers>
            <li Class="IngestionOutcomeDoer_GiveHediff">
                <hediffDef>RavenHediff_AphrodisiacEffect</hediffDef>
                <severity>0.1</severity>
            </li>
        </outcomeDoers>
    </ingestible>
  </ThingDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Recipes\Recipes_Food_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 1. 炒渡鸦蛋 (菜肴定义) -->
  <ThingDef ParentName="MealFineBase">
    <defName>Raven_Meal_FriedEgg</defName>
    <label>炒渡鸦蛋</label>
    <description>用未受精的渡鸦灵卵制作的简单菜肴。蛋液金黄，口感滑嫩，蕴含着丰富的营养和微弱的灵气。吃下去会让人感到非常满足。</description>
    <graphicData>
      <!-- 贴图位置: Textures/Items/Food/FriedRavenEgg.png -->
      <texPath>Items/Food/FriedRavenEgg</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <statBases>
      <MarketValue>45</MarketValue>
      <WorkToMake>400</WorkToMake>
      <Nutrition>0.9</Nutrition>
    </statBases>
    <ingestible>
      <!-- [修复] RimWorld 代码中没有 MealLuxurious，最高级是 MealLavish -->
      <preferability>MealLavish</preferability> 
      <!-- 心情给予：使用原版奢华食物的心情 (+12) -->
      <tasteThought>AteLavishMeal</tasteThought> 
      <ingestEffect>EatVegetarian</ingestEffect>
      <ingestSound>Meal_Eat</ingestSound>
    </ingestible>
  </ThingDef>

  <!-- 2. 烹饪配方 -->
  <RecipeDef>
    <defName>Raven_Cook_FriedRavenEgg</defName>
    <label>烹饪炒渡鸦蛋</label>
    <description>用未受精的渡鸦灵卵制作美味的炒蛋。</description>
    <jobString>正在烹饪炒渡鸦蛋。</jobString>
    <workSpeedStat>CookSpeed</workSpeedStat>
    <effectWorking>Cook</effectWorking>
    <soundWorking>Recipe_CookMeal</soundWorking>
    <workAmount>400</workAmount>
    <recipeUsers>
      <li>ElectricStove</li>
      <li>FueledStove</li>
    </recipeUsers>
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>Raven_SpiritEgg_Unfertilized</li>
          </thingDefs>
        </filter>
        <count>1</count>
      </li>
    </ingredients>
    <fixedIngredientFilter>
      <thingDefs>
        <li>Raven_SpiritEgg_Unfertilized</li>
      </thingDefs>
    </fixedIngredientFilter>
    <products>
      <Raven_Meal_FriedEgg>1</Raven_Meal_FriedEgg>
    </products>
    <skillRequirements>
      <Cooking>6</Cooking>
    </skillRequirements>
  </RecipeDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Recipes\Recipes_Materials.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>



  <!-- ==================== [新增] 构造破碎日核 ==================== -->
  <RecipeDef>
    <defName>Make_Raven_ShatteredSunCore</defName>
    <label>构造破碎日核</label>
    <description>在升阳注入器中进行超高压粒子对撞，将日冕钢与金羽的精华凝聚成破碎日核。</description>
    <jobString>正在构造破碎日核。</jobString>
    
    <workAmount>30000</workAmount>
    <workSpeedStat>GeneralLaborSpeed</workSpeedStat>
    <effectWorking>Cremate</effectWorking>
    <soundWorking>Recipe_Machining</soundWorking>
    
    <recipeUsers>
      <li>Raven_Building_SunRaiserInjector</li>
    </recipeUsers>
    
    <ingredients>
      <li>
        <filter>
          <thingDefs>
            <li>Raven_CoronaSteel</li>
          </thingDefs>
        </filter>
        <count>100</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>Raven_GoldenFeather</li>
          </thingDefs>
        </filter>
        <count>10</count>
      </li>
      <li>
        <filter>
          <thingDefs>
            <li>ComponentSpacer</li>
          </thingDefs>
        </filter>
        <count>5</count>
      </li>
    </ingredients>
    
    <fixedIngredientFilter>
      <thingDefs>
        <li>Raven_CoronaSteel</li>
        <li>Raven_GoldenFeather</li>
        <li>ComponentSpacer</li>
      </thingDefs>
    </fixedIngredientFilter>
    
    <products>
      <Raven_ShatteredSunCore>1</Raven_ShatteredSunCore>
    </products>
    
    <skillRequirements>
      <Crafting>15</Crafting>
      <Intellectual>12</Intellectual>
    </skillRequirements>
    
    <researchPrerequisite>RavenResearch_AdvancedForging</researchPrerequisite>
  </RecipeDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Recipes\Recipe_ExtractEmberBlood.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <RecipeDef>
    <defName>Raven_Recipe_ExtractEmberBlood</defName>
    <label>提取余烬之血</label>
    <description>通过一种古老而残酷的仪式性手术，从渡鸦族的心脏中提取最后的生命精华。\n\n警告：此手术会导致受术者必然死亡。</description>
    <workerClass>RavenRace.Recipe_ExtractEmberBlood</workerClass>
    <jobString>正在提取余烬之血。</jobString>
    <workAmount>2000</workAmount>
    <surgerySuccessChanceFactor>999</surgerySuccessChanceFactor>
    <!-- [Fixed] 移除了 deathOnFailedSurgery，死亡逻辑由 C# 接管 -->
    <targetsBodyPart>false</targetsBodyPart>
    <anesthetize>true</anesthetize>
    <effectWorking>ButcherFlesh</effectWorking>
    <soundWorking>Recipe_ButcherCorpseFlesh</soundWorking>
    <recipeUsers>
      <li>Raven_Race</li>
    </recipeUsers>
    <ingredients>
      <li>
        <filter>
          <categories>
            <li>Medicine</li>
          </categories>
        </filter>
        <count>2</count>
      </li>
    </ingredients>
    <fixedIngredientFilter>
      <categories>
        <li>Medicine</li>
      </categories>
    </fixedIngredientFilter>
  </RecipeDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Things\Gas\Raven_Gas_BlackMist.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 独立定义气体，不依赖 BaseGas -->
  <ThingDef>
    <defName>RavenGas_BlackMist</defName>
    <label>黑灵迷雾</label>
    <category>Gas</category>
    <!-- 指向 C# 类 -->
    <thingClass>RavenRace.Things.RavenGas_BlackMist</thingClass>
    <tickerType>Normal</tickerType>
    <altitudeLayer>Gas</altitudeLayer>
    <useHitPoints>false</useHitPoints>
    <drawerType>MapMeshAndRealTime</drawerType>
    <graphicData>
      <texPath>Things/Gas/Puff</texPath>
      <!-- [修复] 气体必须使用 Graphic_Gas -->
      <graphicClass>Graphic_Gas</graphicClass>
      <shaderType>Transparent</shaderType>
      <drawSize>2.2</drawSize>
      <color>(20, 20, 25, 180)</color>
    </graphicData>
    <gas>
      <expireSeconds>
        <min>30</min>
        <max>45</max>
      </expireSeconds>
      <rotationSpeed>10</rotationSpeed>
      <!-- [修复] 移除了无效的 blockTurretTracking 和 accuracyPenalty -->
      <!-- 我们的 C# Harmony Patch 会全权负责命中率和视线逻辑 -->
    </gas>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Weapons\Raven\Hediffs_WeaponTraits.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 袖剑：刺杀准备 -->
  <HediffDef>
    <defName>Raven_Hediff_HiddenBladePrep</defName>
    <label>assassination prep</label> <!-- 英文占位，中文通过 DefInjected 覆盖 -->
    <description>The blade is ready for a lethal strike.</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(0.8, 0.2, 0.2)</defaultLabelColor>
    <isBad>false</isBad>
    <maxSeverity>1.0</maxSeverity>
    <stages>
      <li>
        <statOffsets>
          <MeleeDamageFactor>2.0</MeleeDamageFactor>
          <MeleeArmorPenetration>0.5</MeleeArmorPenetration>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>

  <!-- 狙击枪：稳定瞄准 -->
  <HediffDef>
    <defName>Raven_Hediff_SteadyAim</defName>
    <label>steady aim</label>
    <description>Focusing aim due to stillness.</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(0.2, 0.8, 0.8)</defaultLabelColor>
    <isBad>false</isBad>
    <maxSeverity>1.0</maxSeverity>
    <stages>
      <li>
        <minSeverity>0.1</minSeverity>
        <label>focus I</label>
        <statOffsets>
          <ShootingAccuracyPawn>2</ShootingAccuracyPawn>
        </statOffsets>
      </li>
      <li>
        <minSeverity>0.5</minSeverity>
        <label>focus V</label>
        <statOffsets>
          <ShootingAccuracyPawn>10</ShootingAccuracyPawn>
          <AimingDelayFactor>-0.2</AimingDelayFactor>
        </statOffsets>
      </li>
      <li>
        <minSeverity>1.0</minSeverity>
        <label>zen state</label>
        <statOffsets>
          <ShootingAccuracyPawn>20</ShootingAccuracyPawn>
          <AimingDelayFactor>-0.4</AimingDelayFactor>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Weapons\Raven\Raven_Weapon_BlackMistGrenade.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 1. 投掷物 -->
  <ThingDef ParentName="BaseGrenadeProjectile">
    <defName>RavenProj_BlackMistGrenade</defName>
    <label>黑灵烟雾弹</label>
    <thingClass>Projectile_Explosive</thingClass>
    <graphicData>
      <texPath>Things/Projectile/Grenade</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <projectile>
      <explosionRadius>4.9</explosionRadius>
      <damageDef>Smoke</damageDef>
      <postExplosionSpawnThingDef>RavenGas_BlackMist</postExplosionSpawnThingDef>
      <postExplosionSpawnChance>1</postExplosionSpawnChance>
      <postExplosionSpawnThingCount>1</postExplosionSpawnThingCount>
      <explosionDelay>50</explosionDelay>
    </projectile>
  </ThingDef>

  <!-- 2. 武器 -->
  <ThingDef ParentName="BaseMakeableGrenade">
    <defName>Raven_Weapon_BlackMistGrenade</defName>
    <label>黑灵烟雾弹</label>
    <description>一种填充了特殊炼金气体的烟雾弹。这种黑色的迷雾蕴含着某种只能被金乌血脉穿透的微粒。\n\n效果：阻碍敌人的视线和命中率，但我方单位不受影响。</description>
    <graphicData>
      <texPath>Items/Weapons/Raven/BlackMistGrenade</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <!-- [修复] 添加 TechLevel -->
    <techLevel>Industrial</techLevel>
    <statBases>
      <Mass>1</Mass>
      <RangedWeapon_Cooldown>2.66</RangedWeapon_Cooldown>
      <MarketValue>250</MarketValue>
    </statBases>
    <weaponTags>
      <li>GrenadeDestructive</li>
    </weaponTags>
    <verbs>
      <li>
        <label>投掷黑灵烟雾弹</label>
        <verbClass>Verb_LaunchProjectile</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <defaultProjectile>RavenProj_BlackMistGrenade</defaultProjectile>
        <warmupTime>1.5</warmupTime>
        <range>15.9</range>
        <forcedMissRadius>1.9</forcedMissRadius>
        <burstShotCount>1</burstShotCount>
        <targetParams>
          <canTargetLocations>true</canTargetLocations>
        </targetParams>
        <soundCast>ThrowGrenade</soundCast>
      </li>
    </verbs>
    <recipeMaker>
      <researchPrerequisite>RavenResearch_ChemicalWarfare</researchPrerequisite>
      <recipeUsers>
        <li>FueledSmithy</li>
        <li>ElectricSmithy</li>
      </recipeUsers>
    </recipeMaker>
    <costList>
      <Steel>20</Steel>
      <Chemfuel>40</Chemfuel>
    </costList>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Content\Weapons\Raven\Weapons_Raven_Standard.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 1. 吹箭 (Blowgun) ==================== -->

  <!-- 飞镖弹药定义 -->
  <ThingDef ParentName="BaseBullet">
    <defName>Raven_Projectile_BlowgunDart</defName>
    <label>aphrodisiac dart</label>
    <thingClass>RavenRace.Projectile_BlowgunDart</thingClass>
    <graphicData>
      <texPath>Things/Projectile/Arrow_Small</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <projectile>
      <damageDef>Scratch</damageDef>
      <damageAmountBase>1</damageAmountBase> 
      <speed>55</speed>
    </projectile>
  </ThingDef>

  <!-- 武器定义 -->
  <ThingDef ParentName="BaseHumanMakeableGun">
    <defName>Raven_Weapon_Blowgun</defName>
    <label>raven blowgun</label>
    <description>A simple but effective blowgun used by Raven assassins. It fires darts coated in a potent aphrodisiac toxin.\n\nUpon impact, the toxin is injected directly, causing the victim to lose composure.</description>
    <tickerType>Normal</tickerType>
    <graphicData>
      <texPath>Items/Weapons/Raven/RavenBlowgun</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <soundInteract>Interact_Rifle</soundInteract>
    <statBases>
      <WorkToMake>3000</WorkToMake>
      <Mass>1.2</Mass>
      <AccuracyTouch>0.95</AccuracyTouch>
      <AccuracyShort>0.80</AccuracyShort>
      <AccuracyMedium>0.40</AccuracyMedium>
      <AccuracyLong>0.20</AccuracyLong>
      <RangedWeapon_Cooldown>1.5</RangedWeapon_Cooldown>
    </statBases>
    
    <!-- [新增] 武器标签，允许被 PawnKind 引用 -->
    <weaponTags>
      <li>RavenWeapon</li>
      <li>RavenRanged</li>
    </weaponTags>

    <costList>
      <WoodLog>30</WoodLog>
      <Steel>5</Steel>
    </costList>
    <verbs>
      <li>
        <verbClass>Verb_Shoot</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <defaultProjectile>Raven_Projectile_BlowgunDart</defaultProjectile>
        <warmupTime>0.5</warmupTime>
        <range>16.9</range>
        <soundCast>Bow_Small</soundCast>
      </li>
    </verbs>
    <recipeMaker>
      <researchPrerequisite>RavenResearch_RavenWeapons</researchPrerequisite>
      <recipeUsers>
        <li>CraftingSpot</li>
        <li>FueledSmithy</li>
        <li>ElectricSmithy</li>
      </recipeUsers>
    </recipeMaker>
  </ThingDef>


  <!-- ==================== 2. 袖剑 (Hidden Blade) ==================== -->
  
  <ThingDef ParentName="BaseMeleeWeapon_Sharp_Quality">
    <defName>Raven_Weapon_HiddenBlade</defName>
    <label>hidden blade</label>
    <description>A retractable blade mounted under the wrist.\n\nSpecial Effect: After remaining out of combat for 10 seconds, the next attack deals massive damage.</description>
    <tickerType>Normal</tickerType>
    <graphicData>
      <texPath>Items/Weapons/Raven/RavenHiddenBlade</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <techLevel>Industrial</techLevel>
    <statBases>
      <WorkToMake>8000</WorkToMake>
      <Mass>0.5</Mass>
      <MarketValue>350</MarketValue>
    </statBases>
    <equippedAngleOffset>-65</equippedAngleOffset>
    
    <!-- [新增] 武器标签 -->
    <weaponTags>
      <li>RavenWeapon</li>
      <li>RavenMelee</li>
    </weaponTags>

    <costList>
      <Steel>40</Steel>
      <ComponentIndustrial>1</ComponentIndustrial>
    </costList>
    <recipeMaker>
      <researchPrerequisite>RavenResearch_RavenWeapons</researchPrerequisite>
      <recipeUsers>
        <li>FueledSmithy</li>
        <li>ElectricSmithy</li>
      </recipeUsers>
    </recipeMaker>
    <comps>
      <li Class="RavenRace.CompProperties_HiddenBlade">
        <ticksToPrep>600</ticksToPrep>
        <prepHediff>Raven_Hediff_HiddenBladePrep</prepHediff>
      </li>
    </comps>
    <tools>
      <li>
        <label>blade</label>
        <capacities>
          <li>Cut</li>
          <li>Stab</li>
        </capacities>
        <power>14</power>
        <cooldownTime>1.2</cooldownTime>
        <armorPenetration>0.4</armorPenetration>
      </li>
    </tools>
  </ThingDef>


  <!-- ==================== 3. 消音狙击枪 (Marksman Rifle) ==================== -->

  <ThingDef ParentName="BaseHumanMakeableGun">
    <defName>Raven_Weapon_SilentSniper</defName>
    <label>phantom marksman rifle</label>
    <description>A highly sophisticated sniper rifle with an integral suppressor.\n\nSpecial Effect: Staying still accumulates "Steady Aim", increasing accuracy.</description>
    <tickerType>Normal</tickerType>
    <graphicData>
      <texPath>Items/Weapons/Raven/RavenSilentSniper</texPath>
      <graphicClass>Graphic_Single</graphicClass>
      <drawSize>1.1</drawSize>
    </graphicData>
    <soundInteract>Interact_Rifle</soundInteract>
    <statBases>
      <WorkToMake>15000</WorkToMake>
      <Mass>4.5</Mass>
      <AccuracyTouch>0.50</AccuracyTouch>
      <AccuracyShort>0.70</AccuracyShort>
      <AccuracyMedium>0.85</AccuracyMedium>
      <AccuracyLong>0.88</AccuracyLong>
      <RangedWeapon_Cooldown>2.0</RangedWeapon_Cooldown>
    </statBases>
    
    <!-- [新增] 武器标签 -->
    <weaponTags>
      <li>RavenWeapon</li>
      <li>SniperRifle</li>
    </weaponTags>

    <costList>
      <Steel>80</Steel>
      <ComponentIndustrial>5</ComponentIndustrial>
    </costList>
    <comps>
      <li Class="RavenRace.CompProperties_SteadyAim">
        <aimHediff>Raven_Hediff_SteadyAim</aimHediff>
        <ticksToStack>120</ticksToStack>
      </li>
    </comps>
    <verbs>
      <li>
        <verbClass>Verb_Shoot</verbClass>
        <hasStandardCommand>true</hasStandardCommand>
        <defaultProjectile>Bullet_SniperRifle</defaultProjectile>
        <warmupTime>2.5</warmupTime>
        <range>44.9</range>
        <soundCast>Shot_SniperRifle</soundCast> 
        <soundCastTail>GunTail_Heavy</soundCastTail>
        <muzzleFlashScale>9</muzzleFlashScale>
      </li>
    </verbs>
    <recipeMaker>
      <researchPrerequisite>RavenResearch_RavenWeapons</researchPrerequisite>
      <recipeUsers>
        <li>TableMachining</li>
      </recipeUsers>
    </recipeMaker>
  </ThingDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\ClAnimationDef\RaveFly.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
    <ChezhouLib.LibDef.ClAnimation>
        <defName>Raven_Fly</defName>
        <!-- 绑定种族 -->
        <raceDef>Raven_Race</raceDef>
        <label>渡鸦族飞行动画</label>
        <!-- 序列帧路径 -->
        <texPath>ClAnimation/Raven_Fly/RavenFly</texPath>
        <!-- 播放速度 -->
        <playSpeed>2</playSpeed>
        <!-- 在哪个渲染节点播放 -->
        <renderNodeName>RavenWing_LayerB</renderNodeName>
        <!-- 在这个hediff存在时播放 -->
        <hediff>
            <li>ClHediff_Flying</li>
        </hediff>
        <!-- 播放的时候隐藏哪个渲染节点 -->
        <hiddRenderNodeName>
            <li>RavenWing_LayerA</li>
            <li>RavenWing_LayerC</li>
        </hiddRenderNodeName>
         <!-- 在执行哪个job的时候播放
        <jobDef>
            <li>testjobdef</li>
        </jobDef> -->
        <!-- 播放优先级 -->
        <pos>1</pos>
        <!-- 是否启用反向循环播放 -->
        <isRevertLoop>false</isRevertLoop>
    </ChezhouLib.LibDef.ClAnimation>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Factions\Faction_Fusang.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- ==================== 扶桑派系定义 ==================== -->
  <FactionDef ParentName="FactionBase">
    <defName>Fusang_Hidden</defName>
    <label>扶桑</label>
    <description>扶桑是一个在边缘世界暗中活动的古老组织，由幸存的渡鸦族人组成。他们没有固定的据点，行踪诡秘。</description>
    <pawnSingular>扶桑探员</pawnSingular>
    <pawnsPlural>扶桑探员</pawnsPlural>
    <fixedName>扶桑</fixedName>
    <factionIconPath>World/Factions/FusangFaction</factionIconPath>
    
    <!-- 基础设置 -->
    <requiredCountAtGameStart>1</requiredCountAtGameStart>
    <techLevel>Industrial</techLevel>
    <hidden>true</hidden>
    <humanlikeFaction>true</humanlikeFaction>
    <permanentEnemy>false</permanentEnemy>
    
    <!-- 文化与信仰 -->
    <allowedCultures>
      <li>Raven_Culture</li>
    </allowedCultures>
    <structureMemeWeights>
      <Structure_GoldenCrow>999</Structure_GoldenCrow>
    </structureMemeWeights>
    <requiredMemes>
      <li>GoldenCrow_Faith</li>
    </requiredMemes>
    <allowedMemes>
      <li>GoldenCrow_Faith</li>
      <li>Structure_GoldenCrow</li>
    </allowedMemes>
    
    <!-- 交易类型 -->
    <caravanTraderKinds>
      <li>Raven_Trader_Caravan</li>
    </caravanTraderKinds>
    <visitorTraderKinds>
      <li>Raven_Trader_Caravan</li>
    </visitorTraderKinds>
    <baseTraderKinds>
      <li>Raven_Trader_Caravan</li>
    </baseTraderKinds>
    
    <!-- 背景故事过滤 -->
    <backstoryFilters>
      <li>
        <categories>
          <li>Raven_Backstory</li>
        </categories>
      </li>
    </backstoryFilters>
    
    <!-- 基础成员类型 -->
    <basicMemberKind>Raven_Colonist</basicMemberKind>
    
    <!-- 战利品价值曲线 -->
    <raidLootValueFromPointsCurve>
      <points>
        <li>(35, 15)</li>
        <li>(100, 120)</li>
        <li>(1000, 500)</li>
        <li>(2000, 800)</li>
        <li>(4000, 1000)</li>
      </points>
    </raidLootValueFromPointsCurve>
    
    <!-- 最大单位成本曲线 -->
    <maxPawnCostPerTotalPointsCurve>
      <points>
        <li>(0, 35)</li>
        <li>(70, 50)</li>
        <li>(700, 100)</li>
        <li>(1300, 150)</li>
        <li>(100000, 10000)</li>
      </points>
    </maxPawnCostPerTotalPointsCurve>
    
    <!-- Pawn 组生成器 -->
    <pawnGroupMakers>
      <!-- 战斗队伍 -->
      <li>
        <kindDef>Combat</kindDef>
        <options>
          <Raven_Colonist>100</Raven_Colonist>
        </options>
      </li>
      
      <!-- 交易商队 -->
      <li>
        <kindDef>Trader</kindDef>
        <traders>
          <Raven_Trader>1</Raven_Trader> <!-- 这里必须是 Raven_Trader -->
        </traders>
        <carriers>
          <Muffalo>6</Muffalo>
          <Dromedary>5</Dromedary>
          <Alpaca>3</Alpaca>
        </carriers>
        <guards>
          <Raven_Colonist>10</Raven_Colonist> <!-- 护卫可以用普通单位 -->
        </guards>
      </li>
      
    </pawnGroupMakers>
    
    <maxConfigurableAtWorldCreation>9999</maxConfigurableAtWorldCreation>
    <configurationListOrderPriority>60</configurationListOrderPriority>
  </FactionDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Factions\IncidentDef_RavenTrader.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <IncidentDef>
    <defName>Raven_Incident_TraderCaravanArrival</defName>
    <label>扶桑商队抵达</label>
    <category>Misc</category>
    <targetTags>
      <li>Map_PlayerHome</li>
    </targetTags>
    <workerClass>RavenRace.Features.FusangOrganization.Trader.IncidentWorker_FusangTraderArrival</workerClass>
    <letterLabel>商队抵达</letterLabel>
    <letterText>一支来自扶桑组织的隐秘商队响应了你的召唤，抵达了殖民地。</letterText>
    <letterDef>PositiveEvent</letterDef>
    <baseChance>0</baseChance>
    <!-- [Fixed] 移除了无效的 pawnGroupMakerSeed -->
  </IncidentDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Factions\PawnKind_Raven_Base.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- ==================== 渡鸦族 PawnKind 抽象基类 ==================== -->
  <PawnKindDef Name="Raven_PawnKindBase" Abstract="True">
    <race>Raven_Race</race>
    <defaultFactionType>Fusang_Hidden</defaultFactionType>
    <chemicalAddictionChance>0.05</chemicalAddictionChance>
    <invNutrition>2.55</invNutrition>
    <itemQuality>Normal</itemQuality>
    <backstoryCryptosleepCommonality>0.08</backstoryCryptosleepCommonality>
    <forceNormalGearQuality>true</forceNormalGearQuality>
    
    <backstoryFiltersOverride>
      <li>
        <categories>
          <li>Raven_Backstory</li>
        </categories>
      </li>
    </backstoryFiltersOverride>
  </PawnKindDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Factions\PawnKind_Raven_Colonist.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- ==================== 渡鸦族战斗单位 ==================== -->
  <PawnKindDef ParentName="Raven_PawnKindBase">
    <defName>Raven_Colonist</defName>
    <label>渡鸦族探员</label>
    <labelPlural>渡鸦族探员</labelPlural>
    
    <race>Raven_Race</race>
    
    <combatPower>30</combatPower>
    <isFighter>true</isFighter>
    <apparelIgnoreSeasons>true</apparelIgnoreSeasons>
    
    <!-- 意志和抵抗 -->
    <initialWillRange>0~0</initialWillRange>
    <initialResistanceRange>10~17</initialResistanceRange>
    
    <!-- 装备 -->
    <apparelTags>
      <li>IndustrialBasic</li>
      <li>IndustrialAdvanced</li>
    </apparelTags>
    <apparelMoney>
      <min>200</min>
      <max>1000</max>
    </apparelMoney>
    
    <!-- [新增] 武器配置 -->
    <!-- 必须配置此项，否则默认无武器 -->
    <weaponMoney>
      <min>500</min>
      <max>1500</max>
    </weaponMoney>
    <weaponTags>
      <li>RavenWeapon</li>
    </weaponTags>

    <!-- 生化植入物 -->
    <techHediffsChance>0.03</techHediffsChance>
    <techHediffsMoney>
      <min>50</min>
      <max>800</max>
    </techHediffsMoney>
    <techHediffsTags>
      <li>Poor</li>
      <li>Simple</li>
    </techHediffsTags>
    
    <!-- 生命阶段图形 -->
    <lifeStages>
      <li>
        <bodyGraphicData>
          <texPath>Races/Raven/Body/RavenBody</texPath>
          <drawSize>0.75</drawSize>
        </bodyGraphicData>
      </li>
      <li>
        <bodyGraphicData>
          <texPath>Races/Raven/Body/RavenBody</texPath>
          <drawSize>0.75</drawSize>
        </bodyGraphicData>
      </li>
      <li>
        <bodyGraphicData>
          <texPath>Races/Raven/Body/RavenBody</texPath>
          <drawSize>0.9</drawSize>
        </bodyGraphicData>
      </li>
      <li>
        <bodyGraphicData>
          <texPath>Races/Raven/Body/RavenBody</texPath>
          <drawSize>1.0</drawSize>
        </bodyGraphicData>
      </li>
    </lifeStages>
  </PawnKindDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Factions\PawnKind_Raven_Trader.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <PawnKindDef ParentName="Raven_PawnKindBase">
    <defName>Raven_Trader</defName>
    <label>渡鸦商人</label>
    <labelPlural>渡鸦商人</labelPlural>
    
    <trader>true</trader>

    <race>Raven_Race</race>
    
    <combatPower>50</combatPower>
    
    <isFighter>false</isFighter>
    
    <minGenerationAge>25</minGenerationAge>
    <maxGenerationAge>60</maxGenerationAge>
    
    <initialWillRange>2~4</initialWillRange>
    <initialResistanceRange>10~17</initialResistanceRange>
    
    <!-- 装备 -->
    <apparelTags>
      <li>IndustrialBasic</li>
      <li>IndustrialAdvanced</li>
    </apparelTags>
    <apparelMoney>
      <min>1000</min>
      <max>2500</max>
    </apparelMoney>
    <apparelAllowHeadgearChance>0.8</apparelAllowHeadgearChance>
    
    <!-- [修改] 武器：允许使用渡鸦武器 -->
    <weaponTags>
      <li>SimpleGun</li>
      <li>Revolver</li>
      <li>RavenWeapon</li>
    </weaponTags>
    <weaponMoney>
      <min>300</min>
      <max>800</max>
    </weaponMoney>
    
    <!-- 技能 -->
    <skills>
      <li>
        <skill>Social</skill>
        <range>8~16</range>
      </li>
      <li>
        <skill>Shooting</skill>
        <range>3~8</range>
      </li>
    </skills>
    
    <!-- 初始库存 -->
    <inventoryOptions>
      <skipChance>0.1</skipChance>
      <subOptionsChooseOne>
        <li>
          <thingDef>Silver</thingDef>
          <countRange>
            <min>100</min>
            <max>300</max>
          </countRange>
        </li>
      </subOptionsChooseOne>
    </inventoryOptions>
  </PawnKindDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Factions\TraderKind_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <TraderKindDef>
    <defName>Raven_Trader_Caravan</defName>
    <label>扶桑隐秘商队</label>
    <commonality>1</commonality>
    <faction>Fusang_Hidden</faction>
    <!-- [Fixed] 移除了 permitRequiredForTrading 标签，默认为空 -->
    
    <stockGenerators>
      <!-- 1. 白银 -->
      <li Class="StockGenerator_SingleDef">
        <thingDef>Silver</thingDef>
        <countRange>3000~6000</countRange>
      </li>

      <!-- 2. 基础材料 (暗羽钢) -->
      <li Class="StockGenerator_SingleDef">
        <thingDef>Raven_DarkfeatherSteel</thingDef>
        <countRange>200~500</countRange>
        <price>Cheap</price>
      </li>

      <!-- 3. 高级材料 -->
      <li Class="StockGenerator_SingleDef">
        <thingDef>Raven_CoronaSteel</thingDef>
        <countRange>50~100</countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Raven_GoldenFeather</thingDef>
        <countRange>5~15</countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Raven_DarkSunLens</thingDef>
        <countRange>2~5</countRange>
      </li>
      <li Class="StockGenerator_SingleDef">
        <thingDef>Raven_ShatteredSunCore</thingDef>
        <countRange>0~2</countRange>
      </li>

      <!-- 4. 渡鸦武器 -->
      <li Class="StockGenerator_Tag">
        <tradeTag>RavenWeapon</tradeTag>
        <thingDefCountRange>3~6</thingDefCountRange>
        <countRange>1~1</countRange>
      </li>

      <!-- 5. 渡鸦装备 -->
      <li Class="StockGenerator_Tag">
        <tradeTag>RavenApparel</tradeTag>
        <thingDefCountRange>3~6</thingDefCountRange>
        <countRange>1~1</countRange>
      </li>
      
      <!-- 6. 药品 (催产素) -->
      <li Class="StockGenerator_SingleDef">
        <thingDef>Raven_Drug_Oxytocin</thingDef>
        <countRange>5~20</countRange>
      </li>
      
      <!-- 7. 收购类别 -->
      <li Class="StockGenerator_BuyTradeTag"><tag>Art</tag></li>
      <li Class="StockGenerator_BuyTradeTag"><tag>ImplantEmpireCommon</tag></li>
      <li Class="StockGenerator_BuyTradeTag"><tag>TechHediff</tag></li>
    </stockGenerators>
  </TraderKindDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Misc\RulePacks_Fusang.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 1. 人名规则：大幅扩充字库 -->
  <RulePackDef>
    <defName>NamerPersonFusang</defName>
    <rulePack>
      <rulesStrings>
        <li>r_name(p=12)->[SolidName]</li>
        
        <!-- 核心修复：在姓和名之间添加空格，确保系统能正确解析 NameTriple -->
        <li>SolidName->[NameLast] [NameFirst]</li>
        
        <!-- 姓氏 -->
        <li>NameLast->金</li>
        <li>NameLast->乌</li>
        <li>NameLast->陆</li>
        <li>NameLast->帝</li>
        <li>NameLast->羲</li>
        <li>NameLast->和</li>
        <li>NameLast->东</li>
        <li>NameLast->阳</li>
        <li>NameLast->姜</li>
        <li>NameLast->姬</li>
        <li>NameLast->赢</li>
        <li>NameLast->子</li>
        <li>NameLast->风</li>
        <li>NameLast->烈</li>
        <li>NameLast->赤</li>
        <li>NameLast->炎</li>
        <li>NameLast->火</li>
        <li>NameLast->祝</li>
        <li>NameLast->融</li>
        <li>NameLast->烛</li>

        <!-- 名字：采用组合词以增加数量级 -->
        <li>NameFirst->[NameSyl]</li>
        <li>NameFirst->[NameSyl][NameSyl]</li>

        <!-- 字库：用于组合名字 -->
        <li>NameSyl->曜</li>
        <li>NameSyl->辉</li>
        <li>NameSyl->光</li>
        <li>NameSyl->赫</li>
        <li>NameSyl->曦</li>
        <li>NameSyl->昕</li>
        <li>NameSyl->昂</li>
        <li>NameSyl->昭</li>
        <li>NameSyl->昱</li>
        <li>NameSyl->影</li>
        <li>NameSyl->墨</li>
        <li>NameSyl->羽</li>
        <li>NameSyl->翼</li>
        <li>NameSyl->翔</li>
        <li>NameSyl->天</li>
        <li>NameSyl->穹</li>
        <li>NameSyl->日</li>
        <li>NameSyl->月</li>
        <li>NameSyl->星</li>
        <li>NameSyl->辰</li>
        <li>NameSyl->离</li>
        <li>NameSyl->火</li>
        <li>NameSyl->焰</li>
        <li>NameSyl->烁</li>
        <li>NameSyl->炜</li>
        <li>NameSyl->煌</li>
        <li>NameSyl->灵</li>
        <li>NameSyl->修</li>
        <li>NameSyl->华</li>
        <li>NameSyl->烨</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

  <RulePackDef>
    <defName>NamerPersonFusangFemale</defName>
    <rulePack>
      <rulesStrings>
        <li>r_name(p=12)->[SolidName]</li>
        
        <!-- 添加空格 -->
        <li>SolidName->[NameLast] [NameFirstFemale]</li>
        
        <!-- 复用上面的姓氏 -->
        <li>NameLast->金</li>
        <li>NameLast->乌</li>
        <li>NameLast->陆</li>
        <li>NameLast->帝</li>
        <li>NameLast->羲</li>
        <li>NameLast->和</li>
        <li>NameLast->常</li>
        <li>NameLast->仪</li>
        <li>NameLast->玄</li>
        <li>NameLast->素</li>
        <li>NameLast->白</li>
        <li>NameLast->丹</li>
        <li>NameLast->朱</li>
        <li>NameLast->彤</li>
        <li>NameLast->彩</li>
        <li>NameLast->云</li>
        <li>NameLast->霓</li>
        <li>NameLast->霞</li>

        <li>NameFirstFemale->[NameSylFem]</li>
        <li>NameFirstFemale->[NameSylFem][NameSylFem]</li>

        <li>NameSylFem->月</li>
        <li>NameSylFem->灵</li>
        <li>NameSylFem->秀</li>
        <li>NameSylFem->婉</li>
        <li>NameSylFem->清</li>
        <li>NameSylFem->瑶</li>
        <li>NameSylFem->琴</li>
        <li>NameSylFem->瑟</li>
        <li>NameSylFem->霓</li>
        <li>NameSylFem->裳</li>
        <li>NameSylFem->羽</li>
        <li>NameSylFem->微</li>
        <li>NameSylFem->柔</li>
        <li>NameSylFem->熙</li>
        <li>NameSylFem->然</li>
        <li>NameSylFem->琼</li>
        <li>NameSylFem->瑰</li>
        <li>NameSylFem->瑛</li>
        <li>NameSylFem->岚</li>
        <li>NameSylFem->雪</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

  <!-- 其余规则包保持不变 -->
  <RulePackDef>
    <defName>NamerDeityFusang</defName>
    <rulePack>
      <rulesStrings>
        <li>r_deityName->三足金乌</li>
        <li>r_deityName->东皇太一</li>
        <li>r_deityName->帝俊</li>
        <li>r_deityName->羲和</li>
        <li>r_deityName->太阳女神</li>
        <li>r_deityName->金乌帝君</li>
        <li>r_deityName->日御</li>
        <li>r_deityName->火帝</li>
        <li>r_deityName->太阳神鸟</li>
        <li>r_deityName->朱雀神君</li>
        <li>r_deityName->炎阳大帝</li>
        <li>r_deityName->光明天帝</li>
        <li>r_deityName->金羽圣尊</li>
        <li>r_deityName->旭日之主</li>
        <li>r_deityName->黄昏之神</li>
        <li>r_deityName->黎明女神</li>
        
        <!-- 安全网：手动定义原版全局规则可能请求的符号 -->
        <li>place_foeSoldiers->敌人</li>
        <li>place_foeLeader->敌军首领</li>
        <li>place_foeWeapon->毁灭武器</li>
        <li>place_foeAdj->邪恶的</li>
        <li>place_personalWeapon->利刃</li>
        <li>place_massWeapon->天火</li>
        <li>place_job->使命</li>
        <li>place_community->组织</li>
        <li>place_location->战场</li>
        <li>place_event->战斗</li>
        <li>place_outcome->胜利</li>
        <li>place_reward->荣耀</li>
        <li>place_punishment->失败</li>
        <li>place_hero->勇士</li>
        <li>place_villain->恶人</li>
        <li>place_ally->盟友</li>
        <li>place_obstacle->障碍</li>
        <li>place_solution->解决方案</li>
        <li>place_goal->目标</li>
        <li>place_challenge->挑战</li>
        <li>place_skill->技能</li>
        <li>place_virtue->美德</li>
        <li>place_vice->恶习</li>
        <li>place_emotion->情感</li>
        <li>place_lesson->教训</li>
        <li>place_morale->士气</li>
        <li>place_strategy->策略</li>
        <li>place_tactic->战术</li>
        <li>deity_name->金乌神</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

  <RulePackDef>
    <defName>NamerDeityTypeFusang</defName>
    <rulePack>
      <rulesStrings>
        <li>r_deityType->神君</li>
        <li>r_deityType->圣尊</li>
        <li>r_deityType->天帝</li>
        <li>r_deityType->日神</li>
        <li>r_deityType->女神</li>
        <li>r_deityType->帝君</li>
        <li>r_deityType->御使</li>
        <li>r_deityType->火神</li>
        <li>r_deityType->圣王</li>
        <li>r_deityType->圣灵</li>
        <li>r_deityType->天尊</li>
        <li>r_deityType->天后</li>
        <li>r_deityType->神官</li>
        <li>r_deityType->使者</li>
        <li>r_deityType->守护者</li>
        <li>r_deityType->创造者</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

  <RulePackDef>
    <defName>NamerIdeoFusang</defName>
    <rulePack>
      <rulesStrings>
        <li>r_ideoName->金乌神道</li>
        <li>r_ideoName->扶桑真理</li>
        <li>r_ideoName->汤谷誓约</li>
        <li>r_ideoName->天穹铁律</li>
        <li>r_ideoName->逐日之道</li>
        
        <li>ideoName->[r_ideoName]</li>
        <li>adjective->[r_ideoAdjective]</li>
        <li>memberName->[r_memberName]</li>
        
        <li>r_ideoAdjective->金乌的</li>
        <li>r_ideoAdjective->神圣的</li>
        <li>r_ideoAdjective->太阳的</li>
        <li>r_memberName->信徒</li>
        <li>r_memberName->追随者</li>
        <li>r_memberName->逐日者</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

  <RulePackDef>
    <defName>NamerLeaderTitleFusang</defName>
    <rulePack>
      <rulesStrings>
        <li>r_leaderTitle->司命</li>
        <li>r_leaderTitle->祭酒</li>
        <li>r_leaderTitle->大司祭</li>
        <li>r_leaderTitle->掌火者</li>
        <li>r_leaderTitle->首席司命</li>
        <li>r_leaderTitle->太阳祭酒</li>
        <li>r_leaderTitle->金乌大司祭</li>
        <li>r_leaderTitle->余烬掌火者</li>
        <li>r_leaderTitle->日御</li>
        <li>r_leaderTitle->火帝</li>
        <li>r_leaderTitle->东皇太一</li>
        <li>r_leaderTitle->羲和</li>
        
        <!-- 直接定义meme相关规则，确保它们能被找到 -->
        <li>memeLeaderAdjective->神圣的</li>
        <li>memeLeaderAdjective->太阳的</li>
        <li>memeLeaderAdjective->金乌的</li>
        <li>memeLeaderAdjective->余烬的</li>
        <li>memeLeaderNoun->司命</li>
        <li>memeLeaderNoun->祭酒</li>
        <li>memeLeaderNoun->大司祭</li>
        <li>memeLeaderNoun->掌火者</li>
        <li>memeMoralist->祭酒</li>
        <li>memeMoralist->司命</li>
        <li>memeMoralist->大司祭</li>
        <li>memeMoralist->掌火者</li>
        <li>memeAdjective->神圣的</li>
        <li>memeAdjective->太阳的</li>
        <li>memeAdjective->金乌的</li>
        <li>memeAdjective->余烬的</li>
        <li>memeConcept->神圣</li>
        <li>memeConcept->太阳</li>
        <li>memeConcept->金乌</li>
        <li>memeConcept->余烬</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

  <RulePackDef>
    <defName>NamerFestivalFusang</defName>
    <rulePack>
      <rulesStrings>
        <li>r_ritualName->浴日节</li>
        <li>r_ritualName->扶桑祭</li>
        <li>r_ritualName->金羽诞</li>
        <li>r_ritualName->归巢日</li>
      </rulesStrings>
    </rulePack>
  </RulePackDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Places\PlaceDefs_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 渡鸦族文化地点定义 -->
  <PlaceDef>
    <defName>RavenPlace_TangGu</defName>
    <label>汤谷</label>
    <description>金乌栖息的神圣山谷，传说中太阳升起的地方。</description>
    <tags>
      <li>Raven_Culture</li>
      <li>Sacred</li>
      <li>Mountain</li>
    </tags>
  </PlaceDef>
  
  <PlaceDef>
    <defName>RavenPlace_FusangTree</defName>
    <label>扶桑树</label>
    <description>巨大的神树，连接天地的通道，金乌一族的圣地。</description>
    <tags>
      <li>Raven_Culture</li>
      <li>Sacred</li>
      <li>Forest</li>
    </tags>
  </PlaceDef>
  
  <PlaceDef>
    <defName>RavenPlace_SunPalace</defName>
    <label>太阳宫</label>
    <description>金乌帝君的宫殿，位于天空的最高处。</description>
    <tags>
      <li>Raven_Culture</li>
      <li>Sacred</li>
      <li>Structure</li>
    </tags>
  </PlaceDef>
  
  <PlaceDef>
    <defName>RavenPlace_ShadowValley</defName>
    <label>暗影谷</label>
    <description>渡鸦族的传统居住地，隐藏在山脉的阴影中。</description>
    <tags>
      <li>Raven_Culture</li>
      <li>Valley</li>
      <li>Settlement</li>
    </tags>
  </PlaceDef>
  
  <PlaceDef>
    <defName>RavenPlace_EmberShrine</defName>
    <label>余烬神社</label>
    <description>供奉金乌余烬的神社，渡鸦族进行仪式的地方。</description>
    <tags>
      <li>Raven_Culture</li>
      <li>Sacred</li>
      <li>Shrine</li>
    </tags>
  </PlaceDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Race\AlienRace_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <AlienRace.ThingDef_AlienRace ParentName="BasePawn">
    <defName>Raven_Race</defName>
    <label>渡鸦族</label>
    <description>他们自称“渡鸦”，是一个拥有黑色羽翼的类人种族。他们通常生活在阴影中，擅长隐秘行动和精细作业。</description>

    <inspectorTabs>
      <li>RavenRace.ITab_Bloodline</li>
    </inspectorTabs>

    <comps>
      <li>
        <compClass>RavenRace.Features.Bloodline.CompBloodline</compClass>
      </li>
      <li Class="RavenRace.Race.CompProperties_RavenRace" />
      <li Class="RavenRace.CompProperties_RavenFeatherDrop"/>
      <li Class="ChezhouLib.ClThingComp.ThingCompProperties_RaceFly">
        <flySpeed>5</flySpeed>
        <diagonalSpeed>1.414</diagonalSpeed>
        <drawHeight>4</drawHeight>
        <hoverSize>0.1</hoverSize>
        <hoverSpeed>2.5</hoverSpeed>
        <shadowTexPath>back</shadowTexPath>
        <shadowSize>1.2,1.2,1.2</shadowSize>

        <autoLandingJobDefs>    <!-- 自动降落逻辑 -->
          <!-- 睡眠/躺下 -->
          <li>LayDown</li>
          <li>LayDownAwake</li>
          <li>LayDownResting</li>
          <!-- 游泳 -->
          <li>GoSwimming</li>
          <!-- 进入建筑/载具/舱体 -->
          <li>EnterCryptosleepCasket</li>
          <li>EnterTransporter</li>
          <li>EnterBiosculpterPod</li>
          <li>EnterBuilding</li>
          <!-- 机械体充能 -->
          <li>MechCharge</li>
        </autoLandingJobDefs>

        <!-- 坠机配置 -->
        <crashOnDowned>true</crashOnDowned>
        <!-- 失去行动能力（Downed）时是否坠落（取消飞行状态） -->
        <crashLandingMode>Teleport</crashLandingMode>
        <!--         
 坠机后如果在不可站立地形上的处理模式：
 Death = 直接死亡，Teleport = 弹到最近的安全地带 -->
        <crashDamageMultiplier>1.0</crashDamageMultiplier>
        <!-- 坠机伤害乘数 -->
        <crashSound>Shuttle_CrashLanding</crashSound>
        <!-- 坠机音效 -->

        <!-- takeOffButtonTexPath 配置起飞按钮贴图 -->
        <!-- landingButtonTexPath 配置降落按钮贴图 -->
      </li>
      <li Class="ChezhouLib.ClThingComp.ThingCompProperties_ClAnimationController"/>
    </comps>

    <alienRace>
      <generalSettings>
        <maleGenderProbability>0.1</maleGenderProbability>
        <allowHumanBios>false</allowHumanBios>
        <humanRecipeImport>true</humanRecipeImport>

        <alienPartGenerator>
          <customDrawSize>(2.6, 2.6)</customDrawSize>
          <customHeadDrawSize>(1.46,1.46)</customHeadDrawSize>
          <customPortraitDrawSize>(2.6, 2.6)</customPortraitDrawSize>
          <customPortraitHeadDrawSize>(1.46, 1.46)</customPortraitHeadDrawSize>
          <headOffsetDirectional>
            <north>
              <offset>(0, 0)</offset>
            </north>
            <south>
              <offset>(0, 0)</offset>
            </south>
            <east>
              <offset>(0, 0)</offset>
            </east>
            <west>
              <offset>(0, 0)</offset>
            </west>
          </headOffsetDirectional>
          <bodyTypes>
            <li>Male</li>
            <li>Female</li>
          </bodyTypes>
          <!-- 头部类型：现在只负责轮廓（白膜） -->
          <headTypes>
            <li>Raven_Head_Normal</li>
          </headTypes>

          <colorChannels>
            <li>
              <name>skin</name>
              <first Class="ColorGenerator_Options">
                <options>
                  <li>
                    <weight>10</weight>
                    <only>RGBA(1.0, 1.0, 1.0, 1.0)</only>
                  </li>
                </options>
              </first>
            </li>
            <li>
              <name>hair</name>
              <first Class="ColorGenerator_Options">
                <options>
                  <li>
                    <weight>10</weight>
                    <only>RGBA(1.0, 1.0, 1.0, 1.0)</only>
                  </li>
                </options>
              </first>
            </li>
          </colorChannels>

          <bodyAddons>
            <!-- 1. 纹身 (保持不变) -->
            <li>
              <name>raven_womb_male</name>
              <path>Races/Raven/Tattoo/Womb/Womb_Male</path>
              <inFrontOfBody>false</inFrontOfBody>
              <alignWithHead>false</alignWithHead>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <drawSize>1.0</drawSize>
              <conditions>
                <BodyPart>Torso</BodyPart>
                <Gender>Male</Gender>
                <Posture>
                  <drawnStanding>true</drawnStanding>
                  <drawnLaying>true</drawnLaying>
                  <drawnInBed>true</drawnInBed>
                </Posture>
              </conditions>
              <offsets>
                <south>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>-0.301</layerOffset>
                </south>
                <east>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>-0.301</layerOffset>
                </east>
                <west>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>-0.301</layerOffset>
                </west>
              </offsets>
            </li>
            <li>
              <name>raven_womb_female</name>
              <path>Races/Raven/Tattoo/Womb/Womb_Female</path>
              <inFrontOfBody>false</inFrontOfBody>
              <alignWithHead>false</alignWithHead>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <drawSize>1.0</drawSize>
              <conditions>
                <BodyPart>Torso</BodyPart>
                <Gender>Female</Gender>
                <Posture>
                  <drawnStanding>true</drawnStanding>
                  <drawnLaying>true</drawnLaying>
                  <drawnInBed>true</drawnInBed>
                </Posture>
              </conditions>
              <offsets>
                <south>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-0.301</layerOffset>
                </south>
                <east>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-0.301</layerOffset>
                </east>
                <west>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-0.301</layerOffset>
                </west>
              </offsets>
            </li>

            <!-- 2.1 ================= 头发 后发 (RavenHair_Back) ================= -->
            <li>
              <path>Races/Raven/Hair/RavenHair_A_Back</path>
              <inFrontOfBody>false</inFrontOfBody>
              <alignWithHead>true</alignWithHead>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <drawSize>1.0</drawSize>
              <colorChannel>hair</colorChannel>
              <useSkipFlags>
                <li>Hair</li>
              </useSkipFlags>
              <conditions>
                <BodyPart>Head</BodyPart>
                <Posture>
                  <drawnStanding>true</drawnStanding>
                  <drawnLaying>true</drawnLaying>
                  <drawnInBed>false</drawnInBed>
                </Posture>
              </conditions>
            </li>

            <!-- 2.2 ================= 头发 主发 (RavenHair) ================= -->
            <li>
              <path>Races/Raven/Hair/RavenHair_A</path>
              <inFrontOfBody>true</inFrontOfBody>
              <alignWithHead>true</alignWithHead>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <drawSize>1.0</drawSize>
              <colorChannel>hair</colorChannel>
              <useSkipFlags>
                <li>Hair</li>
              </useSkipFlags>
              <conditions>
                <BodyPart>Head</BodyPart>
                <Posture>
                  <drawnStanding>true</drawnStanding>
                  <drawnLaying>true</drawnLaying>
                  <drawnInBed>true</drawnInBed>
                </Posture>
              </conditions>
              <offsets>
                <north>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>-1</layerOffset>
                </north>
              </offsets>
            </li>
            <!-- 静态脸 -->
            <li>
              <name>raven_face</name>
              <path>Races/Raven/Head/Face/RavenFace</path>
              <inFrontOfBody>true</inFrontOfBody>
              <alignWithHead>true</alignWithHead>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <drawSize>1.0</drawSize>
              <colorChannel>skin</colorChannel>
              <conditions>
                <BodyPart>Head</BodyPart>
                <Posture>
                  <drawnStanding>true</drawnStanding>
                  <drawnLaying>true</drawnLaying>
                  <drawnInBed>true</drawnInBed>
                </Posture>
              </conditions>
              <offsets>
                <south>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>0.01</layerOffset>
                </south>
                <north>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>0.01</layerOffset>
                </north>
                <east>
                  <bodyTypes>
                    <Female>(0,0)</Female>
                    <Male>(0,0)</Male>
                  </bodyTypes>
                  <layerOffset>0.01</layerOffset>
                </east>
              </offsets>
            </li>
            <!-- 3. 翅膀 (保持不变) -->
            <li>
              <path>Races/Raven/Wing/RavenWing_LayerC</path>
              <inFrontOfBody>false</inFrontOfBody>
              <drawSize>1.0</drawSize>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <offsets>
                <south>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                </south>
                <north>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                </north>
                <east>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                </east>
              </offsets>
            </li>
            <li>
              <path>Races/Raven/Wing/RavenWing_LayerB</path>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <inFrontOfBody>false</inFrontOfBody>
              <drawSize>1.0</drawSize>
              <offsets>
                <south>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-0.2</layerOffset>
                </south>
                <north>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>0.2</layerOffset>
                </north>
                <east>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                </east>
              </offsets>
            </li>
            <li>
              <path>Races/Raven/Wing/RavenWing_LayerA</path>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <inFrontOfBody>true</inFrontOfBody>
              <alignWithHead>false</alignWithHead>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <drawSize>1.0</drawSize>
              <offsets>
                <south>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-0.02</layerOffset>
                </south>
                <north>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-1</layerOffset>
                </north>
                <east>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>0.04</layerOffset>
                </east>
              </offsets>
            </li>

            <!-- 4. 耳羽 (保持不变) -->
            <li>
              <name>raven_RavenEar</name>
              <path>Races/Raven/Ear/RavenEar_Back</path>
              <inFrontOfBody>true</inFrontOfBody>
              <alignWithHead>true</alignWithHead>
              <drawSize>1.0</drawSize>
              <colorChannel>hair</colorChannel>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <layerInvert>true</layerInvert>
              <conditions>
                <BodyPart>Head</BodyPart>
              </conditions>
              <offsets>
                <north>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>-0.1</layerOffset>
                </north>
              </offsets>
            </li>
            <li>
              <path>Races/Raven/Ear/RavenEar_Base</path>
              <inFrontOfBody>true</inFrontOfBody>
              <scaleWithPawnDrawsize>true</scaleWithPawnDrawsize>
              <alignWithHead>true</alignWithHead>
              <drawSize>1.0</drawSize>
              <colorChannel>hair</colorChannel>
              <conditions>
                <BodyPart>Head</BodyPart>
              </conditions>
              <offsets>
                <south>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>0.05</layerOffset>
                </south>
                <north>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                </north>
                <east>
                  <bodyTypes>
                    <Male>(0,0)</Male>
                    <Female>(0,0)</Female>
                  </bodyTypes>
                  <layerOffset>0.05</layerOffset>
                </east>
              </offsets>
            </li>
          </bodyAddons>
        </alienPartGenerator>
      </generalSettings>

      <graphicPaths>
        <body>
          <path>Races/Raven/Body/RavenBody</path>
          <bodytypeGraphics>
            <Male>Races/Raven/Body/RavenBody_Male</Male>
            <Female>Races/Raven/Body/RavenBody_Female</Female>
          </bodytypeGraphics>
        </body>

        <!-- [核心修改] 头部路径现在指向 "Blank" 文件夹 (白膜/不含眼睛的头部) -->
        <head>Races/Raven/Head/Blank/RavenHead_Blank</head>
        <skinShader>Cutout</skinShader>
      </graphicPaths>

      <styleSettings>
        <li>
          <key>HairDef</key>
          <value>
            <hasStyle>true</hasStyle>
            <styleTagsOverride>
              <li>RavenHair</li>
            </styleTagsOverride>
          </value>
        </li>
        <li>
          <key>BeardDef</key>
          <value>
            <hasStyle>false</hasStyle>
          </value>
        </li>
        <li>
          <key>TattooDef</key>
          <value>
            <hasStyle>true</hasStyle>
            <styleTagsOverride>
              <li>RavenTattoo</li>
            </styleTagsOverride>
          </value>
        </li>
      </styleSettings>



      <!-- [核心修复] 使用正确的HAR服装限制结构 -->
      <raceRestriction>
        <blackEndoCategories>
          <li>Melanin</li>
          <li>HairColor</li>
          <li>BodyType</li>
        </blackEndoCategories>

        <!-- 1. 将所有渡鸦服装标记为“受限”，这样其他种族默认不能穿 -->
        <apparelList>
          <li>Raven_Apparel_Casual</li>
          <li>Raven_Apparel_Qipao</li>
          <li>Raven_Apparel_Quju</li>
        </apparelList>

        <!-- 2. 开启“只穿受限服装”模式 -->
        <onlyUseRaceRestrictedApparel>true</onlyUseRaceRestrictedApparel>

        <!-- 3. 将渡鸦服装加入“白名单”，这样渡鸦自己可以穿 -->
        <whiteApparelList>
          <li>Raven_Apparel_Casual</li>
          <li>Raven_Apparel_Qipao</li>
          <li>Raven_Apparel_Quju</li>
        </whiteApparelList>
      </raceRestriction>
    </alienRace>




    <statBases>
      <MarketValue>1750</MarketValue>
      <MoveSpeed>5.2</MoveSpeed>
      <ComfyTemperatureMin>16</ComfyTemperatureMin>
      <ComfyTemperatureMax>55</ComfyTemperatureMax>
      <LeatherAmount>50</LeatherAmount>
      <RoyalFavorValue>3</RoyalFavorValue>
    </statBases>

    <tools>
      <li>
        <label>左拳</label>
        <capacities>
          <li>Blunt</li>
        </capacities>
        <power>8.2</power>
        <cooldownTime>2</cooldownTime>
        <linkedBodyPartsGroup>LeftHand</linkedBodyPartsGroup>
      </li>
      <li>
        <label>右拳</label>
        <capacities>
          <li>Blunt</li>
        </capacities>
        <power>8.2</power>
        <cooldownTime>2</cooldownTime>
        <linkedBodyPartsGroup>RightHand</linkedBodyPartsGroup>
      </li>
      <li>
        <label>牙齿</label>
        <capacities>
          <li>Bite</li>
        </capacities>
        <power>8.2</power>
        <cooldownTime>2</cooldownTime>
        <linkedBodyPartsGroup>Teeth</linkedBodyPartsGroup>
        <chanceFactor>0.07</chanceFactor>
      </li>
    </tools>

    <race>
      <thinkTreeMain>Humanlike</thinkTreeMain>
      <thinkTreeConstant>HumanlikeConstant</thinkTreeConstant>
      <intelligence>Humanlike</intelligence>
      <makesFootprints>true</makesFootprints>
      <lifeExpectancy>80</lifeExpectancy>
      <nameCategory>HumanStandard</nameCategory>
      <body>Raven_Body</body>
      <renderTree>Humanlike</renderTree>
      <baseBodySize>1</baseBodySize>
      <baseHealthScale>1</baseHealthScale>
      <foodType>OmnivoreHuman</foodType>
      <gestationPeriodDays>18</gestationPeriodDays>
      <meatMarketValue>0.8</meatMarketValue>
      <manhunterOnDamageChance>0.20</manhunterOnDamageChance>
      <manhunterOnTameFailChance>0.02</manhunterOnTameFailChance>
      <litterSizeCurve>
        <points>
          <li>(0.5, 0)</li>
          <li>(1, 1)</li>
          <li>(1.01, 0.02)</li>
          <li>(3.5, 0)</li>
        </points>
      </litterSizeCurve>
      <lifeStageAges>
        <li>
          <def>HumanlikeBaby</def>
          <minAge>0</minAge>
        </li>
        <li>
          <def>HumanlikeChild</def>
          <minAge>3</minAge>
        </li>
        <li>
          <def>HumanlikeTeenager</def>
          <minAge>13</minAge>
        </li>
        <li>
          <def>HumanlikeAdult</def>
          <minAge>18</minAge>
        </li>
      </lifeStageAges>
      <soundMeleeHitPawn>Pawn_Melee_Punch_HitPawn</soundMeleeHitPawn>
      <soundMeleeHitBuilding>Pawn_Melee_Punch_HitBuilding</soundMeleeHitBuilding>
      <soundMeleeMiss>Pawn_Melee_Punch_Miss</soundMeleeMiss>
      <specialShadowData>
        <volume>(0.3, 0.8, 0.4)</volume>
        <offset>(0,0,-0.3)</offset>
      </specialShadowData>
      <ageGenerationCurve>
        <points>
          <li>(14,0)</li>
          <li>(16,100)</li>
          <li>(50,100)</li>
          <li>(60,30)</li>
          <li>(70,18)</li>
          <li>(80,10)</li>
          <li>(90,3)</li>
          <li>(100,0)</li>
        </points>
      </ageGenerationCurve>
      <hediffGiverSets>
        <li>OrganicStandard</li>
        <li>Human</li>
      </hediffGiverSets>
    </race>
  </AlienRace.ThingDef_AlienRace>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Race\BodyDef_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <BodyDef>
    <defName>Raven_Body</defName>
    <label>raven body</label>
    <corePart>
      <def>Torso</def>
      <height>Middle</height>
      <depth>Outside</depth>
      <groups>
        <li>Torso</li>
      </groups>
      <parts>
        <li>
          <def>Ribcage</def>
          <coverage>0.036</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Sternum</def>
          <coverage>0.015</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Pelvis</def>
          <coverage>0.025</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Spine</def>
          <coverage>0.025</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Stomach</def>
          <coverage>0.025</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Heart</def>
          <coverage>0.020</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Lung</def>
          <customLabel>left lung</customLabel>
          <coverage>0.025</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Lung</def>
          <customLabel>right lung</customLabel>
          <coverage>0.025</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Kidney</def>
          <customLabel>left kidney</customLabel>
          <coverage>0.017</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Kidney</def>
          <customLabel>right kidney</customLabel>
          <coverage>0.017</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Liver</def>
          <coverage>0.025</coverage>
          <depth>Inside</depth>
          <groups>
            <li>Torso</li>
          </groups>
        </li>
        <li>
          <def>Neck</def>
          <coverage>0.075</coverage>
          <groups>
            <li>Neck</li>
          </groups>
          <parts>
            <li>
              <def>Head</def>
              <coverage>0.80</coverage>
              <groups>
                <li>UpperHead</li>
                <li>FullHead</li>
              </groups>
              <parts>
                <li>
                  <def>Skull</def>
                  <coverage>0.18</coverage>
                  <depth>Inside</depth>
                  <groups>
                    <li>UpperHead</li>
                    <li>FullHead</li>
                  </groups>
                  <parts>
                    <li>
                      <def>Brain</def>
                      <coverage>0.80</coverage>
                      <groups>
                        <li>UpperHead</li>
                        <li>FullHead</li>
                      </groups>
                    </li>
                  </parts>
                </li>
                <li>
                  <def>Eye</def>
                  <customLabel>left eye</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>FullHead</li>
                    <li>Eyes</li>
                  </groups>
                </li>
                <li>
                  <def>Eye</def>
                  <customLabel>right eye</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>FullHead</li>
                    <li>Eyes</li>
                  </groups>
                </li>
                <li>
                  <def>Ear</def>
                  <customLabel>left ear</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>UpperHead</li>
                    <li>FullHead</li>
                  </groups>
                </li>
                <li>
                  <def>Ear</def>
                  <customLabel>right ear</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>UpperHead</li>
                    <li>FullHead</li>
                  </groups>
                </li>
                <li>
                  <def>Nose</def>
                  <coverage>0.10</coverage>
                  <groups>
                    <li>FullHead</li>
                  </groups>
                </li>
                <li>
                  <def>Jaw</def>
                  <coverage>0.15</coverage>
                  <groups>
                    <li>Teeth</li>
                    <li>FullHead</li>
                  </groups>
                </li>
              </parts>
            </li>
          </parts>
        </li>
        <li>
          <def>Shoulder</def>
          <customLabel>left shoulder</customLabel>
          <coverage>0.12</coverage>
          <groups>
            <li>Shoulders</li>
          </groups>
          <parts>
            <li>
              <def>Clavicle</def>
              <customLabel>left clavicle</customLabel>
              <coverage>0.09</coverage>
              <height>Top</height>
              <depth>Inside</depth>
              <groups>
                <li>Torso</li>
              </groups>
            </li>
            <li>
              <def>Arm</def>
              <customLabel>left arm</customLabel>
              <coverage>0.77</coverage>
              <groups>
                <li>Arms</li>
              </groups>
              <parts>
                <li>
                  <def>Humerus</def>
                  <customLabel>left humerus</customLabel>
                  <coverage>0.1</coverage>
                  <depth>Inside</depth>
                  <groups>
                    <li>Arms</li>
                  </groups>
                </li>
                <li>
                  <def>Radius</def>
                  <customLabel>left radius</customLabel>
                  <coverage>0.1</coverage>
                  <depth>Inside</depth>
                  <groups>
                    <li>Arms</li>
                  </groups>
                </li>
                <li>
                  <def>Hand</def>
                  <customLabel>left hand</customLabel>
                  <coverage>0.14</coverage>
                  <height>Bottom</height>
                  <groups>
                    <li>Hands</li>
                  </groups>
                  <parts>
                    <li>
                      <def>Finger</def>
                      <customLabel>left pinky</customLabel>
                      <coverage>0.06</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>LeftHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>left ring finger</customLabel>
                      <coverage>0.07</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>LeftHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>left middle finger</customLabel>
                      <coverage>0.08</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>LeftHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>left index finger</customLabel>
                      <coverage>0.07</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>LeftHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>left thumb</customLabel>
                      <coverage>0.08</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>LeftHand</li>
                      </groups>
                    </li>
                  </parts>
                </li>
              </parts>
            </li>
          </parts>
        </li>
        <li>
          <def>Shoulder</def>
          <customLabel>right shoulder</customLabel>
          <coverage>0.12</coverage>
          <groups>
            <li>Shoulders</li>
          </groups>
          <parts>
            <li>
              <def>Clavicle</def>
              <customLabel>right clavicle</customLabel>
              <coverage>0.09</coverage>
              <height>Top</height>
              <depth>Inside</depth>
              <groups>
                <li>Torso</li>
              </groups>
            </li>
            <li>
              <def>Arm</def>
              <customLabel>right arm</customLabel>
              <coverage>0.77</coverage>
              <groups>
                <li>Arms</li>
              </groups>
              <parts>
                <li>
                  <def>Humerus</def>
                  <customLabel>right humerus</customLabel>
                  <coverage>0.1</coverage>
                  <depth>Inside</depth>
                  <groups>
                    <li>Arms</li>
                  </groups>
                </li>
                <li>
                  <def>Radius</def>
                  <customLabel>right radius</customLabel>
                  <coverage>0.1</coverage>
                  <depth>Inside</depth>
                  <groups>
                    <li>Arms</li>
                  </groups>
                </li>
                <li>
                  <def>Hand</def>
                  <customLabel>right hand</customLabel>
                  <coverage>0.14</coverage>
                  <height>Bottom</height>
                  <groups>
                    <li>Hands</li>
                  </groups>
                  <parts>
                    <li>
                      <def>Finger</def>
                      <customLabel>right pinky</customLabel>
                      <coverage>0.06</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>RightHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>right ring finger</customLabel>
                      <coverage>0.07</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>RightHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>right middle finger</customLabel>
                      <coverage>0.08</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>RightHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>right index finger</customLabel>
                      <coverage>0.07</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>RightHand</li>
                      </groups>
                    </li>
                    <li>
                      <def>Finger</def>
                      <customLabel>right thumb</customLabel>
                      <coverage>0.08</coverage>
                      <groups>
                        <li>Hands</li>
                        <li>RightHand</li>
                      </groups>
                    </li>
                  </parts>
                </li>
              </parts>
            </li>
          </parts>
        </li>
        <li>
          <def>Leg</def>
          <customLabel>left leg</customLabel>
          <coverage>0.14</coverage>
          <height>Bottom</height>
          <groups>
            <li>Legs</li>
          </groups>
          <parts>
            <li>
              <def>Femur</def>
              <customLabel>left femur</customLabel>
              <coverage>0.1</coverage>
              <depth>Inside</depth>
              <groups>
                <li>Legs</li>
              </groups>
            </li>
            <li>
              <def>Tibia</def>
              <customLabel>left tibia</customLabel>
              <coverage>0.1</coverage>
              <depth>Inside</depth>
              <groups>
                <li>Legs</li>
              </groups>
            </li>
            <li>
              <def>Foot</def>
              <customLabel>left foot</customLabel>
              <coverage>0.1</coverage>
              <groups>
                <li>Feet</li>
              </groups>
              <parts>
                <li>
                  <def>Toe</def>
                  <customLabel>left little toe</customLabel>
                  <coverage>0.06</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>left fourth toe</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>left middle toe</customLabel>
                  <coverage>0.08</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>left second toe</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>left big toe</customLabel>
                  <coverage>0.08</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
              </parts>
            </li>
          </parts>
        </li>
        <li>
          <def>Leg</def>
          <customLabel>right leg</customLabel>
          <coverage>0.14</coverage>
          <height>Bottom</height>
          <groups>
            <li>Legs</li>
          </groups>
          <parts>
            <li>
              <def>Femur</def>
              <customLabel>right femur</customLabel>
              <coverage>0.1</coverage>
              <depth>Inside</depth>
              <groups>
                <li>Legs</li>
              </groups>
            </li>
            <li>
              <def>Tibia</def>
              <customLabel>right tibia</customLabel>
              <coverage>0.1</coverage>
              <depth>Inside</depth>
              <groups>
                <li>Legs</li>
              </groups>
            </li>
            <li>
              <def>Foot</def>
              <customLabel>right foot</customLabel>
              <coverage>0.1</coverage>
              <groups>
                <li>Feet</li>
              </groups>
              <parts>
                <li>
                  <def>Toe</def>
                  <customLabel>right little toe</customLabel>
                  <coverage>0.06</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>right fourth toe</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>right middle toe</customLabel>
                  <coverage>0.08</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>right second toe</customLabel>
                  <coverage>0.07</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
                <li>
                  <def>Toe</def>
                  <customLabel>right big toe</customLabel>
                  <coverage>0.08</coverage>
                  <groups>
                    <li>Feet</li>
                  </groups>
                </li>
              </parts>
            </li>
          </parts>
        </li>
      </parts>
    </corePart>
  </BodyDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Race\HairDefs_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <HairDef>
    <defName>Raven_Hair_Standard</defName> <!-- 保持旧名字兼容存档 -->
    <label>渡鸦长发 A</label>
    <hairGender>Any</hairGender>
    
    <!-- 指向透明贴图，实际上什么都不画 -->
    <texPath>Races/Raven/Hair/Transparent</texPath> 
    
    <styleTags>
      <li>RavenHair</li>
    </styleTags>
  </HairDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Race\HeadTypes_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <HeadTypeDef>
    <defName>Raven_Head_Normal</defName>
    <!-- [核心修改] 指向空白头 -->
    <graphicPath>Races/Raven/Head/Blank/RavenHead_Blank</graphicPath> 
    <gender>None</gender> 
  </HeadTypeDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Race\TattooDefs_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <TattooDef>
    <defName>RavenTattoo_Placeholder</defName>
    <label>无</label>
    <tattooType>Face</tattooType>
    <!-- 指向一个已存在的透明贴图 -->
    <texPath>Races/Raven/Hair/Transparent</texPath> 
    <!-- 核心修复：使用正确的标签 <styleTags> -->
    <styleTags>
        <li>RavenTattoo</li>
    </styleTags>
  </TattooDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Race\ThoughtDefs_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 1. 乐高之痛 (对应 RavenHediff_LegoPain) -->
  <ThoughtDef>
    <defName>Raven_Thought_LegoPain</defName>
    <workerClass>RavenRace.Thoughts.ThoughtWorker_LegoPain</workerClass>
    <stages>
      <li>
        <label>踩到乐高</label>
        <description>嗷！该死的乐高积木！这简直是世界上最恶毒的刑具！</description>
        <baseMoodEffect>-5</baseMoodEffect>
      </li>
    </stages>
  </ThoughtDef>

  <!-- 2. 跟腱断裂 (对应 RavenHediff_TendonCut) -->
  <ThoughtDef>
    <defName>Raven_Thought_TendonCut</defName>
    <workerClass>RavenRace.Thoughts.ThoughtWorker_TendonCut</workerClass>
    <stages>
      <li>
        <label>跟腱剧痛</label>
        <description>我的脚后跟...断了！每动一下都是钻心的疼！</description>
        <baseMoodEffect>-15</baseMoodEffect>
      </li>
    </stages>
  </ThoughtDef>

  <!-- 3. 催情效果 (对应 RavenHediff_AphrodisiacEffect) -->
  <ThoughtDef>
    <defName>Raven_Thought_AphrodisiacEffect</defName>
    <workerClass>RavenRace.Thoughts.ThoughtWorker_AphrodisiacEffect</workerClass>
    <validWhileDespawned>true</validWhileDespawned>
    <stages>
      <li>
        <label>意乱情迷</label>
        <description>身体好热...脑袋晕乎乎的...这种渴望的感觉是怎么回事...</description>
        <baseMoodEffect>5</baseMoodEffect> <!-- 甚至可能加心情 -->
      </li>
    </stages>
  </ThoughtDef>

  <!-- 4. 绝顶升天 (对应 Raven_Hediff_HighClimax) -->
  <ThoughtDef>
    <defName>Raven_Thought_HighClimax</defName>
    <workerClass>RavenRace.Thoughts.ThoughtWorker_HighClimax</workerClass>
    <validWhileDespawned>true</validWhileDespawned>
    <stages>
      <li>
        <label>绝顶余韵</label>
        <description>脑子一片空白...这就是...极乐的尽头吗...</description>
        <baseMoodEffect>20</baseMoodEffect>
      </li>
    </stages>
  </ThoughtDef>



</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Scenarios\Scenario_OutcastRaven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ScenarioDef>
    <defName>Raven_Scenario_Outcast</defName>
    <label>离群渡鸦</label>
    <description>你曾是扶桑组织的一员，或是某个隐秘巢穴的雏鸟。但现在，无论是因为犯错、派系斗争还是单纯的运气不好，你被抛弃了。\n\n你独自一人坠落在这个边缘世界，除了手中的利刃和少得可怜的补给，一无所有。\n\n这是对你生存能力的终极考验。在暗影中重铸你的羽翼，或者默默死去。</description>
    <scenario>
      <summary>一名孤独的渡鸦族幸存者。</summary>
      
      <!-- 1. 玩家派系 (必需) -->
      <playerFaction>
        <def>PlayerFaction</def>
        <factionDef>PlayerColony</factionDef>
      </playerFaction>

      <!-- 2. [Fixed] 补全缺失的 surfaceLayer (从原版 ScenarioBase 复制) -->
      <surfaceLayer>
        <def>SurfaceLayerFixed</def>
        <tag>Surface</tag>
        <layer>Surface</layer>
        <settingsDef>Surface</settingsDef>
        <hide>true</hide>
        <connections>
          <Orbit MayRequire="Ludeon.RimWorld.Odyssey">
            <zoomMode>ZoomOut</zoomMode>
          </Orbit>
        </connections>
      </surfaceLayer>

      <parts>
        <!-- [Fixed] 补全 PlanetLayer (从原版 ScenarioBase 复制) -->
        <li MayRequire="Ludeon.RimWorld.Odyssey" Class="ScenPart_PlanetLayer">
          <def>PlanetLayer</def>
          <tag>Orbit</tag>
          <layer>Orbit</layer>
          <settingsDef>Orbit</settingsDef>
          <hide>true</hide>
          <connections>
            <Surface>
              <zoomMode>ZoomIn</zoomMode>
            </Surface>
          </connections>
        </li>

        <!-- 3. 基础配置 -->
        <li Class="ScenPart_ConfigPage_ConfigureStartingPawns">
          <def>ConfigPage_ConfigureStartingPawns</def>
          <pawnCount>1</pawnCount>
          <pawnChoiceCount>8</pawnChoiceCount>
        </li>
        <li Class="ScenPart_PlayerPawnsArriveMethod">
          <def>PlayerPawnsArriveMethod</def>
          <method>DropPods</method>
        </li>

        <!-- 4. 强制种族：渡鸦 -->
        <!-- 务必确保 RavenRace.ScenPart_StartingPawnKind 类已编译且 ScenPartDefs_Raven.xml 已存在 -->
        <li Class="RavenRace.ScenPart_StartingPawnKind">
          <def>Raven_ScenPart_StartingPawnKind</def>
          <pawnKind>Raven_Colonist</pawnKind>
        </li>

        <!-- 5. 物资 -->
        <li Class="ScenPart_StartingThing_Defined">
          <def>StartingThing_Defined</def>
          <thingDef>Silver</thingDef>
          <count>200</count>
        </li>
        <li Class="ScenPart_StartingThing_Defined">
          <def>StartingThing_Defined</def>
          <thingDef>MealSurvivalPack</thingDef>
          <count>20</count>
        </li>
        <li Class="ScenPart_StartingThing_Defined">
          <def>StartingThing_Defined</def>
          <thingDef>MedicineHerbal</thingDef>
          <count>10</count>
        </li>
        
        <!-- 6. 武器 -->
        <li Class="ScenPart_StartingThing_Defined">
          <def>StartingThing_Defined</def>
          <thingDef>Raven_Weapon_HiddenBlade</thingDef>
          <count>1</count>
        </li>
        <li Class="ScenPart_StartingThing_Defined">
          <def>StartingThing_Defined</def>
          <thingDef>WoodLog</thingDef>
          <count>300</count>
        </li>
        <li Class="ScenPart_StartingThing_Defined">
          <def>StartingThing_Defined</def>
          <thingDef>Steel</thingDef>
          <count>150</count>
        </li>

        <!-- 7. 游戏规则 -->
        <li Class="ScenPart_GameStartDialog">
          <def>GameStartDialog</def>
          <text>醒来，流亡者。\n\n虽然离开了巢穴的庇护，但你依然流淌着金乌的血脉（哪怕很稀薄）。利用你的隐蔽天赋，在这个充满敌意的世界中活下去。</text>
          <closeSound>GameStartSting</closeSound>
        </li>
        
      </parts>
    </scenario>
  </ScenarioDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Core\Scenarios\ScenPartDefs_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ScenPartDef>
    <defName>Raven_ScenPart_StartingPawnKind</defName>
    <label>forced starting pawn kind</label>
    <scenPartClass>RavenRace.ScenPart_StartingPawnKind</scenPartClass>
    <category>PlayerPawnModifier</category>
    <selectionWeight>1.0</selectionWeight>
    <summaryPriority>100</summaryPriority>
  </ScenPartDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Bloodline\BloodlineDefs.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- 渡鸦族血脉定义 -->
    <RavenRace.BloodlineDef>
        <defName>Bloodline_Raven</defName>
        <label>渡鸦血脉</label>
        <labelShort>渡鸦</labelShort>
        <description>源自远古三足金乌的稀薄血脉，蕴含着对光与热的渴望。</description>
        <raceDef>Raven_Race</raceDef>
        <isGoldenCrowSource>true</isGoldenCrowSource>
    </RavenRace.BloodlineDef>
    
    <!-- 机械体血脉定义 -->
    <!-- 注意：raceDef 指向 Mech_Lancer 只是一个占位符，C# 逻辑会覆盖所有 IsMechanoid -->
    <RavenRace.BloodlineDef>
        <defName>Bloodline_Mechanoid</defName>
        <label>机械体血脉</label>
        <labelShort>机械</labelShort>
        <description>源自机械体的无机血脉。</description>
        <raceDef>Mech_Lancer</raceDef> 
    </RavenRace.BloodlineDef>

    <!-- 可以在此添加其他兼容种族的血脉定义，如鼠族等 -->
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Bloodline\Hediff_MechanoidBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_MechanoidBloodline</defName>
    <label>机械体血脉</label>
    <description>源自机械体(Mechanoid)的冰冷血脉。细胞结构中充满了纳米机械与合成材料，使其皮肤坚硬如铁，且永远不会被点燃。\n\n特性：\n- 易燃性强制为 0%\n- 利器护甲 +20%\n- 钝器护甲 +10%\n- 对毒素和高温有一定抗性</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(0.7, 0.7, 0.75)</defaultLabelColor>
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    <stages>
      <li>
        <statOffsets>
          <!-- 双重保险：虽然有 Harmony Patch，但这里显示给玩家看 -->
          <Flammability>-2.0</Flammability> 
          <ArmorRating_Sharp>0.2</ArmorRating_Sharp>
          <ArmorRating_Blunt>0.1</ArmorRating_Blunt>
          <ToxicResistance>0.5</ToxicResistance>
          <ComfyTemperatureMax>50</ComfyTemperatureMax>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Cinder\Bloodline_Cinder.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- 烟烬 (Cinder) - 只有安装了 BreadMo.Cinders 才生效 -->
    <RavenRace.BloodlineDef MayRequire="BreadMo.Cinders">
        <defName>Bloodline_Cinder</defName>
        <label>烟烬血脉</label>
        <labelShort>烟烬</labelShort>
        <description>源自余烬花园的变异血脉。体内的无定形聚合物赋予了持有者缓慢但强大的自我修复能力。</description>
        <raceDef>Alien_Cinder</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Cinder\Hediff_CinderBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_CinderBloodline</defName>
    <label>聚合物再生(次级)</label>
    <description>源自烟烬族的特殊血脉。体内的细胞结构部分被类聚合物取代，赋予了其缓慢修复受损组织甚至再生缺失肢体的能力。\n\n效果：\n- 获得再生能力 (每600ticks检测一次)\n- 受到的伤害系数 x0.9\n- 易燃性 x0.8</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(254, 216, 130)</defaultLabelColor>
    <isBad>false</isBad>
    <initialSeverity>1.0</initialSeverity>
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    
    <stages>
      <li>
        <statFactors>
          <IncomingDamageFactor>0.9</IncomingDamageFactor>
          <Flammability>0.8</Flammability>
        </statFactors>
      </li>
    </stages>
    
    <comps>
      <!-- 使用我们复刻的 C# 组件，参数参照原版 -->
      <li Class="RavenRace.Compat.Cinder.CompProperties_RavenRegen">
        <healPerDay>10</healPerDay>
        <checkInterval>600</checkInterval>
        <healPerDayUnlocked>50</healPerDayUnlocked>
        <maxPartHpForLocked>10</maxPartHpForLocked>
        <unlockedString>已觉醒</unlockedString>
      </li>
    </comps>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Dragonian\Bloodline_Dragonian.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="RooAndGloomy.DragonianRaceMod">
        <defName>Bloodline_Dragonian</defName>
        <label>龙人血脉</label>
        <labelShort>龙人</labelShort>
        <description>源自龙人的古老血脉，拥有极其强健的体魄和快速愈合能力，以及独特的产乳潜能。</description>
        <raceDef>Dragonian_Race</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Dragonian\Hediff_DragonianBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_DragonianBloodline</defName>
    <label>龙人血脉(次级)</label>
    <description>源自龙人(Dragonian)的古老血脉。赋予了持有者强健的体魄、惊人的再生能力以及压倒性的力量。\n\n数值加成：\n- 伤口愈合速度 +300% (总计 4.0倍)\n- 近战伤害 +30%\n- 近战命中 +5\n- 移动速度 +0.8\n- 受到的伤害 -15% (龙鳞防护)</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(0.8, 0.9, 1.0)</defaultLabelColor>
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    <stages>
      <li>
        <statOffsets>
          <!-- 愈合：原版 x500%。我们给 +3.0，即 400% 速度 -->
          <InjuryHealingFactor>3.0</InjuryHealingFactor>
          
          <!-- 近战伤害：原版 x135%。我们给 +0.3，即 130% -->
          <MeleeDamageFactor>0.3</MeleeDamageFactor>
          
          <!-- 近战命中：大幅提升 -->
          <MeleeHitChance>5</MeleeHitChance>
          
          <!-- 闪避 -->
          <MeleeDodgeChance>12</MeleeDodgeChance>
          
          <!-- 移动速度 -->
          <MoveSpeed>0.8</MoveSpeed>
          
          <!-- 全局减伤：模拟龙鳞 (IncomingDamageFactor 是负数收益) -->
          <IncomingDamageFactor>-0.15</IncomingDamageFactor>

          <!-- 抗性：模拟龙鳞对火焰的抗性 -->
          <ArmorRating_Heat>0.5</ArmorRating_Heat>
          <Flammability>-0.5</Flammability>
        </statOffsets>
        
        <!-- 免疫部分伤害类型 -->
        <makeImmuneTo>
           <li>Hypothermia</li>
           <li>Heatstroke</li>
        </makeImmuneTo>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Dragonian\ThingDef_DivineMilk.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 物品定义 -->
  <ThingDef ParentName="OrganicProductBase">
    <defName>Raven_DivineMilk</defName>
    <label>神赐乳</label>
    <description>一种极其罕见的混合乳液，产自同时拥有龙人与雪牛血脉的渡鸦族。它散发着金色的微光，兼具龙奶的狂野与雪牛奶的醇厚。\n\n饮用后不仅能极大满足营养需求，还能提供极其强效的生理与心理增益，被视为“液体的奇迹”。</description>
    <graphicData>
      <!-- 请确保贴图存在 -->
      <texPath>Items/Resource/DivineMilk</texPath>
      <graphicClass>Graphic_Single</graphicClass>
    </graphicData>
    <socialPropernessMatters>true</socialPropernessMatters>
    <statBases>
      <MarketValue>25.0</MarketValue> <!-- 价值提升 -->
      <Mass>0.045</Mass>
      <MaxHitPoints>60</MaxHitPoints>
      <Nutrition>0.5</Nutrition> <!-- 增强：0.35 -> 0.5 (极高营养) -->
      <DeteriorationRate>4.0</DeteriorationRate> <!-- 增强：更耐储存 -->
    </statBases>
    <comps>
      <li Class="CompProperties_Rottable">
        <daysToRotStart>30</daysToRotStart> <!-- 增强：保鲜期 30天 -->
        <rotDestroys>true</rotDestroys>
      </li>
    </comps>
    <ingestible>
      <preferability>MealFine</preferability>
      
      <!-- [核心修复] 添加 JoyKind，解决红字报错 -->
      <joyKind>Gluttonous</joyKind>
      
      <foodType>Fluid, AnimalProduct</foodType>
      
      <!-- 增强：0.5 -> 0.8 (极高娱乐) -->
      <joy>0.80</joy>
      
      <maxNumToIngestAtOnce>4</maxNumToIngestAtOnce>
      <ingestEffect>EatVegetarian</ingestEffect>
      <ingestSound>Meal_Eat</ingestSound>
      <outcomeDoers>
        <li Class="IngestionOutcomeDoer_GiveHediff">
          <hediffDef>Raven_Hediff_DivineNectar</hediffDef>
          <severity>0.5</severity>
        </li>
      </outcomeDoers>
    </ingestible>
    <thingCategories>
      <li>AnimalProductRaw</li>
    </thingCategories>
    <tradeTags>
        <li>ExoticMisc</li>
    </tradeTags>
  </ThingDef>

  <!-- 饮用 Buff：神赐滋养 (大幅增强) -->
  <HediffDef>
    <defName>Raven_Hediff_DivineNectar</defName>
    <label>神赐滋养</label>
    <description>饮用了神赐乳。仿佛有一股神圣的能量流淌在血管中，思维变得无比清晰，身体充满了力量。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(1.0, 0.8, 0.2)</defaultLabelColor>
    <comps>
      <li Class="HediffCompProperties_Disappears">
        <disappearsAfterTicks>15000</disappearsAfterTicks> <!-- 持续 6小时 -->
      </li>
    </comps>
    <stages>
      <li>
        <capMods>
            <!-- 增强：意识 +10% (提升一切) -->
            <li>
                <capacity>Consciousness</capacity>
                <offset>0.10</offset>
            </li>
        </capMods>
        <statOffsets>
            <!-- 增强：工作速度 +20% -->
            <WorkSpeedGlobal>0.2</WorkSpeedGlobal>
            <!-- 增强：学习速度 +20% -->
            <GlobalLearningFactor>0.2</GlobalLearningFactor>
            <!-- 增强：精神崩溃阈值 -15% (更不容易崩溃) -->
            <MentalBreakThreshold>-0.15</MentalBreakThreshold>
            <!-- 增强：免疫速度 +10% -->
            <ImmunityGainSpeed>0.1</ImmunityGainSpeed>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>
  
  <!-- 心情 Buff -->
  <ThoughtDef>
    <defName>Raven_Thought_AteDivineMilk</defName>
    <durationDays>0.5</durationDays>
    <stages>
      <li>
        <label>饮用神赐乳</label>
        <description>这不仅仅是某种乳制品...这是液体的黄金，是生命的礼赞！我感觉棒极了！</description>
        <baseMoodEffect>8</baseMoodEffect> <!-- 增强：+5 -> +8 -->
      </li>
    </stages>
  </ThoughtDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Epona\Bloodline_Epona.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- 艾波娜 (Epona) - 三合一核心定义 -->
    <!-- 核心修复：添加 MayRequire，包ID为 Peppne.Epona -->
    <RavenRace.BloodlineDef MayRequire="Peppne.Epona">
        <defName>Bloodline_Epona</defName>
        <label>艾波娜血脉</label>
        <labelShort>艾波娜</labelShort>
        <description>源自艾波娜(Epona)及其亚种(战马、独角兽)的统合血脉。赋予了持有者强健的腿部力量和在开阔地带奔跑的渴望。</description>
        <raceDef>Alien_Epona</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Koelime\Bloodline_Koelime.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="Draconis.Koelime">
        <defName>Bloodline_Koelime</defName>
        <label>珂莉姆血脉</label>
        <labelShort>珂莉姆</labelShort>
        <description>源自古龙种珂莉姆的血脉，流淌着强大的再生因子与对疾病的抗性。</description>
        <raceDef>Alien_Koelime</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Koelime\Hediff_KoelimeBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_KoelimeBloodline</defName>
    <label>古龙血脉(次级)</label>
    <description>源自古龙种珂莉姆的血脉力量。虽然不如纯血古龙那般强横，但依然赋予了持有者对多种致命疾病的免疫力以及显著的再生能力。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(1.0, 0.8, 0.2)</defaultLabelColor> <!-- 金色 -->
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    
    <stages>
      <li>
        <!-- 修正1：免疫列表移动到 Stage 内部 -->
        <makeImmuneTo>
          <li>Flu</li>
          <li>Malaria</li>
          <li>SleepingSickness</li>
          <li>Plague</li>
          <li>WoundInfection</li>
          <li>LungRot</li>
          <li>GutWorms</li>
          <li>MuscleParasites</li>
          <li>OrganDecay</li>
        </makeImmuneTo>

        <!-- 再生能力：原版 KoelimeRegeneration 是 50，我们给 20 -->
        <regeneration>20</regeneration>
        <showRegenerationStat>true</showRegenerationStat>
        <statOffsets>
           <!-- 稍微加一点肉度体现龙血 -->
           <IncomingDamageFactor>-0.05</IncomingDamageFactor>
        </statOffsets>
      </li>
    </stages>
    
    <!-- 修正2：移除了 HediffCompProperties_DisappearsOnDeath 组件 -->
    <!-- 只要不加这个组件，且 HediffDef 默认配置下，状态通常会保留在尸体上 -->
    <comps>
    </comps>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Milira\Bloodline_Milira.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- 米莉拉 (Milira) - 包含原版和帝国版 -->
    <RavenRace.BloodlineDef MayRequire="Ancot.Milira">
        <defName>Bloodline_Milira</defName>
        <label>米莉拉血脉</label>
        <labelShort>米莉拉</labelShort>
        <description>源自拥有洁白羽翼的机械天使血脉。赋予了持有者更轻盈的身姿和更精准的射击本能。</description>
        <raceDef>Milira_Race</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Milira\Hediff_MiliraBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_MiliraBloodline</defName>
    <label>天使血脉(次级)</label>
    <description>源自米莉拉的天使血脉。身体变得更加轻盈，神经反应也更适合远程作战。\n\n效果：\n- 移动速度 +1.0 格/秒\n- 瞄准时间 x90%</description>
    <hediffClass>HediffWithComps</hediffClass>
    <defaultLabelColor>(0.8, 0.9, 1.0)</defaultLabelColor>
    <isBad>false</isBad>
    <initialSeverity>1.0</initialSeverity>
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    
    <stages>
      <li>
        <statOffsets>
          <MoveSpeed>1.0</MoveSpeed>
        </statOffsets>
        <statFactors>
          <AimingDelayFactor>0.9</AimingDelayFactor>
        </statFactors>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Mincho\Bloodline_Mincho.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <!-- 珉巧 (Mincho) - 只有安装了 Mincho the Mint Choco Slime 才生效 -->
    <!-- [核心修复] 使用了正确的 packageId -->
    <RavenRace.BloodlineDef MayRequire="SutSutMan.MinchoTheMintChocoSlimeHARver">
        <defName>Bloodline_Mincho</defName>
        <label>珉巧血脉</label>
        <labelShort>珉巧</labelShort>
        <description>源自薄荷巧克力史莱姆的冰凉血脉。这股血脉让持有者对极寒环境无所畏惧，并且身体能够自然凝结出美味的薄荷巧克力。</description>
        <raceDef>Mincho_ThingDef</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Mincho\Hediff_MinchoBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <!-- 珉巧血脉 Hediff - 只负责属性修正 -->
  <HediffDef MayRequire="SutSutMan.MinchoTheMintChocoSlimeHARver">
    <defName>Raven_Hediff_MinchoBloodline</defName>
    <label>珉巧血脉</label>
    <description>源自珉巧(Mincho)的冰凉血脉。身体的细胞结构发生了根本性的改变，使其完全免疫寒冷，并将多余的能量转化为薄荷巧克力。\n\n效果：\n- 最低舒适温度降至-500℃\n- 能够生产薄荷巧克力</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(0.55, 0.86, 0.90)</defaultLabelColor>
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    <stages>
      <li>
        <statOffsets>
          <ComfyTemperatureMin>-516</ComfyTemperatureMin>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Miraboreas\Bloodline_Miraboreas.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="Tourswen.LegendaryBlackDragon">
        <defName>Bloodline_Miraboreas</defName>
        <label>米拉波雷亚斯血脉</label>
        <labelShort>米拉</labelShort>
        <description>源自传说中的古龙“米拉波雷亚斯”的毁灭血脉。这股力量赋予了持有者无视痛苦与硬直的坚韧，以及在近身搏斗中爆发出范围冲击的恐怖能力。</description>
        <!-- 核心：链接到米拉波雷亚斯种族的defName -->
        <raceDef>LBD_Fatalis_Race</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Miraboreas\Hediff_MiraboreasBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <HediffDef MayRequire="Tourswen.LegendaryBlackDragon">
        <defName>Raven_Hediff_MiraboreasBloodline</defName>
        <label>黑龙血脉</label>
        <description>混合了传说古龙“米拉波雷亚斯”的血脉，获得了其部分毁灭性的力量。\n\n效果：\n- 完全免疫受击硬直。\n- 使用近战武器攻击时，有概率触发“拍击”，对目标周围小范围内的敌人造成冲击伤害。</description>
        <hediffClass>HediffWithComps</hediffClass>
        <defaultLabelColor>(0.8, 0.2, 0.2)</defaultLabelColor>
        <isBad>false</isBad>
        <initialSeverity>1.0</initialSeverity>
        <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
        
        <stages>
          <li>
            <statFactors>
                <!-- 核心：将受击硬直时间乘数设为0，实现免疫 -->
                <StaggerDurationFactor>0</StaggerDurationFactor>
            </statFactors>
          </li>
        </stages>
        
        <comps>
            <!-- 核心：存储拍击的范围和伤害系数 -->
          <li Class="RavenRace.Compat.Miraboreas.CompProperties_MiraboreasSlam">
            <slamRadius>3</slamRadius>
            <slamDamageFactor>0.8</slamDamageFactor>
          </li>
        </comps>
    </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MoeLotl\Bloodline_MoeLotl.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="HenTaiLoliTeam.Axolotl">
        <defName>Bloodline_MoeLotl</defName>
        <label>萌螈血脉</label>
        <labelShort>萌螈</labelShort>
        <description>源自萌螈的修仙血脉，赋予了持有者感应天地灵气与修炼功法的潜能。</description>
        <raceDef>Axolotl</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MoeLotl\WorkGiver_RavenReadBook.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 核心修复：修正 MayRequire 的包 ID -->
  <WorkGiverDef MayRequire="HenTaiLoliTeam.Axolotl"> 
    <defName>Raven_ReadMoeLotlQiSkillBooks</defName>
    <label>read books (raven)</label>
    <giverClass>RavenRace.Compat.MoeLotl.WorkGiver_RavenReadBook</giverClass>
    <workType>Axolotl_ReadMoeLotlQiSkillBooks</workType> 
    <verb>read</verb>
    <gerund>reading</gerund>
    <canBeDoneWhileDrafted>false</canBeDoneWhileDrafted>
    <!-- 优先级高一点，确保排在前面 -->
    <priorityInType>600</priorityInType> 
  </WorkGiverDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Moyo\Bloodline_Moyo.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="Nemonian.MY2.Beta">
        <defName>Bloodline_Moyo</defName>
        <label>茉约血脉</label>
        <labelShort>茉约</labelShort>
        <description>源自深海茉约的血脉，体内流淌着能够生成深蓝物质的特殊体液。</description>
        <raceDef>Alien_Moyo</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MuGirl\Abilities_MuGirl.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 核心修复：添加 MayRequire，包ID为 Nukafrog.MooGirl -->
  <AbilityDef MayRequire="Nukafrog.MooGirl">
    <defName>Raven_Ability_MuGirlCharge</defName>
    <label>雪牛冲锋</label>
    <description>利用雪牛娘血脉中的蛮力，向目标发起猛烈的冲锋。</description>
    <iconPath>UI/MooGirl_Charge</iconPath> <!-- 确保 Textures/UI/MooGirl_Charge.png 存在，或者依赖 MooGirl 模组 -->
    
    <cooldownTicksRange>1200</cooldownTicksRange>
    <jobDef>Raven_Job_MuGirlCharge</jobDef>
    <targetRequired>True</targetRequired>
    <canUseAoeToGetTargets>False</canUseAoeToGetTargets>
    <stunTargetWhileCasting>True</stunTargetWhileCasting>
    <showCastingProgressBar>True</showCastingProgressBar>
    <displayGizmoWhileUndrafted>True</displayGizmoWhileUndrafted>
    <disableGizmoWhileUndrafted>False</disableGizmoWhileUndrafted>
    <hostile>true</hostile>

    <verbProperties>
      <verbClass>Verb_CastAbility</verbClass>
      <range>19.9</range> 
      <warmupTime>0.5</warmupTime>
      <requireLineOfSight>true</requireLineOfSight>
      <targetParams>
        <canTargetSelf>False</canTargetSelf>
        <canTargetPawns>True</canTargetPawns>
        <canTargetBuildings>False</canTargetBuildings>
        <canTargetAnimals>True</canTargetAnimals>
        <canTargetMechs>True</canTargetMechs>
        <neverTargetIncapacitated>False</neverTargetIncapacitated>
      </targetParams>
    </verbProperties>

    <comps>
      <li Class="RavenRace.Compat.MuGirl.CompProperties_AbilityMuGirlCharge">
        <compClass>RavenRace.Compat.MuGirl.CompAbilityEffect_MuGirlCharge</compClass>
      </li>
    </comps>
  </AbilityDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MuGirl\Bloodline_MuGirl.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="Nukafrog.MooGirl">
        <defName>Bloodline_MuGirl</defName>
        <label>雪牛血脉</label>
        <labelShort>雪牛</labelShort>
        <description>源自雪牛娘的强韧血脉，赋予了持有者惊人的耐力、护甲以及特殊的产乳能力。</description>
        <raceDef>MooGirl</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MuGirl\Hediff_ChargeSpeed.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_ChargeVelocity</defName>
    <label>冲锋爆发(极速)</label>
    <description>腿部肌肉爆发出惊人的力量，速度极快。</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(0.5, 0.5, 1.0)</defaultLabelColor>
    <stages>
      <li>
        <statFactors>
          <!-- 极端加速：15倍移速 -->
          <MoveSpeed>15.0</MoveSpeed> 
        </statFactors>
        <statOffsets>
          <!-- 极高闪避 -->
          <MeleeDodgeChance>80</MeleeDodgeChance> 
        </statOffsets>
      </li>
    </stages>
    <comps>
      <li Class="HediffCompProperties_Disappears">
        <disappearsAfterTicks>600</disappearsAfterTicks>
      </li>
    </comps>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MuGirl\Hediff_MuGirlBloodline.xml
=
.
<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <HediffDef>
    <defName>Raven_Hediff_MuGirlBloodline</defName>
    <label>雪牛血脉(显性)</label>
    <description>源自雪牛娘(MooGirl)的强韧血脉。赋予了持有者惊人的皮肤硬度和抗打击能力，以及分泌特殊营养乳汁的潜能。\n\n数值加成：\n- 护甲 +60%\n- 热能护甲 +80%\n- 受到的伤害 -15%\n- 近战伤害 +15%</description>
    <hediffClass>HediffWithComps</hediffClass>
    <isBad>false</isBad>
    <defaultLabelColor>(0.7, 0.8, 1.0)</defaultLabelColor>
    <keepOnBodyPartRestoration>True</keepOnBodyPartRestoration>
    <stages>
      <li>
        <statOffsets>
          <!-- 原版 1.0 -> 我们 0.6 -->
          <ArmorRating_Sharp>0.6</ArmorRating_Sharp>
          <ArmorRating_Blunt>0.6</ArmorRating_Blunt>
          <!-- 原版 1.4 -> 我们 0.8 -->
          <ArmorRating_Heat>0.8</ArmorRating_Heat>
          
          <!-- 原版 0.65 (-35%) -> 我们 -15% -->
          <IncomingDamageFactor>-0.15</IncomingDamageFactor>
          
          <!-- 原版 1.3 (+30%) -> 我们 +15% -->
          <MeleeDamageFactor>0.15</MeleeDamageFactor>
        </statOffsets>
      </li>
    </stages>
  </HediffDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_MuGirl\Jobs_MuGirl.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <JobDef>
    <defName>Raven_Job_MuGirlCharge</defName>
    <driverClass>RavenRace.Compat.MuGirl.JobDriver_RavenMuGirlCharge</driverClass>
    <reportString>正在向 TargetA 发起冲锋。</reportString>
    <allowOpportunisticPrefix>true</allowOpportunisticPrefix>
    <casualInterruptible>false</casualInterruptible>
  </JobDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Tailin\Bloodline_Tailin.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="LepechandEusro.Tailin">
        <defName>Bloodline_Tailin</defName>
        <label>泰临血脉</label>
        <labelShort>泰临</labelShort>
        <description>源自泰临族的血脉，赋予了持有者敏锐的战斗直觉。</description>
        <raceDef>TailinRace</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Features\Hybridization\Compat_Wolfein\Bloodline_Wolfein.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
    <RavenRace.BloodlineDef MayRequire="MelonDove.WolfeinRace">
        <defName>Bloodline_Wolfein</defName>
        <label>沃芬血脉</label>
        <labelShort>沃芬</labelShort>
        <description>源自沃芬狼族的野性血脉，赋予了持有者在夜间与满月时更敏锐的感官。</description>
        <raceDef>Wolfein_Race</raceDef>
    </RavenRace.BloodlineDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Research\ResearchTab_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ResearchTabDef>
    <defName>Raven_ResearchTab</defName>
    <label>渡鸦科技</label> <!-- 这是中文，如果你想支持多语言，这里填 RavenTech，然后在语言文件中翻译 -->
  </ResearchTabDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Research\Research_AdvancedForging.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ResearchProjectDef>
    <defName>RavenResearch_AdvancedForging</defName>
    <label>升阳锻造</label>
    <description>研究金乌神话中关于创造“太阳”的传说，结合现代粒子对撞技术，尝试重现古代金乌族的神级锻造工艺。解锁“升阳注入器”的建造，用以制造破碎日核。</description>
    <baseCost>4000</baseCost> <!-- 高昂的研究成本 -->
    <techLevel>Spacer</techLevel> <!-- 宇航级科技 -->
    <prerequisites>
      <li>RavenResearch_EmberExtraction</li> <!-- 前置科技：余烬提取 -->
    </prerequisites>
    <!-- 在科技树中的位置 -->
    <researchViewX>8.00</researchViewX>
    <researchViewY>2.00</researchViewY>
    <tab>Raven_ResearchTab</tab>
  </ResearchProjectDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Research\Research_EmberExtraction.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <ResearchProjectDef>
    <defName>RavenResearch_EmberExtraction</defName>
    <label>余烬提取技术</label>
    <description>解锁建造残火提取仪，允许以工业化的方式从渡鸦族体内提取余烬之血。</description>
    <baseCost>1500</baseCost>
    <techLevel>Industrial</techLevel>
    <prerequisites>
      <li>RavenResearch_BasicMaterials</li>
      <li>RavenResearch_Reproduction</li>
    </prerequisites>
    <researchViewX>7.00</researchViewX>
    <researchViewY>2.00</researchViewY>
    <tab>Raven_ResearchTab</tab>
  </ResearchProjectDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Research\Research_Equipment_Raven.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- 基础装备 -->
  <ResearchProjectDef>
    <defName>RavenResearch_RavenWeapons</defName>
    <label>渡鸦武装</label>
    <description>解锁渡鸦族的标志性武器：袖剑、幽灵射手步枪和催情吹箭。</description>
    <baseCost>1000</baseCost>
    <techLevel>Industrial</techLevel>
    <prerequisites>
      <li>Machining</li>
      <!-- [已移除] RavenResearch_TrapBasics -->
    </prerequisites>
    <researchViewX>6.00</researchViewX>
    <researchViewY>1.00</researchViewY>
    <tab>Raven_ResearchTab</tab>
  </ResearchProjectDef>

  <!-- 特殊装备 (保持不变) -->
  <ResearchProjectDef>
    <defName>RavenResearch_RavenSpecials</defName>
    <label>渡鸦秘宝</label>
    <description>解锁具有特殊用途的装备：暗影斗篷和灵卵拉珠。</description>
    <baseCost>1200</baseCost>
    <techLevel>Industrial</techLevel>
    <prerequisites>
      <li>RavenResearch_RavenWeapons</li>
      <li>ComplexClothing</li>
    </prerequisites>
    <researchViewX>7.00</researchViewX>
    <researchViewY>1.00</researchViewY>
    <tab>Raven_ResearchTab</tab>
  </ResearchProjectDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Research\Research_Materials.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<Defs>
  <!-- 渡鸦基础工艺 -->
  <ResearchProjectDef>
    <defName>RavenResearch_BasicMaterials</defName>
    <label>渡鸦基础工艺</label>
    <description>解锁渡鸦族的基础材料处理技术，允许建造薄暮制作台以加工暗羽钢等特殊材料。</description>
    <baseCost>600</baseCost>
    <techLevel>Industrial</techLevel>
    <prerequisites>
      <li>Electricity</li>
    </prerequisites>
    <!-- 放在渡鸦科技页面的左侧起始位置 -->
    <researchViewX>5.00</researchViewX>
    <researchViewY>2.00</researchViewY>
    <tab>Raven_ResearchTab</tab>
  </ResearchProjectDef>
</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Defs\Research\Research_RavenTailoring.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<Defs>

  <!-- ==================== 渡鸦缝纫技术 ==================== -->
  <ResearchProjectDef>
    <!-- 定义名称，用于内部引用 -->
    <defName>RavenResearch_Tailoring</defName>
    <!-- 游戏内显示的名称 -->
    <label>渡鸦缝纫技术</label>
    <!-- 游戏内显示的描述 -->
    <description>研究渡鸦族独特的服装裁剪和制作工艺，这些技术特别考虑了翅膀的结构与活动范围。解锁“渡鸦缝纫台”的建造，并允许制作多种渡鸦族专属服饰。</description>
    
    <!-- 研究成本 -->
    <baseCost>800</baseCost>
    <!-- 科技等级 -->
    <techLevel>Industrial</techLevel>
    
    <!-- 前置科技 -->
    <prerequisites>
      <li>ComplexClothing</li>
    </prerequisites>
    
    <!-- 在科技树中的位置 (X, Y) -->
    <researchViewX>3.00</researchViewX>
    <researchViewY>3.00</researchViewY>
    
    <!-- 所属科技标签页 -->
    <tab>Raven_ResearchTab</tab>
  </ResearchProjectDef>

</Defs>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\EspionageMissionDef\EspionageMissionDefs.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_Mission_GatherIntel.label>搜集基础情报</Raven_Mission_GatherIntel.label>
  <Raven_Mission_GatherIntel.description>派遣间谍混入派系外围，搜集关于官员身份和性格的基础信息。</Raven_Mission_GatherIntel.description>

  <Raven_Mission_StealSupplies.label>窃取物资</Raven_Mission_StealSupplies.label>
  <Raven_Mission_StealSupplies.description>从派系仓库中盗取少量补给品。风险较低。</Raven_Mission_StealSupplies.description>

  <Raven_Mission_ProbeOfficial.label>刺探详细资料</Raven_Mission_ProbeOfficial.label>
  <Raven_Mission_ProbeOfficial.description>深入调查特定官员的个人喜好、弱点和人际关系。这是策反或暗杀的前置准备。</Raven_Mission_ProbeOfficial.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_Concealment.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenHediff_Concealed.label>隐蔽中</RavenHediff_Concealed.label>
  <RavenHediff_Concealed.description>此人正藏身于特制的伪装掩体中。对敌人而言几乎是隐形的。</RavenHediff_Concealed.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_DegradationCharm.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Raven_Hediff_Degradation.label>淫堕刻印</Raven_Hediff_Degradation.label>
  <Raven_Hediff_Degradation.description>这张符咒正像饥渴的藤蔓，将它的意志深植于宿主的灵魂。快感与屈辱的蜜液正在重塑其心智，每一次心跳都伴随着对交合的渴望。理智的堤坝正在崩塌，只待最后一次极乐的洪流将其彻底冲垮。</Raven_Hediff_Degradation.description>
  
  <Raven_Hediff_Degradation.stages.初染.label>初染 (1%)</Raven_Hediff_Degradation.stages.初染.label>
  <Raven_Hediff_Degradation.stages.沉沦.label>沉沦 (25%)</Raven_Hediff_Degradation.stages.沉沦.label>
  <Raven_Hediff_Degradation.stages.烙印.label>烙印 (50%)</Raven_Hediff_Degradation.stages.烙印.label>
  <Raven_Hediff_Degradation.stages.雌堕.label>雌堕 (75%)</Raven_Hediff_Degradation.stages.雌堕.label>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_GasEffects.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 麻醉累积 -->
  <RavenHediff_AnestheticBuildup.label>麻醉累积</RavenHediff_AnestheticBuildup.label>
  <RavenHediff_AnestheticBuildup.description>体内积累的麻醉气体。达到高水平时会导致昏迷。</RavenHediff_AnestheticBuildup.description>
  <RavenHediff_AnestheticBuildup.stages.drowsy.label>昏昏欲睡</RavenHediff_AnestheticBuildup.stages.drowsy.label>
  <RavenHediff_AnestheticBuildup.stages.groggy.label>神志不清</RavenHediff_AnestheticBuildup.stages.groggy.label>

  <!-- 催情效果 -->
  <RavenHediff_AphrodisiacEffect.label>催情效果</RavenHediff_AphrodisiacEffect.label>
  <RavenHediff_AphrodisiacEffect.description>强效费洛蒙正在影响受试者。会导致无法控制的脱衣冲动，并最终虚脱倒地。</RavenHediff_AphrodisiacEffect.description>
  <RavenHediff_AphrodisiacEffect.stages.aroused.label>欲火焚身</RavenHediff_AphrodisiacEffect.stages.aroused.label>
  <RavenHediff_AphrodisiacEffect.stages.flushed.label>意乱情迷</RavenHediff_AphrodisiacEffect.stages.flushed.label>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_PhysicalTraps.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenHediff_TendonCut.label>跟腱断裂</RavenHediff_TendonCut.label>
  <RavenHediff_TendonCut.description>跟腱已被完全切断。受害者的移动能力受到严重且永久的损害，不进行手术无法恢复。</RavenHediff_TendonCut.description>
  <RavenHediff_TendonCut.stages.fresh.label>新鲜伤口</RavenHediff_TendonCut.stages.fresh.label>
  <RavenHediff_TendonCut.stages.scarred.label>愈合伤疤</RavenHediff_TendonCut.stages.scarred.label>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_RapidOvulation.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_Hediff_RapidOvulation.label>强制排卵</Raven_Hediff_RapidOvulation.label>
  <Raven_Hediff_RapidOvulation.description>生殖系统正在药物刺激下超负荷运转，即将产下未受精灵卵。</Raven_Hediff_RapidOvulation.description>
  <Raven_Hediff_RapidOvulation.stages.contractions.label>阵痛</Raven_Hediff_RapidOvulation.stages.contractions.label>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_Special.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenHediff_LegoPain.label>乐高之痛</RavenHediff_LegoPain.label>
  <RavenHediff_LegoPain.description>踩到乐高产生的灵魂震颤般的剧痛。</RavenHediff_LegoPain.description>

  <RavenHediff_ConceptionProcess.label>强制受孕中</RavenHediff_ConceptionProcess.label>
  <RavenHediff_ConceptionProcess.description>正在被机器强制进行受孕过程。无法移动或反抗。</RavenHediff_ConceptionProcess.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\HediffDef\Hediffs_WeaponTraits.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 袖剑 Buff -->
  <Raven_Hediff_HiddenBladePrep.label>刺杀准备</Raven_Hediff_HiddenBladePrep.label>
  <Raven_Hediff_HiddenBladePrep.description>袖剑已滑入掌心，下一次攻击将造成毁灭性的伤害。</Raven_Hediff_HiddenBladePrep.description>

  <!-- 狙击枪 Buff -->
  <Raven_Hediff_SteadyAim.label>稳定瞄准</Raven_Hediff_SteadyAim.label>
  <Raven_Hediff_SteadyAim.description>保持静止使射手进入了极度专注的状态。精准度大幅提升。</Raven_Hediff_SteadyAim.description>
  <Raven_Hediff_SteadyAim.stages.0.label>专注 I</Raven_Hediff_SteadyAim.stages.0.label>
  <Raven_Hediff_SteadyAim.stages.1.label>专注 V</Raven_Hediff_SteadyAim.stages.1.label>
  <Raven_Hediff_SteadyAim.stages.2.label>人枪合一</Raven_Hediff_SteadyAim.stages.2.label>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\JobDef\JobDef_BloodlineRitual.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_Job_BloodlineRitual.reportString>正在进行归元回溯仪式。</Raven_Job_BloodlineRitual.reportString>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\JobDef\Jobs_Concealment.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_Job_EnterConcealment.reportString>正在驻守掩体。</Raven_Job_EnterConcealment.reportString>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\PawnRelationDef\RelationDefs_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Raven_Relation_Dominated.label>主人</Raven_Relation_Dominated.label>
  <Raven_Relation_Dominated.labelFemale>女主人</Raven_Relation_Dominated.labelFemale>



  <!-- 新增：别天神关系 -->
  <Raven_Relation_AbsoluteMaster.label>绝对主人</Raven_Relation_AbsoluteMaster.label>
  <Raven_Relation_AbsoluteMaster.labelFemale>绝对女主人</Raven_Relation_AbsoluteMaster.labelFemale>
  
  <Raven_Relation_LoyalServant.label>忠诚奴仆</Raven_Relation_LoyalServant.label>
  <Raven_Relation_LoyalServant.labelFemale>忠诚奴仆</Raven_Relation_LoyalServant.labelFemale>



</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\RecipeDef\Recipes_Materials_Dusk.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Make_Raven_DarkSunLens.label>制作暗日透镜</Make_Raven_DarkSunLens.label>
  <Make_Raven_DarkSunLens.description>切割暗羽钢并在高压下注入微量的金羽粉末，利用光学设备校准其折射率。这需要极高的工艺技巧。</Make_Raven_DarkSunLens.description>
  <Make_Raven_DarkSunLens.jobString>正在制作暗日透镜。</Make_Raven_DarkSunLens.jobString>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ResearchProjectDef\ResearchProjects_RavenDefense.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenResearch_TrapBasics.label>渡鸦陷阱学基础</RavenResearch_TrapBasics.label>
  <RavenResearch_TrapBasics.description>解锁碎胫陷阱等基础防御设施。</RavenResearch_TrapBasics.description>

  <RavenResearch_Concealment.label>伪装战术</RavenResearch_Concealment.label>
  <RavenResearch_Concealment.description>解锁低语之树和歌唱之石，为狙击手提供隐蔽掩体。</RavenResearch_Concealment.description>

  <RavenResearch_SpecialTraps.label>特种陷阱</RavenResearch_SpecialTraps.label>
  <RavenResearch_SpecialTraps.description>解锁乐高地雷和受孕机等非传统陷阱。</RavenResearch_SpecialTraps.description>

  <RavenResearch_DynamicTerrain.label>动态地形防御</RavenResearch_DynamicTerrain.label>
  <RavenResearch_DynamicTerrain.description>解锁升墙陷阱，能够瞬间改变战场地形。</RavenResearch_DynamicTerrain.description>

  <RavenResearch_DecoyTech.label>诱饵技术</RavenResearch_DecoyTech.label>
  <RavenResearch_DecoyTech.description>解锁渡鸦假人。</RavenResearch_DecoyTech.description>

  <RavenResearch_ChemicalWarfare.label>化学战</RavenResearch_ChemicalWarfare.label>
  <RavenResearch_ChemicalWarfare.description>解锁各种气体陷阱。</RavenResearch_ChemicalWarfare.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ResearchProjectDef\Research_AdvancedForging.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <RavenResearch_AdvancedForging.label>升阳锻造</RavenResearch_AdvancedForging.label>
  <RavenResearch_AdvancedForging.description>研究金乌神话中关于创造“太阳”的传说，结合现代粒子对撞技术，尝试重现古代金乌族的神级锻造工艺。解锁“升阳注入器”的建造，用以制造破碎日核。</RavenResearch_AdvancedForging.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ResearchProjectDef\Research_DegradationCharm.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <RavenResearch_DegradationCharm.label>淫堕咒术</RavenResearch_DegradationCharm.label>
  <RavenResearch_DegradationCharm.description>研究那些被视为禁忌的、直接作用于他人心智的符咒技术。通过将精神活性物质与渡鸦族的血脉精华相结合，可以制作出能够扭曲意志、放大欲望的“淫堕符咒”。</RavenResearch_DegradationCharm.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ResearchProjectDef\Research_Materials.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenResearch_BasicMaterials.label>渡鸦基础工艺</RavenResearch_BasicMaterials.label>
  <RavenResearch_BasicMaterials.description>解锁渡鸦族的基础材料处理技术，允许建造薄暮制作台以加工暗羽钢等特殊材料。</RavenResearch_BasicMaterials.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ResearchProjectDef\Research_Reproduction.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenResearch_Reproduction.label>渡鸦繁殖技术</RavenResearch_Reproduction.label>
  <RavenResearch_Reproduction.description>解锁控制渡鸦族独特生殖周期的技术，包括激素药物（如催产素）和专用设备。</RavenResearch_Reproduction.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ScenarioDef\Scenario_OutcastRaven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_Scenario_Outcast.label>离群渡鸦</Raven_Scenario_Outcast.label>
  <Raven_Scenario_Outcast.description>你曾是扶桑组织的一员，或是某个隐秘巢穴的雏鸟。但现在，无论是因为犯错、派系斗争还是单纯的运气不好，你被抛弃了。\n\n你独自一人坠落在这个边缘世界，除了手中的利刃和少得可怜的补给，一无所有。\n\n这是对你生存能力的终极考验。在暗影中重铸你的羽翼，或者默默死去。</Raven_Scenario_Outcast.description>


</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\StorytellerDef\Storyteller_ZuoYao.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  
  <ZuoYao_Storyteller.label>左爻</ZuoYao_Storyteller.label>
  <ZuoYao_Storyteller.description>一位神秘的渡鸦族大姐姐她自称左爻，是扶桑的一位接线员。\n\n长期与各种殖民地打交道的她练就了一张能说会道的嘴，当你和她第一次接触时，请审慎的思考如何与她沟通....也许将来她会给你一些惊喜也说不定....\n\n当你以为自己在沟通中占到了便宜时，她已经想好下一个套话的陷阱，但你也不知道真诚可以换来什么，也许你的亚萨西可能让她觉得你是个无聊的人。\n\n"这里是扶桑....我是您殖民地的专属接线员左爻，请问您今天有何贵干？"\n\n她会以与Cassandra相似的节奏推动事件。</ZuoYao_Storyteller.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Apparel_Raven_Quju.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Raven_Apparel_Quju.label>渡鸦曲裾</Raven_Apparel_Quju.label>
  <Raven_Apparel_Quju.description>一件为渡鸦族设计的传统曲裾。宽大的袖袍和层叠的裙摆不仅优雅，还为翅膀的活动留出了充足空间。采用特殊的织物制成，具有出色的保暖性能。</Raven_Apparel_Quju.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_Concealment.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenConcealment_Tree.label>低语之树</RavenConcealment_Tree.label>
  <RavenConcealment_Tree.description>一棵中空的人造树，设计作为狙击点。提供极佳的掩护和完美的隐蔽性。</RavenConcealment_Tree.description>

  <RavenConcealment_Rock.label>歌唱之石</RavenConcealment_Rock.label>
  <RavenConcealment_Rock.description>一块中空的人造岩石。</RavenConcealment_Rock.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_Decoys.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenDecoy_Dummy.label>渡鸦假人</RavenDecoy_Dummy.label>
  <RavenDecoy_Dummy.description>一个逼真的假人，外形酷似渡鸦族士兵。它内置了高级电子信号模拟器，能极大地吸引敌方AI的仇恨，使其优先将其作为高威胁目标进行攻击。</RavenDecoy_Dummy.description>
  
  <RavenDecoy_SoundLure.label>声波诱饵</RavenDecoy_SoundLure.label>
  <RavenDecoy_SoundLure.description>一种发射模拟求救信号或指挥频率的高频装置。它能强制附近的敌人前往其位置进行调查，从而打乱敌人的阵型，将其引入陷阱区域。</RavenDecoy_SoundLure.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_DynamicTerrain.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenTrap_RisingWall.label>升墙陷阱</RavenTrap_RisingWall.label>
  <RavenTrap_RisingWall.description>一种战术陷阱，触发后会在周围生成封闭墙体和屋顶，将敌人困在内部。可通过规划器调整大小。</RavenTrap_RisingWall.description>
  
  <Raven_TrapWall.label>能量屏障墙</Raven_TrapWall.label>
  <Raven_TrapWall.description>由陷阱生成的临时墙体，会在短时间后自动消散。</Raven_TrapWall.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_ExplosiveTraps.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenTrap_Claymore.label>阔剑护墙器</RavenTrap_Claymore.label>
  <RavenTrap_Claymore.description>一种设计用于保护墙体的定向爆炸装置。它仅在附着的墙体受损时触发（反工兵模式）。触发时，会向正前方扇形区域喷射致命的破片，清除威胁。</RavenTrap_Claymore.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_GasTraps.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 麻醉陷阱 -->
  <RavenTrap_Gas_Anesthetic.label>麻醉气体陷阱</RavenTrap_Gas_Anesthetic.label>
  <RavenTrap_Gas_Anesthetic.description>触发时释放一团麻醉气体，导致吸入者昏迷。</RavenTrap_Gas_Anesthetic.description>

  <!-- 催情陷阱 -->
  <RavenTrap_Gas_Aphrodisiac.label>催情气体陷阱</RavenTrap_Gas_Aphrodisiac.label>
  <RavenTrap_Gas_Aphrodisiac.description>触发时释放一团强效催情气体。受害者会不由自主地脱去衣物，并在极致的快感中倒地。</RavenTrap_Gas_Aphrodisiac.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_PhysicalTraps.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenTrap_LegCrusher.label>碎胫陷阱</RavenTrap_LegCrusher.label>
  <RavenTrap_LegCrusher.description>一种残忍的机械陷阱，专为夹断受害者的小腿而设计。锯齿状的刀片位置经过精确计算，能直接切断跟腱，造成永久性残疾。</RavenTrap_LegCrusher.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_Planner.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_RisingWall_Planner.label>升墙陷阱(规划中)</Raven_RisingWall_Planner.label>
  <Raven_RisingWall_Planner.description>放置此处以配置升墙陷阱的大小。配置完成后点击确认以开始建造真正的陷阱。</Raven_RisingWall_Planner.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Buildings_SpecialTraps.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>




  <RavenTrap_Lego.label>乐高地雷</RavenTrap_Lego.label>
  <RavenTrap_Lego.description>散落在地上的彩色塑料积木。看似无害，但光脚踩上去会产生难以想象的剧痛。</RavenTrap_Lego.description>

  <RavenTrap_Conception.label>强制受孕机</RavenTrap_Conception.label>
  <RavenTrap_Conception.description>一种邪恶的陷阱，触发后会束缚受害者并强制进行“受孕”过程，向其体内植入大量灵卵。</RavenTrap_Conception.description>




</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Building_DuskWorkbench.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  
  <Raven_Building_DuskWorkbench.label>薄暮制作台</Raven_Building_DuskWorkbench.label>
  <Raven_Building_DuskWorkbench.description>一个修长的流线型工作台，专为处理暗羽钢和光敏材料而设计。台面由特殊的吸光材料制成，配有精密的光学校准仪器。\n\n它可以用来制作暗日透镜以及其他涉及光影转换的精密部件。</Raven_Building_DuskWorkbench.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\GasDefs_Raven.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenGas_Anesthetic.label>麻醉气体</RavenGas_Anesthetic.label>
  <RavenGas_Aphrodisiac.label>催情气体</RavenGas_Aphrodisiac.label>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Hediffs_GasEffects.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 麻醉累积 -->
  <RavenHediff_AnestheticBuildup.label>麻醉累积</RavenHediff_AnestheticBuildup.label>
  <RavenHediff_AnestheticBuildup.description>体内积累的麻醉气体。达到高水平时会导致昏迷。</RavenHediff_AnestheticBuildup.description>
  <RavenHediff_AnestheticBuildup.stages.drowsy.label>昏昏欲睡</RavenHediff_AnestheticBuildup.stages.drowsy.label>
  <RavenHediff_AnestheticBuildup.stages.groggy.label>神志不清</RavenHediff_AnestheticBuildup.stages.groggy.label>

  <!-- 催情效果 -->
  <RavenHediff_AphrodisiacEffect.label>催情效果</RavenHediff_AphrodisiacEffect.label>
  <RavenHediff_AphrodisiacEffect.description>强效费洛蒙正在影响受试者。会导致无法控制的脱衣冲动，并最终虚脱倒地。</RavenHediff_AphrodisiacEffect.description>
  <RavenHediff_AphrodisiacEffect.stages.aroused.label>欲火焚身</RavenHediff_AphrodisiacEffect.stages.aroused.label>
  <RavenHediff_AphrodisiacEffect.stages.flushed.label>意乱情迷</RavenHediff_AphrodisiacEffect.stages.flushed.label>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Items_DegradationCharm.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Raven_Item_CorruptionTalisman.label>淫堕符咒</Raven_Item_CorruptionTalisman.label>
  <Raven_Item_CorruptionTalisman.description>这张散发着麝香与蜜糖般甜腻气味的符咒，上面的朱砂仿佛是少女的唇印，仅仅是注视着它，就会让人的心跳加速，呼吸变得急促。\n\n咒文上书：“强制受孕，见我发情”。\n\n将其贴在目标的额头，那扭曲的咒文便会渗入灵魂，将最坚固的道德堤坝冲垮，让其化为只知渴求与奉献的浪荡尤物。携带此符咒时，可以通过右键菜单对他人使用。</Raven_Item_CorruptionTalisman.description>
  <Raven_Item_CorruptionTalisman.comps.CompUsable.useLabel>贴上淫堕符咒</Raven_Item_CorruptionTalisman.comps.CompUsable.useLabel>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Raven_Alloys.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_DarkfeatherSteel.label>暗羽钢</Raven_DarkfeatherSteel.label>
  <Raven_DarkfeatherSteel.description>将熔融的铁与粉碎的黑曜石混合，掺入原木燃烧产生的特殊碱灰，形成富含微气孔和吸光碳颗粒的复合结构。它比普通钢铁更轻，且具有优异的吸能性。</Raven_DarkfeatherSteel.description>
  
  <Raven_CoronaSteel.label>日冕钢</Raven_CoronaSteel.label>
  <Raven_CoronaSteel.description>技术与神性的结合。以暗羽钢为胚体，包裹熔融的白银作为能量脉络，并嵌入翡翠作为灵魂稳定器。它散发着微弱的金色光辉，是制造高级装备的顶级材料。</Raven_CoronaSteel.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Raven_Building_SunRaiserInjector.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Raven_Building_SunRaiserInjector.label>升阳注入器</Raven_Building_SunRaiserInjector.label>
  <Raven_Building_SunRaiserInjector.description>一台汇集了扶桑最高工艺的精密仪器。它能将日冕钢和金羽中蕴含的神性粒子进行超高压对撞，并以无法理解的方式使其重构，最终凝聚成一枚“破碎日核”。整个过程极其漫长且消耗巨大。</Raven_Building_SunRaiserInjector.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Raven_Structure.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <!-- 【修改】Key 和内容均已更新 -->
  <Raven_Wall.label>渡鸦墙体</Raven_Wall.label>
  <Raven_Wall.description>由坚固的岩石砖块砌成的墙体，表面经过抛光处理，呈现出深邃的暗色光泽。结构坚固，能有效抵御攻击，同时其独特的美感也为殖民地增添了一抹肃穆的风格。</Raven_Wall.description>

  <!-- 【修改】Key 和内容均已更新 -->
  <Raven_Terrain_Tile.label>渡鸦地砖</Raven_Terrain_Tile.label>
  <Raven_Terrain_Tile.description>经过精细打磨的暗色地砖，表面平滑，不易积攒灰尘。简单的几何图案在光线下会呈现出微妙的变化。</Raven_Terrain_Tile.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\ThingDef_Oxytocin.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_Drug_Oxytocin.label>催产素</Raven_Drug_Oxytocin.label>
  <Raven_Drug_Oxytocin.description>一种强效的激素药物，能强制刺激渡鸦族的生殖系统。服用后会立即引发剧烈的排卵反应，导致服用者在极短时间内产下一枚未受精的灵卵。\n\n副作用：会导致极度的虚弱和疼痛。</Raven_Drug_Oxytocin.description>
  <Raven_Drug_Oxytocin.ingestible.ingestCommandString>注射 {0}</Raven_Drug_Oxytocin.ingestible.ingestCommandString>
  <Raven_Drug_Oxytocin.ingestible.ingestReportString>正在注射 {0}。</Raven_Drug_Oxytocin.ingestible.ingestReportString>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\ThingDef_UnfertilizedEgg.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_SpiritEgg_Unfertilized.label>未受精渡鸦灵卵</Raven_SpiritEgg_Unfertilized.label>
  <Raven_SpiritEgg_Unfertilized.description>一枚未受精的渡鸦灵卵。它无法孵化出生命，但含有极高的营养价值，依然散发着微弱的热量。</Raven_SpiritEgg_Unfertilized.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThingDef\Weapons_Raven_Standard.xml
=
.
<?xml version="1.0" encoding="utf-8"?>



<LanguageData>



  <!-- 吹箭 -->
  <Raven_Projectile_BlowgunDart.label>催情飞镖</Raven_Projectile_BlowgunDart.label>
  <Raven_Weapon_Blowgun.label>渡鸦吹箭</Raven_Weapon_Blowgun.label>
  <Raven_Weapon_Blowgun.description>一种简单但有效的吹箭，常被渡鸦族刺客使用。它发射的飞镖涂有强效催情毒素，命中后会散发成气体。\n\n这种武器造成的物理伤害极低，但能有效地瓦解敌人的意志。</Raven_Weapon_Blowgun.description>

  <!-- 袖剑 -->
  <Raven_Weapon_HiddenBlade.label>袖剑</Raven_Weapon_HiddenBlade.label>
  <Raven_Weapon_HiddenBlade.description>安装在手腕下方的伸缩式利刃。它允许持有者在隐蔽状态下发动突然且致命的袭击。\n\n特殊效果：脱离战斗10秒后，下一次攻击将造成3倍伤害并具有极高的护甲穿透力。</Raven_Weapon_HiddenBlade.description>
  <Raven_Weapon_HiddenBlade.tools.blade.label>利刃</Raven_Weapon_HiddenBlade.tools.blade.label>

  <!-- 狙击枪 -->
  <Raven_Weapon_SilentSniper.label>幽灵射手步枪</Raven_Weapon_SilentSniper.label>
  <Raven_Weapon_SilentSniper.description>一把高度精密的狙击步枪，集成了整体式消音器。它是为渡鸦族渗透者量身定制的。\n\n特殊效果：保持静止会累积“稳定瞄准”状态，显著提高射击精准度。移动会失去此加成。</Raven_Weapon_SilentSniper.description>



</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\ThoughtDef\ThoughtDefs_Raven_Social.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <KilledMyMaster.stages.0.label>杀害了我的主人</KilledMyMaster.stages.0.label>
  
  <MyMasterDied.stages.0.label>主人去世</MyMasterDied.stages.0.label>
  <MyMasterDied.stages.0.description>我的主人去世了。我感觉迷失了方向，失去了存在的意义。</MyMasterDied.stages.0.description>
  
  <SoldMyMaster.stages.0.label>主人被卖</SoldMyMaster.stages.0.label>
  <SoldMyMaster.stages.0.labelSocial>卖掉了我的主人</SoldMyMaster.stages.0.labelSocial>
  <SoldMyMaster.stages.0.description>我的主人被卖掉了！他们怎么能这么做？</SoldMyMaster.stages.0.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\DefInjected\TraitDef\Traits_DegradationCharm.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <Raven_Trait_Lecherous.degreeDatas.淫堕狂宴.label>淫堕狂宴</Raven_Trait_Lecherous.degreeDatas.淫堕狂宴.label>
  <Raven_Trait_Lecherous.degreeDatas.淫堕狂宴.description>{PAWN_nameDef}的心智已被淫堕刻印彻底重塑。{PAWN_pronoun}的存在意义只剩下追求极致的肉体欢愉。对{PAWN_objective}而言，每一次交合都是对灵魂的献祭与升华，每一次高潮都是向着极乐深渊的又一次坠落。</Raven_Trait_Lecherous.degreeDatas.淫堕狂宴.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Bloodline.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- 血脉系统 -->
    <RavenRace_Bloodline>血脉</RavenRace_Bloodline>
    <RavenRace_BloodlineComposition>血脉组成</RavenRace_BloodlineComposition>
    <RavenRace_GoldenCrowConcentration>金乌血脉浓度</RavenRace_GoldenCrowConcentration>
    <RavenRace_BloodlinePurity>纯度</RavenRace_BloodlinePurity>

    <!-- 新增：特殊血脉翻译 -->
    <RavenRace_Bloodline_Bloodline_Mechanoid>机械体血脉</RavenRace_Bloodline_Bloodline_Mechanoid>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Buildings.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenRace_Extractor_OnlyRaven>只能接受渡鸦族。</RavenRace_Extractor_OnlyRaven>
  <RavenRace_Extractor_Extracting>正在提取：{0}</RavenRace_Extractor_Extracting>
  <RavenRace_Extractor_Finished_Safe>提取完成：{0} 虚弱地离开了仪器，余烬之血已凝结。</RavenRace_Extractor_Finished_Safe>
  <RavenRace_Extractor_InCooldown>{0} 正处于余烬枯竭状态，身体无法承受再次提取。</RavenRace_Extractor_InCooldown>
  
  <!-- 新增的交互文本 -->
  <RavenRace_EnterExtractor>进入残火提取仪</RavenRace_EnterExtractor>
  <RavenRace_InsertPerson>放入人员</RavenRace_InsertPerson>


  <RavenRace_WatchAV>看AV</RavenRace_WatchAV>
  <RavenRace_WatchAV_Desc>开启后，电视将播放成人内容。观看者会获得特殊的娱乐体验，并有概率激发原始冲动。</RavenRace_WatchAV_Desc>
  <Raven_WatchingAV>正在看AV</Raven_WatchingAV>

  <!-- [新增] 催情香炉 -->
  <Raven_Message_IncenseEffect>{0} 在香薰的作用下对 {1} 产生了强烈的冲动...</Raven_Message_IncenseEffect>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Core.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- 种族名称 -->
    <RavenRace_RaceName>渡鸦族</RavenRace_RaceName>
    <RavenRace_GoldenCrowName>三足金乌</RavenRace_GoldenCrowName>
    
    <!-- 派系 -->
    <RavenRace_FusangName>扶桑</RavenRace_FusangName>
    <RavenRace_FusangDesc>一个在暗影中运作的神秘组织。</RavenRace_FusangDesc>
    
    <!-- 设置分类 -->
    <RavenRace_SettingsCategory>渡鸦族</RavenRace_SettingsCategory>

    <!-- 请确保这一行存在且没有拼写错误 -->
    <RavenRace_ScenPart_StartingPawnKind>强制开局种族: {0}</RavenRace_ScenPart_StartingPawnKind>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Creatures.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <Raven_LetterLabel_ShinyFound>大渡鸦的礼物</Raven_LetterLabel_ShinyFound>
  <Raven_LetterText_ShinyFound>{0} 兴冲冲地跑了回来，嘴里叼着闪闪发光的东西！\n\n获得：{1}</Raven_LetterText_ShinyFound>
  
  <!-- [新增] 失败提示 -->
  <Raven_LetterLabel_ShinyNothing>大渡鸦的空手而归</Raven_LetterLabel_ShinyNothing>
  <Raven_LetterText_ShinyNothing>{0} 在外面搜寻了很久，似乎没有什么亮闪闪的东西能入得了它的法眼，只能垂头丧气地回来了。</Raven_LetterText_ShinyNothing>
  
  <Raven_Inspect_ShinySearch>寻找亮闪闪</Raven_Inspect_ShinySearch>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Defense.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <MustPlaceOnWall>必须放置在墙壁或岩石上。</MustPlaceOnWall>


  <!-- 掩体系统 -->
  <Raven_EnterConcealment>进入掩体</Raven_EnterConcealment>
  <Raven_ExitConcealment>离开掩体</Raven_ExitConcealment>
  <Raven_ExitConcealmentDesc>离开当前的伪装掩体。</Raven_ExitConcealmentDesc>
  
  <Raven_Concealment_Occupied>已有人驻守</Raven_Concealment_Occupied>
  <Raven_Concealment_Vacant>空闲</Raven_Concealment_Vacant>
  <Raven_Concealment_Hidden>隐蔽中 (AI无法发现)</Raven_Concealment_Hidden>
  <Raven_Concealment_Revealed>已暴露! (AI将攻击)</Raven_Concealment_Revealed>
  
  <Raven_Concealment_SwapWeapon>切换武器</Raven_Concealment_SwapWeapon>
  <Raven_Concealment_SwapWeaponDesc>选择使用驻守者装备或背包中的另一把远程武器。</Raven_Concealment_SwapWeaponDesc>

  <!-- 捕兽夹 -->
  <Raven_Message_BeastTrapKill>捕兽夹成功捕获并击杀了 {0}。</Raven_Message_BeastTrapKill>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_DegradationCharm.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  <!-- 交互 -->
  <Raven_FloatMenu_RemoveCharm>揭下{0}的淫堕符咒</Raven_FloatMenu_RemoveCharm>

  <!-- 消息与信件 -->
  <Raven_Message_CharmApplied>{0}将一张散发着甜香的符咒贴在了{1}的额头上，符咒仿佛活物般瞬间融入了皮肤。</Raven_Message_CharmApplied>
  <Raven_Message_CharmRemoved>{0}揭下了{1}额头上的淫堕符咒。</Raven_Message_CharmRemoved>

  <Raven_LetterLabel_CharmComplete>心智扭曲：{0}已然堕落</Raven_LetterLabel_CharmComplete>
  <Raven_LetterText_CharmComplete>在淫堕刻印的长期侵蚀下，{PAWN_nameDef}的理智终于完全崩溃了。{PAWN_possessive}人格被重塑，如今只剩下对原始欲望的无限渴求，成为了一个只为欢愉而生的存在。\n\n{PAWN_pronoun}获得了“淫堕狂宴”特性，性取向被扭曲为双性恋，并且对滥交行为不再有任何文化或道德上的顾忌。\n\n【彩蛋】由于能量的剧烈冲突，{PAWN_possessive}身体结构也发生了不可逆的改变……</Raven_LetterText_CharmComplete>
  
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Espionage.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 菜单门户 -->
  <RavenRace_Espionage_MenuTitle>间谍与派系行动总览</RavenRace_Espionage_MenuTitle>
  <RavenRace_Espionage_CommandNet>间谍指挥网络</RavenRace_Espionage_CommandNet>
  <RavenRace_Espionage_CommandNetDesc>查看各派系权力结构\n指派针对性任务</RavenRace_Espionage_CommandNetDesc>
  <RavenRace_Espionage_Management>间谍管理中心</RavenRace_Espionage_Management>
  <RavenRace_Espionage_ManagementDesc>派遣与召回特工\n查看潜伏状态</RavenRace_Espionage_ManagementDesc>
  <RavenRace_Espionage_Back>返回</RavenRace_Espionage_Back>

  <!-- 间谍管理中心 -->
  <RavenRace_Espionage_ActiveSpies>:: 潜伏中的特工 ::</RavenRace_Espionage_ActiveSpies>
  <RavenRace_Espionage_NoActiveSpies>目前没有在役间谍。请从右侧派遣殖民者。</RavenRace_Espionage_NoActiveSpies>
  <RavenRace_Espionage_DispatchAction>:: 派遣行动 ::</RavenRace_Espionage_DispatchAction>
  <RavenRace_Espionage_SelectTargetFaction>选择目标派系...</RavenRace_Espionage_SelectTargetFaction>
  <RavenRace_Espionage_NoColonists>没有可用的殖民者。</RavenRace_Espionage_NoColonists>
  <RavenRace_Espionage_DispatchBtn>派遣</RavenRace_Espionage_DispatchBtn>
  <RavenRace_Espionage_RecallBtn>召回</RavenRace_Espionage_RecallBtn>
  <RavenRace_Espionage_RecallConfirm>确定要召回 {0} 吗？\n该特工将撤离当前位置并返回殖民地。</RavenRace_Espionage_RecallConfirm>
  <RavenRace_Espionage_DispatchConfirm>将 {0} 派遣至 {1}？\n\n该殖民者将暂时离开地图，转入潜伏状态。</RavenRace_Espionage_DispatchConfirm>
  <RavenRace_Espionage_SpyLoc>位置: {0}</RavenRace_Espionage_SpyLoc>
  <RavenRace_Espionage_SpyState>状态: {0}</RavenRace_Espionage_SpyState>
  <RavenRace_Espionage_Exposure>暴露风险:</RavenRace_Espionage_Exposure>
  <RavenRace_Espionage_DispatchSuccess>{0} 已成功潜入 {1}，开始建立情报网。</RavenRace_Espionage_DispatchSuccess>
  <RavenRace_Espionage_RecallSuccess>{0} 已结束潜伏任务，返回殖民地。</RavenRace_Espionage_RecallSuccess>
  

  <!-- 官员职级翻译 -->
  <RavenRace_OfficialRank_Leader>领袖</RavenRace_OfficialRank_Leader>
  <RavenRace_OfficialRank_HighCouncil>核心议会</RavenRace_OfficialRank_HighCouncil>
  <RavenRace_OfficialRank_MiddleManager>中层干部</RavenRace_OfficialRank_MiddleManager>
  <RavenRace_OfficialRank_KeyFigure>关键人物</RavenRace_OfficialRank_KeyFigure>

  <!-- 状态翻译 -->
  <RavenRace_SpyState_Idle>待命</RavenRace_SpyState_Idle>
  <RavenRace_SpyState_Infiltrating>潜伏渗透</RavenRace_SpyState_Infiltrating>
  <RavenRace_SpyState_OnMission>执行任务</RavenRace_SpyState_OnMission>
  <RavenRace_SpyState_Cooldown>潜逃/冷却</RavenRace_SpyState_Cooldown>
  <RavenRace_SpyState_Captured>被捕</RavenRace_SpyState_Captured>

  <!-- 属性显示 -->
  <RavenRace_Espionage_Stat_Infiltration>潜伏</RavenRace_Espionage_Stat_Infiltration>
  <RavenRace_Espionage_Stat_Operation>行动</RavenRace_Espionage_Stat_Operation>
  <RavenRace_Espionage_Stat_Network>网络</RavenRace_Espionage_Stat_Network>
  
  <!-- 任务执行 -->
  <RavenRace_Mission_Executing>执行: {0} (剩余 {1} 天)</RavenRace_Mission_Executing>
  <RavenRace_Mission_Started>任务【{0}】已开始，执行者：{1}。</RavenRace_Mission_Started>
  <RavenRace_Mission_TimeLeft>剩余 {0}</RavenRace_Mission_TimeLeft>
  <RavenRace_Mission_Executing_Detail>执行: {0} (目标: {1})</RavenRace_Mission_Executing_Detail>

  <!-- [修复] 统一后的信件 Key -->
  <RavenRace_Espionage_Mission_Success>任务成功</RavenRace_Espionage_Mission_Success>
  <RavenRace_Espionage_Mission_SuccessDesc>间谍 {0} 成功完成了 {1}。</RavenRace_Espionage_Mission_SuccessDesc>
  <RavenRace_Espionage_Mission_Failure>任务失败</RavenRace_Espionage_Mission_Failure>
  <RavenRace_Espionage_Mission_FailureDesc>行动败露，{0} 险些被捕，暴露值大幅上升。</RavenRace_Espionage_Mission_FailureDesc>

  <!-- 指挥网络 -->
  <RavenRace_Espionage_InfiltrationLevel>渗透度: {0} / 100</RavenRace_Espionage_InfiltrationLevel>
  <RavenRace_Espionage_ControlStatus>控制状态: {0}</RavenRace_Espionage_ControlStatus>
  <RavenRace_Espionage_StructurePreview>:: 权力结构 (数据预览) ::</RavenRace_Espionage_StructurePreview>
  <RavenRace_Espionage_UnknownTarget>未知目标</RavenRace_Espionage_UnknownTarget>
  <RavenRace_Espionage_Known> [已知]</RavenRace_Espionage_Known>
  <RavenRace_Espionage_Unknown> [未知]</RavenRace_Espionage_Unknown>
  <RavenRace_Espionage_NoIntel>暂无情报 (请指派间谍以收集数据)</RavenRace_Espionage_NoIntel>
  
  <!-- 官员详情 -->
  <RavenRace_Official_Rank>职级: {0}</RavenRace_Official_Rank>
  <RavenRace_Official_Age>年龄: {0}</RavenRace_Official_Age>
  <RavenRace_Official_Gender>性别: {0}</RavenRace_Official_Gender>
  <RavenRace_Official_Competence>能力值: {0}</RavenRace_Official_Competence>
  <RavenRace_Official_Corruption>贪婪度: {0}</RavenRace_Official_Corruption>
  <RavenRace_Official_Relation>对玩家好感: {0}</RavenRace_Official_Relation>
  <RavenRace_Official_Loyalty>忠诚度: {0}</RavenRace_Official_Loyalty>
  <RavenRace_Official_UnknownDesc>该官员身份不明。\n派遣间谍进行【搜集情报】任务以解锁详细信息。</RavenRace_Official_UnknownDesc>
  <RavenRace_Official_ActionBtn>针对行动</RavenRace_Official_ActionBtn>
  <RavenRace_Official_DataOutdated>数据过期：无法获取官员所属派系。请尝试重新渗透。</RavenRace_Official_DataOutdated>

  <!-- 任务选择 -->
  <RavenRace_Mission_SelectTitle>指派任务: {0}</RavenRace_Mission_SelectTitle>
  <RavenRace_Mission_Target>针对目标: {0}</RavenRace_Mission_Target>
  <RavenRace_Mission_NoSpy>该派系当前没有可用的驻扎间谍！</RavenRace_Mission_NoSpy>
  <RavenRace_Mission_PleaseDeploy>请先在间谍管理界面派遣间谍进行渗透。</RavenRace_Mission_PleaseDeploy>
  <RavenRace_Mission_Executor>执行间谍: {0}</RavenRace_Mission_Executor>
  <RavenRace_Mission_CurrentExposure>当前暴露值: {0}%</RavenRace_Mission_CurrentExposure>
  <RavenRace_Mission_CostTip>情报: {0}, 影响力: {1}</RavenRace_Mission_CostTip>
  <RavenRace_Mission_ExecuteBtn>执行</RavenRace_Mission_ExecuteBtn>
  <RavenRace_Mission_Reason_Level>渗透等级不足 (需 Lv{0})</RavenRace_Mission_Reason_Level>
  <RavenRace_Mission_Reason_Intel>情报点数不足</RavenRace_Mission_Reason_Intel>

  <RavenRace_Mission_CostSilver>银币不足</RavenRace_Mission_CostSilver>
  <RavenRace_Mission_TargetTurncoated>目标已被策反</RavenRace_Mission_TargetTurncoated>
  <RavenRace_Mission_TargetDead>目标已死亡</RavenRace_Mission_TargetDead>
  
  <RavenRace_Espionage_TurncoatTag>(已策反)</RavenRace_Espionage_TurncoatTag>
  <RavenRace_Espionage_UnknownTarget>未知目标</RavenRace_Espionage_UnknownTarget>
  <RavenRace_Espionage_Known> [已知]</RavenRace_Espionage_Known>
  <RavenRace_Espionage_Unknown> [未知]</RavenRace_Espionage_Unknown>
  


</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Fusang.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- Gizmo -->
  <RavenRace_OpenFusangRadio>打开扶桑终端</RavenRace_OpenFusangRadio>
  <RavenRace_OpenFusangRadioDesc>连接至扶桑组织的加密网络。</RavenRace_OpenFusangRadioDesc>
  <RavenRace_NoColonistCanReach>没有殖民者可以操作终端。</RavenRace_NoColonistCanReach>
  
  <!-- Dev Tools -->
  <RavenRace_Dev_ResetCooldown>DEBUG: 重置冷却</RavenRace_Dev_ResetCooldown>
  <RavenRace_Dev_ReadyTrade>DEBUG: 强制商船抵达</RavenRace_Dev_ReadyTrade>
  <RavenRace_Dev_AddIntel>DEBUG: 获得情报点数</RavenRace_Dev_AddIntel>
  
  <!-- UI Main -->
  <RavenRace_FusangRadioTitle>FUSANG.NETSEC.TERMINAL_V4 // 扶桑网络终端</RavenRace_FusangRadioTitle>
  
  <!-- UI Status -->
  <RavenRace_RadioStatus_Header>:: 链路状态 ::</RavenRace_RadioStatus_Header>
  <RavenRace_Status_Online>连接</RavenRace_Status_Online>
  <RavenRace_Status_Signal>信号</RavenRace_Status_Signal>
  <RavenRace_Status_Power>能源</RavenRace_Status_Power>
  
  <RavenRace_Tag_Stable>[稳定]</RavenRace_Tag_Stable>
  <RavenRace_Tag_Strong>[强]</RavenRace_Tag_Strong>
  <RavenRace_Tag_Online>[在线]</RavenRace_Tag_Online>
  <RavenRace_Tag_Offline>[离线]</RavenRace_Tag_Offline>
  
  <RavenRace_Status_Relation>信任级别</RavenRace_Status_Relation>
  <RavenRace_OperatorFavorability>左爻好感度</RavenRace_OperatorFavorability> <!-- 新增好感度标签 -->
  <RavenRace_Status_Location>接入点坐标</RavenRace_Status_Location>
  <RavenRace_Status_TradeCool>物流状态</RavenRace_Status_TradeCool>
  <RavenRace_Status_Ready>--- 就绪 ---</RavenRace_Status_Ready>
  
  <!-- UI Buttons -->
  <RavenRace_Btn_Trade>物资交换协议</RavenRace_Btn_Trade>
  <RavenRace_Btn_TradeCool>物流重新以此... ({0}天)</RavenRace_Btn_TradeCool>
  <RavenRace_Btn_Scan>区域扫描</RavenRace_Btn_Scan>
  <RavenRace_Btn_Mission>任务面板</RavenRace_Btn_Mission>
  <RavenRace_Btn_Support>捐赠支援</RavenRace_Btn_Support>
  
  <!-- Resources -->
  <RavenRace_Res_Supplies>物资储备</RavenRace_Res_Supplies>
  <RavenRace_Res_Military>武力支持</RavenRace_Res_Military>
  <RavenRace_Res_Intel>情报网络</RavenRace_Res_Intel>
  <RavenRace_Res_Influence>组织声望</RavenRace_Res_Influence>
  
  <!-- Missions -->
  <RavenRace_MissionBoard_Title>行动代号列表</RavenRace_MissionBoard_Title>
  
  <RavenRace_Mission_Surrogate>【代号：杜鹃】灵卵代孕</RavenRace_Mission_Surrogate>
  <RavenRace_Mission_Surrogate_Desc>这是一项保护血脉的必要措施。我们需要借用外族的躯体来孵化我们的后代。\n\n我们将提供一枚经过处理的灵卵（纯血统），植入代孕者体内。这对母体有一定生理负担，但我们会支付相应的报酬（或好感）。\n\n“在那寒冷的巢穴里，任何温暖都是被允许的。”</RavenRace_Mission_Surrogate_Desc>
  <RavenRace_Mission_SelectSurrogate>指定宿主...</RavenRace_Mission_SelectSurrogate>
  <RavenRace_Mission_Success>植入完成。宿主 {0} 状况稳定，正如计划的那样。</RavenRace_Mission_Success>
  <RavenRace_Mission_Cost>消耗声望: {0}</RavenRace_Mission_Cost>
  <RavenRace_Mission_NoCost>无需声望</RavenRace_Mission_NoCost>
  
  <!-- Support -->
  <RavenRace_Support_Title>物资捐赠协议</RavenRace_Support_Title>
  <RavenRace_Support_Desc>扶桑组织长期处于资源匮乏状态。通过提供资金或物资支持，可以换取组织的信任及各方面能力的提升。</RavenRace_Support_Desc>
  
  <RavenRace_Support_SilverSmall>小额资金注入</RavenRace_Support_SilverSmall>
  <RavenRace_Support_SilverSmall_Desc>消耗 100 白银。\n获得：物资+5, 武力+5, 情报+5, 声望+5。</RavenRace_Support_SilverSmall_Desc>
  
  <RavenRace_Support_SilverMedium>专项资金拨款</RavenRace_Support_SilverMedium>
  <RavenRace_Support_SilverMedium_Desc>消耗 500 白银。\n获得：物资+30, 武力+30, 情报+30, 声望+30。</RavenRace_Support_SilverMedium_Desc>
  
  <RavenRace_Support_SilverLarge>战略级投资</RavenRace_Support_SilverLarge>
  <RavenRace_Support_SilverLarge_Desc>消耗 2000 白银。\n获得：物资+150, 武力+150, 情报+150, 声望+150。</RavenRace_Support_SilverLarge_Desc>
  
  <RavenRace_Donate_Success>捐赠成功。资源储备已提升。</RavenRace_Donate_Success>
  <RavenRace_Donate_Fail>资金不足。需要 {0} 白银。</RavenRace_Donate_Fail>

  <!-- Dialogues (Lore) - 这些现在被DialogueManager替代了 -->

  <!-- Ideology Positions -->
  
  <!--
  <Herald>传谕使</Herald>
  <High Priest>大祭司</High Priest>
  <solar>太阳的</solar>
  <ascendant>飞升的</ascendant>
  <purity>纯净</purity>
  <radiance>光辉</radiance>
  -->

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Hybridization.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- 设置分类 -->
    <RavenRace_Settings_Hybridization>杂交</RavenRace_Settings_Hybridization>
    <RavenRace_Settings_HybridizationDesc>配置渡鸦杂交后代从其他种族继承能力的规则。</RavenRace_Settings_HybridizationDesc>

    <!-- 通用状态 -->
    <RavenRace_Settings_ModActive>状态: 已激活 (检测到Mod)</RavenRace_Settings_ModActive>
    <RavenRace_Settings_ModInactive>状态: 未激活 (未检测到Mod)</RavenRace_Settings_ModInactive>

    <!-- 米莉拉 -->
    <RavenRace_Settings_MiliraCompat>米莉拉(Milira)血脉</RavenRace_Settings_MiliraCompat>
    <RavenRace_Settings_EnableMiliraCompat>启用米莉拉血脉特性</RavenRace_Settings_EnableMiliraCompat>
    <RavenRace_Settings_EnableMiliraCompat_Desc>如果开启，含有米莉拉血脉的渡鸦将获得移速加成和瞄准时间缩减。</RavenRace_Settings_EnableMiliraCompat_Desc>

    <!-- 萌螈 -->
    <RavenRace_Settings_MoeLotlCultivation>萌螈修炼能力</RavenRace_Settings_MoeLotlCultivation>
    <RavenRace_Settings_EnableMoeLotlCompat>启用萌螈修炼特性</RavenRace_Settings_EnableMoeLotlCompat>
    <RavenRace_Settings_EnableMoeLotlCompat_Desc>如果开启，含有萌螈血脉的渡鸦将获得修炼面板和阅读功法书的能力。</RavenRace_Settings_EnableMoeLotlCompat_Desc>
    <RavenRace_ForceReadBook>强行阅读：{0}</RavenRace_ForceReadBook>
    <RavenRace_WrongBook>错误的书籍类型</RavenRace_WrongBook>


    <!-- 珂莉姆 -->
    <RavenRace_Settings_KlimDragonBlood>珂莉姆龙血</RavenRace_Settings_KlimDragonBlood>
    <RavenRace_Settings_EnableKoelimeBloodline>启用古龙血脉遗传</RavenRace_Settings_EnableKoelimeBloodline>
    <RavenRace_Settings_EnableKoelimeBloodline_Desc>如果开启，含有珂莉姆血脉的渡鸦将获得“古龙血脉（次级）”Buff，提供再生能力和多种疾病免疫。</RavenRace_Settings_EnableKoelimeBloodline_Desc>


    <!-- 雪牛娘 -->
    <RavenRace_Settings_MuGirlCompat>雪牛娘(MooGirl)血脉</RavenRace_Settings_MuGirlCompat>
    <RavenRace_Settings_EnableMuGirlCompat>启用雪牛娘血脉特性</RavenRace_Settings_EnableMuGirlCompat>
    <RavenRace_Settings_EnableMuGirlCompat_Desc>如果开启，含有雪牛娘血脉的渡鸦（无论性别）将获得高额护甲与减伤加成，并获得产出雪牛奶的能力。</RavenRace_Settings_EnableMuGirlCompat_Desc>
    <!-- 产奶组件 -->
    <RavenRace_MilkFullness>雪牛奶已满</RavenRace_MilkFullness>
    <RavenRace_GatherMilk>收集雪牛奶</RavenRace_GatherMilk>
    <RavenRace_GatherMilkDesc>从该名渡鸦身上收集积攒的雪牛奶。</RavenRace_GatherMilkDesc>
    <RavenRace_Msg_MilkGathered>{0} 收集了 {1} 个 {2}。</RavenRace_Msg_MilkGathered>
    <!-- [新增] 雪牛彩蛋 -->
    <RavenRace_Settings_MuffaloPrank>等等？你说的是哪个雪牛？</RavenRace_Settings_MuffaloPrank>
    <RavenRace_Settings_MuffaloPrank_Desc>这是一个关于走地鸡与雪牛的古老故事...啊呀，真是一对苦命鸳鸯！\n\n（开启后，强制求爱技能可对原版动物雪牛生效，并视作与雪牛娘交配）</RavenRace_Settings_MuffaloPrank_Desc>


    <!-- 沃芬 -->
    <RavenRace_Settings_WolfeinCompat>沃芬(Wolfein)血脉</RavenRace_Settings_WolfeinCompat>
    <RavenRace_Settings_EnableWolfeinCompat>启用沃芬血脉特性</RavenRace_Settings_EnableWolfeinCompat>
    <RavenRace_Settings_EnableWolfeinCompat_Desc>如果开启，含有沃芬血脉的渡鸦将获得次级的夜间增强和月相增强效果。\n\n效果：在夜间小幅提升意识、视力和移动速度。在满月之夜，这些效果会进一步增强，并获得额外的闪避和近战攻击力。</RavenRace_Settings_EnableWolfeinCompat_Desc>

    <!-- 龙人 -->
    <RavenRace_Settings_DragonianCompat>龙人(Dragonian)血脉</RavenRace_Settings_DragonianCompat>
    <RavenRace_Settings_EnableDragonianCompat>启用龙人血脉特性</RavenRace_Settings_EnableDragonianCompat>
    <RavenRace_Settings_EnableDragonianCompat_Desc>如果开启，含有龙人血脉的渡鸦将获得次级龙人基因加成并能产出龙奶。\n\nCombo奖励：\n如果同时拥有雪牛(MuGirl)血脉，将产出特殊的“神赐乳”。</RavenRace_Settings_EnableDragonianCompat_Desc>
    
    <RavenRace_DragonMilkFullness>龙奶已满</RavenRace_DragonMilkFullness>
    <RavenRace_DivineMilkFullness>神赐乳已满</RavenRace_DivineMilkFullness>


    <!-- 茉约 -->
    <RavenRace_Settings_MoyoCompat>茉约(Moyo)血脉</RavenRace_Settings_MoyoCompat>
    <RavenRace_Settings_EnableMoyoCompat>启用茉约血脉特性</RavenRace_Settings_EnableMoyoCompat>
    <RavenRace_Settings_EnableMoyoCompat_Desc>如果开启，含有茉约血脉的渡鸦将能够产出深蓝血浆，并且免疫深蓝药物的成瘾与副作用。</RavenRace_Settings_EnableMoyoCompat_Desc>

    <!-- 艾波娜 -->
    <RavenRace_Settings_EponaCompat>艾波娜(Epona)血脉</RavenRace_Settings_EponaCompat>
    <RavenRace_Settings_EnableEponaCompat>启用艾波娜血脉特性</RavenRace_Settings_EnableEponaCompat>
    <RavenRace_Settings_EnableEponaCompat_Desc>如果开启，含有艾波娜血脉的渡鸦将在室外移动时获得“骏驹奔腾”加速效果。若同时拥有雪牛血脉，还将强化“雪牛冲锋”技能。</RavenRace_Settings_EnableEponaCompat_Desc>

    <RavenRace_AbilityLabel_EnhancedCharge>骏足·雪牛冲锋</RavenRace_AbilityLabel_EnhancedCharge>
    <RavenRace_AbilityDesc_EnhancedCharge>艾波娜血脉与雪牛力量的完美结合。\n\n范围更大，速度更快，能将沿途敌人撞得更远，并对终结目标造成毁灭性打击。</RavenRace_AbilityDesc_EnhancedCharge>
    <RavenRace_Message_OutOfRange>目标超出普通冲锋射程。</RavenRace_Message_OutOfRange>

    <!-- 泰临 -->

    <RavenRace_Settings_TailinCompat>泰临(Tailin)血脉</RavenRace_Settings_TailinCompat>
    <RavenRace_Settings_EnableTailinCompat>启用泰临血脉特性</RavenRace_Settings_EnableTailinCompat>
    <RavenRace_Settings_EnableTailinCompat_Desc>如果开启，含有泰临血脉的渡鸦将。</RavenRace_Settings_EnableTailinCompat_Desc>

    <!-- 烟烬  -->
    <RavenRace_Settings_CinderCompat>烟烬(Cinder)血脉</RavenRace_Settings_CinderCompat>
    <RavenRace_Settings_EnableCinderCompat>启用烟烬血脉特性</RavenRace_Settings_EnableCinderCompat>
    <RavenRace_Settings_EnableCinderCompat_Desc>如果开启，含有烟烬血脉的渡鸦将获得“聚合物再生”能力，可以缓慢修复伤口甚至再生缺失的肢体。</RavenRace_Settings_EnableCinderCompat_Desc>

    <!-- 米拉波雷亚斯 -->
    <RavenRace_Settings_MiraboreasCompat>米拉波雷亚斯(Miraboreas)血脉</RavenRace_Settings_MiraboreasCompat>
    <RavenRace_Settings_EnableMiraboreasCompat>启用米拉波雷亚斯血脉特性</RavenRace_Settings_EnableMiraboreasCompat>
    <RavenRace_Settings_EnableMiraboreasCompat_Desc>如果开启，含有米拉波雷亚斯血脉的渡鸦将免疫受击硬直，并且在使用近战武器时获得“拍击”范围伤害能力。</RavenRace_Settings_EnableMiraboreasCompat_Desc>

    <!-- 珉巧 (Mincho) -->
    <RavenRace_Settings_MinchoCompat>珉巧(Mincho)血脉</RavenRace_Settings_MinchoCompat>
    <RavenRace_Settings_EnableMinchoCompat>启用珉巧血脉特性</RavenRace_Settings_EnableMinchoCompat>
    <RavenRace_Settings_EnableMinchoCompat_Desc>如果开启，含有珉巧血脉的渡鸦将获得极强的抗寒能力（-500℃），并能够生产薄荷巧克力。</RavenRace_Settings_EnableMinchoCompat_Desc>
    
    <RavenRace_MinchoChocolateFullness>薄荷巧克力</RavenRace_MinchoChocolateFullness>
    <RavenRace_Message_MinchoProduced>{0} 的身体自然凝结出了 {1}！</RavenRace_Message_MinchoProduced>




    <!-- Gizmo UI -->
    <Milira_Flight_Toggle>飞行</Milira_Flight_Toggle>
    <Milira_Flight_Toggle_Desc>开启/关闭飞行能力。\n\n飞行时可以越过深水、墙壁等障碍（需补丁支持），但会持续消耗饥饿度。</Milira_Flight_Toggle_Desc>
    
    <Milira_Flight_LowAlt>低空模式</Milira_Flight_LowAlt>
    <Milira_Flight_HighAlt>高空模式</Milira_Flight_HighAlt>
    <Milira_Flight_Mode_Desc>切换飞行高度。\n\n【低空】：仅在移动时飞行，可飞越建筑但不能飞越屋顶。\n【高空】：始终飞行，可飞越屋顶但不能飞越实体建筑。</Milira_Flight_Mode_Desc>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Items.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 金羽信件 -->
  <RavenRace_LetterLabel_Feather_Mood>折翼金羽析出 (情绪)</RavenRace_LetterLabel_Feather_Mood>
  <RavenRace_LetterText_Feather_HugeGrief>{0} 陷入了无尽的悲恸之中，灵魂的激荡使得一根金羽从羽翼中脱落。</RavenRace_LetterText_Feather_HugeGrief>
  <RavenRace_LetterText_Feather_HugeJoy>{0} 感到了无上的极乐，灵魂的共鸣使得一根金羽从羽翼中脱落。</RavenRace_LetterText_Feather_HugeJoy>
  <RavenRace_LetterText_Feather_MentalBreak>{0} 的精神防线彻底崩溃了，这种极端的混乱反而促使了金羽的析出。</RavenRace_LetterText_Feather_MentalBreak>

  <RavenRace_LetterLabel_Feather_Health>折翼金羽析出 (濒死)</RavenRace_LetterLabel_Feather_Health>
  <RavenRace_LetterText_Feather_NearDeath>在死亡的边缘，{0} 的求生本能激发了血脉深处的神性，一根金羽作为代价脱落了。</RavenRace_LetterText_Feather_NearDeath>

  <RavenRace_LetterLabel_Feather_Birth>折翼金羽析出 (新生)</RavenRace_LetterLabel_Feather_Birth>
  <RavenRace_LetterText_Feather_NewLife>新生命的诞生带来了纯粹的希望，{0} 为此献上了一根金羽作为祝福。</RavenRace_LetterText_Feather_NewLife>

  <!-- 余烬之血信件 -->
  <RavenRace_LetterLabel_EmberExtraction>余烬之血提取完成</RavenRace_LetterLabel_EmberExtraction>
  <RavenRace_LetterText_EmberExtraction>{0} 成功完成了手术。{1} 的心脏停止了跳动，所有的生命精华都已凝结在这份余烬之血中。这是一份沉重的代价。</RavenRace_LetterText_EmberExtraction>
  
  <!-- 任务描述 -->
  <RavenRace_Mission_Ember_Desc>【代号：余烬】崇高奉献\n\n组织内有一些年迈或身负重伤的成员，自愿献出生命以换取族群的延续。我们需要情报点数来定位他们的位置，并消耗影响力来安排专门的运输舱将提取物送达。\n\n获得：余烬之血 x1</RavenRace_Mission_Ember_Desc>

  <!-- [新增] 武器淬毒 -->
  <Raven_Message_WeaponCoated>已将 {0} 涂抹在 {1} 上。剩余生效次数: {2}</Raven_Message_WeaponCoated>
  <Raven_Mote_Poisoned>中毒</Raven_Mote_Poisoned>



</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Reproduction.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- 孵化相关 -->
    <IncubationProgress>孵化进度</IncubationProgress>
    <RavenRace_Mother>母亲</RavenRace_Mother>
    <RavenRace_Father>父亲</RavenRace_Father>
    <RavenRace_BloodlineComposition>血脉组成</RavenRace_BloodlineComposition>
    <RavenRace_GoldenCrowConcentration>金乌浓度</RavenRace_GoldenCrowConcentration>
    
    <!-- 信件 -->
    <RavenRace_LetterLabel_EggLaid>产下灵卵</RavenRace_LetterLabel_EggLaid>
    <RavenRace_LetterText_EggLaid>{0} 成功产下了一枚渡鸦灵卵。父亲是 {1}，这枚卵中结合了他们的血脉。\n\n请尽快将其放入原始摇篮中进行孵化，否则生命迹象将停止发育。</RavenRace_LetterText_EggLaid>
    <LetterLabelHatch>灵卵孵化</LetterLabelHatch>
    <LetterTextHatch>一枚渡鸦灵卵成功孵化了！\n\n{0} 破壳而出。</LetterTextHatch>

    <!-- 摇篮与灵卵操作 -->
    <RavenRace_CradleEmpty>摇篮空置</RavenRace_CradleEmpty>
    <RavenRace_EjectEgg>取出灵卵</RavenRace_EjectEgg>
    <RavenRace_EjectEggDesc>将灵卵从摇篮中取出，停止孵化过程。</RavenRace_EjectEggDesc>
    
    <!-- 体内保存系统 (Phase 3.2) -->
    <RavenRace_FloatMenu_InsertEgg>将灵卵置入 {0} 体内</RavenRace_FloatMenu_InsertEgg>
    <RavenRace_Message_EggInsertedFemale>{0} 的子宫现在温暖地包裹着灵卵。</RavenRace_Message_EggInsertedFemale>
    <RavenRace_Message_EggInsertedMale>灵卵已被置入 {0} 直肠深处。</RavenRace_Message_EggInsertedMale>
    <RavenRace_Message_EggRemoved>灵卵已从 {0} 体内取出。</RavenRace_Message_EggRemoved>
    
    <RavenRace_Gizmo_RemoveEgg>取出体内灵卵</RavenRace_Gizmo_RemoveEgg>
    <RavenRace_Gizmo_RemoveEggDesc>将目前保存在体内的灵卵取出。</RavenRace_Gizmo_RemoveEggDesc>
    
    <!-- 强制交配反馈信息 (Phase 3.2 - 更新) -->
    <RavenRace_Msg_ResistanceLowered>在极度的快感剥夺与射精管理下，{0} 的心理防线正在崩塌（抵抗 -{1}）。</RavenRace_Msg_ResistanceLowered>
    <RavenRace_Msg_WillLowered>除了臣服和高潮，{0} 的脑海中已容不下任何反抗的念头（意志 -{1}）。</RavenRace_Msg_WillLowered>
    <RavenRace_Msg_InstantRecruit>{0} 哭喊着乞求完全的占有。为了换取再一次的高潮，{0} 发誓永远效忠于您！</RavenRace_Msg_InstantRecruit>
    <RavenRace_Msg_InstantEnslave>{0} 的自我意志被彻底击碎了。现在，{0} 只是您顺从而渴望的奴隶。</RavenRace_Msg_InstantEnslave>
    <RavenRace_Msg_LoyaltyBroken>曾经的誓言在持续不断的强烈刺激下化为泡影。{0} 的死忠信念已然瓦解，眼中只有对您的渴望。</RavenRace_Msg_LoyaltyBroken>


    <!-- Phase 3.5 扩展 -->
    <RavenRace_Gizmo_LaunchEgg>发射灵卵</RavenRace_Gizmo_LaunchEgg>
    <RavenRace_Gizmo_LaunchEggDesc>利用腹部肌肉强力收缩，将最外侧的一枚灵卵像炮弹一样射向目标。\n\n命中会导致目标强制昏迷。</RavenRace_Gizmo_LaunchEggDesc>
    
    <RavenRace_Msg_EggEjected_Pleasure>{0} 浑身颤抖着达到了高潮，伴随着大量的爱液，一枚灵卵被噗地一声排了出来。</RavenRace_Msg_EggEjected_Pleasure>
    <RavenRace_Msg_EggLaunch_Impact>灵卵精准地砸中了 {0}，巨大的冲击力让其瞬间失去了意识。</RavenRace_Msg_EggLaunch_Impact>
    
    <RavenRace_Fail_Full>{0} 的体内已经塞满了灵卵，再也塞不进去了！</RavenRace_Fail_Full>




</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Ritual.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <!-- 目标检查 -->
  <RavenRace_Ritual_TargetDestroyed>目标已损毁。</RavenRace_Ritual_TargetDestroyed>
  <RavenRace_Ritual_NotCradle>目标不是摇篮。</RavenRace_Ritual_NotCradle>
  <RavenRace_Ritual_CradleEmpty>摇篮中没有灵卵。</RavenRace_Ritual_CradleEmpty>
  <RavenRace_Ritual_NotSpiritEgg>摇篮中的物品不是灵卵。</RavenRace_Ritual_CradleEmpty>
  <RavenRace_Ritual_TargetInfo>包含灵卵的摇篮</RavenRace_Ritual_TargetInfo>
  
  <!-- 仪式结果 -->
  <RavenRace_Ritual_AbsorptionSuccess>{0} 成功吸收了灵卵的血脉精华，体内的力量变得更加纯粹了。</RavenRace_Ritual_AbsorptionSuccess>
  
  <!-- 角色检查 -->
  <RavenRace_Ritual_RoleMustBeRaven>必须由渡鸦族发起。</RavenRace_Ritual_RoleMustBeRaven>

  <!-- 祭坛提示 -->
  <RavenRace_Ritual_CradleEmpty>摇篮为空</RavenRace_Ritual_CradleEmpty>
  


  <!-- 这里补充一些 UI 上的提示 -->
  <RavenRace_Ritual_NoRavens>无可用渡鸦族</RavenRace_Ritual_NoRavens>
  <RavenRace_Ritual_Unreachable>{0} (无法到达)</RavenRace_Ritual_Unreachable>
  
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Settings.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- 设置标签页 -->
    <RavenRace_Settings_Base>基础</RavenRace_Settings_Base>
    <RavenRace_Settings_Bloodline>血脉</RavenRace_Settings_Bloodline>
    <RavenRace_Settings_Altar>祭坛</RavenRace_Settings_Altar>
    <RavenRace_Settings_Fusang>扶桑</RavenRace_Settings_Fusang>
    <RavenRace_Settings_Operator>接线员</RavenRace_Settings_Operator> <!-- 新增 -->
    <RavenRace_Settings_Espionage>间谍</RavenRace_Settings_Espionage>
    <RavenRace_Settings_Debug>调试</RavenRace_Settings_Debug>
    <RavenRace_Settings_Reproduction>繁殖</RavenRace_Settings_Reproduction>
    <RavenRace_Settings_Hybridization>杂交</RavenRace_Settings_Hybridization>
    <RavenRace_Settings_Defense>防卫</RavenRace_Settings_Defense>
    <RavenRace_Settings_Buildings>建筑</RavenRace_Settings_Buildings>
    
    <!-- 设置描述 -->
    <RavenRace_Settings_BaseDesc>渡鸦族模组的基础设置。</RavenRace_Settings_BaseDesc>
    <RavenRace_Settings_BloodlineDesc>血脉系统相关设置。</RavenRace_Settings_BloodlineDesc>
    <RavenRace_Settings_AltarDesc>育生祭坛的孵化参数。</RavenRace_Settings_AltarDesc>
    <RavenRace_Settings_FusangDesc>扶桑组织的服务和通讯参数。</RavenRace_Settings_FusangDesc>
    <RavenRace_Settings_EspionageDesc>间谍任务相关设置。</RavenRace_Settings_EspionageDesc>
    <RavenRace_Settings_DebugDesc>开发者调试工具。启用调试模式后可使用额外功能。</RavenRace_Settings_DebugDesc>
    <RavenRace_Settings_ReproductionDesc>调整渡鸦族特有的繁殖行为、强制交配参数以及对囚犯的特殊互动效果。</RavenRace_Settings_ReproductionDesc>
    <RavenRace_Settings_HybridizationDesc>配置渡鸦杂交后代从其他种族继承能力的规则。</RavenRace_Settings_HybridizationDesc>
    <RavenRace_Settings_ComingSoon>此功能将在后续版本中开放配置...</RavenRace_Settings_ComingSoon>

    <!-- 基础设置 -->
    <RavenRace_Settings_EnableDebugMode>启用调试模式</RavenRace_Settings_EnableDebugMode>
    <RavenRace_Settings_EnableVerboseLogging>启用详细日志</RavenRace_Settings_EnableVerboseLogging>

    <!-- 育生祭坛设置 -->
    <RavenRace_Settings_BaseHatchingDays>基础孵化时间</RavenRace_Settings_BaseHatchingDays>
    
    <!-- 繁殖与交配设置 -->
    <RavenRace_Settings_EnableForceLovinPregnancy>启用强制交配怀孕</RavenRace_Settings_EnableForceLovinPregnancy>
    <RavenRace_Settings_ForcedLovinPregnancyRate>强制交配怀孕率</RavenRace_Settings_ForcedLovinPregnancyRate>
    <RavenRace_Settings_IgnoreFertilityForPregnancy>忽略生育能力检查</RavenRace_Settings_IgnoreFertilityForPregnancy>
    <RavenRace_Settings_IgnoreFertilityForPregnancyDesc>如果开启，即使双方生育率为0%，强制交配也能强制受孕。</RavenRace_Settings_IgnoreFertilityForPregnancyDesc>
    <RavenRace_Settings_EnableSameSexForceLovin>启用同性强制交配</RavenRace_Settings_EnableSameSexForceLovin>
    <RavenRace_Settings_EnableSameSexForceLovinDesc>允许对同性目标使用强制求爱能力。这种行为不会导致怀孕(除非开启男性生蛋)，但会产生特殊的心情和互动效果。</RavenRace_Settings_EnableSameSexForceLovinDesc>
    
    <RavenRace_Settings_PrisonerInteractions>囚犯与奴隶互动参数</RavenRace_Settings_PrisonerInteractions>
    <RavenRace_Settings_ForceLovinResistanceReduction>抵抗减少量</RavenRace_Settings_ForceLovinResistanceReduction>
    <RavenRace_Settings_ForceLovinWillReduction>意志减少量</RavenRace_Settings_ForceLovinWillReduction>
    <RavenRace_Settings_ForceLovinCertaintyReduction>信仰动摇量</RavenRace_Settings_ForceLovinCertaintyReduction>
    <RavenRace_Settings_ForceLovinBreakLoyaltyChance>打破死忠概率</RavenRace_Settings_ForceLovinBreakLoyaltyChance>
    <RavenRace_Settings_ForceLovinCooldownDays>技能冷却时间</RavenRace_Settings_ForceLovinCooldownDays>
    
    <RavenRace_Settings_RavenFatherDeterminesEgg>父系决定卵生</RavenRace_Settings_RavenFatherDeterminesEgg>
    <RavenRace_Settings_RavenFatherDeterminesEggDesc>如果开启，当父亲是渡鸦族时，无论母亲是什么种族，都会产下灵卵。</RavenRace_Settings_RavenFatherDeterminesEggDesc>

    <RavenRace_Settings_EnableMalePregnancyEgg>[彩蛋] 启用男性生蛋</RavenRace_Settings_EnableMalePregnancyEgg>
    <RavenRace_Settings_EnableMalePregnancyEggDesc>只要配对双方中有一方是渡鸦族，男性一方就会承担怀孕和产卵的职责。此规则优先级高于所有其他性别规则。</RavenRace_Settings_EnableMalePregnancyEggDesc>

    <RavenRace_Settings_ForceRavenDescendant>强制渡鸦后代</RavenRace_Settings_ForceRavenDescendant>
    <RavenRace_Settings_ForceRavenDescendantDesc>如果开启，只要父母一方是渡鸦族，后代必定是渡鸦族。</RavenRace_Settings_ForceRavenDescendantDesc>
    
    <RavenRace_Settings_EnableEggProjectileMode>启用灵卵投射模式</RavenRace_Settings_EnableEggProjectileMode>
    <RavenRace_Settings_EnableEggProjectileModeDesc>开启后，取出体内灵卵的操作将变为瞄准射击模式，可将灵卵作为非致命投射物发射。</RavenRace_Settings_EnableEggProjectileModeDesc>


    <!-- [新增] 渡鸦本能教本 -->
    <RavenRace_AbilityTomeLearned>{0} 学习并掌握了“强制求爱”技能！</RavenRace_AbilityTomeLearned>
    <RavenRace_AbilityTomeAlreadyKnown>{0} 已经掌握了这项技能。</RavenRace_AbilityTomeAlreadyKnown>

    <!-- 杂交设置 -->
    <RavenRace_Settings_MiliraFlight>米莉拉飞行能力</RavenRace_Settings_MiliraFlight>
    <RavenRace_Settings_MiliraFlight_Tooltip>含有米莉拉血脉的渡鸦将获得真实飞行能力。</RavenRace_Settings_MiliraFlight_Tooltip>
    <RavenRace_Settings_EnableMiliraFlight>为杂交渡鸦启用飞行</RavenRace_Settings_EnableMiliraFlight>
    <RavenRace_Settings_EnableMiliraFlight_Desc>如果开启，只要含有米莉拉血脉，渡鸦将自动获得飞行能力界面。</RavenRace_Settings_EnableMiliraFlight_Desc>
    <RavenRace_Settings_MiliraFlight_Note>注意：要实现真正的“穿墙/飞越深水”功能，建议安装【天羽族真实飞行补丁】。</RavenRace_Settings_MiliraFlight_Note>

    <RavenRace_Settings_MoyoCultivation>萌螈修炼能力</RavenRace_Settings_MoyoCultivation>
    <RavenRace_Settings_MoyoActive>状态: 已激活 (检测到萌螈Mod)</RavenRace_Settings_MoyoActive>
    <RavenRace_Settings_MoyoInactive>状态: 未激活 (未找到萌螈Mod)</RavenRace_Settings_MoyoInactive>
    <RavenRace_Settings_AutoHandled>设置将根据角色血脉自动处理。</RavenRace_Settings_AutoHandled>

    <RavenRace_Settings_KlimDragonBlood>珂莉姆龙血</RavenRace_Settings_KlimDragonBlood>
    <RavenRace_Settings_EnableKoelimeBloodline>启用古龙血脉遗传</RavenRace_Settings_EnableKoelimeBloodline>
    <RavenRace_Settings_EnableKoelimeBloodline_Desc>如果开启，含有珂莉姆血脉的渡鸦将获得再生能力和疾病免疫。</RavenRace_Settings_EnableKoelimeBloodline_Desc>


    <!-- 间谍设置 -->
    <RavenRace_Settings_MissionSuccessBonus>任务成功率修正</RavenRace_Settings_MissionSuccessBonus>
    <RavenRace_Settings_EnableManualInfiltration>允许手动潜入模式</RavenRace_Settings_EnableManualInfiltration>
    <RavenRace_Settings_FailureCooldown>任务失败冷却天数</RavenRace_Settings_FailureCooldown>
    <RavenRace_Settings_CostMultiplier>任务消耗倍率</RavenRace_Settings_CostMultiplier>
    <RavenRace_Settings_DurationMultiplier>任务耗时倍率</RavenRace_Settings_DurationMultiplier>




    <!-- 防卫系统 -->
    <RavenRace_Settings_DefenseSystem>防卫系统</RavenRace_Settings_DefenseSystem>
    <RavenRace_Settings_DefenseDebug>启用陷阱调试显示</RavenRace_Settings_DefenseDebug>
    <RavenRace_Settings_DefenseDebugDesc>在选中陷阱时显示触发范围和状态信息。</RavenRace_Settings_DefenseDebugDesc>
    <RavenRace_Settings_FriendlyFireSafe>友军安全模式</RavenRace_Settings_FriendlyFireSafe>
    <RavenRace_Settings_FriendlyFireSafeDesc>如果开启，陷阱不会被殖民者和友军触发。如果关闭，任何人都会触发。</RavenRace_Settings_FriendlyFireSafeDesc>
    <RavenRace_Settings_TrapDamageMultiplier>陷阱伤害倍率</RavenRace_Settings_TrapDamageMultiplier>
    <RavenRace_Settings_RisingWallSize>升墙陷阱尺寸</RavenRace_Settings_RisingWallSize>

    <!-- [新增] 飞机杯设置文本 -->
    <RavenRace_Settings_MasturbatorCup>飞机杯 (彩蛋道具)</RavenRace_Settings_MasturbatorCup>
    <RavenRace_Settings_EnableDimensionalSex>启用: 次元性交</RavenRace_Settings_EnableDimensionalSex>
    <RavenRace_Settings_EnableDimensionalSexDesc>允许飞机杯与地图上的任意目标进行量子绑定，并实施远程强制性交。这是一个作弊向的强力控制功能。</RavenRace_Settings_EnableDimensionalSexDesc>


    <!-- 通用 -->
    <Days>天</Days>
    <Hours>小时</Hours>

    <!-- 消息提示 -->
    <RavenRace_Msg_OxytocinReaction>{0} 使用了催产素，身体开始剧烈反应！</RavenRace_Msg_OxytocinReaction>
    <RavenRace_Msg_OxytocinNoEffect>催产素对该生物无效。</RavenRace_Msg_OxytocinNoEffect>
    <RavenRace_Msg_RapidOvulationBirth>{0} 在药物刺激下产下了一枚未受精的灵卵。</RavenRace_Msg_RapidOvulationBirth>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_SpiritBeads.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenRace_AutoInsert>自动纳刀</RavenRace_AutoInsert>
  <RavenRace_AutoInsertDesc>开启后，当脱离战斗且灵珠未在体内时，会自动尝试将其塞入。\n(不会在征召状态下触发)</RavenRace_AutoInsertDesc>
  
  <RavenRace_InsertBeads>塞入灵珠</RavenRace_InsertBeads>
  <RavenRace_InsertBeadsDesc>手动将灵卵拉珠塞入体内，准备发动强力攻击。</RavenRace_InsertBeadsDesc>
  
  <RavenRace_Msg_BeadsPopOut>{0} 卸下了武器，灵珠滑了出来。</RavenRace_Msg_BeadsPopOut>
  <RavenRace_Text_BeadsInserted>已纳刀 (充盈)</RavenRace_Text_BeadsInserted>
  <RavenRace_Text_ClimaxImpact>高潮!</RavenRace_Text_ClimaxImpact>
  
  <RavenRace_Settings_SpiritBeads>灵卵拉珠 (彩蛋武器)</RavenRace_Settings_SpiritBeads>
  <RavenRace_Settings_EnableGrandClimax>启用技能：盛大高潮</RavenRace_Settings_EnableGrandClimax>
  <RavenRace_Settings_EnableGrandClimaxDesc>允许灵卵拉珠使用全图范围的强力控制技能。默认关闭以保持平衡。</RavenRace_Settings_EnableGrandClimaxDesc>
  <RavenRace_Msg_GrandClimaxDisabled>该技能已在模组设置中禁用。</RavenRace_Msg_GrandClimaxDisabled>
  <RavenRace_Msg_GrandClimaxUnleashed>{0} 释放了灵珠的所有潜能，战场被淫靡的气息淹没！</RavenRace_Msg_GrandClimaxUnleashed>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_Storyteller.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenRace_Kotoamatsukami_Title>别天神 - 意志改写</RavenRace_Kotoamatsukami_Title>
  <RavenRace_Kotoamatsukami_Desc>正在改写 {1} 的意志，使其成为 {0} 的所有物。</RavenRace_Kotoamatsukami_Desc>
  
  <RavenRace_Label_Master>受术者 {0} 对 施术者 {1} 的称呼:</RavenRace_Label_Master>
  <RavenRace_Label_Servant>施术者 {0} 对 受术者 {1} 的称呼:</RavenRace_Label_Servant>
  
  <RavenRace_Label_Opinion_S2M>强制好感度 ({0} - {1}): {2}</RavenRace_Label_Opinion_S2M>
  <RavenRace_Label_Opinion_M2S>强制好感度 ({0} - {1}): {2}</RavenRace_Label_Opinion_M2S>
  
  <RavenRace_Msg_KotoamatsukamiSuccess>{0} 对 {1} 施展了别天神！{1} 的意志已被彻底改写。</RavenRace_Msg_KotoamatsukamiSuccess>
  
  <Raven_Default_Master>绝对主人</Raven_Default_Master>
  <Raven_Default_Servant>忠诚奴仆</Raven_Default_Servant>
  <Confirm>确定</Confirm> 

  <!-- 渡鸦加入事件 -->
  <RavenRace_LetterLabel_FirstRavenJoin>渡鸦加入</RavenRace_LetterLabel_FirstRavenJoin>
  <RavenRace_LetterText_FirstRavenJoin>一名流浪的渡鸦族来到了你的殖民地附近。{0} 声称在暗影中听到了召唤。\n\n名字: {0}\n背景: {1}\n年龄: {2}\n\n你可以选择接纳{0}成为殖民者，或者将其拒之门外。</RavenRace_LetterText_FirstRavenJoin>
  <RavenRace_Message_RavenJoined>{0} 已加入殖民地。</RavenRace_Message_RavenJoined>
  



</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\ChineseSimplified\Keyed\Keys_UniqueEquipment.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>

  
  <!-- 暗影斗篷 -->


  <Raven_Hediff_ShadowStep.label>暗影步</Raven_Hediff_ShadowStep.label>
  <Raven_Hediff_ShadowStep.description>借助暗影斗篷的力量，移动速度大幅提升，身形变得难以捉摸。</Raven_Hediff_ShadowStep.description>

  <RavenHediff_ShadowAttackCooldown.label>暗影冷却</RavenHediff_ShadowAttackCooldown.label>
  <RavenHediff_ShadowAttackCooldown.description>刚刚发动了致命一击，正在重整姿态。此时移动速度极快，但无法再次发动攻击。</RavenHediff_ShadowAttackCooldown.description>



</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\DefInjected\StorytellerDef\Storyteller_ZuoYao.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  
  <ZuoYao_Storyteller.label>Zuo Yao</ZuoYao_Storyteller.label>
  <ZuoYao_Storyteller.description>A mysterious Raven woman has contacted you of her own accord.\n\nShe calls herself Zuo Yao and claims to be "quite interested" in your colony.\n\nHer tone always carries a subtle hint of playfulness, as if everything is part of her calculations. Just when you think you've gained a moment's respite, she may be weaving an even greater puzzle in the shadows.\n\n"Don't be nervous, I just want to see how far you can go."\n\nShe drives events at a pace similar to Cassandra, but you can't shake the feeling... she knows something you don't.</ZuoYao_Storyteller.description>

</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\DefInjected\ThingDef\Buildings_ExplosiveTraps.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <RavenTrap_Claymore.label>claymore wall guard</RavenTrap_Claymore.label>
  <RavenTrap_Claymore.description>A directional explosive charge designed to protect walls. It is triggered ONLY when the wall it is attached to takes damage (anti-sapper). When triggered, it blasts a fan-shaped area in front of it to eliminate threats.</RavenTrap_Claymore.description>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\Keyed\Keys_Bloodline.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Bloodline System -->
    <RavenRace_Bloodline>Bloodline</RavenRace_Bloodline>
    <RavenRace_BloodlineComposition>Bloodline Composition</RavenRace_BloodlineComposition>
    <RavenRace_GoldenCrowConcentration>Golden Crow Concentration</RavenRace_GoldenCrowConcentration>
    <RavenRace_BloodlinePurity>Purity</RavenRace_BloodlinePurity>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\Keyed\Keys_Core.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Race Names -->
    <RavenRace_RaceName>Raven</RavenRace_RaceName>
    <RavenRace_GoldenCrowName>Golden Crow</RavenRace_GoldenCrowName>
    
    <!-- Faction -->
    <RavenRace_FusangName>Fusang</RavenRace_FusangName>
    <RavenRace_FusangDesc>A mysterious organization operating in the shadows.</RavenRace_FusangDesc>
    
    <!-- Settings Category -->
    <RavenRace_SettingsCategory>Raven Race</RavenRace_SettingsCategory>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\Keyed\Keys_Defense.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
  <MustPlaceOnWall>Must be placed on a wall or rock.</MustPlaceOnWall>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\Keyed\Keys_Hybridization.xml
=
.
<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Settings Category -->
    <RavenRace_Settings_Hybridization>Hybridization</RavenRace_Settings_Hybridization>
    <RavenRace_Settings_HybridizationDesc>Configure rules for hybrid ravens inheriting abilities from other races.</RavenRace_Settings_HybridizationDesc>

    <!-- Common Status -->
    <RavenRace_Settings_ModActive>Status: Active (Mod Detected)</RavenRace_Settings_ModActive>
    <RavenRace_Settings_ModInactive>Status: Inactive (Mod Not Detected)</RavenRace_Settings_ModInactive>

    <!-- Milira -->
    <RavenRace_Settings_MiliraCompat>Milira Bloodline</RavenRace_Settings_MiliraCompat>
    <RavenRace_Settings_EnableMiliraCompat>Enable Milira Traits</RavenRace_Settings_EnableMiliraCompat>
    <RavenRace_Settings_EnableMiliraCompat_Desc>If enabled, ravens with Milira bloodline will gain movement speed bonus and reduced aiming time.</RavenRace_Settings_EnableMiliraCompat_Desc>

    <!-- MoeLotl -->
    <RavenRace_Settings_MoeLotlCultivation>MoeLotl Cultivation</RavenRace_Settings_MoeLotlCultivation>
    <RavenRace_Settings_EnableMoeLotlCompat>Enable MoeLotl Traits</RavenRace_Settings_EnableMoeLotlCompat>
    <RavenRace_Settings_EnableMoeLotlCompat_Desc>If enabled, ravens with MoeLotl bloodline will gain cultivation abilities.</RavenRace_Settings_EnableMoeLotlCompat_Desc>
    <RavenRace_ForceReadBook>Force Read: {0}</RavenRace_ForceReadBook>
    <RavenRace_WrongBook>Wrong Book Type</RavenRace_WrongBook>

    <!-- Klim Dragon Blood -->
    <RavenRace_Settings_KlimDragonBlood>Klim Dragon Blood</RavenRace_Settings_KlimDragonBlood>
    <RavenRace_Settings_EnableKoelimeBloodline>Enable Ancient Dragon Traits</RavenRace_Settings_EnableKoelimeBloodline>
    <RavenRace_Settings_EnableKoelimeBloodline_Desc>If enabled, ravens with Koelime bloodline will gain regeneration and immunity to diseases.</RavenRace_Settings_EnableKoelimeBloodline_Desc>

    <!-- MuGirl -->
    <RavenRace_Settings_MuGirlCompat>MooGirl Bloodline</RavenRace_Settings_MuGirlCompat>
    <RavenRace_Settings_EnableMuGirlCompat>Enable MooGirl Traits</RavenRace_Settings_EnableMuGirlCompat>
    <RavenRace_Settings_EnableMuGirlCompat_Desc>If enabled, ravens with MooGirl bloodline (regardless of gender) will gain armor bonuses and the ability to produce milk.</RavenRace_Settings_EnableMuGirlCompat_Desc>
    <RavenRace_MilkFullness>Snow Milk Full</RavenRace_MilkFullness>
    <RavenRace_GatherMilk>Gather Milk</RavenRace_GatherMilk>
    <RavenRace_GatherMilkDesc>Gather the accumulated milk from this Raven.</RavenRace_GatherMilkDesc>
    <RavenRace_Msg_MilkGathered>{0} gathered {1} {2}.</RavenRace_Msg_MilkGathered>
    <RavenRace_Settings_MuffaloPrank>Wait, WHICH Muffalo?</RavenRace_Settings_MuffaloPrank>
    <RavenRace_Settings_MuffaloPrank_Desc>An old story about a chicken and a muffalo... oh my, what a tragic couple!\n\n(Enables Force Lovin on vanilla Muffalos, treating them as MooGirls)</RavenRace_Settings_MuffaloPrank_Desc>

    <!-- Wolfein -->
    <RavenRace_Settings_WolfeinCompat>Wolfein Bloodline</RavenRace_Settings_WolfeinCompat>
    <RavenRace_Settings_EnableWolfeinCompat>Enable Wolfein Traits</RavenRace_Settings_EnableWolfeinCompat>
    <RavenRace_Settings_EnableWolfeinCompat_Desc>If enabled, ravens with Wolfein bloodline will gain lesser Night and Moon phase buffs.</RavenRace_Settings_EnableWolfeinCompat_Desc>
    
    <!-- Dragonian -->
    <RavenRace_Settings_DragonianCompat>Dragonian Bloodline</RavenRace_Settings_DragonianCompat>
    <RavenRace_Settings_EnableDragonianCompat>Enable Dragonian Traits</RavenRace_Settings_EnableDragonianCompat>
    <RavenRace_Settings_EnableDragonianCompat_Desc>If enabled, ravens with Dragonian bloodline will produce dragon milk.</RavenRace_Settings_EnableDragonianCompat_Desc>
    <RavenRace_DragonMilkFullness>Dragon Milk</RavenRace_DragonMilkFullness>
    <RavenRace_DivineMilkFullness>Divine Milk</RavenRace_DivineMilkFullness>

    <!-- Moyo -->
    <RavenRace_Settings_MoyoCompat>Moyo Bloodline</RavenRace_Settings_MoyoCompat>
    <RavenRace_Settings_EnableMoyoCompat>Enable Moyo Traits</RavenRace_Settings_EnableMoyoCompat>
    <RavenRace_Settings_EnableMoyoCompat_Desc>If enabled, ravens with Moyo bloodline will produce Blue Serum and be immune to Deep Blue addiction/side effects.</RavenRace_Settings_EnableMoyoCompat_Desc>

    <!-- Epona -->
    <RavenRace_Settings_EponaCompat>Epona Bloodline</RavenRace_Settings_EponaCompat>
    <RavenRace_Settings_EnableEponaCompat>Enable Epona Traits</RavenRace_Settings_EnableEponaCompat>
    <RavenRace_Settings_EnableEponaCompat_Desc>If enabled, ravens with Epona bloodline gain speed bonuses and enhanced charge ability.</RavenRace_Settings_EnableEponaCompat_Desc>
    <RavenRace_AbilityLabel_EnhancedCharge>Swift Charge</RavenRace_AbilityLabel_EnhancedCharge>
    <RavenRace_AbilityDesc_EnhancedCharge>A perfect blend of Epona speed and MooGirl strength.</RavenRace_AbilityDesc_EnhancedCharge>
    <RavenRace_Message_OutOfRange>Target is out of range.</RavenRace_Message_OutOfRange>

    <!-- Tailin -->
    <RavenRace_Settings_TailinCompat>Tailin Bloodline</RavenRace_Settings_TailinCompat>
    <RavenRace_Settings_EnableTailinCompat>Enable Tailin Traits</RavenRace_Settings_EnableTailinCompat>
    <RavenRace_Settings_EnableTailinCompat_Desc>If enabled, ravens with Tailin bloodline gain combat instincts.</RavenRace_Settings_EnableTailinCompat_Desc>

    <!-- Cinder -->
    <RavenRace_Settings_CinderCompat>Cinder Bloodline</RavenRace_Settings_CinderCompat>
    <RavenRace_Settings_EnableCinderCompat>Enable Cinder Traits</RavenRace_Settings_EnableCinderCompat>
    <RavenRace_Settings_EnableCinderCompat_Desc>If enabled, ravens with Cinder bloodline will gain "Polymer Regeneration".</RavenRace_Settings_EnableCinderCompat_Desc>

    <!-- Miraboreas -->
    <RavenRace_Settings_MiraboreasCompat>Miraboreas Bloodline</RavenRace_Settings_MiraboreasCompat>
    <RavenRace_Settings_EnableMiraboreasCompat>Enable Miraboreas Traits</RavenRace_Settings_EnableMiraboreasCompat>
    <RavenRace_Settings_EnableMiraboreasCompat_Desc>If enabled, ravens with Miraboreas bloodline gain stagger immunity and melee cleave attacks.</RavenRace_Settings_EnableMiraboreasCompat_Desc>

    <!-- Mincho -->
    <RavenRace_Settings_MinchoCompat>Mincho Bloodline</RavenRace_Settings_MinchoCompat>
    <RavenRace_Settings_EnableMinchoCompat>Enable Mincho Traits</RavenRace_Settings_EnableMinchoCompat>
    <RavenRace_Settings_EnableMinchoCompat_Desc>If enabled, ravens with Mincho bloodline gain extreme cold resistance (-500C) and produce Mint Choco.</RavenRace_Settings_EnableMinchoCompat_Desc>
    
    <RavenRace_MinchoChocolateFullness>Mint Choco</RavenRace_MinchoChocolateFullness>
    <RavenRace_Message_MinchoProduced>{0} has naturally produced {1}!</RavenRace_Message_MinchoProduced>

    <!-- Gizmo UI -->
    <Milira_Flight_Toggle>Flight</Milira_Flight_Toggle>
    <Milira_Flight_Toggle_Desc>Toggle flight ability.\n\nWhile flying, can bypass deep water and walls (with patch), but continuously drains hunger.</Milira_Flight_Toggle_Desc>
    
    <Milira_Flight_LowAlt>Low Altitude</Milira_Flight_LowAlt>
    <Milira_Flight_HighAlt>High Altitude</Milira_Flight_HighAlt>
    <Milira_Flight_Mode_Desc>Switch flight altitude.\n\n【Low】: Only fly while moving, can fly over buildings but not roofs.\n【High】: Always flying, can fly over roofs but not solid buildings.</Milira_Flight_Mode_Desc>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Languages\English\Keyed\Keys_Settings.xml
=
.
﻿<?xml version="1.0" encoding="utf-8"?>
<LanguageData>
    <!-- Settings Tabs -->
    <RavenRace_Settings_Base>Base</RavenRace_Settings_Base>
    <RavenRace_Settings_Bloodline>Bloodline</RavenRace_Settings_Bloodline>
    <RavenRace_Settings_Altar>Altar</RavenRace_Settings_Altar>
    <RavenRace_Settings_Fusang>Fusang</RavenRace_Settings_Fusang>
    <RavenRace_Settings_Espionage>Espionage</RavenRace_Settings_Espionage>
    <RavenRace_Settings_Debug>Debug</RavenRace_Settings_Debug>
    
    <!-- Settings Descriptions -->
    <RavenRace_Settings_BaseDesc>Basic settings for the Raven Race mod.</RavenRace_Settings_BaseDesc>
    <RavenRace_Settings_BloodlineDesc>Adjust bloodline inheritance and mutation rules.</RavenRace_Settings_BloodlineDesc>
    <RavenRace_Settings_AltarDesc>Adjust hatching and effect parameters for the Soul Altar.</RavenRace_Settings_AltarDesc>
    <RavenRace_Settings_FusangDesc>Adjust service and communication parameters for the Fusang organization.</RavenRace_Settings_FusangDesc>
    <RavenRace_Settings_EspionageDesc>Adjust success rates and cooldowns for espionage missions.</RavenRace_Settings_EspionageDesc>
    <RavenRace_Settings_DebugDesc>Developer debug tools. Additional features available when debug mode is enabled.</RavenRace_Settings_DebugDesc>
    <RavenRace_Settings_ComingSoon>This feature will be implemented in a future version...</RavenRace_Settings_ComingSoon>
    
    <!-- Bloodline System Settings -->
    <RavenRace_Settings_InheritanceStrength>Bloodline Inheritance Strength</RavenRace_Settings_InheritanceStrength>
    <RavenRace_Settings_DecayRate>Golden Crow Concentration Decay Rate</RavenRace_Settings_DecayRate>
    <RavenRace_Settings_EnableMutations>Enable Bloodline Mutations</RavenRace_Settings_EnableMutations>
    
    <!-- Soul Altar Settings -->
    <RavenRace_Settings_BaseHatchingDays>Base Hatching Days</RavenRace_Settings_BaseHatchingDays>
    <RavenRace_Settings_EffectRadius>Altar Effect Radius</RavenRace_Settings_EffectRadius>
    <RavenRace_Settings_EnableVisualEffects>Enable Visual Effects</RavenRace_Settings_EnableVisualEffects>
    
    <!-- Fusang Organization Settings -->
    <RavenRace_Settings_CommCooldown>Communication Cooldown</RavenRace_Settings_CommCooldown>
    <RavenRace_Settings_ReinforcementDelay>Reinforcement Arrival Delay</RavenRace_Settings_ReinforcementDelay>
    <RavenRace_Settings_TradePriceModifier>Trade Price Modifier</RavenRace_Settings_TradePriceModifier>
    
    <!-- Espionage System Settings -->
    <RavenRace_Settings_MissionSuccessBonus>Mission Success Rate Bonus</RavenRace_Settings_MissionSuccessBonus>
    <RavenRace_Settings_EnableManualInfiltration>Enable Manual Infiltration Mode</RavenRace_Settings_EnableManualInfiltration>
    <RavenRace_Settings_FailureCooldown>Mission Failure Cooldown</RavenRace_Settings_FailureCooldown>


    <!-- Defense System -->
    <RavenRace_Settings_DefenseSystem>Defense System</RavenRace_Settings_DefenseSystem>
    <RavenRace_Settings_DefenseDebug>Enable Trap Debugging</RavenRace_Settings_DefenseDebug>
    <RavenRace_Settings_DefenseDebugDesc>Shows trigger radius and status information when traps are selected.</RavenRace_Settings_DefenseDebugDesc>
    <RavenRace_Settings_FriendlyFireSafe>Friendly Fire Safety</RavenRace_Settings_FriendlyFireSafe>
    <RavenRace_Settings_FriendlyFireSafeDesc>If enabled, traps will not be triggered by colonists or allies. If disabled, anyone can trigger them.</RavenRace_Settings_FriendlyFireSafeDesc>
    <RavenRace_Settings_TrapDamageMultiplier>Trap Damage Multiplier</RavenRace_Settings_TrapDamageMultiplier>



    
    <!-- Debug Settings -->
    <RavenRace_Settings_EnableDebugMode>Enable Debug Mode</RavenRace_Settings_EnableDebugMode>
    <RavenRace_Settings_EnableVerboseLogging>Enable Verbose Logging</RavenRace_Settings_EnableVerboseLogging>
    <RavenRace_Settings_DebugActions>Debug Actions</RavenRace_Settings_DebugActions>
    
    <!-- Debug Buttons -->
    <RavenRace_Debug_InstantHatch>Instant Hatch All Eggs</RavenRace_Debug_InstantHatch>
    <RavenRace_Debug_SetConcentration>Set Golden Crow Concentration</RavenRace_Debug_SetConcentration>
    <RavenRace_Debug_ResetMainQuest>Reset Main Quest</RavenRace_Debug_ResetMainQuest>
    

    <!-- Common -->
    <Days>days</Days>
    <Hours>hours</Hours>
</LanguageData>.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Buildings\Building_EmberExtractor.cs
=
.
﻿using System.Collections.Generic;
using UnityEngine;
using Verse;
using RimWorld;
using System.Linq;
using Verse.AI;
using System.Text;

namespace RavenRace.Buildings
{
    /// <summary>
    /// 提取仪专用属性类，用于加载自定义 XML 贴图节点。
    /// </summary>
    public class BuildingProperties_EmberExtractor : BuildingProperties
    {
        public GraphicData emberExtractorTankGraphic = null;
    }

    /// <summary>
    /// 残火提取仪：实现人员进入、多层贴图渲染及属性逻辑。
    /// [1.6 规范] 必须使用 StaticConstructorOnStartup 以确保 Texture2D 在主线程初始化。
    /// </summary>
    [StaticConstructorOnStartup]
    public class Building_EmberExtractor : Building_Enterable, IThingHolderWithDrawnPawn
    {
        // ==========================================
        // 字段
        // ==========================================
        private const int ExtractionDuration = 60000;
        private int ticksRemaining = ExtractionDuration;
        private CompPowerTrader powerComp;
        private Graphic tankGraphic;

        // [1.6 修复] 使用绝对安全的原版路径，并在静态构造函数中显式加载
        private static readonly Texture2D InsertIcon = ContentFinder<Texture2D>.Get("UI/Designators/Cancel", true);
        private static readonly Texture2D CancelIcon = ContentFinder<Texture2D>.Get("UI/Designators/Cancel", true);

        // ==========================================
        // 属性
        // ==========================================
        public Pawn ContainedPawn => innerContainer.FirstOrDefault() as Pawn;
        public bool PowerOn => powerComp != null && powerComp.PowerOn;
        private BuildingProperties_EmberExtractor BuildingProps => (BuildingProperties_EmberExtractor)def.building;

        // ==========================================
        // 渲染接口 (IThingHolderWithDrawnPawn)
        // ==========================================
        public float HeldPawnDrawPos_Y => DrawPos.y + Altitudes.AltInc;
        public float HeldPawnBodyAngle => Rotation.AsAngle;
        public PawnPosture HeldPawnPosture => PawnPosture.LayingOnGroundFaceUp;
        public override Vector3 PawnDrawOffset => Vector3.zero;

        // ==========================================
        // 生命周期
        // ==========================================
        public override void SpawnSetup(Map map, bool respawningAfterLoad)
        {
            base.SpawnSetup(map, respawningAfterLoad);
            powerComp = GetComp<CompPowerTrader>();
        }

        public override void ExposeData()
        {
            base.ExposeData();
            Scribe_Values.Look(ref ticksRemaining, "ticksRemaining", ExtractionDuration);
        }

        protected override void Tick()
        {
            base.Tick();
            if (Working && ContainedPawn != null && PowerOn)
            {
                ticksRemaining--;
                if (ticksRemaining <= 0) FinishExtraction();
            }
        }

        // ==========================================
        // 渲染核心 (DrawAt)
        // ==========================================
        protected override void DrawAt(Vector3 drawLoc, bool flip = false)
        {
            // 1. 绘制底座
            base.DrawAt(drawLoc, flip);

            // 2. 绘制内部 Pawn
            if (Working && ContainedPawn != null)
            {
                Vector3 pawnDrawPos = this.DrawPos;
                pawnDrawPos.z += 0.52f; // 微调 Z 轴位置使小人居中

                // [1.6 规范] 调用 RenderPawnAt 并在渲染后确保节点状态
                ContainedPawn.Drawer.renderer.RenderPawnAt(pawnDrawPos, null, false);
            }

            // 3. 绘制覆盖罐体
            if (this.tankGraphic == null && BuildingProps.emberExtractorTankGraphic != null)
            {
                this.tankGraphic = BuildingProps.emberExtractorTankGraphic.GraphicColoredFor(this);
            }

            if (this.tankGraphic != null)
            {
                Vector3 tankPos = drawLoc;
                tankPos.y += Altitudes.AltInc * 2; // Y轴抬高，确保覆盖在底座和小人之上
                this.tankGraphic.Draw(tankPos, Rotation, this, 0f);
            }
        }

        // ==========================================
        // 逻辑处理
        // ==========================================
        public override AcceptanceReport CanAcceptPawn(Pawn pawn)
        {
            if (!pawn.IsColonist && !pawn.IsSlaveOfColony && !pawn.IsPrisonerOfColony) return false;
            if (pawn.def.defName != "Raven_Race") return "RavenRace_Extractor_OnlyRaven".Translate();
            if (pawn.health.hediffSet.HasHediff(RavenDefOf.Raven_Hediff_EmberDrain))
                return "RavenRace_Extractor_InCooldown".Translate(pawn.Named("PAWN"));
            if (!PowerOn) return "NoPower".Translate().CapitalizeFirst();
            if (innerContainer.Count > 0) return "Occupied".Translate();
            return true;
        }

        public override void TryAcceptPawn(Pawn pawn)
        {
            if (!CanAcceptPawn(pawn)) return;
            pawn.DeSpawnOrDeselect(DestroyMode.Vanish);
            if (innerContainer.TryAddOrTransfer(pawn, true))
            {
                selectedPawn = pawn;
                startTick = Find.TickManager.TicksGame;
                ticksRemaining = ExtractionDuration;
                // [核心] 改变状态后标记渲染为脏
                pawn.Drawer?.renderer?.SetAllGraphicsDirty();
            }
        }

        private void FinishExtraction()
        {
            Pawn pawn = ContainedPawn;
            if (pawn == null) { ResetState(); return; }

            Thing blood = ThingMaker.MakeThing(ThingDef.Named("Raven_EmberBlood"));
            GenDrop.TryDropSpawn(blood, InteractionCell, Map, ThingPlaceMode.Near, out Thing _);

            pawn.health.AddHediff(RavenDefOf.Raven_Hediff_EmberDrain);
            if (!pawn.health.hediffSet.HasHediff(HediffDefOf.Anesthetic))
                pawn.health.AddHediff(HediffDefOf.Anesthetic);

            innerContainer.TryDropAll(InteractionCell, Map, ThingPlaceMode.Near);

            // [核心修复] 弹出人员后必须彻底刷新其渲染树
            pawn.Drawer?.renderer?.SetAllGraphicsDirty();
            ResetState();

            Messages.Message("RavenRace_Extractor_Finished_Safe".Translate(pawn.LabelShort), new LookTargets(this, blood, pawn), MessageTypeDefOf.PositiveEvent);
        }

        private void ResetState() { selectedPawn = null; startTick = -1; ticksRemaining = ExtractionDuration; }

        public override IEnumerable<Gizmo> GetGizmos()
        {
            foreach (var gizmo in base.GetGizmos()) yield return gizmo;
            if (Working)
            {
                yield return new Command_Action { defaultLabel = "CommandCancel".Translate(), icon = CancelIcon, action = CancelExtraction };
            }
            else if (innerContainer.Count == 0)
            {
                yield return new Command_Action
                {
                    defaultLabel = "RavenRace_InsertPerson".Translate() + "...",
                    icon = InsertIcon,
                    action = OpenInsertFloatMenu
                };
            }
        }

        private void OpenInsertFloatMenu()
        {
            List<FloatMenuOption> list = new List<FloatMenuOption>();
            foreach (Pawn p in Map.mapPawns.AllPawnsSpawned)
            {
                if (p.IsColonist || p.IsPrisonerOfColony || p.IsSlaveOfColony)
                {
                    AcceptanceReport ar = CanAcceptPawn(p);
                    if (ar.Accepted) list.Add(new FloatMenuOption(p.LabelShortCap, () => SelectPawn(p)));
                    else list.Add(new FloatMenuOption(p.LabelShortCap + ": " + ar.Reason, null));
                }
            }
            Find.WindowStack.Add(new FloatMenu(list));
        }

        private void CancelExtraction() { innerContainer.TryDropAll(InteractionCell, Map, ThingPlaceMode.Near); ResetState(); }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Buildings\RavenBuildingDefOf.cs
=
.
﻿using RimWorld;
using Verse;

namespace RavenRace.Buildings
{
    [DefOf]
    public static class RavenBuildingDefOf
    {
        // 对应 Defs/Buildings/Thoughts/Thoughts_Buildings.xml 中的 defName
        public static ThoughtDef Raven_Thought_IncenseSmell;

        static RavenBuildingDefOf()
        {
            DefOfHelper.EnsureInitializedInCtor(typeof(RavenBuildingDefOf));
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Buildings\RavenWall_Building.cs
=
.
﻿using Verse;

namespace RavenRace.Buildings
{
    /// <summary>
    /// 渡鸦墙体专用标识类。
    /// 继承自 Building，用于在 Harmony 补丁中与原版墙体及蓝图进行逻辑对接。
    /// </summary>
    public class RavenWall_Building : Building
    {
        // 此类保持为空，仅作为类型标记使用
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Buildings\Comps\CompIncenseBurner.cs
=
.
﻿using System.Collections.Generic;
using UnityEngine;
using Verse;
using RimWorld;
using Verse.AI;
using System.Linq;

namespace RavenRace.Buildings.Comps
{
    public class CompProperties_IncenseBurner : CompProperties
    {
        public float effectRadius = 9.9f;
        public float joyAmount = 0.05f;
        public float forceLovinChance = 0.05f;

        public CompProperties_IncenseBurner()
        {
            this.compClass = typeof(CompIncenseBurner);
        }
    }

    public class CompIncenseBurner : ThingComp
    {
        public CompProperties_IncenseBurner Props => (CompProperties_IncenseBurner)props;
        private CompRefuelable refuelable;

        public override void PostSpawnSetup(bool respawningAfterLoad)
        {
            base.PostSpawnSetup(respawningAfterLoad);
            refuelable = parent.GetComp<CompRefuelable>();
        }

        public override void CompTick()
        {
            base.CompTick();
            // 使用设置中的间隔
            if (parent.IsHashIntervalTick(RavenRaceMod.Settings.incenseCheckInterval))
            {
                DoEffect();
            }
        }

        private void DoEffect()
        {
            if (refuelable != null && !refuelable.HasFuel) return;

            Map map = parent.Map;
            List<Pawn> pawnsInRange = new List<Pawn>();

            // 1. 获取范围内生物
            foreach (Thing t in GenRadial.RadialDistinctThingsAround(parent.Position, map, Props.effectRadius, true))
            {
                if (t is Pawn p && !p.Dead && !p.Downed && p.RaceProps.Humanlike)
                {
                    pawnsInRange.Add(p);
                }
            }

            if (pawnsInRange.Count == 0) return;

            foreach (Pawn p in pawnsInRange)
            {
                // A. 娱乐与心情
                p.needs?.joy?.GainJoy(RavenRaceMod.Settings.incenseJoyAmount, JoyKindDefOf.Social);

                if (RavenBuildingDefOf.Raven_Thought_IncenseSmell != null)
                {
                    p.needs?.mood?.thoughts?.memories?.TryGainMemory(RavenBuildingDefOf.Raven_Thought_IncenseSmell);
                }

                // B. [修改] 施加独立的香炉氛围 Hediff (无副作用)
                HediffDef auraDef = DefDatabase<HediffDef>.GetNamedSilentFail("RavenHediff_IncenseAura");
                if (auraDef != null)
                {
                    HealthUtility.AdjustSeverity(p, auraDef, 0.01f);
                }
            }

            // 2. 触发技能
            TriggerRavenAbility(pawnsInRange);
        }

        private void TriggerRavenAbility(List<Pawn> pawnsInRange)
        {
            List<Pawn> capableRavens = pawnsInRange
                .Where(p => p.def.defName == "Raven_Race" && !p.Drafted &&
                            p.abilities?.GetAbility(RavenDefOf.Raven_Ability_ForceLovin) != null)
                .ToList();

            if (capableRavens.Count > 0 && Rand.Chance(RavenRaceMod.Settings.incenseForceLovinChance))
            {
                Pawn caster = capableRavens.RandomElement();

                // [修复] 检查施法者是否已经在忙于交配
                if (IsBusyLovin(caster)) return;

                var validTargets = pawnsInRange.Where(t => t != caster && !t.Downed && !IsBusyLovin(t)).ToList();
                if (validTargets.Count == 0) return;

                Pawn target = validTargets.FirstOrDefault(t => LovePartnerRelationUtility.LovePartnerRelationExists(caster, t));
                if (target == null)
                {
                    target = validTargets.Where(t => t.gender != caster.gender && caster.relations.OpinionOf(t) > 20).RandomElementWithFallback();
                }
                if (target == null) target = validTargets.RandomElement();

                if (target != null)
                {
                    Job job = JobMaker.MakeJob(RavenDefOf.Raven_Job_ForceLovin, target);
                    caster.jobs.TryTakeOrderedJob(job, JobTag.Misc);

                    FleckMaker.ThrowMetaIcon(caster.Position, caster.Map, FleckDefOf.Heart);
                    Messages.Message("Raven_Message_IncenseEffect".Translate(caster.LabelShort, target.LabelShort), caster, MessageTypeDefOf.NeutralEvent);
                }
            }
        }

        // [新增] 检查是否正在进行交配任务
        private bool IsBusyLovin(Pawn p)
        {
            if (p.CurJob == null) return false;
            return p.CurJob.def == JobDefOf.Lovin ||
                   p.CurJob.def == RavenDefOf.Raven_Job_ForceLovin;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Abilities\Ability_BlindingFlash.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Ability_BlindingFlash
    /// TODO: Implement this class
    /// </summary>
    public class Ability_BlindingFlash
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Abilities\Ability_HeatShield.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Ability_HeatShield
    /// TODO: Implement this class
    /// </summary>
    public class Ability_HeatShield
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Abilities\Ability_SolarBurst.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Ability_SolarBurst
    /// TODO: Implement this class
    /// </summary>
    public class Ability_SolarBurst
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\DamageWorkers\DamageWorker_EmberBurn.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// DamageWorker_EmberBurn
    /// TODO: Implement this class
    /// </summary>
    public class DamageWorker_EmberBurn
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\DamageWorkers\DamageWorker_Solar.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// DamageWorker_Solar
    /// TODO: Implement this class
    /// </summary>
    public class DamageWorker_Solar
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Hediffs\Hediff_EmberBloodExtracted.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Hediff_EmberBloodExtracted
    /// TODO: Implement this class
    /// </summary>
    public class Hediff_EmberBloodExtracted
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Hediffs\Hediff_SolarBurn.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Hediff_SolarBurn
    /// TODO: Implement this class
    /// </summary>
    public class Hediff_SolarBurn
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Hediffs\Hediff_Stealth.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Hediff_Stealth
    /// TODO: Implement this class
    /// </summary>
    public class Hediff_Stealth
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Hediffs\Hediff_TrueStealth.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Hediff_TrueStealth
    /// TODO: Implement this class
    /// </summary>
    public class Hediff_TrueStealth
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Settings\CombatSettings.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// CombatSettings
    /// TODO: Implement this class
    /// </summary>
    public class CombatSettings
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Verbs\Verb_Backstab.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Verb_Backstab
    /// TODO: Implement this class
    /// </summary>
    public class Verb_Backstab
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Combat\Verbs\Verb_SolarBeam.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Verb_SolarBeam
    /// TODO: Implement this class
    /// </summary>
    public class Verb_SolarBeam
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\RavenModConstants.cs
=
.
﻿namespace RavenRace
{
    /// <summary>
    /// 模组全局常量定义
    /// 用于消除代码中的魔法字符串 (Magic Strings)
    /// </summary>
    public static class RavenModConstants
    {
        // Mod Package ID (必须与 About.xml 一致)
        public const string PackageId = "ZuoYao.RavenRace";

        // Harmony Patch ID
        public const string HarmonyId = "ZuoYao.RavenRace.Harmony";

        // 关键 DefNames (用于 DefOf 映射前的临时或特殊用途)
        public const string RavenRaceDefName = "Raven_Race";
        public const string FacialAnimationModId = "Nals.FacialAnimation";
        public const string FacialAnimationWIPModId = "2850854272";
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\RavenRaceMod.cs
=
.
﻿using System.Reflection;
using HarmonyLib;
using UnityEngine;
using Verse;

namespace RavenRace
{
    /// <summary>
    /// 模组的主入口类。
    /// 负责加载设置和初始化 Mod 对象。
    /// </summary>
    public class RavenRaceMod : Mod
    {
        /// <summary>
        /// 全局 Mod 设置实例
        /// </summary>
        public static RavenRaceSettings Settings { get; private set; }

        /// <summary>
        /// 模组内容包引用
        /// </summary>
        public static ModContentPack ContentPack { get; private set; }

        /// <summary>
        /// 构造函数，由游戏自动调用
        /// </summary>
        public RavenRaceMod(ModContentPack content) : base(content)
        {
            ContentPack = content;
            Settings = GetSettings<RavenRaceSettings>();

            // 注意：Harmony 补丁的加载已移交至 RavenRaceStartup.cs
            // 这样做是为了确保 Defs 加载完毕后再应用某些依赖 Def 的补丁，
            // 并且可以更好地处理 Mod 冲突。

            Log.Message($"[{RavenModConstants.PackageId}] Mod initialized. Version 1.0.0");
        }

        /// <summary>
        /// 设置菜单的标题
        /// </summary>
        public override string SettingsCategory()
        {
            return "RavenRace_SettingsCategory".Translate();
        }

        /// <summary>
        /// 绘制设置菜单的内容
        /// </summary>
        public override void DoSettingsWindowContents(Rect inRect)
        {
            Settings.DoSettingsWindowContents(inRect);
        }

        /// <summary>
        /// 当设置被修改并保存时调用
        /// </summary>
        public override void WriteSettings()
        {
            base.WriteSettings();
            Settings.OnSettingsChanged();
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\RavenRaceSettings.cs
=
.
﻿using System;
using System.Collections.Generic;
using RavenRace.Settings;
using RavenRace.HarmonyPatches; // 确保引用了补丁命名空间
using RimWorld;
using UnityEngine;
using Verse;

namespace RavenRace
{
    public class RavenRaceSettings : ModSettings
    {
        // ===================================================
        // 1. 基础与调试 (Base & Debug)
        // ===================================================
        public bool enableDebugMode = false;
        public bool enableVerboseLogging = false;

        // [新增] 余烬之血概率设置 (归类于 Base)
        public float emberBloodDeathChance = 0.3f;
        public float emberBloodBerserkChance = 0.3f;

        // [新增] 金羽设置
        public float featherDropMoodThreshold = 0.05f; // 默认 5% 悲伤/ 95% 快乐
        public int featherDropCheckInterval = 250;     // 默认 TickRare (不可调，因为方法固定)
        public float featherDropChance = 0.02f;        // 默认 2%
        public float featherCooldownDays = 60f;        // 默认 60天

        public bool showFeatherCooldown = false;

        // --- 大渡鸦 (渡鸦大统领) 设置 ---
        public bool enableGreatRavenShiny = true;
        public float greatRavenSearchDays = 3.0f;

        // [新增] 寻宝概率配置
        public float greatRavenGoldChance = 0.95f;    // 黄金概率
        public float greatRavenItemChance = 0.04f;    // 金制品概率
        public float greatRavenCubeChance = 0.01f;    // 齁金魔方概率



        // ===================================================
        // 2. 血脉系统 (Bloodline)
        // ===================================================
        public float bloodlineInheritanceStrength = 1.0f;
        public float goldenCrowDecayRate = 0.1f;
        public bool enableBloodlineMutations = true;

        // ===================================================
        // 3. 育生祭坛 (Soul Altar)
        // ===================================================
        public float baseHatchingDays = 15f;
        public int altarEffectRadius = 5;
        public bool enableAltarVisualEffects = true;

        // ===================================================
        // 4. 繁殖与互动 (Reproduction)
        // ===================================================
        public bool enableForceLovinPregnancy = true;
        public float forcedLovinPregnancyRate = 0.05f;
        public float forceLovinCooldownDays = 1.0f;

        public bool ravenFatherDeterminesEgg = false;
        public bool enableMalePregnancyEgg = false;
        public bool ignoreFertilityForPregnancy = false;
        public bool enableSameSexForceLovin = true;

        // [新增] 机械族交配开关
        public bool enableMechanoidLovin = false;

        public bool forceRavenDescendant = true;
        public bool enableEggProjectileMode = false;

        // 囚犯/奴隶互动参数
        public float forceLovinResistanceReduction = 2f;
        public float forceLovinWillReduction = 0.1f;
        public float forceLovinCertaintyReduction = 0.1f;
        public float forceLovinInstantRecruitChance = 0.1f;
        public float forceLovinBreakLoyaltyChance = 0.05f;

        public float spiritEggWarmthDays = 3f; // 灵卵温养所需天数

        public bool enableGrandClimax = false; //灵卵拉珠相关，默认关闭。

        // [新增] 飞机杯设置
        public bool enableDimensionalSex = false; // 默认关闭，作为彩蛋


        // [新增] RJW兼容开关
        public bool rjwRavenPregnancyCompat = true;

        // ===================================================
        // 5. 杂交兼容 (Hybridization)
        // ===================================================


        public bool enableMiliraCompat = true; // 米莉拉 (Milira)
        public bool enableMoeLotlCompat = true; // 萌螈 (MoeLotl)
        public bool enableKoelimeBloodline = true; // 珂莉姆 (Koelime)
        public bool enableMuGirlCompat = true; // 雪牛娘 (MuGirl)
        public bool enableMuffaloPrank = false;  // 雪牛(Muffalo)彩蛋开关
        public bool enableWolfeinCompat = true; // 沃芬 (Wolfein)
        public bool enableDragonianCompat = true; // 龙人 (Dragonian)
        public bool enableMoyoCompat = true; // 茉约 (Moyo)                                          
        public bool enableEponaCompat = true;// 艾波娜 (Epona)
        public bool enableTailinCompat = true;// 泰临 (Tailin)
        public bool enableCinderCompat = true; // 烟烬 (Cinder)
        public bool enableMiraboreasCompat = true; // 米拉波雷亚斯 (Miraboreas)
        public bool enableMinchoCompat = true; // 珉巧 (Mincho)



        // ===================================================
        // 6. 扶桑组织 (Fusang)
        // ===================================================
        public float fusangCommCooldownDays = 3f;
        public float reinforcementDelayHours = 6f;
        public float tradePriceModifier = 1.0f;

        // [新增] 商队交易冷却 (归类于 Fusang)
        public float tradeCaravanCooldownDays = 3.0f;

        // ===================================================
        // 7. 间谍系统 (Espionage)
        // ===================================================
        public float missionSuccessBonus = 0f;
        public bool enableManualInfiltration = true;
        public float missionFailureCooldownDays = 7f;
        public float missionCostMultiplier = 1.0f;
        public float missionDurationMultiplier = 1.0f;

        // ===================================================
        // 8. 防卫系统 (Defense)
        // ===================================================
        public bool enableDefenseSystemDebug = false;
        public float trapDamageMultiplier = 1.0f;
        public bool friendlyFireSafe = true;

        // 升墙陷阱大小 (5, 7, 9, 11, 13)
        public int risingWallSize = 5;

        // ===================================================
        // 9. 建筑与娱乐 (Buildings & Entertainment)
        // ===================================================
        public float incenseJoyAmount = 0.05f;
        public float incenseForceLovinChance = 0.05f;
        public int incenseCheckInterval = 250;

        // --- 电视机功能设置 ---
        public float avMatingChance = 0.02f; // 默认 2% 概率
        public float avJoyWeightMultiplier = 1.0f; // 娱乐权重倍率
        public bool avDisableTolerance = false;    // 禁用娱乐耐受/厌倦

        // ===================================================
        // UI 状态与逻辑
        // ===================================================
        private enum SettingsTab
        {
            Base,
            Bloodline,
            Altar,
            Reproduction,
            Hybridization,
            Fusang,
            Operator,
            Espionage,
            Defense,
            Buildings,
        }

        private SettingsTab currentTab = SettingsTab.Base;
        private Vector2 scrollPosition = Vector2.zero;

        public void DoSettingsWindowContents(Rect inRect)
        {
            Rect tabRect = new Rect(inRect.x, inRect.y, inRect.width, 35f);
            DrawTabs(tabRect);
            Rect contentRect = new Rect(inRect.x, inRect.y + 40f, inRect.width, inRect.height - 40f);
            Rect viewRect = new Rect(0f, 0f, contentRect.width - 16f, 1500f);
            Widgets.BeginScrollView(contentRect, ref scrollPosition, viewRect);

            Listing_Standard listing = new Listing_Standard();
            listing.Begin(viewRect);

            switch (currentTab)
            {
                case SettingsTab.Base: Settings_Base.Draw(listing); break;
                case SettingsTab.Bloodline: Settings_Bloodline.Draw(listing); break;
                case SettingsTab.Altar: Settings_Altar.Draw(listing); break;
                case SettingsTab.Reproduction: Settings_Reproduction.Draw(listing); break;
                case SettingsTab.Hybridization: Settings_Hybridization.Draw(listing); break;
                case SettingsTab.Fusang: Settings_Fusang.Draw(listing); break;
                case SettingsTab.Operator: Settings_Operator.Draw(listing); break;
                case SettingsTab.Espionage: Settings_Espionage.Draw(listing); break;
                case SettingsTab.Defense: Settings_Defense.Draw(listing); break;
                case SettingsTab.Buildings: Settings_Buildings.Draw(listing); break;
            }

            listing.End();
            Widgets.EndScrollView();
        }

        private void DrawTabs(Rect rect)
        {
            Array tabs = Enum.GetValues(typeof(SettingsTab));
            float tabWidth = rect.width / tabs.Length;

            for (int i = 0; i < tabs.Length; i++)
            {
                SettingsTab tab = (SettingsTab)tabs.GetValue(i);
                Rect tRect = new Rect(rect.x + tabWidth * i, rect.y, tabWidth, rect.height);
                if (currentTab == tab) GUI.color = Color.yellow;
                if (Widgets.ButtonText(tRect, $"RavenRace_Settings_{tab}".Translate()))
                {
                    currentTab = tab;
                    scrollPosition = Vector2.zero;
                }
                GUI.color = Color.white;
            }
        }

        public override void ExposeData()
        {
            base.ExposeData();

            Scribe_Values.Look(ref enableDebugMode, "enableDebugMode", false);
            Scribe_Values.Look(ref enableVerboseLogging, "enableVerboseLogging", false);
            Scribe_Values.Look(ref emberBloodDeathChance, "emberBloodDeathChance", 0.3f);
            Scribe_Values.Look(ref emberBloodBerserkChance, "emberBloodBerserkChance", 0.3f);
            Scribe_Values.Look(ref featherDropMoodThreshold, "featherDropMoodThreshold", 0.05f);
            Scribe_Values.Look(ref featherDropChance, "featherDropChance", 0.02f);
            Scribe_Values.Look(ref featherCooldownDays, "featherCooldownDays", 60f);
            Scribe_Values.Look(ref showFeatherCooldown, "showFeatherCooldown", false);

            //渡鸦大统领设置 (归类于 Base)
            Scribe_Values.Look(ref enableGreatRavenShiny, "enableGreatRavenShiny", true);
            Scribe_Values.Look(ref greatRavenSearchDays, "greatRavenSearchDays", 3.0f);
            Scribe_Values.Look(ref greatRavenGoldChance, "greatRavenGoldChance", 0.95f);
            Scribe_Values.Look(ref greatRavenItemChance, "greatRavenItemChance", 0.04f);
            Scribe_Values.Look(ref greatRavenCubeChance, "greatRavenCubeChance", 0.01f);



            Scribe_Values.Look(ref bloodlineInheritanceStrength, "bloodlineInheritanceStrength", 1.0f);
            Scribe_Values.Look(ref goldenCrowDecayRate, "goldenCrowDecayRate", 0.1f);
            Scribe_Values.Look(ref enableBloodlineMutations, "enableBloodlineMutations", true);
            Scribe_Values.Look(ref baseHatchingDays, "baseHatchingDays", 15f);
            Scribe_Values.Look(ref altarEffectRadius, "altarEffectRadius", 5);
            Scribe_Values.Look(ref enableAltarVisualEffects, "enableAltarVisualEffects", true);
            Scribe_Values.Look(ref enableForceLovinPregnancy, "enableForceLovinPregnancy", true);
            Scribe_Values.Look(ref forcedLovinPregnancyRate, "forcedLovinPregnancyRate", 0.05f);
            Scribe_Values.Look(ref forceLovinCooldownDays, "forceLovinCooldownDays", 1.0f);
            Scribe_Values.Look(ref ravenFatherDeterminesEgg, "ravenFatherDeterminesEgg", false);
            Scribe_Values.Look(ref enableMalePregnancyEgg, "enableMalePregnancyEgg", false);
            Scribe_Values.Look(ref ignoreFertilityForPregnancy, "ignoreFertilityForPregnancy", false);
            Scribe_Values.Look(ref enableSameSexForceLovin, "enableSameSexForceLovin", true);
            Scribe_Values.Look(ref enableMechanoidLovin, "enableMechanoidLovin", false);             // 和机械族
            Scribe_Values.Look(ref forceRavenDescendant, "forceRavenDescendant", true);
            Scribe_Values.Look(ref enableEggProjectileMode, "enableEggProjectileMode", false);
            Scribe_Values.Look(ref forceLovinResistanceReduction, "forceLovinResistanceReduction", 2f);
            Scribe_Values.Look(ref forceLovinWillReduction, "forceLovinWillReduction", 0.1f);
            Scribe_Values.Look(ref forceLovinCertaintyReduction, "forceLovinCertaintyReduction", 0.1f);
            Scribe_Values.Look(ref forceLovinInstantRecruitChance, "forceLovinInstantRecruitChance", 0.1f);
            Scribe_Values.Look(ref forceLovinBreakLoyaltyChance, "forceLovinBreakLoyaltyChance", 0.05f);
            Scribe_Values.Look(ref spiritEggWarmthDays, "spiritEggWarmthDays", 3f);


            Scribe_Values.Look(ref enableGrandClimax, "enableGrandClimax", false);
            Scribe_Values.Look(ref enableDimensionalSex, "enableDimensionalSex", false);

            Scribe_Values.Look(ref rjwRavenPregnancyCompat, "rjwRavenPregnancyCompat", true); // 保存 RJW 兼容设置

            Scribe_Values.Look(ref enableMiliraCompat, "enableMiliraCompat", true);
            Scribe_Values.Look(ref enableMoeLotlCompat, "enableMoeLotlCompat", true);
            Scribe_Values.Look(ref enableKoelimeBloodline, "enableKoelimeBloodline", true);
            Scribe_Values.Look(ref enableMuGirlCompat, "enableMuGirlCompat", true);
            Scribe_Values.Look(ref enableMuffaloPrank, "enableMuffaloPrank", false);
            Scribe_Values.Look(ref enableWolfeinCompat, "enableWolfeinCompat", true);
            Scribe_Values.Look(ref enableDragonianCompat, "enableDragonianCompat", true);
            Scribe_Values.Look(ref enableMoyoCompat, "enableMoyoCompat", true);
            Scribe_Values.Look(ref enableEponaCompat, "enableEponaCompat", true);
            Scribe_Values.Look(ref enableTailinCompat, "enableTailinCompat", true);// 泰临 (Tailin)
            Scribe_Values.Look(ref enableCinderCompat, "enableCinderCompat", true);// 烟烬 (Cinder)
            Scribe_Values.Look(ref enableMiraboreasCompat, "enableMiraboreasCompat", true);// 米拉波雷亚斯 (Miraboreas)
            Scribe_Values.Look(ref enableMinchoCompat, "enableMinchoCompat", true); // 珉巧 (Mincho)


            Scribe_Values.Look(ref fusangCommCooldownDays, "fusangCommCooldownDays", 3f);
            Scribe_Values.Look(ref reinforcementDelayHours, "reinforcementDelayHours", 6f);
            Scribe_Values.Look(ref tradePriceModifier, "tradePriceModifier", 1.0f);
            Scribe_Values.Look(ref tradeCaravanCooldownDays, "tradeCaravanCooldownDays", 3.0f);
            Scribe_Values.Look(ref missionSuccessBonus, "missionSuccessBonus", 0f);
            Scribe_Values.Look(ref enableManualInfiltration, "enableManualInfiltration", true);
            Scribe_Values.Look(ref missionFailureCooldownDays, "missionFailureCooldownDays", 7f);
            Scribe_Values.Look(ref missionCostMultiplier, "missionCostMultiplier", 1.0f);
            Scribe_Values.Look(ref missionDurationMultiplier, "missionDurationMultiplier", 1.0f);
            Scribe_Values.Look(ref enableDefenseSystemDebug, "enableDefenseSystemDebug", false);
            Scribe_Values.Look(ref trapDamageMultiplier, "trapDamageMultiplier", 1.0f);
            Scribe_Values.Look(ref friendlyFireSafe, "friendlyFireSafe", true);
            Scribe_Values.Look(ref risingWallSize, "risingWallSize", 5);
            Scribe_Values.Look(ref incenseJoyAmount, "incenseJoyAmount", 0.05f);
            Scribe_Values.Look(ref incenseForceLovinChance, "incenseForceLovinChance", 0.05f);
            Scribe_Values.Look(ref incenseCheckInterval, "incenseCheckInterval", 250);
        }

        public void OnSettingsChanged()
        {
            if (Current.ProgramState == ProgramState.Playing)
            {
                // [Change] RavenRace.HarmonyPatches -> RavenRace.Harmony, Patch_RavenWallColor -> RavenWallColorPatch
                RavenRace.Harmony.RavenWallColorPatch.ClearCache();

                foreach (Pawn p in PawnsFinder.AllMaps_FreeColonistsSpawned)
                {
                    p.Drawer?.renderer?.SetAllGraphicsDirty();
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\RavenRaceStartup.cs
=
.
﻿using System.Reflection;
using HarmonyLib;
using Verse;
using System;
using System.Collections.Generic; // 引入字典所需的命名空间

namespace RavenRace
{
    [StaticConstructorOnStartup]
    public static class RavenRaceStartup
    {
        // 创建一个静态只读字典来存储Mod兼容性日志信息
        // Key: Mod的PackageId, Value: 要在日志中打印的趣味消息
        private static readonly Dictionary<string, string> CompatLogMessages = new Dictionary<string, string>
        {
            { "void.charactereditor",         "你知道的，我们支持CE..." },
            { "matathias.tdiner",             "正在让大家上桌吃饭..." },
            { "Ancot.MiliraRace",             "正在摸米莉拉的翅膀根..." },
            { "Ariandel.MiliraImperium",      "正在将灵卵塞入艾蕾德尔的后门..." },
            { "hentailoliteam.axolotl",       "正在嗦可爱萌螈的小脚..." },
            { "fxz.moelotlzombie.update",     "正在玩弄满道长的墨镜..." },
            { "Draconis.Koelime",             "正在揉饺龙的肚子..." },
            { "MelonDove.WolfeinRace",        "正在吸沃芬的毛绒绒大尾巴..." },
            { "HAR.MuGirlRace",               "正在喝雪牛娘的奶..." },
            { "RooAndGloomy.DragonianRaceMod","正在把玩龙娘的珠子..." },
            { "Nemonian.MY2.Beta",            "正在用巨大触手攻击茉约的子宫..." },
            { "Epona.EponaDynasticRise",      "正在和艾波娜一起玩赛马娘..." },
            { "LepechandEusro.Tailin",        "正在拍小泰临的屁股..." },
            { "BreadMo.Cinders",              "正在感受余烬的温暖..." },
            { "Tourswen.LegendaryBlackDragon",  "正在请黑龙给灶台生火..." },
            { "SutSutMan.MinchoTheMintChocoSlimeHARver",  "正在品尝美味的珉巧...嗯，是小人，不是冰淇淋！" },


        };

        static RavenRaceStartup()
        {
            // 使用常量 ID
            var harmony = new HarmonyLib.Harmony(RavenModConstants.HarmonyId);
            harmony.PatchAll(Assembly.GetExecutingAssembly());

            // 诱饵缓存清理 (防止重载存档时残留)
            Features.DefenseSystem.RavenDecoyCache.Clear();

            Log.Message($"[{RavenModConstants.PackageId}] 左爻小姐正在无聊的自我安慰...");

            // 特殊处理RJW，因为它需要调用一个方法，而不仅仅是打印日志
            if (ModsConfig.IsActive("rim.job.world"))
            {
                if (ModsConfig.IsActive("rjw.menstruation"))
                {
                    Log.Message($"[{RavenModConstants.PackageId}] 饿啊，我们是高贵的三字母玩家！");
                    ApplyRJWCompat();
                }
            }

            // 遍历字典，检查所有其他兼容Mod并打印日志
            foreach (var entry in CompatLogMessages)
            {
                if (ModsConfig.IsActive(entry.Key))
                {
                    Log.Message($"[{RavenModConstants.PackageId}] {entry.Value}");
                }
            }
        }

        private static void ApplyRJWCompat()
        {
            try
            {
                var compatInitializer = GenTypes.GetTypeInAnyAssembly("RavenRace.RJWCompat.RJWCompat_Startup");
                if (compatInitializer != null)
                {
                    var applyMethod = compatInitializer.GetMethod("ApplyPatches", BindingFlags.Public | BindingFlags.Static);
                    if (applyMethod != null)
                    {
                        applyMethod.Invoke(null, null);
                    }
                    else
                    {
                        Log.Error($"[{RavenModConstants.PackageId}] Could not find 'ApplyPatches' method in RJWCompat_Startup.");
                    }
                }
            }
            catch (Exception ex)
            {
                Log.Error($"[{RavenModConstants.PackageId}] Exception while applying RJW compatibility patches: {ex}");
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\DefOf\BloodlineDefOf.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineDefOf
    /// TODO: Implement this class
    /// </summary>
    public class BloodlineDefOf
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\DefOf\EspionageDefOf.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// EspionageDefOf
    /// TODO: Implement this class
    /// </summary>
    public class EspionageDefOf
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\DefOf\FusangDefOf.cs
=
.
﻿using RimWorld;
using Verse;

namespace RavenRace
{
    [DefOf]
    public static class FusangDefOf
    {
        // 派系
        public static FactionDef Fusang_Hidden;

        // 建筑
        public static ThingDef Raven_FusangRadio;

        // 工作/Job
        public static JobDef Raven_Job_UseFusangRadio;

        // 交易类型 (你需要在XML中定义这个，或者暂时用 Base_Outlander_Standard)
        // public static TraderKindDef Fusang_TraderKind; 

        static FusangDefOf()
        {
            DefOfHelper.EnsureInitializedInCtor(typeof(FusangDefOf));
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\DefOf\RavenDefOf.cs
=
.
﻿using RimWorld;
using Verse;

namespace RavenRace
{
    [DefOf]
    public static class RavenDefOf
    {
        // --- 种族与生物 ---
        public static ThingDef Raven_Race;
        public static PawnKindDef Raven_Colonist;
        public static PawnKindDef Raven_PawnKind_ZuoYao;
        public static PawnKindDef Raven_HighArchon;

        // 【修复】添加 Binah 的 PawnKindDef
        [MayRequire("Chezhou.ChezhouLib.lib")]
        public static PawnKindDef Raven_PawnKind_Binah;

        // --- 物品 & 建筑 ---
        public static ThingDef Raven_SpiritEgg;
        public static ThingDef Raven_SpiritEgg_Unfertilized;
        public static ThingDef Raven_EmberBlood;
        public static ThingDef Raven_PrimitiveCradle;
        public static ThingDef Raven_Item_Suppository;
        public static ThingDef Raven_Item_MiracleHeal;
        public static ThingDef Raven_GoldenFeather;

        public static ThingDef RavenItem_SevenEmotionsNectar;        // 七情花蜜

        public static ThingDef Raven_Item_MasturbatorCup;

        public static ThingDef Raven_Item_HojoCube;        // 齁金魔方

        public static ThingDef RavenItem_AbilityTome;        // 技能教本

        // --- 武器 & 装备 ---
        public static ThingDef Raven_Weapon_HiddenBlade;
        public static ThingDef Raven_Weapon_SpiritBeads;
        public static ThingDef Raven_Apparel_ShadowCloak;

        // --- 气体 & 陷阱 ---
        public static ThingDef RavenGas_BlackMist;
        public static ThingDef RavenGas_Anesthetic;
        public static ThingDef RavenGas_Aphrodisiac;
        public static ThingDef RavenDecoy_Dummy;

        // --- 能力 (Abilities) ---
        public static AbilityDef Raven_Ability_ForceLovin;
        public static AbilityDef Raven_Ability_Kotoamatsukami;
        public static AbilityDef Raven_Ability_GrandClimax;

        [MayRequire("Nukafrog.MooGirl")]
        public static AbilityDef Raven_Ability_MuGirlCharge;

        // --- 工作 (Jobs) ---
        public static JobDef Raven_Job_ForceLovin;
        public static JobDef Raven_Job_PlaceEggInCradle;
        public static JobDef Raven_Job_InsertSpiritEgg;
        public static JobDef Raven_Job_RemoveSpiritEgg;
        public static JobDef Raven_Job_FillAltar;
        public static JobDef Raven_Job_BloodlineRitual;
        public static JobDef Raven_Job_InsertBeads;
        public static JobDef Raven_Job_UseFusangRadio;
        public static JobDef Raven_Job_EnterConcealment;
        public static JobDef Raven_Job_ApplyCharm;
        public static JobDef Raven_Job_RemoveCharm;

        public static JobDef Raven_Job_MasturbateWithCup;
        public static JobDef Raven_Job_DimensionalClimax;

        // --- 状态 (Hediffs) ---
        public static HediffDef Raven_Hediff_EmberDrain;
        public static HediffDef Raven_Hediff_RavenPregnancy;
        public static HediffDef Raven_Hediff_SpiritEggInserted;
        public static HediffDef Raven_Hediff_RapidOvulation;
        public static HediffDef Raven_Hediff_SoulAltarBonus;

        public static HediffDef Raven_Hediff_SpiritBeadsInserted;
        public static HediffDef Raven_Hediff_HighClimax;
        public static HediffDef Raven_Hediff_HiddenBladePrep;
        public static HediffDef Raven_Hediff_SteadyAim;
        public static HediffDef Raven_Hediff_ShadowStep;
        public static HediffDef Raven_Hediff_ShadowAttackCooldown;
        public static HediffDef Raven_Hediff_Degradation;
        public static HediffDef RavenHediff_AphrodisiacEffect;
        public static HediffDef RavenHediff_AnestheticBuildup;
        public static HediffDef RavenHediff_LegoPain;
        public static HediffDef RavenHediff_TendonCut;
        public static HediffDef RavenHediff_ConceptionProcess;
        public static HediffDef RavenHediff_IncenseAura;

        public static HediffDef Raven_Hediff_GoldenSpirit;        // 黄金精神

        // --- 思想 (Thoughts) ---
        public static ThoughtDef Raven_Thought_ForceLovin_Initiator;
        public static ThoughtDef Raven_Thought_ForceLovin_Recipient;
        public static ThoughtDef Raven_Thought_EggFilled;
        public static ThoughtDef Raven_Thought_Kotoamatsukami_Recruited;
        public static ThoughtDef Raven_Thought_Snuggle;
        public static ThoughtDef Raven_Thought_IncenseSmell;
        public static ThoughtDef Raven_Thought_WatchedAV;

        public static ThoughtDef Raven_Thought_MasturbatedWithCup;

        public static JoyKindDef Raven_AdultEntertainment;

        // --- 关系 ---
        public static PawnRelationDef Raven_Relation_Dominated;
        public static PawnRelationDef Raven_Relation_AbsoluteMaster;
        public static PawnRelationDef Raven_Relation_LoyalServant;

        // --- 故事与背景 ---
        public static BackstoryDef Raven_Backstory_ZuoYao_Child;
        public static BackstoryDef Raven_Backstory_ZuoYao_Adult;
        public static TraitDef Raven_Trait_ZuoYao;
        public static TraitDef Raven_Trait_Lecherous;

        // --- 研究 ---
        public static ResearchProjectDef RavenResearch_BloodlineRegression;

        // --- 派系 ---
        public static FactionDef Fusang_Hidden;

        static RavenDefOf()
        {
            DefOfHelper.EnsureInitializedInCtor(typeof(RavenDefOf));
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Harmony\Patch_DisablePsylink.cs
=
.
﻿using HarmonyLib;
using Verse;
using RimWorld;

namespace RavenRace.Core.Harmony
{
    /// <summary>
    /// 核心功能补丁：禁用由非灵能技能（如强制求爱）错误触发的灵能熵UI。
    /// 这是一个全局补丁，放置在Core文件夹下非常合适，用于解决根本性问题。
    /// </summary>
    [HarmonyPatch(typeof(Pawn_PsychicEntropyTracker), "IsPsychicallySensitive", MethodType.Getter)]
    public static class Patch_DisablePsylink
    {
        /// <summary>
        /// 在原版 IsPsychicallySensitive 属性的get方法执行后运行。
        /// </summary>
        /// <param name="__instance">Pawn_PsychicEntropyTracker的实例。</param>
        /// <param name="pawn">该组件所属的Pawn。</param>
        /// <param name="__result">原版方法的返回值，我们可以修改它。</param>
        [HarmonyPostfix]
        public static void Postfix(Pawn_PsychicEntropyTracker __instance, Pawn ___pawn, ref bool __result)
        {
            // 如果原版判断结果已经是“不敏感”，则无需任何操作。
            if (!__result) return;

            Pawn p = ___pawn;
            if (p == null) return;

            // 检查该Pawn是否拥有真正的灵能等级（来自帝国、启灵树或心灵武器）。
            bool hasRealPsylink = p.health.hediffSet.HasHediff(HediffDefOf.PsychicAmplifier);

            // 如果该Pawn没有真正的灵能等级，但游戏却因为他有技能（如我们的强制求爱）而误判为“灵能敏感”，
            // 我们就强制将结果改回false，从而隐藏错误的灵能熵UI。
            if (!hasRealPsylink && __instance.EntropyValue <= float.Epsilon)
            {
                __result = false;
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Harmony\Patch_FireUtility.cs
=
.
﻿using HarmonyLib;
using RimWorld;
using Verse;
using RavenRace.Features.Bloodline;

namespace RavenRace.Core.Harmony
{
    /// <summary>
    /// 防火逻辑补丁
    /// </summary>
    [HarmonyPatch(typeof(FireUtility), "CanEverAttachFire")]
    public static class Patch_FireUtility_CanEverAttachFire
    {
        /// <summary>
        /// 拦截是否可以附着火焰的判定。
        /// </summary>
        [HarmonyPrefix]
        public static bool Prefix(Thing t, ref bool __result)
        {
            if (t is Pawn p)
            {
                // 获取血脉组件
                var comp = p.TryGetComp<CompBloodline>();

                // 检查是否拥有机械体血脉
                // 这里的 Key "Bloodline_Mechanoid" 对应我们在 BloodlineManager 中定义的逻辑
                if (comp != null && comp.BloodlineComposition.ContainsKey("Bloodline_Mechanoid"))
                {
                    float value = comp.BloodlineComposition["Bloodline_Mechanoid"];
                    if (value > 0f)
                    {
                        // 强制不可燃
                        __result = false;
                        return false; // 跳过原版方法
                    }
                }
            }
            return true; // 执行原版方法
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Harmony\Patch_PawnGenerator.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;
using HarmonyLib;
using UnityEngine;
using AlienRace; // 必须引用 HAR 的命名空间

namespace RavenRace
{
    /// <summary>
    /// 强制渡鸦族肤色为白色的补丁
    /// </summary>
    [HarmonyPatch(typeof(PawnGenerator), "GeneratePawn", new Type[] { typeof(PawnGenerationRequest) })]
    public static class Patch_PawnGenerator
    {
        [HarmonyPostfix]
        public static void Postfix(Pawn __result)
        {
            // 1. 基础检查
            if (__result == null) return;

            // 2. 检查是否为渡鸦族
            // [修改] 使用 DefOf 进行对象比较，比字符串比较更快且防拼写错误
            if (__result.def == RavenDefOf.Raven_Race)
            {
                ForceWhiteSkin(__result);
            }
        }

        /// <summary>
        /// 强制将 Pawn 的皮肤颜色设置为纯白
        /// </summary>
        public static void ForceWhiteSkin(Pawn pawn)
        {
            if (pawn == null) return;

            // 1. 获取 HAR 的组件
            var alienComp = pawn.TryGetComp<AlienPartGenerator.AlienComp>();
            if (alienComp != null)
            {
                // 强制覆写 "skin" 通道为白色
                // OverwriteColorChannel 是 HAR 提供的直接修改颜色的方法
                alienComp.OverwriteColorChannel("skin", Color.white, Color.white);
            }

            // 2. 同时也修正原版的 Story 颜色 (作为双重保险，虽然 HAR 通常会覆盖这个)
            if (pawn.story != null)
            {
                pawn.story.skinColorOverride = Color.white;
            }

            // 3. 如果已有 Melanin (黑色素) 基因，强制移除或修改 (防止基因面板显示不一致)
            if (ModsConfig.BiotechActive && pawn.genes != null)
            {
                // 查找所有黑色素基因
                var melaninGenes = pawn.genes.GenesListForReading
                    .Where(g => g.def.endogeneCategory == EndogeneCategory.Melanin)
                    .ToList();

                foreach (var gene in melaninGenes)
                {
                    pawn.genes.RemoveGene(gene);
                }
            }

            // 4. 刷新渲染
            if (pawn.Drawer != null && pawn.Drawer.renderer != null)
            {
                pawn.Drawer.renderer.SetAllGraphicsDirty();
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Scenarios\Patch_ScenPart_StartingPawnKind.cs
=
.
﻿using HarmonyLib;
using Verse;
using RimWorld;
using System.Linq;

namespace RavenRace
{
    // Patch PawnGenerator，如果检测到当前剧本有我们的 ScenPart，就强制覆盖 PawnKind
    [HarmonyPatch(typeof(PawnGenerator), "GeneratePawn", new System.Type[] { typeof(PawnGenerationRequest) })]
    public static class Patch_ScenPart_StartingPawnKind
    {
        [HarmonyPrefix]
        public static void Prefix(ref PawnGenerationRequest request)
        {
            // 1. 只处理开局角色生成
            if (request.Context != PawnGenerationContext.PlayerStarter) return;

            // 2. 检查当前剧本
            if (Find.Scenario == null) return;

            // 3. 查找我们自定义的 ScenPart
            // 注意：在 XML 加载初期可能找不到 Parts，但在生成 Pawn 时肯定有了
            var part = Find.Scenario.AllParts.OfType<ScenPart_StartingPawnKind>().FirstOrDefault();

            if (part != null && part.pawnKind != null)
            {
                // 4. 强制覆盖 PawnKind
                // 因为 request 是 ref 传递的结构体，直接修改生效
                request.KindDef = part.pawnKind;

                // 确保派系是玩家派系 (虽然通常已经是了)
                if (request.Faction == null) request.Faction = Faction.OfPlayer;

                // RavenModUtility.LogVerbose($"[RavenRace] Forced starting pawn kind to {part.pawnKind.defName} via ScenPart.");
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Scenarios\ScenPart_StartingPawnKind.cs
=
.
﻿using Verse;
using RimWorld;
using UnityEngine;
using System.Collections.Generic;

namespace RavenRace
{
    // 自定义的剧本部分，用于强制指定开局 Pawn 的类型 (PawnKind)
    public class ScenPart_StartingPawnKind : ScenPart
    {
        public PawnKindDef pawnKind;

        public override void ExposeData()
        {
            base.ExposeData();
            Scribe_Defs.Look(ref pawnKind, "pawnKind");
        }

        public override void DoEditInterface(Listing_ScenEdit listing)
        {
            Rect scenPartRect = listing.GetScenPartRect(this, RowHeight);
            if (Widgets.ButtonText(scenPartRect, pawnKind?.LabelCap ?? "Select PawnKind..."))
            {
                List<FloatMenuOption> list = new List<FloatMenuOption>();
                foreach (PawnKindDef kind in DefDatabase<PawnKindDef>.AllDefs)
                {
                    if (kind.RaceProps.Humanlike)
                    {
                        list.Add(new FloatMenuOption(kind.LabelCap, delegate
                        {
                            pawnKind = kind;
                        }));
                    }
                }
                Find.WindowStack.Add(new FloatMenu(list));
            }
        }

        public override string Summary(Scenario scen)
        {
            return "RavenRace_ScenPart_StartingPawnKind".Translate(pawnKind?.LabelCap ?? "None");
        }

        public override void Randomize()
        {
            // 不随机，保持设定
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Altar.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Altar
    {
        public static void Draw(Listing_Standard listing)
        {
            var s = RavenRaceMod.Settings;
            listing.Label("RavenRace_Settings_AltarDesc".Translate());
            listing.GapLine();

            // 仅保留基础孵化时间 (这个是核心功能需要的)
            listing.Label("RavenRace_Settings_BaseHatchingDays".Translate() + ": " + s.baseHatchingDays.ToString("0.0") + " " + "Days".Translate());
            s.baseHatchingDays = listing.Slider(s.baseHatchingDays, 1f, 60f);
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Base.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Base
    {
        public static void Draw(Listing_Standard listing)
        {
            var s = RavenRaceMod.Settings;
            listing.Label("RavenRace_Settings_BaseDesc".Translate());
            listing.GapLine();

            listing.CheckboxLabeled("RavenRace_Settings_EnableDebugMode".Translate(), ref s.enableDebugMode);
            listing.CheckboxLabeled("RavenRace_Settings_EnableVerboseLogging".Translate(), ref s.enableVerboseLogging);

            listing.GapLine();

            // --- 余烬之血设置 ---
            listing.Label("=== 余烬之血概率设置 ===");

            listing.Label($"死亡概率: {s.emberBloodDeathChance:P0}");
            s.emberBloodDeathChance = listing.Slider(s.emberBloodDeathChance, 0f, 1f);

            // [Fixed] 动态限制发狂概率，确保总和不超过 100%
            float maxBerserk = 1f - s.emberBloodDeathChance;
            if (s.emberBloodBerserkChance > maxBerserk) s.emberBloodBerserkChance = maxBerserk;

            listing.Label($"发狂概率: {s.emberBloodBerserkChance:P0} (最大可用: {maxBerserk:P0})");
            s.emberBloodBerserkChance = listing.Slider(s.emberBloodBerserkChance, 0f, maxBerserk);

            listing.Label($"剩余成功概率: {1f - s.emberBloodDeathChance - s.emberBloodBerserkChance:P0}");

            listing.Gap();

            // --- 金羽设置 ---
            listing.Label("=== 折翼金羽设置 ===");

            listing.CheckboxLabeled("显示金羽冷却状态", ref s.showFeatherCooldown, "在Pawn的检查面板中显示金羽掉落的冷却时间。");

            listing.Label($"情绪阈值 (极低<X / 极高>1-X): {s.featherDropMoodThreshold:P0}");
            s.featherDropMoodThreshold = listing.Slider(s.featherDropMoodThreshold, 0.01f, 0.2f);

            listing.Label($"每次检测掉落概率: {s.featherDropChance:P1}");
            s.featherDropChance = listing.Slider(s.featherDropChance, 0.001f, 0.1f);

            listing.Label($"掉落冷却时间: {s.featherCooldownDays:F1} 天");
            s.featherCooldownDays = listing.Slider(s.featherCooldownDays, 1f, 120f);


            // --- 大渡鸦 (大统领) 设置 ---
            listing.GapLine();
            listing.Label("=== 渡鸦大统领设置 ===");
            listing.CheckboxLabeled("启用“寻找亮闪闪”功能", ref s.enableGreatRavenShiny, "开启后，驯服的大渡鸦会周期性地叼回金质物品。");

            if (s.enableGreatRavenShiny)
            {
                listing.Label($"寻找间隔: {s.greatRavenSearchDays:F1} 天");
                s.greatRavenSearchDays = listing.Slider(s.greatRavenSearchDays, 0.1f, 10f);

                // [新增] 概率配置
                listing.Gap();
                listing.Label("寻宝概率配置 (独立判断 0-100%)");

                listing.Label($"发现黄金概率: {s.greatRavenGoldChance:P0}");
                s.greatRavenGoldChance = listing.Slider(s.greatRavenGoldChance, 0f, 1f);

                listing.Label($"发现金制品概率: {s.greatRavenItemChance:P0}");
                s.greatRavenItemChance = listing.Slider(s.greatRavenItemChance, 0f, 1f);

                listing.Label($"发现齁金魔方概率: {s.greatRavenCubeChance:P0}");
                s.greatRavenCubeChance = listing.Slider(s.greatRavenCubeChance, 0f, 1f);

                listing.SubLabel("注：如果所有概率均未触发，大统领将空手而归并提示。", 0.8f);
            }
        }



    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Bloodline.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Bloodline
    {
        public static void Draw(Listing_Standard listing)
        {
            // [Fixed] 移除了所有未授权的滑块
            listing.Label("RavenRace_Settings_BloodlineDesc".Translate());
            listing.GapLine();

            // 目前没有可调节项，显示一条提示即可
            listing.Label("RavenRace_Settings_ComingSoon".Translate());
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Buildings.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Buildings
    {
        public static void Draw(Listing_Standard listing)
        {
            var s = RavenRaceMod.Settings;

            // ==========================================
            // 1. 催情香炉
            // ==========================================
            listing.Label("=== 催情香炉设置 ===");
            listing.Label($"强制求爱概率 (每次判定): {s.incenseForceLovinChance.ToStringPercent()}");
            s.incenseForceLovinChance = listing.Slider(s.incenseForceLovinChance, 0f, 1f);
            listing.GapLine();

            // ==========================================
            // 2. 电视机功能强化
            // ==========================================
            listing.Label("=== 电视机功能设置 ===");

            // A. 交配触发率
            listing.Label($"AV播放时交配触发率: {s.avMatingChance.ToStringPercent()}");
            s.avMatingChance = listing.Slider(s.avMatingChance, 0f, 1f);

            // B. 吸引力权重
            listing.Label($"电视娱乐吸引力倍率: {s.avJoyWeightMultiplier:F1}x");
            // 【1.6 适配】使用反编译代码中确认存在的 SubLabel 方法 (GameFont.Tiny + Color.gray)
            listing.SubLabel("数值越大，小人越优先看电视。设为 100x 时将几乎只进行电视娱乐。", 1f);
            s.avJoyWeightMultiplier = listing.Slider(s.avJoyWeightMultiplier, 1.0f, 100.0f);

            // C. 厌倦屏蔽
            listing.CheckboxLabeled("禁用电视娱乐厌倦感", ref s.avDisableTolerance, "开启后，电视娱乐产生的耐受度永远为0，获得的娱乐值不会随次数衰减。");

            listing.GapLine();
            listing.SubLabel("说明：开启电视AV模式后，至少两名观看者同时在场时，有概率无视条件发生交配。", 1f);
            listing.Gap();
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Defense.cs
=
.
﻿using UnityEngine;
using Verse;
using System;

namespace RavenRace.Settings
{
    public static class Settings_Defense
    {
        public static void Draw(Listing_Standard listing)
        {
            listing.Label("RavenRace_Settings_DefenseSystem".Translate());
            listing.GapLine();

            var s = RavenRaceMod.Settings;

            // 友军安全
            listing.CheckboxLabeled("RavenRace_Settings_FriendlyFireSafe".Translate(), ref s.friendlyFireSafe, "RavenRace_Settings_FriendlyFireSafeDesc".Translate());

            // 伤害倍率
            listing.Label("RavenRace_Settings_TrapDamageMultiplier".Translate() + ": " + s.trapDamageMultiplier.ToStringPercent());
            s.trapDamageMultiplier = listing.Slider(s.trapDamageMultiplier, 0.1f, 5.0f);

            listing.Gap();

            // [修复] 严格的类型转换，防止将 float 写入 xml 导致下次读取报错
            listing.Label("RavenRace_Settings_RisingWallSize".Translate() + ": " + s.risingWallSize + "x" + s.risingWallSize);

            float currentSize = (float)s.risingWallSize;
            float newSize = listing.Slider(currentSize, 5f, 13f);

            // 转换为奇数 int
            int intSize = Mathf.RoundToInt(newSize);
            if (intSize % 2 == 0) intSize++; // 偶数变奇数

            s.risingWallSize = intSize;

            listing.Gap();
            listing.CheckboxLabeled("RavenRace_Settings_DefenseDebug".Translate(), ref s.enableDefenseSystemDebug, "RavenRace_Settings_DefenseDebugDesc".Translate());
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Espionage.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Espionage
    {
        public static void Draw(Listing_Standard listing)
        {
            var s = RavenRaceMod.Settings;
            listing.Label("RavenRace_Settings_EspionageDesc".Translate());
            listing.GapLine();

            // 任务成功率加成
            listing.Label($"{"RavenRace_Settings_MissionSuccessBonus".Translate()}: {s.missionSuccessBonus:P0}");
            s.missionSuccessBonus = listing.Slider(s.missionSuccessBonus, -0.5f, 0.5f);

            // 任务失败冷却
            listing.Label($"{"RavenRace_Settings_FailureCooldown".Translate()}: {s.missionFailureCooldownDays} Days");
            s.missionFailureCooldownDays = listing.Slider(s.missionFailureCooldownDays, 1f, 30f);

            // [新增] 消耗倍率
            listing.Label($"{"RavenRace_Settings_CostMultiplier".Translate()}: {s.missionCostMultiplier:P0}");
            s.missionCostMultiplier = listing.Slider(s.missionCostMultiplier, 0.1f, 5.0f);

            // [新增] 耗时倍率
            listing.Label($"{"RavenRace_Settings_DurationMultiplier".Translate()}: {s.missionDurationMultiplier:P0}");
            s.missionDurationMultiplier = listing.Slider(s.missionDurationMultiplier, 0.1f, 5.0f);

            listing.Gap();
            listing.CheckboxLabeled("RavenRace_Settings_EnableManualInfiltration".Translate(), ref s.enableManualInfiltration);
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Fusang.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Fusang
    {
        public static void Draw(Listing_Standard listing)
        {
            listing.Label("RavenRace_Settings_FusangDesc".Translate());
            listing.GapLine();
            // [Fixed] 移除所有未实装功能的参数调整
            listing.Label("RavenRace_Settings_ComingSoon".Translate());
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Hybridization.cs
=
.
﻿using UnityEngine;
using Verse;
using RavenRace.Compat.MoeLotl;
using RavenRace.Compat.Koelime;
using RavenRace.Compat.MuGirl;
using RavenRace.Compat.Milira;
using RavenRace.Compat.Wolfein;
using RavenRace.Compat.Dragonian;
using RavenRace.Compat.Moyo;
using RavenRace.Compat.Epona; 
using RavenRace.Compat.Tailin;
using RavenRace.Compat.Cinder;
using RavenRace.Compat.Miraboreas;
using RavenRace.Compat.Mincho; // 【新增】

// 记得每加一个都要引用命名空间！

namespace RavenRace.Settings
{
    public static class Settings_Hybridization
    {
        public static void Draw(Listing_Standard listing)
        {
            var s = RavenRaceMod.Settings;

            listing.Label("RavenRace_Settings_HybridizationDesc".Translate());
            listing.Gap();

            // 统一使用 GapLine + Label 的标准形式

            // =================================================
            // 1. 米莉拉 (Milira)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_MiliraCompat".Translate());
            DrawModStatus(listing, MiliraCompatUtility.IsMiliraActive);

            // 替换为：
            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableMiliraCompat".Translate(),
                ref s.enableMiliraCompat,
                "RavenRace_Settings_EnableMiliraCompat_Desc".Translate()
            );

            // =================================================
            // 2. 萌螈 (MoeLotl)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_MoeLotlCultivation".Translate());
            DrawModStatus(listing, MoeLotlCompatUtility.IsMoeLotlActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableMoeLotlCompat".Translate(),
                ref s.enableMoeLotlCompat,
                "RavenRace_Settings_EnableMoeLotlCompat_Desc".Translate()
            );

            // =================================================
            // 3. 珂莉姆 (Koelime)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_KlimDragonBlood".Translate());
            DrawModStatus(listing, KoelimeCompatUtility.IsKoelimeActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableKoelimeBloodline".Translate(),
                ref s.enableKoelimeBloodline,
                "RavenRace_Settings_EnableKoelimeBloodline_Desc".Translate()
            );

            // =================================================
            // 4. 雪牛娘 (MooGirl)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_MuGirlCompat".Translate());
            DrawModStatus(listing, MuGirlCompatUtility.IsMuGirlActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableMuGirlCompat".Translate(),
                ref s.enableMuGirlCompat,
                "RavenRace_Settings_EnableMuGirlCompat_Desc".Translate()
            );

            listing.Gap(4f);
            listing.CheckboxLabeled(
                "RavenRace_Settings_MuffaloPrank".Translate(),
                ref s.enableMuffaloPrank,
                "RavenRace_Settings_MuffaloPrank_Desc".Translate()
            );

            // =================================================
            // 5. 沃芬 (Wolfein)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_WolfeinCompat".Translate());
            DrawModStatus(listing, WolfeinCompatUtility.IsWolfeinActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableWolfeinCompat".Translate(),
                ref s.enableWolfeinCompat,
                "RavenRace_Settings_EnableWolfeinCompat_Desc".Translate()
            );

            // =================================================
            // 6. 龙人 (Dragonian)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_DragonianCompat".Translate());
            DrawModStatus(listing, DragonianCompatUtility.IsDragonianActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableDragonianCompat".Translate(),
                ref s.enableDragonianCompat,
                "RavenRace_Settings_EnableDragonianCompat_Desc".Translate()
            );

            // =================================================
            // 7. 茉约 (Moyo)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_MoyoCompat".Translate());
            DrawModStatus(listing, MoyoCompatUtility.IsMoyoActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableMoyoCompat".Translate(),
                ref s.enableMoyoCompat,
                "RavenRace_Settings_EnableMoyoCompat_Desc".Translate()
            );


            // =================================================
            // 8. 艾波娜 (Epona)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_EponaCompat".Translate());
            DrawModStatus(listing, EponaCompatUtility.IsEponaActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableEponaCompat".Translate(),
                ref s.enableEponaCompat,
                "RavenRace_Settings_EnableEponaCompat_Desc".Translate()
            );

            // =================================================
            // 9. 泰临 (Tailin)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_TailinCompat".Translate());
            DrawModStatus(listing, TailinCompatUtility.IsTailinActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableTailinCompat".Translate(),
                ref s.enableTailinCompat,
                "RavenRace_Settings_EnableTailinCompat_Desc".Translate()
            );

            // =================================================
            // 10. 烟烬 (Cinder)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_CinderCompat".Translate());
            DrawModStatus(listing, CinderCompatUtility.IsCinderActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableCinderCompat".Translate(),
                ref s.enableCinderCompat,
                "RavenRace_Settings_EnableCinderCompat_Desc".Translate()
            );

            // =================================================
            // 11. 米拉波雷亚斯 (Miraboreas)
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_MiraboreasCompat".Translate());
            DrawModStatus(listing, MiraboreasCompatUtility.IsMiraboreasActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableMiraboreasCompat".Translate(),
                ref s.enableMiraboreasCompat,
                "RavenRace_Settings_EnableMiraboreasCompat_Desc".Translate()
            );


            // =================================================
            // 12. 珉巧 (Mincho) 
            // =================================================
            listing.GapLine();
            listing.Label("RavenRace_Settings_MinchoCompat".Translate());
            DrawModStatus(listing, MinchoCompatUtility.IsMinchoActive);

            listing.CheckboxLabeled(
                "RavenRace_Settings_EnableMinchoCompat".Translate(),
                ref s.enableMinchoCompat,
                "RavenRace_Settings_EnableMinchoCompat_Desc".Translate()
            );








        }

        private static void DrawModStatus(Listing_Standard listing, bool isActive)
        {
            Color originalColor = GUI.color;
            if (isActive)
            {
                GUI.color = Color.green;
                listing.Label("RavenRace_Settings_ModActive".Translate());
            }
            else
            {
                GUI.color = Color.red;
                listing.Label("RavenRace_Settings_ModInactive".Translate());
            }
            GUI.color = originalColor;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Operator.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Operator
    {
        public static void Draw(Listing_Standard listing)
        {
            // 移除了所有UI元素，只保留一个说明
            listing.Label("接线员 · 左爻 好感度与表情设置");
            listing.GapLine();

            GUI.color = Color.gray;
            listing.Label("好感度现在与扶桑组织的派系关系自动挂钩。\n\n你可以在通讯界面中，通过点击肖像旁的设置按钮来切换已解锁的表情套装。");
            GUI.color = Color.white;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Core\Settings\Settings_Reproduction.cs
=
.
﻿using UnityEngine;
using Verse;

namespace RavenRace.Settings
{
    public static class Settings_Reproduction
    {
        public static void Draw(Listing_Standard listing)
        {
            var s = RavenRaceMod.Settings;
            listing.Label("RavenRace_Settings_ReproductionDesc".Translate());
            listing.GapLine();

            // 孵化
            listing.Label("RavenRace_Settings_BaseHatchingDays".Translate() + ": " + s.baseHatchingDays.ToString("0.0") + " Days");
            s.baseHatchingDays = listing.Slider(s.baseHatchingDays, 1f, 60f);

            listing.Gap();

            // 强制交配
            listing.Label("RavenRace_Settings_ForceLovinCooldownDays".Translate() + ": " + s.forceLovinCooldownDays.ToString("0.0") + " Days");
            s.forceLovinCooldownDays = listing.Slider(s.forceLovinCooldownDays, 0f, 15f);

            listing.CheckboxLabeled("RavenRace_Settings_EnableForceLovinPregnancy".Translate(), ref s.enableForceLovinPregnancy);
            if (s.enableForceLovinPregnancy)
            {
                listing.Label("RavenRace_Settings_ForcedLovinPregnancyRate".Translate() + ": " + s.forcedLovinPregnancyRate.ToStringPercent());
                s.forcedLovinPregnancyRate = listing.Slider(s.forcedLovinPregnancyRate, 0f, 1f);
                listing.CheckboxLabeled("RavenRace_Settings_IgnoreFertilityForPregnancy".Translate(), ref s.ignoreFertilityForPregnancy, "RavenRace_Settings_IgnoreFertilityForPregnancyDesc".Translate());
            }

            listing.CheckboxLabeled("RavenRace_Settings_EnableSameSexForceLovin".Translate(), ref s.enableSameSexForceLovin, "RavenRace_Settings_EnableSameSexForceLovinDesc".Translate());

            listing.CheckboxLabeled("启用机械体强制交配", ref s.enableMechanoidLovin, "允许对机械族单位使用强制求爱。机械族无法怀孕，但若渡鸦作为母体可产下带有机械血脉的后代。");

            listing.Gap();
            listing.Label("RavenRace_Settings_PrisonerInteractions".Translate());
            listing.Label("RavenRace_Settings_ForceLovinResistanceReduction".Translate() + ": " + s.forceLovinResistanceReduction.ToString("0.0"));
            s.forceLovinResistanceReduction = listing.Slider(s.forceLovinResistanceReduction, 0f, 20f);

            listing.Label("RavenRace_Settings_ForceLovinWillReduction".Translate() + ": " + s.forceLovinWillReduction.ToString("0.0"));
            s.forceLovinWillReduction = listing.Slider(s.forceLovinWillReduction, 0f, 20f);

            listing.Label("RavenRace_Settings_ForceLovinCertaintyReduction".Translate() + ": " + s.forceLovinCertaintyReduction.ToStringPercent());
            s.forceLovinCertaintyReduction = listing.Slider(s.forceLovinCertaintyReduction, 0f, 1f);

            listing.GapLine();
            listing.CheckboxLabeled("RavenRace_Settings_EnableMalePregnancyEgg".Translate(), ref s.enableMalePregnancyEgg, "RavenRace_Settings_EnableMalePregnancyEggDesc".Translate());
            listing.CheckboxLabeled("RavenRace_Settings_ForceRavenDescendant".Translate(), ref s.forceRavenDescendant, "RavenRace_Settings_ForceRavenDescendantDesc".Translate());
            listing.CheckboxLabeled("RavenRace_Settings_EnableEggProjectileMode".Translate(), ref s.enableEggProjectileMode, "RavenRace_Settings_EnableEggProjectileModeDesc".Translate());


            listing.GapLine();
            listing.Label("RavenRace_Settings_SpiritBeads".Translate());
            listing.CheckboxLabeled("RavenRace_Settings_EnableGrandClimax".Translate(), ref s.enableGrandClimax, "RavenRace_Settings_EnableGrandClimaxDesc".Translate());

            listing.GapLine();
            listing.Label("RavenRace_Settings_MasturbatorCup".Translate());
            listing.CheckboxLabeled("RavenRace_Settings_EnableDimensionalSex".Translate(), ref s.enableDimensionalSex, "RavenRace_Settings_EnableDimensionalSexDesc".Translate());

            listing.GapLine();
            listing.Label("灵卵温养设置");
            listing.Label($"完全温养所需时间: {s.spiritEggWarmthDays:F1} 天");

            s.spiritEggWarmthDays = listing.Slider(s.spiritEggWarmthDays, 0.01f, 5f);
            listing.Label("将灵卵保存在体内可进行温养，完美温养的灵卵在摇篮中孵化时会获得速度加成。");

            // [新增] RJW 兼容设置部分
            listing.GapLine();
            listing.Label("RJW 兼容设置");
            // 只有在RJW激活时才显示
            if (ModsConfig.IsActive("rim.job.world"))
            {
                listing.CheckboxLabeled("启用渡鸦怀孕兼容模式", ref s.rjwRavenPregnancyCompat, "开启后，使用“强制求爱”技能会立即触发渡鸦灵卵怀孕，RJW性爱过程仅作为表现。关闭则完全由RJW决定是否怀孕。");
            }
            else
            {
                listing.Label("未检测到RJW，相关设置已隐藏。");
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Components\CompBloodline_Compat.cs
=
.
﻿using System;
using System.Collections.Generic;
using RavenRace.Compat.Cinder;
using RavenRace.Compat.Dragonian;
using RavenRace.Compat.Epona;
using RavenRace.Compat.Koelime;
using RavenRace.Compat.Milira;
using RavenRace.Compat.Miraboreas;
using RavenRace.Compat.MoeLotl;
using RavenRace.Compat.Moyo;
using RavenRace.Compat.MuGirl;
using RavenRace.Compat.Tailin;
using RavenRace.Compat.Wolfein;
using RavenRace.Compat.Mincho; // 【新增】
using RimWorld;
using RimWorld.Planet;
using UnityEngine;
using Verse;

// 记得每加一个都要引用命名空间！

namespace RavenRace.Features.Bloodline
{
    /// <summary>
    /// 血脉组件 - 模组兼容性逻辑
    /// </summary>
    public partial class CompBloodline
    {
        public void RefreshAbilities()
        {
            EnsureBloodlineFloor(); // 每次刷新都检查保底
            CheckAndGrantBloodlineAbilities();
        }

        private void CheckAndGrantBloodlineAbilities()
        {
            if (bloodlineComposition == null || bloodlineComposition.Count == 0) return;

            try
            {

                // [新增] 机械体血脉处理
                if (bloodlineComposition.ContainsKey(BloodlineManager.MECHANIOD_BLOODLINE_KEY) &&
                    bloodlineComposition[BloodlineManager.MECHANIOD_BLOODLINE_KEY] > 0f)
                {
                    HandleMechanoidBloodline(this.Pawn, true);
                }
                else
                {
                    HandleMechanoidBloodline(this.Pawn, false);
                }



                // 1. 米莉拉
                if (RavenRaceMod.Settings.enableMiliraCompat && MiliraCompatUtility.IsMiliraActive)
                {
                    bool hasMilira = MiliraCompatUtility.HasMiliraBloodline(this);
                    MiliraCompatUtility.HandleMiliraBuff(this.Pawn, hasMilira);
                }



                // 2. 萌螈
                if (RavenRaceMod.Settings.enableMoeLotlCompat &&
                    bloodlineComposition.ContainsKey("Axolotl") &&
                    bloodlineComposition["Axolotl"] > 0f)
                {
                    MoeLotlCompatUtility.GrantCultivationAbility(this.Pawn);
                }

                // 3. 珂莉姆
                if (RavenRaceMod.Settings.enableKoelimeBloodline)
                {
                    bool hasKoelime = bloodlineComposition.ContainsKey("Alien_Koelime") &&
                                      bloodlineComposition["Alien_Koelime"] > 0f;
                    KoelimeCompatUtility.HandleDraconicBloodline(this.Pawn, hasKoelime);
                }

                // 4. 沃芬 (Wolfein)
                if (RavenRaceMod.Settings.enableWolfeinCompat && WolfeinCompatUtility.IsWolfeinActive)
                {
                    // 逻辑与珂莉姆一致：先判断是否有血脉，然后让工具类处理组件的添加或移除
                    bool hasWolfein = WolfeinCompatUtility.HasWolfeinBloodline(this);
                    WolfeinCompatUtility.HandleWolfeinBloodline(this.Pawn, hasWolfein);
                }

                // 5. 产奶逻辑 (雪牛 MuGirl & 龙人 Dragonian & 混合 Combo)
                RemoveExistingMilkComp();

                bool hasMuGirl = RavenRaceMod.Settings.enableMuGirlCompat && MuGirlCompatUtility.HasMuGirlBloodline(this);
                bool hasDragonian = RavenRaceMod.Settings.enableDragonianCompat && DragonianCompatUtility.HasDragonianBloodline(this);

                if (RavenRaceMod.Settings.enableDragonianCompat)
                {
                    DragonianCompatUtility.HandleDragonianBuff(this.Pawn, hasDragonian);
                }
                if (RavenRaceMod.Settings.enableMuGirlCompat)
                {
                    MuGirlCompatUtility.HandleMuGirlBloodline(this.Pawn, hasMuGirl);
                    MuGirlCompatUtility.HandleChargeAbility(this.Pawn, hasMuGirl);
                }

                if (hasDragonian && hasMuGirl)
                {
                    DragonianCompatUtility.GrantDivineMilkAbility(this.Pawn);
                }
                else if (hasDragonian)
                {
                    DragonianCompatUtility.GrantDragonMilkAbility(this.Pawn);
                }
                else if (hasMuGirl)
                {
                    MuGirlCompatUtility.EnsureMilkable(this.Pawn);
                }

                // 6. 莫约 (Moyo)
                if (RavenRaceMod.Settings.enableMoyoCompat && MoyoCompatUtility.HasMoyoBloodline(this.Pawn))
                {
                    MoyoCompatUtility.GrantDeepBlueProduction(this.Pawn);
                }

                // 7. 艾波娜 (Epona)
                if (EponaCompatUtility.IsEponaActive && EponaCompatUtility.HasEponaBloodline(this.Pawn))
                {
                    EponaCompatUtility.EnsureEponaHybridComp(this.Pawn);
                }

                // 刷新雪牛冲锋逻辑 (受艾波娜影响)
                if (RavenRaceMod.Settings.enableMuGirlCompat && MuGirlCompatUtility.HasMuGirlBloodline(this))
                {
                    MuGirlCompatUtility.HandleChargeAbility(this.Pawn, true);
                }

                // 8. 泰临 (Tailin)
                if (RavenRaceMod.Settings.enableTailinCompat && TailinCompatUtility.IsTailinActive)
                {
                    bool hasTailinBlood = TailinCompatUtility.HasTailinBloodline(this);
                    TailinCompatUtility.HandleTailinBloodline(this.Pawn, hasTailinBlood);
                }

                // 9. 烟烬 (Cinder)
                if (RavenRaceMod.Settings.enableCinderCompat && CinderCompatUtility.IsCinderActive)
                {
                    bool hasCinder = CinderCompatUtility.HasCinderBloodline(this);
                    CinderCompatUtility.HandleCinderRegen(this.Pawn, hasCinder);
                }

                // 10. 米拉波雷亚斯 (Miraboreas)
                if (RavenRaceMod.Settings.enableMiraboreasCompat && MiraboreasCompatUtility.IsMiraboreasActive)
                {
                    bool hasBloodline = MiraboreasCompatUtility.HasMiraboreasBloodline(this);
                    MiraboreasCompatUtility.HandleMiraboreasBloodline(this.Pawn, hasBloodline);
                }

                // 11. 珉巧( Mincho) 
                if (RavenRaceMod.Settings.enableMinchoCompat && MinchoCompatUtility.IsMinchoActive)
                {
                    bool hasMincho = MinchoCompatUtility.HasMinchoBloodline(this);
                    MinchoCompatUtility.HandleMinchoBloodline(this.Pawn, hasMincho);
                }













            }
            catch (Exception ex)
            {
                Log.Warning($"[RavenRace] 血脉组件访问失效: {ex.Message}");
            }
        }


        private void HandleMechanoidBloodline(Pawn pawn, bool hasBloodline) //机械体处理
        {
            HediffDef mechHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_MechanoidBloodline");
            if (mechHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(mechHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(mechHediff);
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(mechHediff);
                if (h != null) pawn.health.RemoveHediff(h);
            }
        }


        private void RemoveExistingMilkComp()
        {
            Pawn.AllComps.RemoveAll(c => c is Compat.MuGirl.CompRavenMilkable);
        }


    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Components\CompBloodline_Core.cs
=
.
﻿using System.Collections.Generic;
using Verse;
using RimWorld;
using UnityEngine;
using System.Linq;

namespace RavenRace.Features.Bloodline
{
    public class CompProperties_Bloodline : CompProperties
    {
        public CompProperties_Bloodline()
        {
            this.compClass = typeof(CompBloodline);
        }
    }

    /// <summary>
    /// 血脉组件 - 核心数据定义
    /// </summary>
    public partial class CompBloodline : ThingComp
    {
        // 核心数据
        private Dictionary<string, float> bloodlineComposition = new Dictionary<string, float>();
        private float goldenCrowConcentration = 0f;

        public Dictionary<string, float> BloodlineComposition => bloodlineComposition;

        public float GoldenCrowConcentration
        {
            get => goldenCrowConcentration;
            set => goldenCrowConcentration = Mathf.Clamp01(value);
        }

        public Pawn Pawn => (Pawn)this.parent;

        // 在类中定义两个临时列表用于存档
        private List<string> tmpBloodlineKeys;
        private List<float> tmpBloodlineValues;

        public override void PostExposeData()
        {
            base.PostExposeData();
            Scribe_Values.Look(ref goldenCrowConcentration, "goldenCrowConcentration", 0f);

            // 【修改】传入临时列表，防止红字 "You need to provide working lists..."
            Scribe_Collections.Look(ref bloodlineComposition, "bloodlineComposition", LookMode.Value, LookMode.Value, ref tmpBloodlineKeys, ref tmpBloodlineValues);

            if (Scribe.mode == LoadSaveMode.PostLoadInit)
            {
                if (bloodlineComposition == null) bloodlineComposition = new Dictionary<string, float>();
            }
        }

        public override string CompInspectStringExtra()
        {
            if (!RavenRaceMod.Settings.enableDebugMode) return null;

            if (bloodlineComposition == null) return "Bloodline: Error(Null)";

            try
            {
                string bloodlineStr = string.Join(", ", bloodlineComposition.Select(kv => $"{kv.Key}:{kv.Value:P0}"));
                return $"Golden Crow: {goldenCrowConcentration:P1}\nBloodlines: {bloodlineStr}";
            }
            catch
            {
                return "Bloodline: Error(Format)";
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Components\CompBloodline_Logic.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace.Features.Bloodline
{
    /// <summary>
    /// 血脉组件 - 核心逻辑 (初始化、计算、验证)
    /// </summary>
    public partial class CompBloodline
    {
        public override void PostSpawnSetup(bool respawningAfterLoad)
        {
            base.PostSpawnSetup(respawningAfterLoad);

            // 1. 初始化
            if (bloodlineComposition == null || bloodlineComposition.Count == 0)
            {
                InitializeBloodline();
            }

            // 2. 强制执行 1% 保底检查 (兼容旧存档)
            EnsureBloodlineFloor();

            // 3. 赋予能力 (调用 Compat 部分的方法)
            CheckAndGrantBloodlineAbilities();
        }

        public void InitializeBloodline()
        {
            if (bloodlineComposition == null) bloodlineComposition = new Dictionary<string, float>();
            if (bloodlineComposition.Count > 0) return;

            BloodlineManager.InitializePawnBloodline(this.Pawn, this);
        }

        /// <summary>
        /// [核心逻辑] 确保所有存在的血脉至少有 1% (0.01) 的占比
        /// </summary>
        private void EnsureBloodlineFloor()
        {
            if (bloodlineComposition == null || bloodlineComposition.Count == 0) return;

            bool changed = false;
            float minThreshold = 0.01f; // 1%

            // A. 检查是否有低于 1% 的
            List<string> keys = bloodlineComposition.Keys.ToList();
            foreach (var key in keys)
            {
                if (bloodlineComposition[key] > 0f && bloodlineComposition[key] < minThreshold)
                {
                    bloodlineComposition[key] = minThreshold;
                    changed = true;
                }
            }

            // B. 如果有变动，重新归一化 (Normalize) 使得总和为 1.0
            if (changed)
            {
                float total = bloodlineComposition.Values.Sum();
                if (total > 0f)
                {
                    // 重新计算比例
                    foreach (var key in keys)
                    {
                        bloodlineComposition[key] /= total;
                    }
                }
            }
        }

        public void SetBloodlineComposition(Dictionary<string, float> newComposition)
        {
            if (newComposition == null) return;
            if (bloodlineComposition == null) bloodlineComposition = new Dictionary<string, float>();

            bloodlineComposition.Clear();
            foreach (var kvp in newComposition)
            {
                bloodlineComposition.Add(kvp.Key, kvp.Value);
            }
            EnsureBloodlineFloor(); // 设置新数据时也要保底
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Defs\BloodlineDef.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineDef - 定义一种血脉
    /// 将游戏中的种族 (ThingDef) 映射到血脉系统中，并定义该血脉的基础属性。
    /// </summary>
    public class BloodlineDef : Def
    {
        /// <summary>
        /// 关联的种族定义
        /// </summary>
        public ThingDef raceDef;

        /// <summary>
        /// 该血脉的基础标签（例如：渡鸦、人类、鼠族）
        /// 用于UI显示
        /// </summary>
        public string labelShort;

        /// <summary>
        /// 是否为金乌血脉源头（如果是，将启用金乌浓度条）
        /// </summary>
        public bool isGoldenCrowSource = false;

        // 可以在这里添加更多属性，例如：
        // - 该血脉带来的属性修正
        // - 杂交时的优势/劣势权重

        /// <summary>
        /// 配置错误检查
        /// </summary>
        public override IEnumerable<string> ConfigErrors()
        {
            foreach (string error in base.ConfigErrors())
            {
                yield return error;
            }

            if (raceDef == null)
            {
                yield return $"[RavenRace] BloodlineDef {defName} has null raceDef.";
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Defs\BloodlineTraitDef.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineTraitDef
    /// TODO: Implement this class
    /// </summary>
    public class BloodlineTraitDef
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Managers\BloodlineInheritanceCalculator.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineInheritanceCalculator
    /// TODO: Implement this class
    /// </summary>
    public class BloodlineInheritanceCalculator
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Managers\BloodlineManager.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace.Features.Bloodline
{
    public static class BloodlineManager
    {
        private static Dictionary<ThingDef, BloodlineDef> raceToBloodlineCache;

        // 特殊常量 Key
        public const string MECHANIOD_BLOODLINE_KEY = "Bloodline_Mechanoid";

        public static void InitializePawnBloodline(Pawn pawn, CompBloodline comp)
        {
            if (pawn == null || comp == null) return;

            // 1. 检查是否为机械族 (优先于 Def 查找)
            if (pawn.RaceProps.IsMechanoid)
            {
                comp.BloodlineComposition.Clear();
                comp.BloodlineComposition.Add(MECHANIOD_BLOODLINE_KEY, 1.0f);
                comp.GoldenCrowConcentration = 0f;
                return;
            }

            // 2. 原有逻辑
            BloodlineDef bloodline = GetBloodlineDef(pawn.def);

            if (bloodline != null)
            {
                comp.BloodlineComposition.Clear();
                comp.BloodlineComposition.Add(pawn.def.defName, 1.0f);

                if (bloodline.isGoldenCrowSource)
                {
                    comp.GoldenCrowConcentration = Rand.Range(0.01f, 0.10f);
                }
                else
                {
                    comp.GoldenCrowConcentration = 0f;
                }

                RavenModUtility.LogVerbose($"Initialized known bloodline for {pawn.ThingID}: {bloodline.labelShort}");
            }
            else
            {
                comp.BloodlineComposition.Clear();
                comp.BloodlineComposition.Add(pawn.def.defName, 1.0f);
                comp.GoldenCrowConcentration = 0f;
            }
        }

        public static BloodlineDef GetBloodlineDef(ThingDef raceDef)
        {
            if (raceToBloodlineCache == null)
            {
                RebuildCache();
            }

            if (raceDef != null && raceToBloodlineCache.TryGetValue(raceDef, out BloodlineDef def))
            {
                return def;
            }
            return null;
        }

        private static void RebuildCache()
        {
            raceToBloodlineCache = new Dictionary<ThingDef, BloodlineDef>();
            List<BloodlineDef> allDefs = DefDatabase<BloodlineDef>.AllDefsListForReading;

            foreach (var def in allDefs)
            {
                if (def.raceDef != null && !raceToBloodlineCache.ContainsKey(def.raceDef))
                {
                    raceToBloodlineCache.Add(def.raceDef, def);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\Settings\BloodlineSettings.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineSettings
    /// TODO: Implement this class
    /// </summary>
    public class BloodlineSettings
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\UI\BloodlineCardUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineCardUtility
    /// TODO: Implement this class
    /// </summary>
    public class BloodlineCardUtility
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Bloodline\UI\ITab_Bloodline.cs
=
.
﻿using System.Collections.Generic;
using System.Linq;
using UnityEngine;
using Verse;
using RimWorld;
using RavenRace.Features.Bloodline;
using RavenRace.Features.FusangOrganization.UI; // <-- 核心修改：引用扶桑UI风格

namespace RavenRace
{
    public class ITab_Bloodline : ITab
    {
        private static readonly Vector2 WinSize = new Vector2(350f, 450f); // 稍微调整窗口大小以适应新风格
        private Vector2 scrollPosition = Vector2.zero; // 用于滚动视图

        private CompBloodline cachedComp;

        public ITab_Bloodline()
        {
            this.size = WinSize;
            this.labelKey = "RavenRace_Bloodline";
        }

        private CompBloodline Comp
        {
            get
            {
                Pawn pawn = base.SelPawn;
                if (pawn == null) return null;
                if (cachedComp != null && cachedComp.parent == pawn) return cachedComp;
                cachedComp = pawn.TryGetComp<CompBloodline>();
                return cachedComp;
            }
        }

        public override bool IsVisible => Comp != null;

        protected override void FillTab()
        {
            // --- 使用扶桑风格重构整个UI ---

            Rect mainRect = new Rect(0f, 0f, WinSize.x, WinSize.y).ContractedBy(10f);

            // 绘制背景和边框
            FusangUIStyle.DrawPanel(mainRect);

            CompBloodline comp = this.Comp;
            if (comp == null)
            {
                Widgets.Label(mainRect, "错误: 未找到血脉组件。");
                return;
            }

            // 使用一个内部Rect来管理布局
            Rect contentRect = mainRect.ContractedBy(15f);
            float currentY = contentRect.y;

            // --- 1. 标题 ---
            Text.Font = GameFont.Medium;
            GUI.color = FusangUIStyle.MainColor_Gold;
            Rect titleRect = new Rect(contentRect.x, currentY, contentRect.width, 30f);
            Widgets.Label(titleRect, "RavenRace_Bloodline".Translate());
            currentY += 35f;
            GUI.color = Color.white;
            Text.Font = GameFont.Small;

            // --- 2. 金乌浓度条 ---
            DrawConcentrationBar(contentRect.x, ref currentY, contentRect.width, comp.GoldenCrowConcentration);
            currentY += 15f;

            // --- 3. 分割线 ---
            GUI.color = FusangUIStyle.BorderColor;
            Widgets.DrawLineHorizontal(contentRect.x, currentY, contentRect.width);
            currentY += 15f;
            GUI.color = Color.white;

            // --- 4. 血脉组成 (带滚动视图) ---
            Rect compositionLabelRect = new Rect(contentRect.x, currentY, contentRect.width, 22f);
            Widgets.Label(compositionLabelRect, "RavenRace_BloodlineComposition".Translate() + ":");
            currentY += 26f;

            Rect scrollViewOuterRect = new Rect(contentRect.x, currentY, contentRect.width, contentRect.yMax - currentY);

            var sortedBloodlines = comp.BloodlineComposition.Where(kv => kv.Value > 0.001f) // 过滤掉极小值
                                                             .OrderByDescending(kv => kv.Value)
                                                             .ToList();

            float rowHeight = 26f;
            float viewRectHeight = sortedBloodlines.Count * rowHeight;
            Rect viewRect = new Rect(0, 0, scrollViewOuterRect.width - 16f, viewRectHeight);

            Widgets.BeginScrollView(scrollViewOuterRect, ref scrollPosition, viewRect);

            float scrollY = 0;
            foreach (var entry in sortedBloodlines)
            {
                Rect rowRect = new Rect(0, scrollY, viewRect.width, rowHeight - 2f);
                DrawCompositionRow(rowRect, entry.Key, entry.Value);
                scrollY += rowHeight;
            }

            Widgets.EndScrollView();
        }

        private void DrawConcentrationBar(float x, ref float y, float width, float concentration)
        {
            // 标签
            Rect labelRect = new Rect(x, y, width, 22f);
            Widgets.Label(labelRect, "RavenRace_GoldenCrowConcentration".Translate() + ": " + concentration.ToStringPercent("F1"));
            y += 24f;

            // 进度条
            Rect barRect = new Rect(x, y, width, 22f);
            Widgets.DrawBoxSolid(barRect, new Color(0.1f, 0.1f, 0.1f, 0.5f)); // 暗色背景

            Rect fillRect = barRect.ContractedBy(2f);
            fillRect.width *= concentration;
            Widgets.DrawBoxSolid(fillRect, FusangUIStyle.MainColor_Gold); // 金色填充

            GUI.color = FusangUIStyle.MainColor_DarkGold;
            Widgets.DrawBox(barRect, 1); // 金色边框
            GUI.color = Color.white;

            TooltipHandler.TipRegion(barRect, "RavenRace_BloodlinePurity".Translate() + ": " + concentration.ToStringPercent("F2"));
            y += 24f;
        }

        private void DrawCompositionRow(Rect rect, string raceDefName, float percent)
        {
            // 绘制微型背景条
            Rect barBgRect = rect;
            barBgRect.width *= percent;
            Widgets.DrawBoxSolid(barBgRect, new Color(0.4f, 0.35f, 0.2f, 0.3f));

            // 左侧标签
            Rect labelRect = rect.LeftPart(0.7f).ContractedBy(4f, 0);
            string displayLabel = GetBloodlineDisplayLabel(raceDefName);
            Widgets.Label(labelRect, displayLabel);

            // 右侧百分比
            Rect percentRect = rect.RightPart(0.3f).ContractedBy(4f, 0);
            Text.Anchor = TextAnchor.MiddleRight;
            GUI.color = FusangUIStyle.TextColor;
            Widgets.Label(percentRect, percent.ToStringPercent("F1"));
            GUI.color = Color.white;
            Text.Anchor = TextAnchor.UpperLeft;

            TooltipHandler.TipRegion(rect, $"{displayLabel}: {percent:P2}");
        }

        private string GetBloodlineDisplayLabel(string raceDefName)
        {
            // 优先尝试翻译特殊Key
            string translationKey = $"RavenRace_Bloodline_{raceDefName}";
            if (translationKey.CanTranslate())
            {
                return translationKey.Translate();
            }

            // 其次尝试从RaceDef获取
            ThingDef raceDef = DefDatabase<ThingDef>.GetNamedSilentFail(raceDefName);
            if (raceDef != null) return raceDef.LabelCap;

            // 最后的兜底
            return raceDefName;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Cinder\CinderCompatUtility.cs
=
.
﻿using System;
using Verse;
using RimWorld;
using RavenRace.Features.Bloodline;

namespace RavenRace.Compat.Cinder
{
    [StaticConstructorOnStartup]
    public static class CinderCompatUtility
    {
        public static bool IsCinderActive { get; private set; }
        public static ThingDef CinderRaceDef { get; private set; }
        public static HediffDef CinderBloodlineHediff { get; private set; }

        static CinderCompatUtility()
        {
            // 根据 About.xml 中的 packageId 或 RaceDefName 判断
            CinderRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Alien_Cinder");
            IsCinderActive = (CinderRaceDef != null);

            CinderBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_CinderBloodline");

            if (IsCinderActive)
            {
                RavenModUtility.LogVerbose("[RavenRace] Cinder (Embergarden) detected. Compatibility active.");
            }
        }

        public static bool HasCinderBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            return comp.BloodlineComposition.ContainsKey("Alien_Cinder") &&
                   comp.BloodlineComposition["Alien_Cinder"] > 0f;
        }

        public static void HandleCinderRegen(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || CinderBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(CinderBloodlineHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(CinderBloodlineHediff);
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(CinderBloodlineHediff);
                if (h != null) pawn.health.RemoveHediff(h);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Cinder\CompRavenRegen.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using RimWorld;
using UnityEngine;
using Verse;

namespace RavenRace.Compat.Cinder
{
    public class CompProperties_RavenRegen : HediffCompProperties
    {
        public int checkInterval = 600;
        public float healPerDay = 10f; // 默认给个基础值
        public float healPerDayUnlocked = 50f;
        public int maxPartHpForLocked = 10;
        public string unlockedString = "Unlocked";

        public CompProperties_RavenRegen()
        {
            this.compClass = typeof(CompRavenRegen);
        }
    }

    /// <summary>
    /// 复刻自 Embergarden.HediffComp_Regen
    /// 实现不依赖基因的肉体再生逻辑
    /// </summary>
    public class CompRavenRegen : HediffComp
    {
        private CompProperties_RavenRegen Props => (CompProperties_RavenRegen)this.props;

        // 存档数据
        public bool Unlocked = false;

        // 缓存列表，避免每帧分配内存
        private static List<Hediff> hediffsToHeal = new List<Hediff>();
        private static List<BodyPartRecord> ignoreParts = new List<BodyPartRecord>();

        private float HealPerDay => Unlocked ? Props.healPerDayUnlocked : Props.healPerDay;
        private float HealPerCycle => HealPerDay * (float)Props.checkInterval / 60000f;

        public override void CompExposeData()
        {
            Scribe_Values.Look(ref Unlocked, "Unlocked", false);
        }

        public override string CompLabelPrefix => Unlocked ? Props.unlockedString : null;

        public override string CompLabelInBracketsExtra => $"{HealPerDay} HP/d";

        public override void CompPostTick(ref float severityAdjustment)
        {
            if (!Pawn.IsHashIntervalTick(Props.checkInterval)) return;

            hediffsToHeal.Clear();
            ignoreParts.Clear();
            bool eyeInhibited = false;

            // 1. 扫描所有 Hediff
            foreach (Hediff hediff in Pawn.health.hediffSet.hediffs)
            {
                // 记录义肢部位，避免再生
                if (hediff is Hediff_AddedPart)
                {
                    foreach (BodyPartRecord item in hediff.Part.GetPartAndAllChildParts())
                    {
                        ignoreParts.Add(item);
                    }
                }

                // 检查是否有烟烬族的眼睛再生抑制 (通过 DefName 查找，软兼容)
                if (hediff.def.defName == "Cinder_EyeRegenInhibited")
                {
                    eyeInhibited = true;
                }
                else
                {
                    if (hediff is Hediff_Injury)
                    {
                        hediffsToHeal.Add(hediff);
                    }
                    else if (hediff is Hediff_MissingPart missingPart)
                    {
                        // 检查缺失部位是否已有义肢或未被完全移除
                        if (Pawn.health.hediffSet.GetMissingPartFor(missingPart.Part.parent) == null &&
                            !Pawn.health.hediffSet.GetInjuredParts().Contains(missingPart.Part.parent))
                        {
                            hediffsToHeal.Add(hediff);
                        }
                    }
                }
            }

            // 打乱顺序，随机治疗
            hediffsToHeal.Shuffle();

            if (hediffsToHeal.Count > 0)
            {
                float remainingHealAmount = HealPerCycle;
                int count = hediffsToHeal.Count;

                // 2. 执行治疗循环
                // 注意：原版逻辑是在循环中修改集合，这里使用副本或倒序比较安全，但为了复刻原逻辑结构，我们小心处理
                for (int i = 0; i < hediffsToHeal.Count; i++)
                {
                    if (remainingHealAmount <= 0f) break;

                    Hediff targetHediff = hediffsToHeal[i];

                    // A. 治疗伤口
                    if (targetHediff is Hediff_Injury)
                    {
                        float amountToHeal = Math.Min(remainingHealAmount / count, targetHediff.Severity);
                        targetHediff.Severity -= amountToHeal;
                        remainingHealAmount -= amountToHeal;
                        count--; // 剩余目标减少，分摊剩余治疗量
                    }
                    // B. 再生缺失部位
                    else
                    {
                        // 眼睛抑制检查
                        bool isSightSource = targetHediff.Part.def.tags.Contains(BodyPartTagDefOf.SightSource);
                        if (eyeInhibited && isSightSource) continue;

                        if (targetHediff is Hediff_MissingPart missingPart)
                        {
                            if (ignoreParts.Contains(missingPart.Part)) continue;

                            // 检查是否允许再生 (基于血量锁定逻辑)
                            if (!CannotRegenPart(missingPart.Part))
                            {
                                float maxHealth = missingPart.Part.def.GetMaxHealth(Pawn);
                                float healShare = remainingHealAmount / count;

                                // 如果一次分配的治疗量不足以完全长出部位
                                if (healShare < maxHealth)
                                {
                                    // 移除"缺失"状态，添加一个"切伤"状态并设置严重度
                                    // 这样下次循环就会把它当做普通伤口治疗，表现为慢慢长出来
                                    BodyPartRecord part = missingPart.Part;
                                    Hediff injury = HediffMaker.MakeHediff(missingPart.lastInjury ?? HediffDefOf.Cut, Pawn, part);

                                    Pawn.health.RemoveHediff(targetHediff);
                                    Pawn.health.AddHediff(injury, part);
                                    injury.Severity = maxHealth - healShare;

                                    remainingHealAmount -= healShare;
                                }
                                else
                                {
                                    // 直接完全修复
                                    remainingHealAmount -= maxHealth;
                                    Pawn.health.RemoveHediff(targetHediff);
                                }
                            }
                        }
                    }
                }
            }
        }

        private bool CannotRegenPart(BodyPartRecord part)
        {
            if (Unlocked) return false;
            // 如果未解锁高级再生，且部位最大血量超过限制，则无法再生
            return part.def.hitPoints > Props.maxPartHpForLocked;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Dragonian\DragonianCompatUtility.cs
=
.
﻿using System;
using System.Linq;
using Verse;
using RimWorld;
using RavenRace.Compat.MuGirl;
using RavenRace.Features.Bloodline; // [Added]

namespace RavenRace.Compat.Dragonian
{
    [StaticConstructorOnStartup]
    public static class DragonianCompatUtility
    {
        public static bool IsDragonianActive { get; private set; }
        public static ThingDef DragonianRaceDef { get; private set; }
        public static ThingDef DragonianMilkDef { get; private set; }
        public static ThingDef DivineMilkDef { get; private set; }
        public static HediffDef DragonianBloodlineHediff { get; private set; }

        static DragonianCompatUtility()
        {
            DragonianRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Dragonian_Race");
            IsDragonianActive = (DragonianRaceDef != null);
            DragonianMilkDef = DefDatabase<ThingDef>.GetNamedSilentFail("DragonianMilk");
            DivineMilkDef = DefDatabase<ThingDef>.GetNamedSilentFail("Raven_DivineMilk");
            DragonianBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_DragonianBloodline");

            if (IsDragonianActive)
            {
                RavenModUtility.LogVerbose("[RavenRace] Dragonian detected. Compatibility active.");
            }
        }

        // [Change] Comp_Bloodline -> CompBloodline
        public static bool HasDragonianBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            return comp.BloodlineComposition.ContainsKey("Dragonian_Race") &&
                   comp.BloodlineComposition["Dragonian_Race"] > 0f;
        }

        public static void HandleDragonianBuff(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || DragonianBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(DragonianBloodlineHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(DragonianBloodlineHediff);
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(DragonianBloodlineHediff);
                if (h != null) pawn.health.RemoveHediff(h);
            }
        }

        public static void GrantDragonMilkAbility(Pawn pawn)
        {
            ThingDef product = DragonianMilkDef ?? DefDatabase<ThingDef>.GetNamed("Milk");
            AddMilkComp(pawn, product, 10, 2.5f, "RavenRace_DragonMilkFullness");
        }

        public static void GrantDivineMilkAbility(Pawn pawn)
        {
            ThingDef product = DivineMilkDef ?? DragonianMilkDef ?? DefDatabase<ThingDef>.GetNamed("Milk");
            AddMilkComp(pawn, product, 15, 2.0f, "RavenRace_DivineMilkFullness");
        }

        private static void AddMilkComp(Pawn pawn, ThingDef product, int amount, float interval, string labelKey)
        {
            try
            {
                CompProperties_RavenMilkable props = new CompProperties_RavenMilkable
                {
                    milkDef = product,
                    milkAmount = amount,
                    milkIntervalDays = interval,
                    displayStringKey = labelKey
                };

                CompRavenMilkable newComp = new CompRavenMilkable();
                newComp.parent = pawn;
                newComp.Initialize(props);
                pawn.AllComps.Add(newComp);
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Failed to grant milk ability ({product}): {ex}");
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Epona\Comp_EponaHybridLogic.cs
=
.
﻿using System;
using System.Collections.Generic;
using Verse;
using Verse.AI;
using RimWorld;
using UnityEngine;

namespace RavenRace.Compat.Epona
{
    public class CompProperties_EponaHybridLogic : CompProperties
    {
        public CompProperties_EponaHybridLogic()
        {
            this.compClass = typeof(Comp_EponaHybridLogic);
        }
    }

    /// <summary>
    /// 模拟艾波娜 JobHediff 机制的组件
    /// </summary>
    public class Comp_EponaHybridLogic : ThingComp
    {
        private Pawn Pawn => (Pawn)parent;

        // 每 30 ticks (0.5秒) 检查一次
        // 原版设定 60 ticks +0.06 severity
        // 我们改为 30 ticks +0.03 severity，效果等同
        private const int TicksToHediffMax = 60;
        private const float SeverityIncrease = 0.06f;

        private int ticksCounter = TicksToHediffMax;

        private static readonly HashSet<string> targetJobDefs = new HashSet<string>
        {
            "Goto", "Follow", "FollowClose", "FollowRoper", "GotoSafeTemperature",
            "GotoWander", "HaulToTransporter", "Flee", "FleeAndCower", "HaulToCell",
            "HaulToContainer", "Steal", "Kidnap", "CarryDownedPawnToExit", "Rescue",
            "TakeDownedPawnToBedDrafted", "CarryDownedPawnDrafted", "ReleasePrisoner",
            "EscortPrisonerToBed", "TakeWoundedPrisonerToBed", "TakeToBedToOperate", "Hunt"
        };

        public override void CompTick()
        {
            base.CompTick();

            if (!Pawn.IsHashIntervalTick(30)) return;
            if (!Pawn.Spawned || Pawn.Dead || Pawn.Downed) return;

            // 检查血脉
            if (!EponaCompatUtility.HasEponaBloodline(Pawn)) return;

            // 1. 检查 Job
            if (Pawn.jobs?.curJob != null && targetJobDefs.Contains(Pawn.jobs.curJob.def.defName))
            {
                // 2. 检查室外 (无屋顶)
                bool isOutdoors = Pawn.GetRoom()?.PsychologicallyOutdoors ?? false;

                if (isOutdoors)
                {
                    ticksCounter -= 30;
                    if (ticksCounter <= 0)
                    {
                        ApplyHediff();
                        ticksCounter = TicksToHediffMax;
                    }
                    return;
                }
            }

            ticksCounter = TicksToHediffMax;
        }

        private void ApplyHediff()
        {
            // 始终使用通用加速 Hediff (三合一)
            if (EponaCompatUtility.EponaRunHediff == null) return;

            Hediff hediff = Pawn.health.hediffSet.GetFirstHediffOfDef(EponaCompatUtility.EponaRunHediff);
            if (hediff == null)
            {
                hediff = Pawn.health.AddHediff(EponaCompatUtility.EponaRunHediff);
                hediff.Severity = 0.01f;
            }
            else
            {
                hediff.Severity = Mathf.Min(hediff.Severity + SeverityIncrease, 1f);
            }
        }

        public override void PostExposeData()
        {
            base.PostExposeData();
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Epona\EponaCompatUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;
using RavenRace.Features.Bloodline; // [Added]

namespace RavenRace.Compat.Epona
{
    [StaticConstructorOnStartup]
    public static class EponaCompatUtility
    {
        public static bool IsEponaActive { get; private set; }
        public static HediffDef EponaRunHediff { get; private set; }

        static EponaCompatUtility()
        {
            IsEponaActive = DefDatabase<ThingDef>.GetNamedSilentFail("Alien_Epona") != null ||
                            DefDatabase<ThingDef>.GetNamedSilentFail("Alien_Destrier") != null ||
                            DefDatabase<ThingDef>.GetNamedSilentFail("Alien_Unicorn") != null;

            if (IsEponaActive)
            {
                EponaRunHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Epona_Run_Hediff");
            }
        }

        public static bool IsEponaRace(string defName)
        {
            if (defName == null) return false;
            return defName == "Alien_Epona" || defName == "Alien_Destrier" || defName == "Alien_Unicorn";
        }

        public static string NormalizeToEponaKey(string defName)
        {
            if (IsEponaRace(defName)) return "Alien_Epona";
            return defName;
        }

        public static bool HasEponaBloodline(Pawn pawn)
        {
            if (pawn == null) return false;
            // [Change] Comp_Bloodline -> CompBloodline
            var comp = pawn.TryGetComp<CompBloodline>();
            if (comp == null || comp.BloodlineComposition == null) return false;

            return comp.BloodlineComposition.ContainsKey("Alien_Epona") ||
                   comp.BloodlineComposition.ContainsKey("Alien_Destrier") ||
                   comp.BloodlineComposition.ContainsKey("Alien_Unicorn");
        }

        public static void EnsureEponaHybridComp(Pawn pawn)
        {
            if (!IsEponaActive || pawn == null) return;
            if (!HasEponaBloodline(pawn)) return;

            if (pawn.GetComp<Comp_EponaHybridLogic>() != null) return;

            try
            {
                Comp_EponaHybridLogic newComp = new Comp_EponaHybridLogic();
                newComp.parent = pawn;
                newComp.Initialize(new CompProperties_EponaHybridLogic());
                pawn.AllComps.Add(newComp);
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Failed to add EponaHybridLogic to {pawn}: {ex}");
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Koelime\KoelimeCompatUtility.cs
=
.
﻿using System;
using Verse;
using RimWorld;

namespace RavenRace.Compat.Koelime
{
    /// <summary>
    /// 珂莉姆种族兼容性工具类
    /// </summary>
    [StaticConstructorOnStartup]
    public static class KoelimeCompatUtility
    {
        public static bool IsKoelimeActive { get; private set; }
        public static ThingDef KoelimeRaceDef { get; private set; }
        public static HediffDef KoelimeBloodlineHediff { get; private set; }

        static KoelimeCompatUtility()
        {
            // 根据珂莉姆 XML 中的 DefName "Alien_Koelime" 查找
            KoelimeRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Alien_Koelime");
            IsKoelimeActive = (KoelimeRaceDef != null);

            KoelimeBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_KoelimeBloodline");

            if (IsKoelimeActive)
            {
                RavenModUtility.LogVerbose("[RavenRace] Koelime (Alien_Koelime) detected. Compatibility active.");
            }
        }

        /// <summary>
        /// 赋予或移除次级古龙血脉 Hediff
        /// </summary>
        public static void HandleDraconicBloodline(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || KoelimeBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(KoelimeBloodlineHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(KoelimeBloodlineHediff);
                // 仅在调试模式下输出，避免刷屏
                if (RavenRaceMod.Settings.enableVerboseLogging)
                {
                    RavenModUtility.LogVerbose($"Applied Koelime Bloodline Hediff to {pawn.LabelShort}");
                }
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(KoelimeBloodlineHediff);
                if (h != null)
                {
                    pawn.health.RemoveHediff(h);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Milira\MiliraCompatUtility.cs
=
.
﻿using Verse;
using RimWorld;
using RavenRace.Features.Bloodline;

namespace RavenRace.Compat.Milira
{
    [StaticConstructorOnStartup]
    public static class MiliraCompatUtility
    {
        public static bool IsMiliraActive { get; private set; }
        public static ThingDef MiliraRaceDef { get; private set; }
        public static HediffDef MiliraBloodlineHediff { get; private set; }

        static MiliraCompatUtility()
        {
            // 尝试查找米莉拉种族 Def
            MiliraRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Milira_Race");

            // 如果没找到 Milira_Race，尝试找 Milira (以防版本差异)
            if (MiliraRaceDef == null)
            {
                MiliraRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Milira");
            }

            IsMiliraActive = (MiliraRaceDef != null);

            // 获取我们新定义的 Hediff
            MiliraBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_MiliraBloodline");

            if (IsMiliraActive)
            {
                RavenModUtility.LogVerbose("[RavenRace] Milira detected. Compatibility active.");
            }
        }

        /// <summary>
        /// 检查是否拥有米莉拉血脉
        /// </summary>
        public static bool HasMiliraBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;

            // 检查可能的 Key
            return comp.BloodlineComposition.ContainsKey("Milira_Race") ||
                   comp.BloodlineComposition.ContainsKey("Milira");
        }

        /// <summary>
        /// 处理米莉拉血脉带来的属性加成 Hediff
        /// </summary>
        public static void HandleMiliraBuff(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || MiliraBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(MiliraBloodlineHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(MiliraBloodlineHediff);
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(MiliraBloodlineHediff);
                if (h != null)
                {
                    pawn.health.RemoveHediff(h);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Mincho\CompMinchoPassiveProduction.cs
=
.
﻿using System;
using System.Collections.Generic;
using UnityEngine;
using Verse;
using RimWorld;

namespace RavenRace.Compat.Mincho
{
    public class CompProperties_MinchoPassiveProduction : CompProperties
    {
        public ThingDef resourceDef; // 产出的物品
        public int amount = 10;      // 产出数量
        public float intervalDays = 1f; // 生产周期(天)
        public string labelKey = "RavenRace_MinchoChocolateFullness"; // UI显示的Key

        public CompProperties_MinchoPassiveProduction()
        {
            this.compClass = typeof(CompMinchoPassiveProduction);
        }
    }

    public class CompMinchoPassiveProduction : ThingComp
    {
        public CompProperties_MinchoPassiveProduction Props => (CompProperties_MinchoPassiveProduction)this.props;

        private float progress = 0f;

        public override void PostExposeData()
        {
            base.PostExposeData();
            Scribe_Values.Look(ref progress, "minchoProductionProgress", 0f);
        }

        public override void CompTick()
        {
            base.CompTick();
            Pawn pawn = this.parent as Pawn;
            if (pawn == null || pawn.Dead) return;

            // 饥饿时停止生产
            float hungerFactor = 1f;
            if (pawn.needs?.food != null && pawn.needs.food.Starving)
            {
                hungerFactor = 0f;
            }

            // 增加进度
            float increase = (1f / (Props.intervalDays * 60000f)) * hungerFactor;
            progress += increase;

            // 满了自动掉落
            if (progress >= 1f)
            {
                Produce();
                progress = 0f;
            }
        }

        private void Produce()
        {
            Pawn pawn = (Pawn)parent;
            if (pawn.Map == null) return; // 不在地图上不生成(但在世界地图会累积进度，回到地图瞬间掉落)

            // 生成物品
            Thing thing = ThingMaker.MakeThing(Props.resourceDef);
            thing.stackCount = Props.amount;

            // 尝试放置在脚下
            if (GenPlace.TryPlaceThing(thing, pawn.Position, pawn.Map, ThingPlaceMode.Near, out Thing resultingThing))
            {
                // 播放音效和消息
                // 复用产卵的声音或标准的物品掉落声
                // (DefDatabase<SoundDef>.GetNamedSilentFail("Hive_Spawn") ?? SoundDefOf.Standard_Drop).PlayOneShot(pawn);

                Messages.Message("RavenRace_Message_MinchoProduced".Translate(pawn.LabelShort, thing.Label), new LookTargets(pawn, resultingThing), MessageTypeDefOf.PositiveEvent);
            }
        }

        // [核心] 这里决定了左下角信息栏的显示
        public override string CompInspectStringExtra()
        {
            if (Props.resourceDef == null) return null;
            return Props.labelKey.Translate() + ": " + progress.ToStringPercent();
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Mincho\HediffComp_MinchoProduction.cs
=
.
﻿using Verse;
using RimWorld;
using UnityEngine;

namespace RavenRace.Compat.Mincho
{
    /// <summary>
    /// HediffComp的属性定义类，用于在XML中配置生产参数。
    /// </summary>
    public class HediffCompProperties_MinchoProduction : HediffCompProperties
    {
        public ThingDef thingToProduce;
        public int productionIntervalTicks = 30000; // 默认为半天
        public int amountToProduce = 10;

        public HediffCompProperties_MinchoProduction()
        {
            this.compClass = typeof(HediffComp_MinchoProduction);
        }
    }

    /// <summary>
    /// 附加在珉巧血脉Hediff上的组件，实现自动生产薄荷巧克力。
    /// </summary>
    public class HediffComp_MinchoProduction : HediffComp
    {
        private int ticksToProduce;

        public HediffCompProperties_MinchoProduction Props => (HediffCompProperties_MinchoProduction)this.props;

        public override void CompPostPostAdd(DamageInfo? dinfo)
        {
            base.CompPostPostAdd(dinfo);
            // 首次添加时，重置计时器
            this.ticksToProduce = Props.productionIntervalTicks;
        }

        public override void CompExposeData()
        {
            base.CompExposeData();
            Scribe_Values.Look(ref this.ticksToProduce, "ticksToProduce", 0);
        }

        public override void CompPostTick(ref float severityAdjustment)
        {
            base.CompPostTick(ref severityAdjustment);

            // 每帧减少计时
            this.ticksToProduce--;

            if (this.ticksToProduce <= 0)
            {
                // 计时结束，执行生产
                Produce();
                // 重置计时器
                this.ticksToProduce = Props.productionIntervalTicks;
            }
        }

        /// <summary>
        /// 生产物品并掉落在Pawn脚下。
        /// </summary>
        private void Produce()
        {
            // 确保Pawn存在且在地图上
            if (this.Pawn == null || !this.Pawn.Spawned || this.Pawn.Map == null)
            {
                return;
            }

            // 确保要生产的物品已定义
            if (Props.thingToProduce == null)
            {
                Log.ErrorOnce("[RavenRace] HediffComp_MinchoProduction: thingToProduce is not defined in XML!", 918273645);
                return;
            }

            // 创建物品
            Thing thing = ThingMaker.MakeThing(Props.thingToProduce);
            thing.stackCount = Props.amountToProduce;

            // 尝试将物品放置在Pawn附近
            if (GenPlace.TryPlaceThing(thing, this.Pawn.Position, this.Pawn.Map, ThingPlaceMode.Near, out Thing resultingThing))
            {
                // 发送消息通知玩家
                Messages.Message("RavenRace_Message_MinchoProduced".Translate(this.Pawn.LabelShort, thing.Label), this.Pawn, MessageTypeDefOf.PositiveEvent);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Mincho\MinchoCompatUtility.cs
=
.
﻿using System;
using System.Linq;
using Verse;
using RimWorld;
using RavenRace.Features.Bloodline;

namespace RavenRace.Compat.Mincho
{
    [StaticConstructorOnStartup]
    public static class MinchoCompatUtility
    {
        public static bool IsMinchoActive { get; private set; }
        public static ThingDef MinchoRaceDef { get; private set; }
        public static ThingDef MinchoMintChocolateDef { get; private set; }
        public static HediffDef MinchoBloodlineHediff { get; private set; }

        static MinchoCompatUtility()
        {
            // 根据XML中的DefName判断Mod是否存在
            MinchoRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Mincho_ThingDef");
            IsMinchoActive = (MinchoRaceDef != null);

            if (IsMinchoActive)
            {
                MinchoMintChocolateDef = DefDatabase<ThingDef>.GetNamedSilentFail("Mincho_Mintchoco");
                MinchoBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_MinchoBloodline");

                if (MinchoMintChocolateDef == null)
                {
                    Log.Warning("[RavenRace] Mincho compatibility is active, but ThingDef 'Mincho_Mintchoco' was not found. Production will be disabled.");
                }

                RavenModUtility.LogVerbose("[RavenRace] Mincho the Mint Choco Slime detected. Compatibility active.");
            }
        }

        /// <summary>
        /// 检查Pawn是否拥有珉巧血脉
        /// </summary>
        public static bool HasMinchoBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            return comp.BloodlineComposition.ContainsKey("Mincho_ThingDef") &&
                   comp.BloodlineComposition["Mincho_ThingDef"] > 0f;
        }

        /// <summary>
        /// 兼容性逻辑主入口
        /// </summary>
        public static void HandleMinchoBloodline(Pawn pawn, bool hasBloodline)
        {
            HandleMinchoBuff(pawn, hasBloodline);
            HandleMinchoProduction(pawn, hasBloodline);
        }

        /// <summary>
        /// 处理由血脉赋予的永久Hediff（极寒抗性）
        /// </summary>
        private static void HandleMinchoBuff(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || MinchoBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(MinchoBloodlineHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(MinchoBloodlineHediff);
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff hediff = pawn.health.hediffSet.GetFirstHediffOfDef(MinchoBloodlineHediff);
                if (hediff != null)
                {
                    pawn.health.RemoveHediff(hediff);
                }
            }
        }

        /// <summary>
        /// 处理薄荷巧克力生产逻辑 (使用 ThingComp 以显示在左下角信息栏)
        /// </summary>
        private static void HandleMinchoProduction(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || MinchoMintChocolateDef == null) return;

            // 检查是否已经有我们的生产组件
            bool hasComp = pawn.AllComps.Any(c => c is CompMinchoPassiveProduction);

            if (hasBloodline && !hasComp)
            {
                try
                {
                    // 动态创建并配置属性
                    var props = new CompProperties_MinchoPassiveProduction
                    {
                        resourceDef = MinchoMintChocolateDef,
                        amount = 10,
                        intervalDays = 0.5f, // 半天产一次
                        labelKey = "RavenRace_MinchoChocolateFullness" // 左下角显示的Key
                    };

                    // 初始化组件并添加到Pawn
                    var newComp = new CompMinchoPassiveProduction();
                    newComp.parent = pawn;
                    newComp.Initialize(props);
                    pawn.AllComps.Add(newComp);

                    // 如果Pawn已经生成，可能需要手动触发一次SpawnSetup来初始化数据
                    // 但对于简单的Ticker组件，直接Add通常就足够了
                }
                catch (Exception ex)
                {
                    Log.Error($"[RavenRace] Failed to grant Mincho Chocolate production to {pawn.LabelShort}: {ex}");
                }
            }
            else if (!hasBloodline && hasComp)
            {
                // 如果不再有血脉，则移除组件
                pawn.AllComps.RemoveAll(c => c is CompMinchoPassiveProduction);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Miraboreas\CompMiraboreasSlam.cs
=
.
﻿using Verse;

namespace RavenRace.Compat.Miraboreas
{
    /// <summary>
    /// 用于在Hediff的XML中存储拍击效果参数的CompProperties。
    /// </summary>
    public class CompProperties_MiraboreasSlam : HediffCompProperties
    {
        public float slamRadius = 1.9f;
        public float slamDamageFactor = 0.65f;

        public CompProperties_MiraboreasSlam()
        {
            this.compClass = typeof(CompMiraboreasSlam);
        }
    }

    /// <summary>
    /// 一个简单的数据容器组件，附加在Hediff上，让Harmony补丁可以读取其XML中定义的属性。
    /// </summary>
    public class CompMiraboreasSlam : HediffComp
    {
        public CompProperties_MiraboreasSlam Props => (CompProperties_MiraboreasSlam)this.props;
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Miraboreas\MiraboreasCompatUtility.cs
=
.
﻿using Verse;
using RimWorld;
using RavenRace.Features.Bloodline;

namespace RavenRace.Compat.Miraboreas
{
    [StaticConstructorOnStartup]
    public static class MiraboreasCompatUtility
    {
        public static bool IsMiraboreasActive { get; private set; }
        public static ThingDef MiraboreasRaceDef { get; private set; }
        public static HediffDef MiraboreasBloodlineHediff { get; private set; }

        static MiraboreasCompatUtility()
        {
            // 根据米拉波雷亚斯的种族DefName判断Mod是否存在
            MiraboreasRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("LBD_Fatalis_Race");
            IsMiraboreasActive = (MiraboreasRaceDef != null);

            MiraboreasBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_MiraboreasBloodline");

            if (IsMiraboreasActive)
            {
                // 在开发者日志中打印兼容性激活信息
                RavenModUtility.LogVerbose("[RavenRace] Legendary Black Dragon (Miraboreas) detected. Compatibility active.");
            }
        }

        /// <summary>
        /// 检查Pawn是否拥有米拉波雷亚斯血脉。
        /// </summary>
        public static bool HasMiraboreasBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            // 使用正确的raceDef名称作为Key来检查
            return comp.BloodlineComposition.ContainsKey("LBD_Fatalis_Race") &&
                   comp.BloodlineComposition["LBD_Fatalis_Race"] > 0f;
        }

        /// <summary>
        /// 根据血脉状态，为Pawn添加或移除“黑龙血脉”Hediff。
        /// </summary>
        public static void HandleMiraboreasBloodline(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || MiraboreasBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(MiraboreasBloodlineHediff);

            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(MiraboreasBloodlineHediff);
            }
            else if (!hasBloodline && hasHediff)
            {
                Hediff hediff = pawn.health.hediffSet.GetFirstHediffOfDef(MiraboreasBloodlineHediff);
                if (hediff != null)
                {
                    pawn.health.RemoveHediff(hediff);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Miraboreas\Patch_MiraboreasSlam.cs
=
.
﻿using HarmonyLib;
using RimWorld;
using Verse;

namespace RavenRace.Compat.Miraboreas
{
    /// <summary>
    /// Harmony补丁，用于实现米拉波雷亚斯血脉的近战范围攻击（拍击）效果。
    /// </summary>
    [HarmonyPatch(typeof(Verb_MeleeAttackDamage), "ApplyMeleeDamageToTarget")]
    public static class Patch_MiraboreasSlam
    {
        /// <summary>
        /// 在原版造成近战伤害后执行。
        /// </summary>
        [HarmonyPostfix]
        public static void Postfix(Verb_MeleeAttackDamage __instance, LocalTargetInfo target)
        {
            // 1. 检查Mod设置是否启用
            if (!RavenRaceMod.Settings.enableMiraboreasCompat) return;

            // 2. 获取攻击者和主要目标
            Pawn attacker = __instance.CasterPawn;
            Thing mainTarget = target.Thing;

            // 3. 基础条件检查
            if (attacker == null || attacker.Dead || mainTarget == null || attacker.Map == null) return;

            // 4. 检查攻击者是否为渡鸦族，且装备了近战武器
            if (attacker.def != RavenDefOf.Raven_Race || attacker.equipment?.Primary == null || !attacker.equipment.Primary.def.IsMeleeWeapon) return;

            // 5. 检查攻击者是否有“黑龙血脉”Hediff
            Hediff hediff = attacker.health?.hediffSet.GetFirstHediffOfDef(MiraboreasCompatUtility.MiraboreasBloodlineHediff);
            if (hediff == null) return;

            // 6. 获取Hediff上的拍击效果组件
            CompMiraboreasSlam comp = hediff.TryGetComp<CompMiraboreasSlam>();
            if (comp == null) return;

            // 7. 获取拍击参数
            float slamRadius = comp.Props.slamRadius;
            float slamDamageFactor = comp.Props.slamDamageFactor;

            // 8. 查找主要目标周围的其他敌人
            foreach (Thing thing in GenRadial.RadialDistinctThingsAround(mainTarget.Position, attacker.Map, slamRadius, true))
            {
                // 跳过主要目标、攻击者自己以及非Pawn目标
                if (thing == mainTarget || thing == attacker || !(thing is Pawn secondaryPawn))
                {
                    continue;
                }

                // 只对敌对且未倒地的Pawn造成伤害
                if (secondaryPawn.HostileTo(attacker) && !secondaryPawn.Downed)
                {
                    // 9. 计算范围伤害
                    // 复刻米拉波雷亚斯原版逻辑：伤害和穿透都乘以伤害系数
                    float damage = __instance.verbProps.AdjustedMeleeDamageAmount(__instance, attacker) * slamDamageFactor;
                    float armorPen = __instance.verbProps.AdjustedArmorPenetration(__instance, attacker) * slamDamageFactor;
                    DamageDef damageDef = __instance.verbProps.meleeDamageDef ?? DamageDefOf.Blunt;

                    // 10. 创建并应用伤害
                    DamageInfo dinfo = new DamageInfo(
                        damageDef,
                        damage,
                        armorPen,
                        -1f,
                        attacker,
                        null,
                        __instance.EquipmentSource?.def ?? attacker.def);

                    // 设置伤害角度
                    dinfo.SetAngle((secondaryPawn.Position - attacker.Position).ToVector3());

                    secondaryPawn.TakeDamage(dinfo);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MoeLotl\Debug_Axolotl_SaveLoad.cs
=
.
﻿using HarmonyLib;
using Verse;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using System.Linq;
using RimWorld;
using System.Text;

namespace RavenRace.Compat.MoeLotl
{
    /// <summary>
    /// [侦探脚本 V2] 专注于追踪数据载入后的去向
    /// </summary>
    [HarmonyPatch]
    public static class Debug_Axolotl_Inspector
    {
        // 1. 监听 PostExposeData 完成后的瞬间状态
        [HarmonyPatch(typeof(ThingComp), "PostExposeData")] // 这里我们手动指定Target，因为我们要Patch的是萌螈的类
        public static class Patch_PostExposeData_End
        {
            public static bool Prepare()
            {
                return MoeLotlCompatUtility.IsMoeLotlActive;
            }

            public static MethodBase TargetMethod()
            {
                return AccessTools.Method(MoeLotlCompatUtility.CompCultivationType, "PostExposeData");
            }

            [HarmonyPostfix]
            public static void Postfix(ThingComp __instance)
            {
                if (Scribe.mode != LoadSaveMode.PostLoadInit) return; // 只关注载入完成阶段

                Pawn pawn = __instance.parent as Pawn;
                if (pawn == null || pawn.def != RavenDefOf.Raven_Race) return;

                Log.Error($"[RavenInspector] 1. PostExposeData 结束: {pawn.Name}");
                CheckSkills(__instance, "PostExposeData");
            }
        }

        // 2. 监听 SpawnSetup (生成到地图时)，看看此时数据是否还在
        [HarmonyPatch(typeof(ThingComp), "PostSpawnSetup")]
        public static class Patch_PostSpawnSetup
        {
            public static bool Prepare()
            {
                return MoeLotlCompatUtility.IsMoeLotlActive;
            }

            public static MethodBase TargetMethod()
            {
                return AccessTools.Method(MoeLotlCompatUtility.CompCultivationType, "PostSpawnSetup");
            }

            [HarmonyPostfix]
            public static void Postfix(ThingComp __instance)
            {
                Pawn pawn = __instance.parent as Pawn;
                if (pawn == null || pawn.def != RavenDefOf.Raven_Race) return;

                Log.Error($"[RavenInspector] 2. PostSpawnSetup 结束: {pawn.Name}");
                CheckSkills(__instance, "PostSpawnSetup");
            }
        }

        // 3. 辅助检查方法
        public static void CheckSkills(ThingComp comp, string stage)
        {
            Traverse trav = Traverse.Create(comp);
            var skills = trav.Field("AllLearnedSkills").GetValue() as IList;
            var installList = trav.Field("SkillInstallList").GetValue() as IList;

            if (skills == null)
            {
                Log.Error($"[RavenInspector] [{stage}] AllLearnedSkills is NULL!");
            }
            else
            {
                Log.Error($"[RavenInspector] [{stage}] Skills Count: {skills.Count}");
                foreach (var skill in skills)
                {
                    if (skill == null)
                    {
                        Log.Error($"[RavenInspector]  - Found NULL skill entry!");
                        continue;
                    }

                    Traverse tSkill = Traverse.Create(skill);
                    Def def = tSkill.Field("def").GetValue<Def>();
                    Pawn p = tSkill.Field("pawn").GetValue<Pawn>();
                    var comps = tSkill.Field("comps").GetValue() as IList;

                    string defName = def?.defName ?? "NULL_DEF";
                    string pawnName = p?.Name?.ToStringFull ?? "NULL_PAWN";
                    int compCount = comps?.Count ?? -1;

                    Log.Error($"[RavenInspector]  - Skill: {defName} | PawnRef: {pawnName} | Comps: {compCount}");
                }
            }

            if (installList == null)
            {
                Log.Error($"[RavenInspector] [{stage}] SkillInstallList is NULL!");
            }
            else
            {
                Log.Error($"[RavenInspector] [{stage}] InstallList Count: {installList.Count}");
                foreach (var item in installList)
                {
                    Def d = item as Def;
                    Log.Error($"[RavenInspector]  - Installed: {d?.defName ?? "NULL"}");
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MoeLotl\MoeLotlCompatUtility.cs
=
.
﻿using System;
using System.Linq;
using System.Reflection;
using Verse;
using RimWorld;
using HarmonyLib;
using System.Collections.Generic;
using RavenRace.Features.Bloodline;

namespace RavenRace.Compat.MoeLotl
{
    /// <summary>
    /// 萌螈兼容性工具类 - 最终完整版
    /// 包含所有字段定义、血脉检查逻辑以及存档修复逻辑。
    /// [核心修复] 新增了对萌螈原版CompProperties的缓存与注入逻辑，以解决存档加载后数据丢失的问题。
    /// </summary>
    [StaticConstructorOnStartup]
    public static class MoeLotlCompatUtility
    {
        // =============================================================
        // 1. 静态类型引用 (通过反射获取，避免编译时依赖)
        // =============================================================
        public static Type CompCultivationType;
        public static Type CompAxolotlEnergyType;
        public static Type ITabCultivationType;
        public static Type CompUseAxolotlThingsType;
        public static Type CompUseEffectEnergyThingType;
        public static Type CompUseEffectBookType;
        public static Type WorkGiverReadBookType;
        public static Type MoeLotlSkillBookType;

        public static HediffDef LotlQiHediffDef;
        public static bool IsMoeLotlActive { get; private set; }

        // =============================================================
        // 2. [核心修复] 存档修复专用缓存 (用于 Props 注入)
        // =============================================================
        public static CompProperties CachedCultivationProps;
        public static CompProperties CachedEnergyProps;

        static MoeLotlCompatUtility()
        {
            try
            {
                // 获取萌螈种族定义
                ThingDef axolotlRace = DefDatabase<ThingDef>.GetNamedSilentFail("Axolotl");
                if (axolotlRace == null)
                {
                    IsMoeLotlActive = false;
                    return; // 如果连萌螈种族都找不到，直接中止
                }

                // 反射所有必要的类型
                CompCultivationType = AccessTools.TypeByName("Axolotl.Comp_Cultivation");
                CompAxolotlEnergyType = AccessTools.TypeByName("Axolotl.CompAxolotlEnergy");
                ITabCultivationType = AccessTools.TypeByName("Axolotl.ITab_MoeLotl_Cultivation");
                CompUseAxolotlThingsType = AccessTools.TypeByName("Axolotl.CompUseAxolotlThingsWithLabel");
                CompUseEffectEnergyThingType = AccessTools.TypeByName("Axolotl.ThingComp_UseAxolotlEnergyThing");
                CompUseEffectBookType = AccessTools.TypeByName("Axolotl.CompUseEffectGiveBookHediff");
                WorkGiverReadBookType = AccessTools.TypeByName("Axolotl.WorkGiver_ReadMoeLotlQiSkillBook");
                MoeLotlSkillBookType = AccessTools.TypeByName("Axolotl.MoeLotlSkillBook");

                // 获取 Hediff
                LotlQiHediffDef = DefDatabase<HediffDef>.GetNamedSilentFail("Axolotl_LotlQi");

                // 只要核心组件存在，就视为激活
                IsMoeLotlActive = (CompCultivationType != null && CompAxolotlEnergyType != null);

                if (!IsMoeLotlActive) return;

                // [核心修复] 缓存萌螈原版的 CompProperties
                // 这是解决“存档加载后 props 为空导致数据丢失”的关键
                if (CompCultivationType != null)
                    CachedCultivationProps = axolotlRace.comps.FirstOrDefault(p => p.compClass == CompCultivationType);

                if (CompAxolotlEnergyType != null)
                    CachedEnergyProps = axolotlRace.comps.FirstOrDefault(p => p.compClass == CompAxolotlEnergyType);

                // [兜底逻辑] 如果 Def 里没找到，手动创建一个空属性，防止空指针崩溃
                if (CachedCultivationProps == null && CompCultivationType != null)
                {
                    Log.Warning("[RavenRace] Could not find CompProperties_Cultivation in Axolotl ThingDef. Creating a fallback instance.");
                    Type propType = AccessTools.TypeByName("Axolotl.CompProperties_Cultivation");
                    if (propType != null)
                        CachedCultivationProps = (CompProperties)Activator.CreateInstance(propType);
                    else
                        CachedCultivationProps = new CompProperties { compClass = CompCultivationType };
                }

                if (CachedEnergyProps == null && CompAxolotlEnergyType != null)
                {
                    Log.Warning("[RavenRace] Could not find CompProperties_AxolotlEnergy in Axolotl ThingDef. Creating a fallback instance.");
                    Type propType = AccessTools.TypeByName("Axolotl.CompProperties_AxolotlEnergy");
                    if (propType != null)
                        CachedEnergyProps = (CompProperties)Activator.CreateInstance(propType);
                    else
                        CachedEnergyProps = new CompProperties { compClass = CompAxolotlEnergyType };
                }
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Failed to initialize MoeLotl compatibility: {ex}");
                IsMoeLotlActive = false;
            }
        }

        // =============================================================
        // 3. 核心功能方法
        // =============================================================

        /// <summary>
        /// 赋予或修复渡鸦的修仙能力组件。
        /// </summary>
        public static void GrantCultivationAbility(Pawn pawn)
        {
            if (!IsMoeLotlActive || pawn == null) return;

            try
            {
                // 1. 处理修炼组件 (Comp_Cultivation)
                EnsureCompExistsAndInitialize(pawn, CompCultivationType, CachedCultivationProps);

                // 2. 处理能量组件 (CompAxolotlEnergy)
                EnsureCompExistsAndInitialize(pawn, CompAxolotlEnergyType, CachedEnergyProps);
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Error processing MoeLotl abilities for {pawn.LabelShort}: {ex}");
            }
        }

        /// <summary>
        /// 辅助方法：确保组件存在。如果不存在，则使用缓存的正确 props 创建并添加它。
        /// </summary>
        private static void EnsureCompExistsAndInitialize(Pawn pawn, Type compType, CompProperties props)
        {
            if (compType == null || props == null) return;

            if (pawn.AllComps.Any(c => c.GetType() == compType)) return;

            try
            {
                ThingComp newComp = (ThingComp)Activator.CreateInstance(compType);
                newComp.parent = pawn;
                newComp.Initialize(props);

                MethodInfo mPostMake = AccessTools.Method(compType, "PostMake");
                mPostMake?.Invoke(newComp, null);

                pawn.AllComps.Add(newComp);
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Failed to create and add MoeLotl component '{compType.Name}' to {pawn.LabelShort}. Error: {ex}");
            }
        }

        /// <summary>
        /// 检查Pawn是否拥有萌螈血脉
        /// </summary>
        public static bool HasMoeLotlBloodline(Pawn pawn)
        {
            if (pawn == null) return false;

            var comp = pawn.TryGetComp<CompBloodline>();
            if (comp != null && comp.BloodlineComposition != null)
            {
                return comp.BloodlineComposition.ContainsKey("Axolotl") &&
                       comp.BloodlineComposition["Axolotl"] > 0f;
            }
            return false;
        }

        /// <summary>
        /// 获取当前阅读计划
        /// </summary>
        public static ThingDef GetTargetReadBook(Pawn pawn)
        {
            if (!IsMoeLotlActive || CompCultivationType == null) return null;
            try
            {
                var comp = pawn.AllComps.FirstOrDefault(c => c.GetType() == CompCultivationType);
                if (comp == null) return null;
                FieldInfo field = AccessTools.Field(CompCultivationType, "TargetReadBook");
                if (field != null) return (ThingDef)field.GetValue(comp);
                return null;
            }
            catch
            {
                return null;
            }
        }

        public static void LogCompatibilityStatus()
        {
            if (!IsMoeLotlActive)
            {
                Log.Message("[RavenRace] MoeLotl compatibility: INACTIVE (Mod not detected)");
                return;
            }
            Log.Message("[RavenRace] MoeLotl Status: ACTIVE.");
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MoeLotl\Patch_MoeLotl_Compat.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using HarmonyLib;
using Verse;
using Verse.AI;
using RimWorld;
using UnityEngine;

namespace RavenRace.Compat.MoeLotl
{
    /// <summary>
    /// 萌螈模组功能性兼容补丁集合。
    /// 主要负责拦截萌螈模组的各种功能性检查，确保我们的混血渡鸦能够被正确识别和处理。
    /// </summary>
    [StaticConstructorOnStartup]
    public static class Patch_MoeLotl_Compat
    {
        private static WorkTypeDef readBookWorkType;
        private static Type hediffCompWaterTreatType;

        static Patch_MoeLotl_Compat()
        {
            if (!MoeLotlCompatUtility.IsMoeLotlActive) return;

            readBookWorkType = DefDatabase<WorkTypeDef>.GetNamedSilentFail("Axolotl_ReadMoeLotlQiSkillBooks");
            HarmonyLib.Harmony harmony = new HarmonyLib.Harmony("ZuoYao.RavenRace.MoeLotlCompat");

            hediffCompWaterTreatType = AccessTools.TypeByName("Axolotl.HediffCompWaterTreatToSelf");

            try
            {
                // ==============================================================
                // [核心功能修复] 全局补丁 IsMoeLotl() 方法
                // 这是解决所有兼容问题的根源。它让萌螈mod的所有部分都承认我们的混血渡鸦。
                // ==============================================================
                var mIsMoeLotl = AccessTools.Method("Axolotl.AxolotlExtension:IsMoeLotl");
                if (mIsMoeLotl != null)
                {
                    harmony.Patch(mIsMoeLotl, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(IsMoeLotl_Postfix)));
                }
                else
                {
                    Log.Error("[RavenRace] MoeLotl compat: CRITICAL - Could not find method 'Axolotl.AxolotlExtension:IsMoeLotl' to patch. Compatibility will fail.");
                }


                // [保留的其他功能性兼容补丁]
                // 这些补丁确保混血渡鸦可以使用萌螈的物品、正确计算能量恢复等。
                if (MoeLotlCompatUtility.CompUseEffectEnergyThingType != null)
                {
                    var mCanBeUsedBy = AccessTools.Method(MoeLotlCompatUtility.CompUseEffectEnergyThingType, "CanBeUsedBy");
                    if (mCanBeUsedBy != null) harmony.Patch(mCanBeUsedBy, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(CanBeUsedBy_Postfix)));
                }
                if (MoeLotlCompatUtility.CompUseEffectBookType != null)
                {
                    var mCanBeUsedByBook = AccessTools.Method(MoeLotlCompatUtility.CompUseEffectBookType, "CanBeUsedBy");
                    if (mCanBeUsedByBook != null) harmony.Patch(mCanBeUsedByBook, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(CanBeUsedBy_Postfix)));
                }
                if (MoeLotlCompatUtility.CompAxolotlEnergyType != null)
                {
                    var pEnergyGain = AccessTools.PropertyGetter(MoeLotlCompatUtility.CompAxolotlEnergyType, "EnergyGainPerSec");
                    if (pEnergyGain != null)
                    {
                        harmony.Patch(pEnergyGain, prefix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(EnergyGainPerSec_Prefix)));
                    }
                }
                if (MoeLotlCompatUtility.MoeLotlSkillBookType != null)
                {
                    var mGetFloatMenuOptions = AccessTools.Method(MoeLotlCompatUtility.MoeLotlSkillBookType, "GetFloatMenuOptions");
                    if (mGetFloatMenuOptions != null)
                    {
                        harmony.Patch(mGetFloatMenuOptions, prefix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(SkillBook_GetFloatMenuOptions_Prefix)));
                    }
                }

                Type contextType = AccessTools.TypeByName("RimWorld.FloatMenuContext");
                var mGetOptions = AccessTools.Method(typeof(FloatMenuMakerMap), "GetOptions", new Type[] { typeof(List<Pawn>), typeof(Vector3), contextType.MakeByRefType() });
                if (mGetOptions != null)
                {
                    harmony.Patch(mGetOptions, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(FloatMenuMakerMap_Postfix)));
                }

                if (hediffCompWaterTreatType != null)
                {
                    var mCompPostTick = AccessTools.Method(hediffCompWaterTreatType, "CompPostTick");
                    if (mCompPostTick != null)
                    {
                        harmony.Patch(mCompPostTick, prefix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(HediffCompWaterTreat_CompPostTick_Prefix)));
                    }
                }

                ApplyMiscPatches(harmony);

                RavenModUtility.LogVerbose("[RavenRace] MoeLotl compatibility patches applied successfully.");
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Error applying MoeLotl compatibility patches: {ex}");
            }
        }

        /// <summary>
        /// [核心功能修复] 在 Axolotl.AxolotlExtension:IsMoeLotl() 方法之后执行。
        /// 如果原方法因为种族检查而返回 false，我们的补丁会介入，
        /// 检查Pawn是否是拥有萌螈血脉的渡鸦。如果是，则强制将结果改为 true。
        /// </summary>
        public static void IsMoeLotl_Postfix(Pawn pawn, ref bool __result)
        {
            if (__result || pawn == null) return;

            if (pawn.def == RavenDefOf.Raven_Race &&
                RavenRaceMod.Settings.enableMoeLotlCompat &&
                MoeLotlCompatUtility.HasMoeLotlBloodline(pawn))
            {
                __result = true;
            }
        }


        private static void ApplyMiscPatches(HarmonyLib.Harmony harmony)
        {
            if (readBookWorkType != null)
            {
                var mWorkTypeIsDisabled = AccessTools.Method(typeof(Pawn), "WorkTypeIsDisabled");
                if (mWorkTypeIsDisabled != null) harmony.Patch(mWorkTypeIsDisabled, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(WorkTypeIsDisabled_Postfix)) { priority = Priority.Last });
            }
            if (MoeLotlCompatUtility.MoeLotlSkillBookType != null)
            {
                var mCanReadBook = AccessTools.Method(MoeLotlCompatUtility.MoeLotlSkillBookType, "CanReadBook");
                if (mCanReadBook != null) harmony.Patch(mCanReadBook, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(CanReadBook_Postfix)) { priority = Priority.Last });
            }
            var mAddHediff = AccessTools.Method(typeof(Pawn_HealthTracker), "AddHediff", new Type[] { typeof(Hediff), typeof(BodyPartRecord), typeof(DamageInfo?), typeof(DamageWorker.DamageResult) });
            if (mAddHediff != null) harmony.Patch(mAddHediff, prefix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(AddHediff_Prefix)));
            if (MoeLotlCompatUtility.CompAxolotlEnergyType != null)
            {
                var mValidateTarget = AccessTools.Method(MoeLotlCompatUtility.CompAxolotlEnergyType, "ValidateTarget");
                if (mValidateTarget != null) harmony.Patch(mValidateTarget, postfix: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(ValidateTarget_Postfix)));
                var mGetGizmos = AccessTools.Method(MoeLotlCompatUtility.CompAxolotlEnergyType, "CompGetGizmosExtra");
                if (mGetGizmos != null) harmony.Patch(mGetGizmos, finalizer: new HarmonyMethod(typeof(Patch_MoeLotl_Compat), nameof(GetGizmos_Finalizer)));
            }
        }

        public static bool HediffCompWaterTreat_CompPostTick_Prefix(HediffComp __instance)
        {
            Pawn pawn = __instance.Pawn;
            if (pawn != null && pawn.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(pawn))
            {
                try
                {
                    if (pawn.Map != null && pawn.Position.GetTerrain(pawn.Map).IsWater)
                    {
                        foreach (Hediff hediff in pawn.health.hediffSet.hediffs)
                        {
                            if (hediff is Hediff_Injury injury && injury.CanHealNaturally())
                            {
                                if (__instance.parent.ageTicks % 60 == 0)
                                {
                                    injury.Heal(0.1f);
                                }
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    Log.ErrorOnce($"[RavenRace] Error in manual water treat logic for {pawn.LabelShort}: {ex}", 19283746);
                }
                return false;
            }
            return true;
        }

        #region Unchanged Methods
        public static void FloatMenuMakerMap_Postfix(List<Pawn> selectedPawns, Vector3 clickPos, ref List<FloatMenuOption> __result)
        {
            try
            {
                if (!MoeLotlCompatUtility.IsMoeLotlActive) return;
                if (selectedPawns == null || selectedPawns.Count != 1) return;
                Pawn pawn = selectedPawns[0];
                if (pawn.def.defName != "Raven_Race" || !MoeLotlCompatUtility.HasMoeLotlBloodline(pawn)) return;

                IntVec3 c = IntVec3.FromVector3(clickPos);
                if (!c.InBounds(pawn.Map)) return;

                List<Thing> things = c.GetThingList(pawn.Map);
                for (int i = 0; i < things.Count; i++)
                {
                    Thing t = things[i];
                    if (t.GetType() == MoeLotlCompatUtility.MoeLotlSkillBookType)
                    {
                        string label = "RavenRace_ForceReadBook".Translate(t.LabelShort);
                        if (!pawn.CanReach(t, PathEndMode.Touch, Danger.Deadly))
                        {
                            __result.Add(new FloatMenuOption(label + " (" + "NoPath".Translate() + ")", null));
                            continue;
                        }

                        ThingDef targetBookDef = MoeLotlCompatUtility.GetTargetReadBook(pawn);
                        if (RavenRaceMod.Settings.enableDebugMode)
                        {
                            string tName = targetBookDef?.defName ?? "NULL";
                            string cName = t.def.defName;
                            Log.Message($"[RavenRace] RightClick: Pawn={pawn.LabelShort}, TargetInComp={tName}, Clicked={cName}");
                        }

                        if (targetBookDef != t.def)
                        {
                            __result.Add(new FloatMenuOption(label + " (" + "RavenRace_WrongBook".Translate() + ")", null));
                            continue;
                        }

                        Action action = delegate
                        {
                            JobDef jobDef = DefDatabase<JobDef>.GetNamed("Axolotl_ReadMoeLotlQiSkillBooks");
                            Job job = JobMaker.MakeJob(jobDef, t);
                            pawn.jobs.TryTakeOrderedJob(job, JobTag.Misc);
                        };

                        __result.Add(FloatMenuUtility.DecoratePrioritizedTask(new FloatMenuOption(label, action), pawn, t));
                    }
                }
            }
            catch (Exception ex)
            {
                Log.ErrorOnce($"[RavenRace] Error in FloatMenuMakerMap Postfix: {ex}", 7384122);
            }
        }

        public static bool EnergyGainPerSec_Prefix(ThingComp __instance, ref float __result)
        {
            Pawn pawn = __instance.parent as Pawn;
            if (pawn != null && pawn.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(pawn))
            {
                float level = 0f;
                Hediff hediff = pawn.health.hediffSet.GetFirstHediffOfDef(MoeLotlCompatUtility.LotlQiHediffDef);
                if (hediff != null) level = hediff.Severity;
                float gainValue = 0.05f * level;
                var compCult = pawn.AllComps.FirstOrDefault(c => c.GetType() == MoeLotlCompatUtility.CompCultivationType);
                if (compCult != null)
                {
                    var pOffset = AccessTools.Property(MoeLotlCompatUtility.CompCultivationType, "LotlQiGainOffsets");
                    if (pOffset != null)
                    {
                        gainValue += (float)pOffset.GetValue(compCult, null);
                    }
                }
                float breathing = Mathf.Clamp(pawn.health.capacities.GetLevel(PawnCapacityDefOf.Breathing), 0.1f, 2.0f);
                gainValue *= breathing;
                gainValue *= 1.0f;
                __result = Mathf.Max(0, gainValue);
                return false;
            }
            return true;
        }

        public static bool SkillBook_GetFloatMenuOptions_Prefix(Pawn selPawn, ref IEnumerable<FloatMenuOption> __result)
        {
            if (selPawn != null && selPawn.def.defName == "Raven_Race")
            {
                __result = Enumerable.Empty<FloatMenuOption>();
                return false;
            }
            return true;
        }

        public static void CanBeUsedBy_Postfix(Pawn user, ref AcceptanceReport __result)
        {
            if (!__result.Accepted)
            {
                if (user != null && user.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(user))
                {
                    __result = true;
                }
            }
        }

        public static Exception GetGizmos_Finalizer(Exception __exception) { return null; }

        public static void AddHediff_Prefix(Pawn_HealthTracker __instance, Hediff hediff, ref BodyPartRecord part)
        {
            Pawn pawn = Traverse.Create(__instance).Field("pawn").GetValue<Pawn>();
            if (pawn != null && pawn.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(pawn))
            {
                if (hediff.def.defName.StartsWith("Axolotl_") && part == null)
                    part = pawn.RaceProps.body.corePart;
            }
        }

        public static void WorkTypeIsDisabled_Postfix(ref bool __result, Pawn __instance, WorkTypeDef w)
        {
            if (__result && w == readBookWorkType)
            {
                if (__instance != null && __instance.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(__instance)) __result = false;
            }
        }

        public static void CanReadBook_Postfix(object[] __args, ref bool __result)
        {
            if (__result) return;
            Pawn reader = __args[1] as Pawn;
            if (reader != null && reader.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(reader))
            {
                if (!reader.health.capacities.CapableOf(PawnCapacityDefOf.Sight)) return;
                __result = true;
                __args[2] = null;
            }
        }

        public static void ValidateTarget_Postfix(LocalTargetInfo target, ref bool __result)
        {
            if (__result) return;
            Pawn p = target.Pawn;
            if (p != null && p.def.defName == "Raven_Race" && MoeLotlCompatUtility.HasMoeLotlBloodline(p))
            {
                if (MoeLotlCompatUtility.LotlQiHediffDef != null && p.health.hediffSet.HasHediff(MoeLotlCompatUtility.LotlQiHediffDef))
                    __result = true;
            }
        }
        #endregion
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MoeLotl\Patch_MoeLotl_SaveLoad.cs
=
.
﻿using HarmonyLib;
using Verse;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using System.Linq;
using RimWorld;

namespace RavenRace.Compat.MoeLotl
{
    /// <summary>
    /// [编译修正版 V6] 萌螈修炼组件存读档补丁
    /// 修复重点：
    /// 1. 修正 GetComp 编译错误（改用 LINQ 查找）。
    /// 2. 修正 Scribe 反射。
    /// 3. 强制 Props 注入。
    /// 4. 在 PostLoadInit 阶段强制修复 Pawn 引用并执行技能初始化。
    /// </summary>
    [HarmonyPatch]
    public static class Patch_CompCultivation_PostExposeData
    {
        // 缓存反射获取的方法
        private static MethodInfo _lookListMethod;
        private static MethodInfo _lookDictMethod;

        // 目标：Axolotl.Comp_Cultivation.PostExposeData
        public static MethodBase TargetMethod()
        {
            if (!MoeLotlCompatUtility.IsMoeLotlActive) return null;
            return AccessTools.Method(MoeLotlCompatUtility.CompCultivationType, "PostExposeData");
        }

        public static bool Prefix(ThingComp __instance)
        {
            Pawn pawn = __instance.parent as Pawn;

            // 仅对混血渡鸦生效
            if (pawn == null || pawn.def != RavenDefOf.Raven_Race || !RavenRaceMod.Settings.enableMoeLotlCompat)
            {
                return true;
            }

            try
            {
                // [1] 修复动态组件 Props 丢失
                if (__instance.props == null && MoeLotlCompatUtility.CachedCultivationProps != null)
                {
                    __instance.Initialize(MoeLotlCompatUtility.CachedCultivationProps);
                }

                Traverse trav = Traverse.Create(__instance);

                // =========================================================
                // 数据保存/读取流程 (Scribe)
                // =========================================================

                // --- 1. AllLearnedSkills (List<MoeLotlQiSkill>) ---
                var allLearnedSkills = trav.Field("AllLearnedSkills").GetValue();
                if (allLearnedSkills == null)
                {
                    Type listType = typeof(List<>).MakeGenericType(AccessTools.TypeByName("Axolotl.MoeLotlQiSkill"));
                    allLearnedSkills = Activator.CreateInstance(listType);
                    trav.Field("AllLearnedSkills").SetValue(allLearnedSkills);
                }
                LookEx_List(ref allLearnedSkills, "Axolotl.MoeLotlQiSkill", "AllLearnedSkills", LookMode.Deep, new object[0]);
                trav.Field("AllLearnedSkills").SetValue(allLearnedSkills);

                // --- 2. TargetReadBook (ThingDef) ---
                var targetReadBook = trav.Field("TargetReadBook").GetValue<ThingDef>();
                Scribe_Defs.Look(ref targetReadBook, "TargetReadBook");
                trav.Field("TargetReadBook").SetValue(targetReadBook);

                // --- 3. KV_SkillLearningProgress (Dictionary<MoeLotlQiSkillDef, int>) ---
                var skillLearningProgress = trav.Field("KV_SkillLearningProgress").GetValue();
                LookEx_Dict(ref skillLearningProgress, "Axolotl.MoeLotlQiSkillDef", typeof(int), "KV_SkillLearningProgress", LookMode.Def, LookMode.Value);
                trav.Field("KV_SkillLearningProgress").SetValue(skillLearningProgress);

                // --- 4. KV_SkillLearningMax (Dictionary<MoeLotlQiSkillDef, int>) ---
                var skillLearningMax = trav.Field("KV_SkillLearningMax").GetValue();
                LookEx_Dict(ref skillLearningMax, "Axolotl.MoeLotlQiSkillDef", typeof(int), "KV_SkillLearningMax", LookMode.Def, LookMode.Value);
                trav.Field("KV_SkillLearningMax").SetValue(skillLearningMax);

                // --- 5. SkillInstallList (List<MoeLotlQiSkillDef>) ---
                var skillInstallList = trav.Field("SkillInstallList").GetValue();
                if (skillInstallList == null)
                {
                    Type listType = typeof(List<>).MakeGenericType(AccessTools.TypeByName("Axolotl.MoeLotlQiSkillDef"));
                    skillInstallList = Activator.CreateInstance(listType);
                    trav.Field("SkillInstallList").SetValue(skillInstallList);
                }
                LookEx_List(ref skillInstallList, "Axolotl.MoeLotlQiSkillDef", "SkillInstallList", LookMode.Def, null);
                trav.Field("SkillInstallList").SetValue(skillInstallList);


                // =========================================================
                // [核心修复] 载入后数据初始化
                // =========================================================
                if (Scribe.mode == LoadSaveMode.PostLoadInit || Scribe.mode == LoadSaveMode.LoadingVars)
                {
                    InitializeDataStructs(trav);

                    var skillsList = trav.Field("AllLearnedSkills").GetValue() as IList;
                    var installList = trav.Field("SkillInstallList").GetValue() as IList;

                    if (skillsList != null)
                    {
                        // 清理空元素
                        for (int i = skillsList.Count - 1; i >= 0; i--)
                        {
                            if (skillsList[i] == null) skillsList.RemoveAt(i);
                        }

                        foreach (var skill in skillsList)
                        {
                            if (skill != null)
                            {
                                Traverse st = Traverse.Create(skill);

                                // 1. 修复父引用
                                st.Field("pawn").SetValue(pawn);

                                // 2. 初始化组件与数值
                                try
                                {
                                    st.Method("InitializeComps").GetValue();
                                    st.Method("UpdateCurrentStatModifier").GetValue();
                                    st.Method("Notify_LevelChange").GetValue();

                                    // 3. 如果是已启用技能，触发启用通知
                                    Def skillDef = st.Field("def").GetValue<Def>();
                                    if (installList != null && installList.Contains(skillDef))
                                    {
                                        st.Method("Notify_InstallSkill").GetValue();
                                    }
                                }
                                catch
                                {
                                    // 忽略单个技能初始化错误
                                }
                            }
                        }
                    }

                    // [修复编译错误] 刷新护盾
                    // 原版 GetComp 不支持 Type 参数，必须使用 AllComps 查找
                    if (MoeLotlCompatUtility.CompAxolotlEnergyType != null)
                    {
                        ThingComp energyComp = pawn.AllComps.FirstOrDefault(c => c.GetType() == MoeLotlCompatUtility.CompAxolotlEnergyType);

                        if (energyComp != null)
                        {
                            // 通过反射调用 Action_UpdateLastDamageTick
                            Traverse.Create(energyComp).Method("Action_UpdateLastDamageTick").GetValue();
                            // 调用 AutoResetShield (这个方法会计算护盾值)
                            Traverse.Create(energyComp).Method("AutoResetShield").GetValue();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] MoeLotl Save/Load Patch Critical Error for {pawn.LabelShort}: {ex}");
                return false;
            }

            return false;
        }

        // ========================================================================
        // 反射逻辑
        // ========================================================================

        private static MethodInfo GetLookListMethod()
        {
            if (_lookListMethod != null) return _lookListMethod;

            var methods = typeof(Scribe_Collections).GetMethods(BindingFlags.Static | BindingFlags.Public);
            foreach (var m in methods)
            {
                if (m.Name != "Look" || !m.IsGenericMethodDefinition) continue;
                if (m.GetGenericArguments().Length != 1) continue;

                var pars = m.GetParameters();
                if (pars.Length == 4 &&
                    pars[0].ParameterType.IsByRef &&             // ref List<T>
                    pars[1].ParameterType == typeof(string) &&   // string label
                    pars[2].ParameterType == typeof(LookMode) && // LookMode
                    pars[3].ParameterType == typeof(object[]))   // params object[]
                {
                    _lookListMethod = m;
                    return m;
                }
            }
            return null;
        }

        private static MethodInfo GetLookDictMethod()
        {
            if (_lookDictMethod != null) return _lookDictMethod;

            var methods = typeof(Scribe_Collections).GetMethods(BindingFlags.Static | BindingFlags.Public);
            foreach (var m in methods)
            {
                if (m.Name != "Look" || !m.IsGenericMethodDefinition) continue;
                if (m.GetGenericArguments().Length != 2) continue;

                var pars = m.GetParameters();
                if (pars.Length == 4 &&
                    pars[0].ParameterType.IsByRef &&             // ref Dictionary<K,V>
                    pars[1].ParameterType == typeof(string) &&   // string label
                    pars[2].ParameterType == typeof(LookMode))   // LookMode key
                {
                    _lookDictMethod = m;
                    return m;
                }
            }
            return null;
        }

        private static void LookEx_List(ref object list, string typeName, string label, LookMode lookMode, object[] ctorArgs)
        {
            Type itemType = AccessTools.TypeByName(typeName);
            if (itemType == null) return;

            var methodDef = GetLookListMethod();
            if (methodDef == null) return;

            var method = methodDef.MakeGenericMethod(itemType);

            object[] args;
            if (methodDef.GetParameters().Length == 4)
            {
                args = new object[] { list, label, lookMode, ctorArgs ?? new object[0] };
            }
            else
            {
                args = new object[] { list, label, false, lookMode, ctorArgs ?? new object[0] };
            }

            try
            {
                method.Invoke(null, args);
                list = args[0];
            }
            catch (Exception ex)
            {
                Log.Warning($"[RavenRace] Scribe List invoke error: {ex.Message}");
            }
        }

        private static void LookEx_Dict(ref object dict, string keyTypeName, Type valueType, string label, LookMode keyLookMode, LookMode valueLookMode)
        {
            Type keyType = AccessTools.TypeByName(keyTypeName);
            if (keyType == null) return;

            var methodDef = GetLookDictMethod();
            if (methodDef == null) return;

            var method = methodDef.MakeGenericMethod(keyType, valueType);

            object[] args = new object[] { dict, label, keyLookMode, valueLookMode };

            try
            {
                method.Invoke(null, args);
                dict = args[0];
            }
            catch (Exception ex)
            {
                Log.Warning($"[RavenRace] Scribe Dict invoke error: {ex.Message}");
            }
        }

        private static void InitializeDataStructs(Traverse trav)
        {
            EnsureInstance(trav, "AllLearnedSkills", typeof(List<>), "Axolotl.MoeLotlQiSkill");
            EnsureInstance(trav, "KV_SkillLearningProgress", typeof(Dictionary<,>), "Axolotl.MoeLotlQiSkillDef", typeof(int));
            EnsureInstance(trav, "KV_SkillLearningMax", typeof(Dictionary<,>), "Axolotl.MoeLotlQiSkillDef", typeof(int));
            EnsureInstance(trav, "SkillInstallList", typeof(List<>), "Axolotl.MoeLotlQiSkillDef");
        }

        private static void EnsureInstance(Traverse trav, string fieldName, Type genericType, params object[] typeArgs)
        {
            if (trav.Field(fieldName).GetValue() == null)
            {
                Type[] types = new Type[typeArgs.Length];
                for (int i = 0; i < typeArgs.Length; i++)
                {
                    if (typeArgs[i] is string s) types[i] = AccessTools.TypeByName(s);
                    else types[i] = (Type)typeArgs[i];
                }
                trav.Field(fieldName).SetValue(Activator.CreateInstance(genericType.MakeGenericType(types)));
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MoeLotl\WorkGiver_RavenReadBook.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using Verse.AI;
using RimWorld;

namespace RavenRace.Compat.MoeLotl
{
    public class WorkGiver_RavenReadBook : WorkGiver_Scanner
    {
        public override PathEndMode PathEndMode => PathEndMode.Touch;
        public override ThingRequest PotentialWorkThingRequest => ThingRequest.ForUndefined();

        public override bool ShouldSkip(Pawn pawn, bool forced = false)
        {
            if (!MoeLotlCompatUtility.IsMoeLotlActive) return true;
            if (pawn.def.defName != "Raven_Race" || !MoeLotlCompatUtility.HasMoeLotlBloodline(pawn)) return true;

            return MoeLotlCompatUtility.GetTargetReadBook(pawn) == null;
        }

        public override IEnumerable<Thing> PotentialWorkThingsGlobal(Pawn pawn)
        {
            ThingDef targetDef = MoeLotlCompatUtility.GetTargetReadBook(pawn);
            if (targetDef == null) yield break;

            var books = pawn.Map.listerThings.ThingsOfDef(targetDef);
            foreach (var book in books)
            {
                if (!book.IsForbidden(pawn) && pawn.CanReach(book, PathEndMode.Touch, Danger.Deadly))
                {
                    yield return book;
                }
            }
        }

        public override bool HasJobOnThing(Pawn pawn, Thing t, bool forced = false)
        {
            if (t.IsForbidden(pawn)) return false;

            ThingDef targetDef = MoeLotlCompatUtility.GetTargetReadBook(pawn);
            if (t.def != targetDef) return false;

            if (!pawn.CanReserve(t, 1, -1, null, forced)) return false;

            return true;
        }

        public override Job JobOnThing(Pawn pawn, Thing t, bool forced = false)
        {
            JobDef jobDef = DefDatabase<JobDef>.GetNamedSilentFail("Axolotl_ReadMoeLotlQiSkillBooks");
            return jobDef == null ? null : JobMaker.MakeJob(jobDef, t);
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Moyo\MoyoCompatUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Reflection;
using Verse;
using RimWorld;
using HarmonyLib;
using System.Linq;
using RavenRace.Features.Bloodline; // [Added]

namespace RavenRace.Compat.Moyo
{
    [StaticConstructorOnStartup]
    public static class MoyoCompatUtility
    {
        public static bool IsMoyoActive { get; private set; }

        public static ThingDef MoyoRaceDef;
        public static ThingDef BlueSerumDef;
        public static JobDef HarvestJobDef;

        public static Type CompResourceHarvestableType;
        public static Type CompProperties_ResourceHarvestableType;
        public static Type ConstraintPawnAgeType;

        static MoyoCompatUtility()
        {
            try
            {
                MoyoRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Alien_Moyo");
                IsMoyoActive = (MoyoRaceDef != null);

                if (IsMoyoActive)
                {
                    BlueSerumDef = DefDatabase<ThingDef>.GetNamedSilentFail("BlueSerum");
                    HarvestJobDef = DefDatabase<JobDef>.GetNamedSilentFail("Moyo2_ExtractDeepBlue_Job");

                    CompResourceHarvestableType = AccessTools.TypeByName("Moyo2_HPF.CompResourceHarvestable");
                    CompProperties_ResourceHarvestableType = AccessTools.TypeByName("Moyo2_HPF.CompProperties_ResourceHarvestable");
                    ConstraintPawnAgeType = AccessTools.TypeByName("Moyo2_HPF.ConstraintPawnAge");

                    if (CompResourceHarvestableType == null)
                    {
                        Log.Warning("[RavenRace] Moyo mod detected but failed to find Moyo2_HPF classes. Compatibility disabled.");
                        IsMoyoActive = false;
                    }
                }
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Error initializing Moyo compatibility: {ex}");
                IsMoyoActive = false;
            }
        }

        public static bool HasMoyoBloodline(Pawn pawn)
        {
            if (pawn == null) return false;
            // [Change] Comp_Bloodline -> CompBloodline
            var comp = pawn.TryGetComp<CompBloodline>();
            if (comp != null && comp.BloodlineComposition != null)
            {
                if (comp.BloodlineComposition.ContainsKey("Alien_Moyo"))
                {
                    return comp.BloodlineComposition["Alien_Moyo"] > 0f;
                }
            }
            return false;
        }

        public static void GrantDeepBlueProduction(Pawn pawn)
        {
            if (!IsMoyoActive || pawn == null) return;

            try
            {
                if (pawn.AllComps.Any(c => c.GetType() == CompResourceHarvestableType)) return;

                object constraintObj = Activator.CreateInstance(ConstraintPawnAgeType);
                AccessTools.Field(ConstraintPawnAgeType, "age").SetValue(constraintObj, 7);
                object enumOver = Enum.ToObject(AccessTools.TypeByName("Moyo2_HPF.AgeCompareType"), 3);
                AccessTools.Field(ConstraintPawnAgeType, "compareType").SetValue(constraintObj, enumOver);

                CompProperties props = (CompProperties)Activator.CreateInstance(CompProperties_ResourceHarvestableType);

                AccessTools.Field(CompProperties_ResourceHarvestableType, "harvestJobDef").SetValue(props, HarvestJobDef);
                AccessTools.Field(CompProperties_ResourceHarvestableType, "thingDef").SetValue(props, BlueSerumDef);
                AccessTools.Field(CompProperties_ResourceHarvestableType, "intervalDays").SetValue(props, 8f);
                AccessTools.Field(CompProperties_ResourceHarvestableType, "amount").SetValue(props, 2);
                AccessTools.Field(CompProperties_ResourceHarvestableType, "translationKey").SetValue(props, "Moyo2_HPF_inspectText");
                AccessTools.Field(CompProperties_ResourceHarvestableType, "constraint").SetValue(props, constraintObj);

                ThingComp comp = (ThingComp)Activator.CreateInstance(CompResourceHarvestableType);
                comp.parent = pawn;
                comp.Initialize(props);

                pawn.AllComps.Add(comp);
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Failed to grant Deep Blue production to {pawn.LabelShort}: {ex}");
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Moyo\Patch_MoyoImmunity.cs
=
.
﻿using System;
using HarmonyLib;
using Verse;
using RimWorld;
using RavenRace.Compat.Moyo;

namespace RavenRace.Features.Hybridization.Harmony
{
    /// <summary>
    /// 处理 Moyo 深蓝成瘾免疫逻辑
    /// </summary>
    [HarmonyPatch]
    public static class Patch_MoyoImmunity
    {
        // 1. 拦截 Hediff 添加，如果是深蓝相关且为混血渡鸦，则阻止添加
        // 注意：AddHediff 的参数必须与原版方法签名完全匹配，或者使用 Harmony 的特殊参数
        [HarmonyPatch(typeof(Pawn_HealthTracker), "AddHediff", new Type[] { typeof(Hediff), typeof(BodyPartRecord), typeof(DamageInfo?), typeof(DamageWorker.DamageResult) })]
        [HarmonyPrefix]
        public static bool PreventDeepBlueAddiction(Pawn_HealthTracker __instance, Hediff hediff, Pawn ___pawn)
        {
            // 如果 Moyo 未加载，直接跳过
            if (!MoyoCompatUtility.IsMoyoActive) return true;

            if (hediff == null || hediff.def == null) return true;

            // 检查 DefName (硬编码检查，因为我们没有引用 Moyo DLL)
            string defName = hediff.def.defName;
            if (defName == "DeepBlueTolerance" || defName == "DeepBlueAddiction")
            {
                // 使用 Harmony 注入的 ___pawn 私有字段
                Pawn pawn = ___pawn;

                // 双重保险：如果注入失败 (极少见)，尝试通过 hediffSet 获取 (它是 public 的)
                if (pawn == null && __instance.hediffSet != null)
                    pawn = __instance.hediffSet.pawn;

                if (pawn != null && pawn.def.defName == "Raven_Race")
                {
                    // 检查血脉
                    if (RavenRaceMod.Settings.enableMoyoCompat && MoyoCompatUtility.HasMoyoBloodline(pawn))
                    {
                        // 混血渡鸦免疫深蓝成瘾和耐受，直接拦截 (返回 false)
                        return false;
                    }
                }
            }
            return true; // 继续执行原版逻辑
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MuGirl\CompRavenMilkable.cs
=
.
﻿using System;
using System.Collections.Generic;
using UnityEngine;
using Verse;
using RimWorld;

namespace RavenRace.Compat.MuGirl
{
    public class CompProperties_RavenMilkable : CompProperties
    {
        public ThingDef milkDef;
        public int milkAmount = 11;
        public float milkIntervalDays = 1f;
        public string displayStringKey = "RavenRace_MilkFullness";

        public CompProperties_RavenMilkable()
        {
            this.compClass = typeof(CompRavenMilkable);
        }
    }

    public class CompRavenMilkable : ThingComp
    {
        public CompProperties_RavenMilkable Props => (CompProperties_RavenMilkable)this.props;

        private float fullness = 0f;

        public float Fullness => fullness;
        public bool Active => true; // 只要添加了组件就生效，不分性别

        public override void PostExposeData()
        {
            base.PostExposeData();
            Scribe_Values.Look(ref fullness, "ravenMilkFullness", 0f);
        }

        public override void CompTick()
        {
            base.CompTick();
            Pawn pawn = this.parent as Pawn;
            if (pawn == null || pawn.Dead) return;

            float hungerFactor = 1f;
            if (pawn.needs?.food != null)
            {
                if (pawn.needs.food.Starving) hungerFactor = 0f;
            }

            float increase = (1f / (Props.milkIntervalDays * 60000f)) * hungerFactor;

            fullness += increase;
            if (fullness > 1f) fullness = 1f;
        }

        public override string CompInspectStringExtra()
        {
            if (!Active) return null;
            return Props.displayStringKey.Translate() + ": " + fullness.ToStringPercent();
        }

        public override IEnumerable<Gizmo> CompGetGizmosExtra()
        {
            if (fullness >= 0.95f)
            {
                yield return new Command_Action
                {
                    defaultLabel = "RavenRace_GatherMilk".Translate(),
                    defaultDesc = "RavenRace_GatherMilkDesc".Translate(),
                    icon = Props.milkDef?.uiIcon ?? BaseContent.BadTex,
                    action = () =>
                    {
                        GatherMilk(parent as Pawn);
                    }
                };
            }
        }

        public void GatherMilk(Pawn doer)
        {
            if (!Active || fullness < 0.01f) return;

            int amount = GenMath.RoundRandom(Props.milkAmount * fullness);
            if (amount > 0)
            {
                Thing milk = ThingMaker.MakeThing(Props.milkDef);
                milk.stackCount = amount;
                GenPlace.TryPlaceThing(milk, doer.Position, doer.Map, ThingPlaceMode.Near);

                Messages.Message("RavenRace_Msg_MilkGathered".Translate(doer.LabelShort, amount, milk.Label), doer, MessageTypeDefOf.PositiveEvent);
            }

            fullness = 0f;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MuGirl\JobDriver_RavenMuGirlCharge.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using Verse.AI;
using RimWorld;
using UnityEngine;
using RavenRace.Compat.Epona;
using Verse.Sound;

namespace RavenRace.Compat.MuGirl
{
    // ==========================================
    // 1. Ability Effect
    // ==========================================
    public class CompProperties_AbilityMuGirlCharge : CompProperties_AbilityEffect
    {
        public CompProperties_AbilityMuGirlCharge()
        {
            this.compClass = typeof(CompAbilityEffect_MuGirlCharge);
        }
    }

    public class CompAbilityEffect_MuGirlCharge : CompAbilityEffect
    {
        public override void Apply(LocalTargetInfo target, LocalTargetInfo dest)
        {
            base.Apply(target, dest);
            Pawn pawn = this.parent.pawn;
            if (pawn == null || target.Pawn == null) return;

            Job job = JobMaker.MakeJob(DefDatabase<JobDef>.GetNamed("Raven_Job_MuGirlCharge"), target.Pawn);
            job.ability = this.parent;
            pawn.jobs.TryTakeOrderedJob(job, JobTag.Misc);
        }

        public override bool Valid(LocalTargetInfo target, bool throwMessages = false)
        {
            if (!base.Valid(target, throwMessages)) return false;
            if (target.Pawn == null) return false;

            // [修改] 范围限制逻辑已移交给 Harmony Patch (Verb.Range)
            // 这里只需要检查基本的可达性即可

            if (!this.parent.pawn.CanReach(target, PathEndMode.Touch, Danger.Deadly))
            {
                if (throwMessages) Messages.Message("CannotReach".Translate(), MessageTypeDefOf.RejectInput, false);
                return false;
            }
            return true;
        }
    }

    // ==========================================
    // 2. Job Driver (保持原样，无需大改，确认逻辑即可)
    // ==========================================
    public class JobDriver_RavenMuGirlCharge : JobDriver
    {
        private const float SmallPawnThreshold = 1.0f;
        private HashSet<Pawn> hitPawns = new HashSet<Pawn>();
        private const int SmokeGenerationInterval = 3;
        private int ticksSinceSmokeGeneration = 0;
        private Hediff chargeHediff;
        private Hediff speedHediff;
        private bool isEponaEnhanced = false;

        public override bool TryMakePreToilReservations(bool errorOnFailed)
        {
            return pawn.Reserve(job.targetA, job, 1, -1, null, errorOnFailed);
        }

        public override void Notify_Starting()
        {
            base.Notify_Starting();
            if (RavenRaceMod.Settings.enableMuGirlCompat)
            {
                isEponaEnhanced = EponaCompatUtility.IsEponaActive && EponaCompatUtility.HasEponaBloodline(pawn);
            }
        }

        protected override IEnumerable<Toil> MakeNewToils()
        {
            Pawn target = job.targetA.Thing as Pawn;
            this.FailOnDestroyedOrNull(TargetIndex.A);
            this.FailOnDespawnedOrNull(TargetIndex.A);

            // Toil 1: 准备
            yield return new Toil
            {
                initAction = () =>
                {
                    if (MuGirlCompatUtility.MooGirl_Charge != null)
                    {
                        chargeHediff = HediffMaker.MakeHediff(MuGirlCompatUtility.MooGirl_Charge, pawn);
                        chargeHediff.Severity = isEponaEnhanced ? 1.0f : 0.5f;
                        pawn.health.AddHediff(chargeHediff);
                    }

                    if (isEponaEnhanced)
                    {
                        HediffDef velocityDef = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_ChargeVelocity");
                        if (velocityDef != null)
                        {
                            speedHediff = HediffMaker.MakeHediff(velocityDef, pawn);
                            speedHediff.Severity = 1.0f;
                            pawn.health.AddHediff(speedHediff);
                        }
                    }

                    GenerateSmokeBehindPawn();
                    SoundDef.Named("Pawn_Melee_BigBash_HitPawn")?.PlayOneShot(pawn);
                },
                defaultCompleteMode = ToilCompleteMode.Instant
            };

            // Toil 2: 移动
            Toil gotoToil = Toils_Goto.GotoThing(TargetIndex.A, PathEndMode.Touch);
            gotoToil.tickAction = () =>
            {
                float radius = isEponaEnhanced ? 4.0f : 1.9f;
                var nearbyPawns = GenRadial.RadialDistinctThingsAround(pawn.Position, pawn.Map, radius, true).OfType<Pawn>();

                foreach (Pawn p in nearbyPawns)
                {
                    if (p == pawn || p == target) continue;
                    if (hitPawns.Contains(p)) continue;
                    if (!p.HostileTo(pawn)) continue;

                    DamageInfo dinfo;
                    float dmgMult = isEponaEnhanced ? 2.0f : 1.0f;

                    if (p.BodySize < SmallPawnThreshold)
                        dinfo = new DamageInfo(DamageDefOf.Crush, Rand.Range(4f, 6f) * dmgMult, 0f, -1, pawn);
                    else
                        dinfo = new DamageInfo(DamageDefOf.Blunt, Rand.Range(2f, 4f) * dmgMult, 0f, -1, pawn);

                    p.TakeDamage(dinfo);
                    hitPawns.Add(p);

                    if (!p.Dead)
                    {
                        int flyDist = isEponaEnhanced ? 6 : 2;
                        Vector3 dir = (p.Position.ToVector3() - pawn.Position.ToVector3()).normalized;
                        IntVec3 flyDest = p.Position + (dir * flyDist).ToIntVec3();
                        DoKnockback(p, flyDest);
                        FleckMaker.ThrowMicroSparks(p.DrawPos, pawn.Map);
                    }
                }

                if (++ticksSinceSmokeGeneration >= SmokeGenerationInterval)
                {
                    ticksSinceSmokeGeneration = 0;
                    float smokeSize = isEponaEnhanced ? 3.0f : 1.5f;
                    FleckMaker.ThrowSmoke(pawn.DrawPos, pawn.Map, smokeSize);
                }
            };
            yield return gotoToil;

            // Toil 3: 终结
            Toil attack = new Toil
            {
                initAction = () =>
                {
                    if (chargeHediff != null) pawn.health.RemoveHediff(chargeHediff);
                    if (speedHediff != null) pawn.health.RemoveHediff(speedHediff);

                    if (target == null || !target.Spawned) return;

                    float finalDmg = isEponaEnhanced ? 100f : 40f;
                    target.TakeDamage(new DamageInfo(DamageDefOf.Cut, finalDmg, 2f, -1, pawn));

                    if (MuGirlCompatUtility.MooGirl_Stun != null)
                    {
                        target.health.AddHediff(MuGirlCompatUtility.MooGirl_Stun);
                    }

                    if (!target.Dead)
                    {
                        int flyDist = isEponaEnhanced ? 15 : 5;
                        Vector3 dir = (target.Position.ToVector3() - pawn.Position.ToVector3()).normalized;
                        IntVec3 flyDest = target.Position + (dir * flyDist).ToIntVec3();
                        DoKnockback(target, flyDest);
                    }
                },
                defaultCompleteMode = ToilCompleteMode.Instant
            };

            attack.AddFinishAction(() =>
            {
                if (job.ability != null)
                {
                    job.ability.StartCooldown(job.ability.def.cooldownTicksRange.RandomInRange);
                }
            });

            yield return attack;
        }

        private void GenerateSmokeBehindPawn()
        {
            if (job.targetA.Thing == null) return;
            Vector3 dir = (pawn.DrawPos - job.targetA.Thing.DrawPos).normalized;
            for (int i = 1; i <= 3; i++)
            {
                IntVec3 pos = pawn.Position + (dir * i).ToIntVec3();
                if (pos.InBounds(pawn.Map))
                    FleckMaker.ThrowSmoke(pos.ToVector3Shifted(), pawn.Map, Rand.Range(1.5f, 2.0f));
            }
        }

        private IntVec3 GetKnockbackDest(Pawn victim, float range)
        {
            Vector3 vect = (victim.Position - pawn.Position).ToVector3().Yto0().normalized * range;
            IntVec3 dest = victim.Position + vect.ToIntVec3();

            ShootLine shootLine = new ShootLine(victim.Position, dest);
            List<IntVec3> list = shootLine.Points().ToList();

            if (list.Count == 0) return victim.Position;

            Map map = pawn.Map;
            for (int i = 0; i < list.Count; i++)
            {
                if (!list[i].InBounds(map) || list[i].Impassable(map))
                {
                    return list[Mathf.Max(0, i - 1)];
                }
            }
            return dest;
        }

        private void DoKnockback(Pawn victim, IntVec3 destCell)
        {
            if (!destCell.InBounds(pawn.Map)) return;
            PawnFlyer flyer = PawnFlyer.MakeFlyer(ThingDefOf.PawnFlyer, victim, destCell, null, null, false);
            if (flyer != null)
            {
                FleckMaker.ThrowDustPuff(victim.Position.ToVector3Shifted() + Gen.RandomHorizontalVector(0.5f), pawn.Map, 2f);
                GenSpawn.Spawn(flyer, destCell, pawn.Map, WipeMode.Vanish);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_MuGirl\MuGirlCompatUtility.cs
=
.
﻿using System;
using System.Linq;
using Verse;
using RimWorld;
using RavenRace.Features.Bloodline; // [Added]

namespace RavenRace.Compat.MuGirl
{
    [StaticConstructorOnStartup]
    public static class MuGirlCompatUtility
    {
        public static bool IsMuGirlActive { get; private set; }

        public static ThingDef MuGirlRaceDef { get; private set; }
        public static ThingDef MuGirlMilkDef { get; private set; }
        public static HediffDef MuGirlBloodlineHediff { get; private set; }

        public static HediffDef MooGirl_Charge { get; private set; }
        public static HediffDef MooGirl_Stun { get; private set; }
        public static AbilityDef RavenChargeAbility { get; private set; }

        static MuGirlCompatUtility()
        {
            MuGirlRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("MooGirl");
            IsMuGirlActive = (MuGirlRaceDef != null);

            MuGirlMilkDef = DefDatabase<ThingDef>.GetNamedSilentFail("MooGirl_Milk");
            MuGirlBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Raven_Hediff_MuGirlBloodline");

            MooGirl_Charge = DefDatabase<HediffDef>.GetNamedSilentFail("MooGirl_Charge");
            MooGirl_Stun = DefDatabase<HediffDef>.GetNamedSilentFail("MooGirl_Stun");

            RavenChargeAbility = DefDatabase<AbilityDef>.GetNamedSilentFail("Raven_Ability_MuGirlCharge");

            if (IsMuGirlActive)
            {
                RavenModUtility.LogVerbose("[RavenRace] MooGirl detected. Compatibility active.");
            }
        }

        public static void HandleMuGirlBloodline(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null) return;
            if (MuGirlBloodlineHediff != null)
            {
                bool hasHediff = pawn.health.hediffSet.HasHediff(MuGirlBloodlineHediff);
                if (hasBloodline && !hasHediff) pawn.health.AddHediff(MuGirlBloodlineHediff);
                else if (!hasBloodline && hasHediff)
                {
                    Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(MuGirlBloodlineHediff);
                    if (h != null) pawn.health.RemoveHediff(h);
                }
            }
        }

        public static void EnsureMilkable(Pawn pawn)
        {
            if (pawn.TryGetComp<CompRavenMilkable>() != null) return;
            if (pawn.AllComps.Any(c => c.GetType().Name == "CompMooMilkable")) return;

            ThingDef product = MuGirlMilkDef ?? DefDatabase<ThingDef>.GetNamed("Milk");
            try
            {
                CompProperties_RavenMilkable props = new CompProperties_RavenMilkable
                {
                    milkDef = product,
                    milkAmount = 11,
                    milkIntervalDays = 1f,
                    displayStringKey = "RavenRace_MilkFullness"
                };
                CompRavenMilkable newComp = new CompRavenMilkable();
                newComp.parent = pawn;
                newComp.Initialize(props);
                pawn.AllComps.Add(newComp);
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] Failed to grant milkable ability to {pawn.LabelShort}: {ex}");
            }
        }

        // [Change] Comp_Bloodline -> CompBloodline
        public static bool HasMuGirlBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            return comp.BloodlineComposition.ContainsKey("MooGirl") && comp.BloodlineComposition["MooGirl"] > 0f;
        }

        public static void HandleChargeAbility(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || RavenChargeAbility == null) return;

            bool hasAbility = pawn.abilities.GetAbility(RavenChargeAbility) != null;

            if (hasBloodline && !hasAbility)
            {
                pawn.abilities.GainAbility(RavenChargeAbility);
            }
            else if (!hasBloodline && hasAbility)
            {
                pawn.abilities.RemoveAbility(RavenChargeAbility);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Tailin\TailinCompatUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Reflection;
using Verse;
using RimWorld;
using HarmonyLib;
using System.Linq;
using RavenRace.Features.Bloodline;

namespace RavenRace.Compat.Tailin
{
    [StaticConstructorOnStartup]
    public static class TailinCompatUtility
    {
        public static bool IsTailinActive { get; private set; }

        public static ThingDef TailinRaceDef { get; private set; }
        public static HediffDef TailinBloodlineHediff { get; private set; }

        static TailinCompatUtility()
        {
            try
            {
                TailinRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("TailinRace");
                IsTailinActive = (TailinRaceDef != null);
                TailinBloodlineHediff = DefDatabase<HediffDef>.GetNamedSilentFail("Tailin_CombatInstinct");

                if (IsTailinActive)
                {
                    Log.Message($"[RavenRace] 泰临补丁运行成功: ");
                }
            }
            catch (Exception ex)
            {
                Log.Error($"[RavenRace] 泰临补丁运行失败: {ex}");
                IsTailinActive = false;
            }
        }

        public static bool HasTailinBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            // 【核心修正】将 "Tailin" 改为正确的种族 DefName "TailinRace"
            return comp.BloodlineComposition.ContainsKey("TailinRace") && comp.BloodlineComposition["TailinRace"] > 0f;
        }

        public static void HandleTailinBloodline(Pawn pawn, bool hasBloodline)
        {
            if (pawn == null || pawn.health == null || TailinBloodlineHediff == null) return;

            bool hasHediff = pawn.health.hediffSet.HasHediff(TailinBloodlineHediff);

            // 如果应该有但没有，则添加
            if (hasBloodline && !hasHediff)
            {
                pawn.health.AddHediff(TailinBloodlineHediff);
            }
            // 如果不应该有但有，则移除
            else if (!hasBloodline && hasHediff)
            {
                Hediff hediff = pawn.health.hediffSet.GetFirstHediffOfDef(TailinBloodlineHediff);
                if (hediff != null)
                {
                    pawn.health.RemoveHediff(hediff);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Compat_Wolfein\WolfeinCompatUtility.cs
=
.
﻿using System;
using System.Linq;
using Verse;
using RimWorld;
using RavenRace.Features.Bloodline;
using HarmonyLib;

namespace RavenRace.Compat.Wolfein
{
    [StaticConstructorOnStartup]
    public static class WolfeinCompatUtility
    {
        public static bool IsWolfeinActive { get; private set; }
        public static ThingDef WolfeinRaceDef { get; private set; }

        private static Type WolfeinStrengthCompType;
        // 【核心修正】缓存沃芬原版的CompProperties实例
        private static CompProperties WolfeinStrengthCompProps;

        static WolfeinCompatUtility()
        {
            WolfeinRaceDef = DefDatabase<ThingDef>.GetNamedSilentFail("Wolfein_Race");
            IsWolfeinActive = (WolfeinRaceDef != null);

            if (IsWolfeinActive)
            {
                WolfeinStrengthCompType = AccessTools.TypeByName("Wolfein.CompWolfeinStrength");
                if (WolfeinStrengthCompType != null)
                {
                    // 【核心修正】在启动时，从Wolfein_Race的ThingDef中找到并缓存正确的CompProperties
                    WolfeinStrengthCompProps = WolfeinRaceDef.comps.FirstOrDefault(p => p.compClass == WolfeinStrengthCompType);

                    if (WolfeinStrengthCompProps == null)
                    {
                        Log.Warning("[RavenRace] Wolfein mod detected, but could not find CompProperties for 'Wolfein.CompWolfeinStrength'. Compatibility is disabled.");
                        IsWolfeinActive = false;
                    }
                }
                else
                {
                    Log.Warning("[RavenRace] Wolfein mod detected, but could not find 'Wolfein.CompWolfeinStrength' component. Compatibility is disabled.");
                    IsWolfeinActive = false;
                }
            }
        }

        public static void HandleWolfeinBloodline(Pawn pawn, bool hasBloodline)
        {
            // 【核心修正】添加对WolfeinStrengthCompProps的非空检查
            if (!IsWolfeinActive || pawn == null || WolfeinStrengthCompType == null || WolfeinStrengthCompProps == null) return;

            bool hasComp = pawn.AllComps.Any(c => c.GetType() == WolfeinStrengthCompType);

            if (hasBloodline && !hasComp)
            {
                try
                {
                    ThingComp newComp = (ThingComp)Activator.CreateInstance(WolfeinStrengthCompType);
                    newComp.parent = pawn;
                    pawn.AllComps.Add(newComp);

                    // 【核心修正】使用我们缓存的、完整的CompProperties实例来初始化组件
                    newComp.Initialize(WolfeinStrengthCompProps);

                    if (pawn.Spawned) newComp.PostSpawnSetup(false);
                }
                catch (Exception ex)
                {
                    Log.Error($"[RavenRace] Failed to dynamically add Wolfein strength component to {pawn.LabelShort}: {ex}");
                }
            }
            else if (!hasBloodline && hasComp)
            {
                pawn.AllComps.RemoveAll(c => c.GetType() == WolfeinStrengthCompType);
            }
        }

        public static bool HasWolfeinBloodline(CompBloodline comp)
        {
            if (comp == null || comp.BloodlineComposition == null) return false;
            return comp.BloodlineComposition.ContainsKey("Wolfein_Race") &&
                   comp.BloodlineComposition["Wolfein_Race"] > 0f;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Harmony\Patch_Ability_Enhanced.cs
=
.
﻿using System;
using System.Collections.Generic;
using HarmonyLib;
using RimWorld;
using Verse;
using RavenRace.Compat.MuGirl;

// 命名空间修正
namespace RavenRace.Features.Hybridization.Harmony
{
    [StaticConstructorOnStartup]
    public static class Patch_Ability_Enhanced
    {
        static Patch_Ability_Enhanced()
        {
            // CS0118 错误修正：使用完全限定名 HarmonyLib.Harmony
            HarmonyLib.Harmony harmony = new HarmonyLib.Harmony("ZuoYao.RavenRace.EponaEnhanced");

            var originalGizmo = AccessTools.Method(typeof(Ability), "GetGizmos");
            var postfixGizmo = AccessTools.Method(typeof(Patch_Ability_Enhanced), nameof(Postfix_GetGizmos));
            if (originalGizmo != null) harmony.Patch(originalGizmo, postfix: new HarmonyMethod(postfixGizmo));

            var originalRange = AccessTools.PropertyGetter(typeof(Verb), "Range");
            if (originalRange != null)
            {
                var postfixRange = AccessTools.Method(typeof(Patch_Ability_Enhanced), nameof(Postfix_GetRange));
                harmony.Patch(originalRange, postfix: new HarmonyMethod(postfixRange));
            }
        }

        public static IEnumerable<Gizmo> Postfix_GetGizmos(IEnumerable<Gizmo> __result, Ability __instance)
        {
            foreach (var gizmo in __result)
            {
                if (gizmo is Command_Ability cmd && __instance.def.defName == "Raven_Ability_MuGirlCharge")
                {
                    Pawn pawn = __instance.pawn;
                    if (RavenRaceMod.Settings.enableMuGirlCompat &&
                        Compat.Epona.EponaCompatUtility.IsEponaActive &&
                        Compat.Epona.EponaCompatUtility.HasEponaBloodline(pawn))
                    {
                        cmd.defaultLabel = "RavenRace_AbilityLabel_EnhancedCharge".Translate();
                        cmd.defaultDesc = "RavenRace_AbilityDesc_EnhancedCharge".Translate();
                    }
                }
                yield return gizmo;
            }
        }

        public static void Postfix_GetRange(Verb __instance, ref float __result)
        {
            if (__instance is Verb_CastAbility castVerb && castVerb.ability != null)
            {
                if (castVerb.ability.def.defName == "Raven_Ability_MuGirlCharge")
                {
                    Pawn pawn = castVerb.CasterPawn;
                    if (pawn != null &&
                        RavenRaceMod.Settings.enableMuGirlCompat &&
                        Compat.Epona.EponaCompatUtility.IsEponaActive &&
                        Compat.Epona.EponaCompatUtility.HasEponaBloodline(pawn))
                    {
                        __result = 35.9f;
                    }
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Harmony\Patch_Ability_GetGizmos.cs
=
.
﻿using System.Collections.Generic;
using HarmonyLib;
using RimWorld;
using Verse;
using RavenRace.Compat.Epona; // 引用

// 命名空间修正
namespace RavenRace.Features.Hybridization.Harmony
{
    [StaticConstructorOnStartup]
    public static class Patch_Ability_GetGizmos
    {
        static Patch_Ability_GetGizmos()
        {
            // CS0118 错误修正：使用完全限定名 HarmonyLib.Harmony
            HarmonyLib.Harmony harmony = new HarmonyLib.Harmony("ZuoYao.RavenRace.EponaCompat");
            var original = AccessTools.Method(typeof(Ability), "GetGizmos");
            var postfix = AccessTools.Method(typeof(Patch_Ability_GetGizmos), nameof(Postfix));

            if (original != null && postfix != null)
            {
                harmony.Patch(original, postfix: new HarmonyMethod(postfix));
                // if (Prefs.DevMode) Log.Message("[RavenRace] Epona Ability Gizmo Patch Applied.");
            }
        }

        public static IEnumerable<Gizmo> Postfix(IEnumerable<Gizmo> __result, Ability __instance)
        {
            foreach (var gizmo in __result)
            {
                if (gizmo is Command_Ability cmd && __instance.def.defName == "Raven_Ability_MuGirlCharge")
                {
                    Pawn pawn = __instance.pawn;

                    if (RavenRaceMod.Settings.enableMuGirlCompat &&
                        EponaCompatUtility.IsEponaActive &&
                        EponaCompatUtility.HasEponaBloodline(pawn))
                    {
                        cmd.defaultLabel = "RavenRace_AbilityLabel_EnhancedCharge".Translate();
                        cmd.defaultDesc = "RavenRace_AbilityDesc_EnhancedCharge".Translate();
                    }
                }
                yield return gizmo;
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Features\Hybridization\Harmony\Patch_Pawn_GetInspectTabs.cs
=
.
﻿using System.Collections.Generic;
using HarmonyLib;
using RimWorld;
using Verse;
using RavenRace.Compat.MoeLotl;

namespace RavenRace.Features.Hybridization.Harmony
{
    /// <summary>
    /// 动态为拥有萌螈血脉的渡鸦添加“修炼”标签页。
    /// 【最终修正版】
    /// 1. 补丁目标是声明虚方法的基类 Thing。
    /// 2. 方法内部安全地将 Thing 实例转换为 Pawn 进行逻辑判断。
    /// 3. 使用 [HarmonyPatch] 自动注册，无需在其他地方手动调用。
    /// </summary>
    [HarmonyPatch(typeof(Thing), "GetInspectTabs")]
    public static class Patch_Pawn_GetInspectTabs
    {
        [HarmonyPostfix]
        public static IEnumerable<InspectTabBase> Postfix(IEnumerable<InspectTabBase> __result, Thing __instance)
        {
            // 1. 首先，返回原版方法提供的所有标签页，这是必须的。
            foreach (var tab in __result)
            {
                yield return tab;
            }

            // 2. 检查实例是否是一个 Pawn，如果不是，则直接结束。
            if (__instance is Pawn pawn)
            {
                // 3. 对 Pawn 执行我们之前的逻辑
                // 确保只对我们的渡鸦族生效
                if (pawn.def.defName == "Raven_Race")
                {
                    // 检查设置、Mod激活状态和Pawn血脉
                    if (RavenRaceMod.Settings.enableMoeLotlCompat && MoeLotlCompatUtility.IsMoeLotlActive)
                    {
                        if (MoeLotlCompatUtility.HasMoeLotlBloodline(pawn))
                        {
                            // 从游戏缓存中获取共享的修炼ITab实例
                            // 这是正确且高效的方式
                            InspectTabBase moeLotlTab = InspectTabManager.GetSharedInstance(MoeLotlCompatUtility.ITabCultivationType);
                            if (moeLotlTab != null)
                            {
                                // 将它添加到返回的列表中，UI就会显示它
                                yield return moeLotlTab;
                            }
                        }
                    }
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\Patch_FactionManager.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Patch_FactionManager
    /// TODO: Implement this class
    /// </summary>
    public class Patch_FactionManager
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\Patch_GeneEditor.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Patch_GeneEditor
    /// TODO: Implement this class
    /// </summary>
    public class Patch_GeneEditor
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\Patch_RoyaltyTitles.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Patch_RoyaltyTitles
    /// TODO: Implement this class
    /// </summary>
    public class Patch_RoyaltyTitles
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\Patch_ShadowStep_AI.cs
=
.
﻿using HarmonyLib;
using Verse;
using RimWorld;
using Verse.AI;
using RavenRace.Features.UniqueEquipment.ShadowCloak;

namespace RavenRace.HarmonyPatches
{
    [HarmonyPatch(typeof(JobGiver_AIFightEnemy), "TryGiveJob")]
    public static class Patch_ShadowStep_AI
    {
        [HarmonyPrefix]
        public static bool Prefix(Pawn pawn, ref Job __result)
        {
            // 如果有影步 Buff，禁止 AI 自动索敌
            if (pawn.health != null &&
                ShadowCloakDefOf.Raven_Hediff_ShadowStep != null &&
                pawn.health.hediffSet.HasHediff(ShadowCloakDefOf.Raven_Hediff_ShadowStep))
            {
                __result = null;
                return false; // 拦截原方法
            }
            return true;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\Patch_Temperature.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Patch_Temperature
    /// TODO: Implement this class
    /// </summary>
    public class Patch_Temperature
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\Patch_TradePrice.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Patch_TradePrice
    /// TODO: Implement this class
    /// </summary>
    public class Patch_TradePrice
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\PawnGraphicsPatch.cs
=
.
﻿using HarmonyLib;
using Verse;

namespace RavenRace.Harmony
{
    /// <summary>
    /// 渡鸦族Pawn图形初始化修复补丁
    /// 作用：在Pawn生成到地图上时，强制刷新其所有图形，解决中途加入游戏时可能出现的贴图加载失败（红字）问题。
    /// </summary>
    [HarmonyPatch(typeof(Pawn), nameof(Pawn.SpawnSetup))]
    public static class PawnGraphicsPatch
    {
        [HarmonyPostfix]
        public static void Postfix(Pawn __instance, bool respawningAfterLoad)
        {
            // 在生成Pawn后执行 (非从存档加载时)
            if (!respawningAfterLoad && __instance != null && __instance.def == RavenDefOf.Raven_Race)
            {
                // 安全检查
                if (__instance.Drawer?.renderer != null)
                {
                    // 强制渲染器重新计算和加载该Pawn的所有贴图
                    __instance.Drawer.renderer.SetAllGraphicsDirty();
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Harmony\RavenWallColorPatch.cs
=
.
﻿using System;
using System.Collections.Generic;
using HarmonyLib;
using UnityEngine;
using Verse;
using RimWorld;
using RavenRace.Buildings;

namespace RavenRace.Harmony
{
    /// <summary>
    /// 染色禁用扩展：标记建筑不接受 Stuff 染色。
    /// </summary>
    public class RavenStuffColorDisableExtension : DefModExtension
    {
        public bool disableStuffColor = true;
    }

    /// <summary>
    /// 渡鸦结构逻辑中心。
    /// 职责：劫持 DrawColor 确保贴图不发黑/不透明；劫持 SpawningWipes 确保墙体互盖。
    /// </summary>
    [HarmonyPatch]
    public static class RavenWallColorPatch
    {
        private static Dictionary<ThingDef, bool> cachedResults = new Dictionary<ThingDef, bool>();

        // 1. 颜色补丁
        [HarmonyPatch(typeof(Thing), "get_DrawColor")]
        [HarmonyPostfix]
        public static void DrawColorPostfix(Thing __instance, ref Color __result)
        {
            if (__instance.def == null) return;

            if (ShouldDisableStuffColor(__instance.def))
            {
                // 锁定为纯白，使渲染器直接显示 PNG 贴图原本的像素颜色
                __result = Color.white;
            }
        }

        private static bool ShouldDisableStuffColor(ThingDef def)
        {
            if (cachedResults.TryGetValue(def, out bool result)) return result;

            var ext = def.GetModExtension<RavenStuffColorDisableExtension>();
            bool disable = (ext != null && ext.disableStuffColor) || (def.defName == "Raven_Wall");

            cachedResults[def] = disable;
            return disable;
        }

        public static void ClearCache() => cachedResults.Clear();

        // 2. 覆盖建造补丁
        [HarmonyPatch(typeof(GenSpawn), "SpawningWipes")]
        [HarmonyPrefix]
        public static bool SpawningWipesPrefix(ref bool __result, BuildableDef newEntDef, BuildableDef oldEntDef)
        {
            ThingDef newDef = newEntDef as ThingDef;
            ThingDef oldDef = oldEntDef as ThingDef;

            if (newDef == null || oldDef == null) return true;

            ThingDef newBuiltDef = GenConstruct.BuiltDefOf(newDef) as ThingDef;
            ThingDef oldBuiltDef = GenConstruct.BuiltDefOf(oldDef) as ThingDef;

            if (newBuiltDef == null || oldBuiltDef == null) return true;

            bool newIsWall = newBuiltDef == ThingDefOf.Wall || newBuiltDef.thingClass == typeof(RavenWall_Building);
            bool oldIsWall = oldBuiltDef == ThingDefOf.Wall || oldBuiltDef.thingClass == typeof(RavenWall_Building);

            if (newIsWall && oldIsWall)
            {
                __result = true;
                return false;
            }

            return true;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\IngestionOutcomeDoer_EmberBlood.cs
=
.
﻿using Verse;
using RimWorld;
using UnityEngine;
using RavenRace.Features.Bloodline;

namespace RavenRace
{
    public class IngestionOutcomeDoer_EmberBlood : IngestionOutcomeDoer
    {
        protected override void DoIngestionOutcomeSpecial(Pawn pawn, Thing ingested, int ingestedCount)
        {
            float deathChance = RavenRaceMod.Settings.emberBloodDeathChance;
            float berserkChance = RavenRaceMod.Settings.emberBloodBerserkChance;
            float roll = Rand.Value;

            Map map = pawn.Map;
            Vector3 drawPos = pawn.DrawPos;

            if (roll < deathChance)
            {
                Find.LetterStack.ReceiveLetter(
                    "注射失败：死亡",
                    $"{pawn.LabelShort} 无法承受余烬之血的力量，血管爆裂而亡！",
                    LetterDefOf.Death,
                    new TargetInfo(pawn.Position, map)
                );
                if (map != null) MoteMaker.ThrowText(drawPos, map, "☠", 5f);
                DamageInfo dinfo = new DamageInfo(DamageDefOf.ExecutionCut, 99999f, 999f, -1f, null, pawn.RaceProps.body.corePart);
                pawn.Kill(dinfo);
            }
            else if (roll < deathChance + berserkChance)
            {
                Messages.Message($"{pawn.LabelShort} 被狂暴的力量吞噬了理智！", pawn, MessageTypeDefOf.NegativeEvent);
                pawn.mindState.mentalStateHandler.TryStartMentalState(MentalStateDefOf.Berserk, "余烬侵蚀", true);
            }
            else
            {
                var comp = pawn.TryGetComp<CompBloodline>();
                if (comp != null)
                {
                    float gain = 0.1f;
                    comp.GoldenCrowConcentration += gain;
                    Messages.Message($"{pawn.LabelShort} 成功吸收了余烬之血，金乌血脉得到了纯化 (+{gain:P0})。", pawn, MessageTypeDefOf.PositiveEvent);

                    comp.RefreshAbilities();
                    pawn.Drawer?.renderer?.SetAllGraphicsDirty();
                }
                else
                {
                    Messages.Message($"{pawn.LabelShort} 没有任何反应 (非血脉持有者)。", pawn, MessageTypeDefOf.NeutralEvent);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Comps\CompRavenFeatherDrop.cs
=
.
﻿using System;
using Verse;
using RimWorld;
using UnityEngine;
using System.Text;

namespace RavenRace
{
    public class CompProperties_RavenFeatherDrop : CompProperties
    {
        public CompProperties_RavenFeatherDrop()
        {
            this.compClass = typeof(CompRavenFeatherDrop);
        }
    }

    public class CompRavenFeatherDrop : ThingComp
    {
        // 冷却 Tick 记录 (保存的是 下一次可触发的绝对Tick)
        private int cooldownMood = -99999;
        private int cooldownDowned = -99999;
        private int cooldownBirth = -99999;

        // 使用 Settings 中的动态冷却
        private int CooldownTicks => (int)(RavenRaceMod.Settings.featherCooldownDays * 60000f);

        public Pawn Pawn => (Pawn)parent;

        public override void PostExposeData()
        {
            base.PostExposeData();
            Scribe_Values.Look(ref cooldownMood, "cooldownMood", -99999);
            Scribe_Values.Look(ref cooldownDowned, "cooldownDowned", -99999);
            Scribe_Values.Look(ref cooldownBirth, "cooldownBirth", -99999);
        }

        public override void CompTickRare()
        {
            base.CompTickRare();
            if (!Pawn.Spawned || Pawn.Dead) return;
            // 只有冷却结束后才检查逻辑
            if (Find.TickManager.TicksGame < cooldownMood) return;
            if (Pawn.needs?.mood == null) return;

            float mood = Pawn.needs.mood.CurLevel;
            float threshold = RavenRaceMod.Settings.featherDropMoodThreshold;
            float chance = RavenRaceMod.Settings.featherDropChance;

            bool trigger = false;
            string reason = "";

            if (mood < threshold && Rand.Chance(chance))
            {
                trigger = true;
                reason = "HugeGrief";
            }
            else if (mood > (1f - threshold) && Rand.Chance(chance))
            {
                trigger = true;
                reason = "HugeJoy";
            }

            if (trigger)
            {
                DoDrop("Mood", reason, ref cooldownMood);
            }
        }

        public void Notify_MentalBreak()
        {
            if (Find.TickManager.TicksGame < cooldownMood) return;
            DoDrop("Mood", "MentalBreak", ref cooldownMood);
        }

        public void HandleDownedEvent()
        {
            if (Find.TickManager.TicksGame < cooldownDowned) return;
            float healthPct = Pawn.health.summaryHealth.SummaryHealthPercent;
            bool extremePain = Pawn.health.hediffSet.PainTotal > 0.8f;

            if (healthPct < 0.2f || extremePain)
            {
                DoDrop("Health", "NearDeath", ref cooldownDowned);
            }
        }

        public void Notify_Birth()
        {
            if (Find.TickManager.TicksGame < cooldownBirth) return;
            DoDrop("Birth", "NewLife", ref cooldownBirth);
        }

        private void DoDrop(string type, string reasonSuffix, ref int cooldownField)
        {
            if (!Pawn.Spawned) return;
            Thing feather = ThingMaker.MakeThing(ThingDef.Named("Raven_GoldenFeather"));
            feather.stackCount = 1;
            GenSpawn.Spawn(feather, Pawn.Position, Pawn.Map);
            FleckMaker.ThrowLightningGlow(Pawn.TrueCenter(), Pawn.Map, 1.5f);

            // 更新冷却时间
            cooldownField = Find.TickManager.TicksGame + CooldownTicks;

            string labelKey = $"RavenRace_LetterLabel_Feather_{type}";
            string textKey = $"RavenRace_LetterText_Feather_{reasonSuffix}";

            Find.LetterStack.ReceiveLetter(
                labelKey.Translate(),
                textKey.Translate(Pawn.LabelShort),
                LetterDefOf.NeutralEvent,
                new LookTargets(feather, Pawn)
            );
        }

        // [修复] 检查面板显示逻辑
        public override string CompInspectStringExtra()
        {
            // [修正] 完全移除 DevMode 判断，只看设置
            // 如果用户关闭了 "显示金羽冷却状态"，则返回 null，界面上不显示。
            if (!RavenRaceMod.Settings.showFeatherCooldown) return null;

            StringBuilder sb = new StringBuilder();
            sb.AppendLine("金羽冷却状态:");
            sb.AppendLine($"- 情绪: {GetCooldownStr(cooldownMood)}");
            sb.AppendLine($"- 濒死: {GetCooldownStr(cooldownDowned)}");
            sb.AppendLine($"- 新生: {GetCooldownStr(cooldownBirth)}");
            return sb.ToString().TrimEnd();
        }

        private string GetCooldownStr(int targetTick)
        {
            int remaining = targetTick - Find.TickManager.TicksGame;
            if (remaining <= 0) return "就绪"; // Ready
            return remaining.ToStringTicksToPeriod();
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Comps\CompRavenInfusion.cs
=
.
﻿using UnityEngine;
using Verse;
using RimWorld;

namespace RavenRace.Items.Comps
{
    public class CompProperties_RavenInfusion : CompProperties
    {
        public CompProperties_RavenInfusion() => this.compClass = typeof(CompRavenInfusion);
    }

    public class CompRavenInfusion : ThingComp
    {
        private int poisonCharges = 0;

        public int PoisonCharges
        {
            get => poisonCharges;
            set => poisonCharges = Mathf.Max(0, value);
        }

        public bool IsPoisoned => poisonCharges > 0;

        public void AddCharges(int amount)
        {
            poisonCharges += amount;
        }

        public bool ConsumeCharge()
        {
            if (poisonCharges > 0)
            {
                poisonCharges--;
                return true;
            }
            return false;
        }

        public override void PostExposeData()
        {
            base.PostExposeData();
            Scribe_Values.Look(ref poisonCharges, "ravenPoisonCharges", 0);
        }

        // 修改武器名称 (类似 Infusion)
        public override string TransformLabel(string label)
        {
            if (IsPoisoned)
            {
                return $"{label} (淬毒)";
            }
            return label;
        }

        // 在检查面板显示信息
        public override string CompInspectStringExtra()
        {
            if (IsPoisoned)
            {
                return $"<color=#FF69B4>催情毒素: {poisonCharges} 次</color>";
            }
            return null;
        }

        public override void PostSplitOff(Thing other)
        {
            base.PostSplitOff(other);
            if (other is ThingWithComps twc)
            {
                var otherComp = twc.GetComp<CompRavenInfusion>();
                if (otherComp != null)
                {
                    otherComp.poisonCharges = this.poisonCharges;
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Comps\CompTargetable_RavenPoison.cs
=
.
﻿using System.Collections.Generic;
using Verse;
using RimWorld;

namespace RavenRace.Items.Comps
{
    public class CompProperties_TargetableRavenPoison : CompProperties_Targetable
    {
        public CompProperties_TargetableRavenPoison() => this.compClass = typeof(CompTargetable_RavenPoison);
    }

    public class CompTargetable_RavenPoison : CompTargetable
    {
        protected override bool PlayerChoosesTarget => true;

        protected override TargetingParameters GetTargetingParameters()
        {
            // 允许选择 Pawn (持有人) 或 Thing (地上的武器)
            return new TargetingParameters
            {
                canTargetPawns = true,
                canTargetItems = true,
                mapObjectTargetsMustBeAutoAttackable = false,
                validator = (TargetInfo t) =>
                {
                    // 1. 如果是地上的物品
                    if (t.Thing != null && t.Thing.def.IsMeleeWeapon) return true;

                    // 2. 如果是人，检查是否有近战武器
                    if (t.Thing is Pawn p && p.equipment?.Primary != null && p.equipment.Primary.def.IsMeleeWeapon) return true;

                    return false;
                }
            };
        }

        public override IEnumerable<Thing> GetTargets(Thing targetChosenByPlayer = null)
        {
            yield return targetChosenByPlayer;
        }

        // 核心：把选中的 Pawn 转换为其武器
        public Thing GetWeaponFromTarget(Thing target)
        {
            if (target is Pawn p) return p.equipment?.Primary;
            return target;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Comps\CompTargetEffect_GainForceLovin.cs
=
.
﻿using Verse;
using RimWorld;

namespace RavenRace.Items.Comps
{
    /// <summary>
    /// 使用物品后赋予“强制求爱”技能的效果组件。
    /// </summary>
    public class CompTargetEffect_GainForceLovin : CompTargetEffect
    {
        /// <summary>
        /// 对目标执行效果。
        /// </summary>
        /// <param name="user">使用者 (这里不重要)</param>
        /// <param name="target">被选择的目标 Pawn</param>
        public override void DoEffectOn(Pawn user, Thing target)
        {
            // 确保目标是 Pawn
            if (target is Pawn targetPawn)
            {
                // 检查 Pawn 是否有能力组件
                if (targetPawn.abilities == null)
                {
                    Messages.Message($"{targetPawn.LabelShortCap} 无法学习任何技能。", MessageTypeDefOf.RejectInput);
                    return;
                }

                // 检查是否已经有该技能
                if (targetPawn.abilities.GetAbility(RavenDefOf.Raven_Ability_ForceLovin) != null)
                {
                    Messages.Message($"{targetPawn.LabelShortCap} 已经掌握了这项技能。", MessageTypeDefOf.RejectInput);
                    return;
                }

                // 赋予技能
                targetPawn.abilities.GainAbility(RavenDefOf.Raven_Ability_ForceLovin);

                // 显示反馈信息
                Messages.Message($"{targetPawn.LabelShortCap} 学习并掌握了“强制求爱”技能！", targetPawn, MessageTypeDefOf.PositiveEvent);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Comps\CompUseEffect_RavenCoatWeapon.cs
=
.
﻿using Verse;
using RimWorld;
using UnityEngine;
using Verse.Sound;

namespace RavenRace.Items.Comps
{
    // ==========================================
    // 1. CompProperties
    // ==========================================
    public class CompProperties_UseEffectRavenCoat : CompProperties_UseEffect
    {
        public CompProperties_UseEffectRavenCoat() => this.compClass = typeof(CompTargetEffect_RavenCoat);
    }

    // ==========================================
    // 2. CompUseEffect (空壳，用于兼容 XML 结构，如果不需要可以移除，但建议保留以防万一)
    // ==========================================
    // 注意：如果我们直接用 CompTargetEffect，其实不需要这个 UseEffect 类。
    // 但为了防止之前的引用报错，或者如果你在 XML 里用了这个类名，保留它作为一个空的 UseEffect。
    // 如果 XML 里写的是 <compClass>RavenRace.Items.Comps.CompTargetEffect_RavenCoat</compClass>，那这个类就不需要了。
    // 为了稳妥，我不定义这个类名以免冲突，直接用下面的 TargetEffect。

    // ==========================================
    // 3. CompTargetEffect (核心逻辑)
    // ==========================================
    public class CompTargetEffect_RavenCoat : CompTargetEffect
    {
        public override void DoEffectOn(Pawn user, Thing target)
        {
            // 解析目标：如果是人，取武器
            Thing weapon = target;
            if (target is Pawn p) weapon = p.equipment?.Primary;

            // 基础检查
            if (weapon == null || !weapon.def.IsMeleeWeapon)
            {
                Messages.Message("目标无效：必须是近战武器或持有近战武器的人。", user, MessageTypeDefOf.RejectInput);
                return;
            }

            // [核心修复] 尝试获取或添加组件
            var comp = weapon.TryGetComp<CompRavenInfusion>();

            // 兜底逻辑：如果真的没有组件，动态添加一个
            if (comp == null)
            {
                // [修复] 只有 ThingWithComps 才能加组件
                if (weapon is ThingWithComps twc)
                {
                    comp = new CompRavenInfusion();
                    comp.parent = twc;
                    // [修复] 访问 AllComps 需要是 ThingWithComps
                    twc.AllComps.Add(comp);
                    comp.Initialize(new CompProperties_RavenInfusion()); // 初始化一下 Props 比较好
                }
                else
                {
                    // 如果这把武器甚至不是 ThingWithComps (极少见，除非是原版极简物品)，那真的没法加
                    Messages.Message("错误：该武器不支持高级属性 (非复杂物品)", user, MessageTypeDefOf.RejectInput);
                    return;
                }
            }

            // 执行淬毒
            comp.AddCharges(20);

            // 特效与反馈
            FleckMaker.ThrowMetaIcon(weapon.PositionHeld, weapon.MapHeld, FleckDefOf.PsycastAreaEffect);
            SoundDefOf.MechSerumUsed.PlayOneShot(new TargetInfo(weapon.PositionHeld, weapon.MapHeld));

            Messages.Message("Raven_Message_WeaponCoated".Translate(parent.Label, weapon.LabelShort, 20), user, MessageTypeDefOf.PositiveEvent);
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Harmony\Patch_FeatherDrop.cs
=
.
﻿using HarmonyLib;
using Verse;
using Verse.AI;
using RimWorld;

namespace RavenRace
{
    // 拦截精神崩溃
    [HarmonyPatch(typeof(MentalStateHandler), "TryStartMentalState")]
    public static class Patch_MentalBreak_Feather
    {
        [HarmonyPostfix]
        public static void Postfix(MentalStateHandler __instance, bool __result, Pawn ___pawn)
        {
            // 只有崩溃成功才触发
            if (__result && ___pawn != null)
            {
                var comp = ___pawn.TryGetComp<CompRavenFeatherDrop>();
                comp?.Notify_MentalBreak();
            }
        }
    }

    // 拦截倒地
    [HarmonyPatch(typeof(Pawn_HealthTracker), "MakeDowned")]
    public static class Patch_Downed_Feather
    {
        [HarmonyPostfix]
        public static void Postfix(Pawn_HealthTracker __instance, Pawn ___pawn)
        {
            // 倒地后触发
            if (___pawn != null && ___pawn.Downed)
            {
                var comp = ___pawn.TryGetComp<CompRavenFeatherDrop>();
                // [Fixed] 调用新方法名
                comp?.HandleDownedEvent();
            }
        }
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Harmony\Patch_PoisonWeapon_Hit.cs
=
.
﻿using HarmonyLib;
using Verse;
using RimWorld;
using UnityEngine;
using RavenRace.Items.Comps;

namespace RavenRace.Items.Harmony
{
    [HarmonyPatch(typeof(Verb_MeleeAttackDamage), "ApplyMeleeDamageToTarget")]
    public static class Patch_PoisonWeapon_Hit
    {
        [HarmonyPostfix]
        public static void Postfix(Verb_MeleeAttackDamage __instance, LocalTargetInfo target)
        {
            Pawn victim = target.Thing as Pawn;
            Thing weapon = __instance.EquipmentSource;
            if (victim == null || weapon == null) return;

            var comp = weapon.TryGetComp<CompRavenInfusion>();
            if (comp != null && comp.ConsumeCharge())
            {
                if (DefenseDefOf.RavenHediff_AphrodisiacEffect != null)
                {
                    HealthUtility.AdjustSeverity(victim, DefenseDefOf.RavenHediff_AphrodisiacEffect, 0.2f);
                    MoteMaker.ThrowText(victim.DrawPos, victim.Map, "Raven_Mote_Poisoned".Translate(), Color.magenta);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Harmony\Patch_WeaponInfusionInjection.cs
=
.
﻿using System.Collections.Generic;
using HarmonyLib;
using Verse;
using RavenRace.Items.Comps;

namespace RavenRace.Items.Harmony
{
    [StaticConstructorOnStartup]
    public static class Patch_WeaponInfusionInjection
    {
        static Patch_WeaponInfusionInjection()
        {
            InjectComps();
        }

        private static void InjectComps()
        {
            int count = 0;
            foreach (ThingDef def in DefDatabase<ThingDef>.AllDefs)
            {
                if (def.IsMeleeWeapon && !def.HasComp(typeof(CompRavenInfusion)))
                {
                    if (def.comps == null) def.comps = new List<CompProperties>();
                    def.comps.Add(new CompProperties_RavenInfusion());
                    count++;
                }
            }
             Log.Message($"[RavenRace] Injected CompRavenInfusion to {count} melee weapons.");
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Materials\Comp_EmberBlood.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Comp_EmberBlood
    /// TODO: Implement this class
    /// </summary>
    public class Comp_EmberBlood
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Materials\Comp_GoldenFeather.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Comp_GoldenFeather
    /// TODO: Implement this class
    /// </summary>
    public class Comp_GoldenFeather
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Materials\Comp_ShatteredCore.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Comp_ShatteredCore
    /// TODO: Implement this class
    /// </summary>
    public class Comp_ShatteredCore
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Recipes\Recipe_ExtractEmberBlood.cs
=
.
﻿using System.Collections.Generic;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// 提取余烬之血手术
    /// </summary>
    public class Recipe_ExtractEmberBlood : Recipe_Surgery
    {
        public override void ApplyOnPawn(Pawn pawn, BodyPartRecord part, Pawn billDoer, List<Thing> ingredients, Bill bill)
        {
            if (pawn.Dead) return;

            // 1. 生成余烬之血
            Thing blood = ThingMaker.MakeThing(ThingDef.Named("Raven_EmberBlood"));
            blood.stackCount = 1;
            GenPlace.TryPlaceThing(blood, billDoer.Position, billDoer.Map, ThingPlaceMode.Near);

            // 2. 发送信件 (使用 Death 信件类型，会有红色提示)
            Find.LetterStack.ReceiveLetter(
                "RavenRace_LetterLabel_EmberExtraction".Translate(),
                "RavenRace_LetterText_EmberExtraction".Translate(billDoer.LabelShort, pawn.LabelShort),
                LetterDefOf.Death,
                new LookTargets(billDoer, blood)
            );

            // 3. 处死受害者
            // 使用 ExecutionCut (处决) 伤害类型，99999伤害确保必死
            DamageInfo dinfo = new DamageInfo(DamageDefOf.ExecutionCut, 99999f, 999f, -1f, billDoer, pawn.RaceProps.body.corePart);
            pawn.TakeDamage(dinfo);

            if (!pawn.Dead) pawn.Kill(dinfo);
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Settings\MaterialSettings.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// MaterialSettings
    /// TODO: Implement this class
    /// </summary>
    public class MaterialSettings
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Weapons\CompHiddenBlade.cs
=
.
﻿using Verse;
using RimWorld;

namespace RavenRace
{
    public class CompProperties_HiddenBlade : CompProperties
    {
        public int ticksToPrep = 600;
        public HediffDef prepHediff;

        public CompProperties_HiddenBlade()
        {
            this.compClass = typeof(CompHiddenBlade);
        }
    }

    public class CompHiddenBlade : ThingComp
    {
        public CompProperties_HiddenBlade Props => (CompProperties_HiddenBlade)props;
        private int lastAttackTick = -9999;

        private Pawn Holder => (parent.ParentHolder is Pawn_EquipmentTracker tracker) ? tracker.pawn : null;

        public override void CompTick()
        {
            base.CompTick();
            if (!(this.parent.ParentHolder is Pawn_EquipmentTracker)) return;

            Pawn pawn = Holder;
            if (pawn == null || !pawn.Spawned || pawn.Dead || pawn.equipment?.Primary != parent)
            {
                RemoveBuff(pawn);
                return;
            }

            if (!pawn.health.hediffSet.HasHediff(Props.prepHediff))
            {
                if (Find.TickManager.TicksGame - lastAttackTick > Props.ticksToPrep)
                {
                    pawn.health.AddHediff(Props.prepHediff);
                    pawn.Drawer?.renderer?.SetAllGraphicsDirty(); // 核心修改：添加时标记为脏
                }
            }
        }

        public override void Notify_UsedWeapon(Pawn pawn)
        {
            base.Notify_UsedWeapon(pawn);
            lastAttackTick = Find.TickManager.TicksGame;
            RemoveBuff(pawn);
        }

        public override void Notify_Unequipped(Pawn pawn)
        {
            base.Notify_Unequipped(pawn);
            RemoveBuff(pawn);
        }

        private void RemoveBuff(Pawn pawn)
        {
            if (pawn == null || pawn.health == null) return;
            Hediff h = pawn.health.hediffSet.GetFirstHediffOfDef(Props.prepHediff);
            if (h != null)
            {
                pawn.health.RemoveHediff(h);
                pawn.Drawer?.renderer?.SetAllGraphicsDirty(); // 核心修改：移除时标记为脏
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Weapons\CompSteadyAim.cs
=
.
﻿using Verse;
using RimWorld;
using UnityEngine;

namespace RavenRace
{
    public class CompProperties_SteadyAim : CompProperties
    {
        public HediffDef aimHediff;
        public int ticksToStack = 120;

        public CompProperties_SteadyAim()
        {
            this.compClass = typeof(CompSteadyAim);
        }
    }

    public class CompSteadyAim : ThingComp
    {
        public CompProperties_SteadyAim Props => (CompProperties_SteadyAim)props;
        private int ticksNotMoving = 0;
        private IntVec3 lastPos = IntVec3.Invalid;

        private Pawn Holder => (parent.ParentHolder is Pawn_EquipmentTracker tracker) ? tracker.pawn : null;

        public override void CompTick()
        {
            base.CompTick();
            Pawn pawn = Holder;

            if (pawn == null || !pawn.Spawned || pawn.equipment?.Primary != parent)
            {
                if (pawn != null) RemoveHediff(pawn);
                return;
            }

            if (pawn.Position != lastPos)
            {
                ticksNotMoving = 0;
                RemoveHediff(pawn);
                lastPos = pawn.Position;
            }
            else
            {
                ticksNotMoving++;
                if (ticksNotMoving >= Props.ticksToStack)
                {
                    AddOrStackHediff(pawn);
                    ticksNotMoving = 0;
                }
            }
        }

        public override void Notify_Unequipped(Pawn pawn)
        {
            base.Notify_Unequipped(pawn);
            RemoveHediff(pawn);
            ticksNotMoving = 0;
            lastPos = IntVec3.Invalid;
        }

        private void RemoveHediff(Pawn p)
        {
            if (p == null || p.health == null) return;
            Hediff h = p.health.hediffSet.GetFirstHediffOfDef(Props.aimHediff);
            if (h != null)
            {
                p.health.RemoveHediff(h);
                p.Drawer?.renderer?.SetAllGraphicsDirty(); // 核心修改：移除时标记为脏
            }
        }

        private void AddOrStackHediff(Pawn p)
        {
            Hediff h = p.health.hediffSet.GetFirstHediffOfDef(Props.aimHediff);
            if (h == null)
            {
                h = p.health.AddHediff(Props.aimHediff);
                h.Severity = 0.1f;
            }
            else
            {
                if (h.Severity < 1.0f)
                {
                    h.Severity += 0.1f;
                }
            }
            p.Drawer?.renderer?.SetAllGraphicsDirty(); // 核心修改：添加或堆叠时标记为脏
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Items\Weapons\Projectile_BlowgunDart.cs
=
.
﻿using Verse;
using RimWorld;
using UnityEngine;

namespace RavenRace
{
    public class Projectile_BlowgunDart : Bullet
    {
        protected override void Impact(Thing hitThing, bool blockedByShield = false)
        {
            base.Impact(hitThing, blockedByShield);

            if (hitThing is Pawn hitPawn && !hitPawn.Dead)
            {
                HediffDef aphrodisiac = DefenseDefOf.RavenHediff_AphrodisiacEffect;
                if (aphrodisiac != null)
                {
                    // 施加 Buff
                    HealthUtility.AdjustSeverity(hitPawn, aphrodisiac, 0.5f);

                    // [修复] 使用 LabelCap 获取正确的翻译名称，而不是硬编码 Key
                    string hediffLabel = aphrodisiac.LabelCap;
                    MoteMaker.ThrowText(hitPawn.DrawPos, hitPawn.Map, hediffLabel, Color.magenta);
                }
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\obj\Debug\.NETFramework,Version=v4.8.AssemblyAttributes.cs
=
.
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETFramework,Version=v4.8", FrameworkDisplayName = ".NET Framework 4.8")]
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\obj\Debug\RavenRace.AssemblyInfo.cs
=
.
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("ZuoYao_RavenRace")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+2d0eb32bea14da9712004dff8e4dbe74daeb3809")]
[assembly: System.Reflection.AssemblyProductAttribute("ZuoYao_RavenRace")]
[assembly: System.Reflection.AssemblyTitleAttribute("ZuoYao_RavenRace")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// 由 MSBuild WriteCodeFragment 类生成。

.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\Incidents\Incident_RavenRescue.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Incident_RavenRescue
    /// TODO: Implement this class
    /// </summary>
    public class Incident_RavenRescue
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\Incidents\Incident_StrangeVisitor.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Incident_StrangeVisitor
    /// TODO: Implement this class
    /// </summary>
    public class Incident_StrangeVisitor
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\MainStory\MainStoryManager.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// MainStoryManager
    /// TODO: Implement this class
    /// </summary>
    public class MainStoryManager
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\MainStory\MainStoryState.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// MainStoryState
    /// TODO: Implement this class
    /// </summary>
    public class MainStoryState
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\Settings\QuestSettings.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// QuestSettings
    /// TODO: Implement this class
    /// </summary>
    public class QuestSettings
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\SideQuests\SideQuestGenerator.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// SideQuestGenerator
    /// TODO: Implement this class
    /// </summary>
    public class SideQuestGenerator
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Quests\SideQuests\SideQuestManager.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// SideQuestManager
    /// TODO: Implement this class
    /// </summary>
    public class SideQuestManager
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Race\CompRavenRace.cs
=
.
﻿using System;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace.Race
{
    public class CompProperties_RavenRace : CompProperties
    {
        public CompProperties_RavenRace()
        {
            this.compClass = typeof(CompRavenRace);
        }
    }

    /// <summary>
    /// 渡鸦族核心组件
    /// 职责：
    /// 1. 初始化种族特有的能力（如强制求爱）
    /// 2. 验证 Facial Animation 是否正确加载
    /// </summary>
    public class CompRavenRace : ThingComp
    {
        public override void PostSpawnSetup(bool respawningAfterLoad)
        {
            base.PostSpawnSetup(respawningAfterLoad);
            InitializeAbilities();

            // --- Facial Animation 调试检查 ---
            // 仅在生成时检查一次，确认组件是否注入成功
            if (!respawningAfterLoad && IsFacialAnimationActive())
            {
                CheckFAComponents();
            }
        }

        private void CheckFAComponents()
        {
            Pawn pawn = this.parent as Pawn;
            if (pawn == null) return;

            // 检查是否拥有 FA 的核心组件 HeadControllerComp
            bool hasFA = pawn.AllComps.Any(c => c.GetType().Name == "HeadControllerComp");

            if (!hasFA)
            {
                Log.Error($"[RavenRace] 严重错误: 检测到 Facial Animation 已启用，但渡鸦族({pawn.Name})身上缺少 FA 组件！请检查 Patch_Raven_FA_Components.xml 是否生效。");
            }
            else
            {
                if (RavenRaceMod.Settings.enableDebugMode)
                {
                    Log.Message($"[RavenRace] FA 组件检查通过: {pawn.Name} 已成功加载面部动画组件。");
                }
            }
        }

        private bool IsFacialAnimationActive()
        {
            return ModsConfig.IsActive("Nals.FacialAnimation") || ModsConfig.IsActive("2850854272");
        }

        /// <summary>
        /// 确保Pawn拥有种族固有的能力
        /// </summary>
        private void InitializeAbilities()
        {
            Pawn pawn = this.parent as Pawn;
            if (pawn == null || pawn.abilities == null) return;

            // 只有成年且有生理能力时才获得
            if (!pawn.ageTracker.Adult) return;

            AbilityDef forceLovinDef = RavenDefOf.Raven_Ability_ForceLovin;
            if (forceLovinDef == null) return;

            if (pawn.abilities.GetAbility(forceLovinDef) == null)
            {
                pawn.abilities.GainAbility(forceLovinDef);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Race\Comp_GoldenCrow.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// Comp_GoldenCrow
    /// TODO: Implement this class
    /// </summary>
    public class Comp_GoldenCrow
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Race\RavenPawnUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// RavenPawnUtility - 渡鸦族Pawn相关的工具方法
    /// 职责：
    /// - 判断一个Pawn是否为渡鸦族/金乌族
    /// - 获取Pawn的种族特定属性
    /// - 处理种族特定的Pawn行为
    /// - 翅膀状态和飞行能力检查
    /// </summary>
    public static class RavenPawnUtility
    {
        // [!!! 待实现 - 请勿删除此注释 !!!]
        // Phase 1将实现以下方法：
        // - IsRaven(Pawn pawn): 判断是否为渡鸦族
        // - IsGoldenCrow(Pawn pawn): 判断是否为金乌族
        // - HasWings(Pawn pawn): 判断是否拥有翅膀
        // - GetGoldenCrowConcentration(Pawn pawn): 获取金乌血脉浓度

        /// <summary>
        /// 判断一个Pawn是否为渡鸦族
        /// </summary>
        public static bool IsRaven(Pawn pawn)
        {
            // TODO: Phase 1实现
            return false;
        }

        /// <summary>
        /// 判断一个Pawn是否为金乌族（完全转化）
        /// </summary>
        public static bool IsGoldenCrow(Pawn pawn)
        {
            // TODO: Phase 2实现
            return false;
        }

        /// <summary>
        /// 判断一个Pawn是否拥有可用的翅膀
        /// </summary>
        public static bool HasFunctionalWings(Pawn pawn)
        {
            // TODO: Phase 1实现
            return false;
        }

        /// <summary>
        /// 获取Pawn的金乌血脉浓度（0-1）
        /// </summary>
        public static float GetGoldenCrowConcentration(Pawn pawn)
        {
            // TODO: Phase 3实现（血脉系统）
            return 0f;
        }

        /// <summary>
        /// 判断Pawn是否为渡鸦族或其杂交后代
        /// </summary>
        public static bool IsRavenOrHybrid(Pawn pawn)
        {
            // TODO: Phase 5实现（杂交系统）
            return IsRaven(pawn);
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Storyteller\StorytellerComp_RavenEvents.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// StorytellerComp_RavenEvents
    /// TODO: Implement this class
    /// </summary>
    public class StorytellerComp_RavenEvents
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Storyteller\StorytellerDef_Raven.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// StorytellerDef_Raven
    /// TODO: Implement this class
    /// </summary>
    public class StorytellerDef_Raven
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Things\Gas\RavenGas_BlackMist.cs
=
.
﻿using Verse;
using RimWorld;

namespace RavenRace.Things
{
    /// <summary>
    /// 黑灵烟雾实体类
    /// </summary>
    public class RavenGas_BlackMist : Gas
    {
        // 基础气体逻辑由 XML 定义，特殊效果由 Harmony Patch 实现
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Thoughts\ThoughtWorker_HediffBridges.cs
=
.
﻿using System;
using Verse;
using RimWorld;
using RavenRace.Features.UniqueWeapons.SpiritBeads; // 引用灵珠DefOf

namespace RavenRace.Thoughts
{
    // 1. 乐高之痛检测器
    public class ThoughtWorker_LegoPain : ThoughtWorker
    {
        protected override ThoughtState CurrentStateInternal(Pawn p)
        {
            if (p.health == null || p.health.hediffSet == null) return ThoughtState.Inactive;

            // 检查是否有乐高疼痛 Hediff
            if (DefenseDefOf.RavenHediff_LegoPain != null &&
                p.health.hediffSet.HasHediff(DefenseDefOf.RavenHediff_LegoPain))
            {
                return ThoughtState.ActiveAtStage(0);
            }
            return ThoughtState.Inactive;
        }
    }

    // 2. 跟腱断裂检测器
    public class ThoughtWorker_TendonCut : ThoughtWorker
    {
        protected override ThoughtState CurrentStateInternal(Pawn p)
        {
            if (p.health == null || p.health.hediffSet == null) return ThoughtState.Inactive;

            if (DefenseDefOf.RavenHediff_TendonCut != null &&
                p.health.hediffSet.HasHediff(DefenseDefOf.RavenHediff_TendonCut))
            {
                return ThoughtState.ActiveAtStage(0);
            }
            return ThoughtState.Inactive;
        }
    }

    // 3. 催情效果检测器
    public class ThoughtWorker_AphrodisiacEffect : ThoughtWorker
    {
        protected override ThoughtState CurrentStateInternal(Pawn p)
        {
            if (p.health == null || p.health.hediffSet == null) return ThoughtState.Inactive;

            // 只有严重程度 > 0.1 (aroused阶段) 才显示想法和表情
            if (DefenseDefOf.RavenHediff_AphrodisiacEffect != null)
            {
                Hediff h = p.health.hediffSet.GetFirstHediffOfDef(DefenseDefOf.RavenHediff_AphrodisiacEffect);
                if (h != null && h.Severity > 0.1f)
                {
                    return ThoughtState.ActiveAtStage(0);
                }
            }
            return ThoughtState.Inactive;
        }
    }

    // 4. 绝顶升天检测器
    public class ThoughtWorker_HighClimax : ThoughtWorker
    {
        protected override ThoughtState CurrentStateInternal(Pawn p)
        {
            if (p.health == null || p.health.hediffSet == null) return ThoughtState.Inactive;

            if (SpiritBeadsDefOf.Raven_Hediff_HighClimax != null &&
                p.health.hediffSet.HasHediff(SpiritBeadsDefOf.Raven_Hediff_HighClimax))
            {
                return ThoughtState.ActiveAtStage(0);
            }
            return ThoughtState.Inactive;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Utilities\BloodlineUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// BloodlineUtility - 血脉系统工具方法
    /// 职责：
    /// - 血脉浓度计算
    /// - 遗传规则处理
    /// - 血脉特性判定
    /// </summary>
    public static class BloodlineUtility
    {
        // [!!! 待实现 - 请勿删除此注释 !!!]
        // Phase 3（血脉系统）将实现以下方法：
        // - CalculateInheritedConcentration(父母浓度): 计算遗传浓度
        // - GetBloodlineTraits(Pawn): 获取血脉带来的特性
        // - CanMutate(Pawn): 判断是否可以发生血脉突变

        /// <summary>
        /// 计算两个父母的金乌血脉浓度遗传到后代的浓度
        /// </summary>
        public static float CalculateInheritedConcentration(float parent1Concentration, float parent2Concentration)
        {
            // TODO: Phase 3实现
            // 基础公式：(父浓度 + 母浓度) / 2 * 遗传强度系数
            return 0f;
        }

        /// <summary>
        /// 判断是否满足血脉突变条件
        /// </summary>
        public static bool CanMutate(Pawn pawn, float currentConcentration)
        {
            // TODO: Phase 3实现
            return false;
        }

        /// <summary>
        /// 应用血脉突变
        /// </summary>
        public static void ApplyMutation(Pawn pawn)
        {
            // TODO: Phase 3实现
        }

        /// <summary>
        /// 根据浓度获取血脉等级描述
        /// </summary>
        public static string GetConcentrationLabel(float concentration)
        {
            // TODO: Phase 3实现
            if (concentration >= 0.9f) return "BloodlineLevel_Pure".Translate();
            if (concentration >= 0.7f) return "BloodlineLevel_High".Translate();
            if (concentration >= 0.5f) return "BloodlineLevel_Medium".Translate();
            if (concentration >= 0.3f) return "BloodlineLevel_Low".Translate();
            if (concentration > 0f) return "BloodlineLevel_Trace".Translate();
            return "BloodlineLevel_None".Translate();
        }

        public static void EnsureBloodlineFloor(Dictionary<string, float> bloodlineComposition)
        {
            if (bloodlineComposition == null || bloodlineComposition.Count == 0) return;

            bool changed = false;
            float minThreshold = 0.01f;
            List<string> keys = bloodlineComposition.Keys.ToList();

            foreach (var key in keys)
            {
                if (bloodlineComposition[key] > 0f && bloodlineComposition[key] < minThreshold)
                {
                    bloodlineComposition[key] = minThreshold;
                    changed = true;
                }
            }

            if (changed)
            {
                float total = bloodlineComposition.Values.Sum();
                if (total > 0f)
                {
                    foreach (var key in keys)
                    {
                        bloodlineComposition[key] /= total;
                    }
                }
            }
        }






    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Utilities\DebugActions.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;
using LudeonTK;
using Verse.AI;
using RavenRace.Compat.MoeLotl;
using HarmonyLib;
using System.Reflection;
using RavenRace.Features.Operator;
using RavenRace.Features.Bloodline; // [Added]

namespace RavenRace
{
    public static class DebugActions
    {
        [DebugAction("渡鸦族", "设置浓度 (10%)", false, actionType = DebugActionType.ToolMapForPawns, allowedGameStates = AllowedGameStates.PlayingOnMap)]
        public static void SetConcentrationLow(Pawn p) => TrySetConcentration(p, 0.1f);

        [DebugAction("渡鸦族", "设置浓度 (50%)", false, actionType = DebugActionType.ToolMapForPawns, allowedGameStates = AllowedGameStates.PlayingOnMap)]
        public static void SetConcentrationMedium(Pawn p) => TrySetConcentration(p, 0.5f);

        [DebugAction("渡鸦族", "设置浓度 (90%)", false, actionType = DebugActionType.ToolMapForPawns, allowedGameStates = AllowedGameStates.PlayingOnMap)]
        public static void SetConcentrationHigh(Pawn p) => TrySetConcentration(p, 0.9f);

        [DebugAction("渡鸦族", "重置为纯血渡鸦", false, actionType = DebugActionType.ToolMapForPawns, allowedGameStates = AllowedGameStates.PlayingOnMap)]
        public static void ResetBloodline(Pawn p)
        {
            // [Change] Comp_Bloodline -> CompBloodline
            CompBloodline comp = p.TryGetComp<CompBloodline>();
            if (comp != null)
            {
                BloodlineManager.InitializePawnBloodline(p, comp);
                Messages.Message($"已将 {p.LabelShort} 的血脉重置为纯血渡鸦。", MessageTypeDefOf.TaskCompletion, false);
            }
        }

        [DebugAction("渡鸦族", "左爻：好感度+100", false, actionType = DebugActionType.Action, allowedGameStates = AllowedGameStates.PlayingOnMap)]
        public static void AddFavor()
        {
            Features.Operator.WorldComponent_OperatorManager.ChangeFavorability(100);
            Messages.Message("左爻好感度 +100", MessageTypeDefOf.TaskCompletion);
        }

        [DebugAction("渡鸦族", "左爻：设置好感度...", false, actionType = DebugActionType.Action, allowedGameStates = AllowedGameStates.PlayingOnMap)]
        public static void SetFavor()
        {
            List<DebugMenuOption> options = new List<DebugMenuOption>();
            for (int i = -1000; i <= 1000; i += 100)
            {
                int favor = i;
                options.Add(new DebugMenuOption(favor.ToString(), DebugMenuOptionMode.Action, () => {
                    var manager = Find.World.GetComponent<WorldComponent_OperatorManager>();
                    if (manager != null)
                    {
                        manager.zuoYaoFavorability = favor;
                        manager.GetType().GetMethod("CheckForNewRewards", BindingFlags.NonPublic | BindingFlags.Instance)?.Invoke(manager, new object[] { 0, favor });
                    }
                    Messages.Message($"左爻好感度已设置为: {favor}", MessageTypeDefOf.TaskCompletion);
                }));
            }
            Find.WindowStack.Add(new Dialog_DebugOptionListLister(options));
        }

        private static void TrySetConcentration(Pawn p, float value)
        {
            // [Change] Comp_Bloodline -> CompBloodline
            CompBloodline comp = p.TryGetComp<CompBloodline>();
            if (comp != null)
            {
                comp.GoldenCrowConcentration = value;
                Messages.Message($"已将 {p.LabelShort} 的金乌血脉浓度设置为 {value:P0}", MessageTypeDefOf.TaskCompletion, false);
            }
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Utilities\ModCompatUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// ModCompatUtility
    /// TODO: Implement this class
    /// </summary>
    public class ModCompatUtility
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Utilities\RavenModUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// RavenModUtility - 模组通用工具方法
    /// 职责：
    /// - 模组兼容性检查
    /// - 全局日志和调试工具
    /// - 资源加载和缓存
    /// - 通用数据转换
    /// </summary>
    public static class RavenModUtility
    {
        // [!!! 待实现 - 请勿删除此注释 !!!]
        // 以下方法将在各Phase中逐步实现

        /// <summary>
        /// 输出详细日志（仅在启用详细日志时）
        /// </summary>
        public static void LogVerbose(string message)
        {
            if (RavenRaceMod.Settings != null && RavenRaceMod.Settings.enableVerboseLogging)
            {
                Log.Message($"[RavenRace] {message}");
            }
        }

        /// <summary>
        /// 输出调试日志（仅在调试模式下）
        /// </summary>
        public static void LogDebug(string message)
        {
            if (RavenRaceMod.Settings != null && RavenRaceMod.Settings.enableDebugMode)
            {
                Log.Warning($"[RavenRace DEBUG] {message}");
            }
        }

        /// <summary>
        /// 检查是否安装了指定Mod
        /// </summary>
        public static bool IsModActive(string packageId)
        {
            return ModsConfig.IsActive(packageId);
        }

        /// <summary>
        /// 检查HAR是否已安装
        /// </summary>
        public static bool IsHARActive()
        {
            return IsModActive("erdelf.HumanoidAlienRaces");
        }

        /// <summary>
        /// 获取安全的浮点数（避免NaN和Infinity）
        /// </summary>
        public static float SafeFloat(float value, float defaultValue = 0f)
        {
            if (float.IsNaN(value) || float.IsInfinity(value))
            {
                LogDebug($"Invalid float value detected: {value}, using default: {defaultValue}");
                return defaultValue;
            }
            return value;
        }

        /// <summary>
        /// 将百分比转换为0-1的浮点数
        /// </summary>
        public static float PercentToFloat(float percent)
        {
            return SafeFloat(percent / 100f);
        }

        /// <summary>
        /// 将0-1的浮点数转换为百分比
        /// </summary>
        public static float FloatToPercent(float value)
        {
            return SafeFloat(value * 100f);
        }

        /// <summary>
        /// 获取随机权重选择的索引
        /// </summary>
        public static int GetWeightedRandomIndex(List<float> weights)
        {
            if (weights == null || weights.Count == 0)
            {
                return -1;
            }

            float totalWeight = weights.Sum();
            if (totalWeight <= 0f)
            {
                return 0;
            }

            float randomValue = UnityEngine.Random.Range(0f, totalWeight);
            float currentWeight = 0f;

            for (int i = 0; i < weights.Count; i++)
            {
                currentWeight += weights[i];
                if (randomValue <= currentWeight)
                {
                    return i;
                }
            }

            return weights.Count - 1;
        }
    }
}.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Utilities\TextureUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// TextureUtility
    /// TODO: Implement this class
    /// </summary>
    public class TextureUtility
    {
        // TODO: Add implementation
    }
}
.
.
=
File: C:\Users\Administrator\Desktop\RavenRace\ZuoYao_RavenRace\Source\RavenRace\Utilities\UIUtility.cs
=
.
﻿using System;
using System.Collections.Generic;
using System.Linq;
using Verse;
using RimWorld;

namespace RavenRace
{
    /// <summary>
    /// UIUtility
    /// TODO: Implement this class
    /// </summary>
    public class UIUtility
    {
        // TODO: Add implementation
    }
}
.
.
